{"version":3,"sources":["system/redux/reducer.tsx","system/utils/theoryUtils.tsx","system/utils/backingUtil.tsx","system/utils/instrumentsUtil.tsx","system/utils/melodyUtil.tsx","system/utils/systemConst.tsx","system/redux/dispatcher/dispatcher.tsx","system/redux/store/state/dataHistory.tsx","system/redux/store/store.tsx","system/redux/store/userEnv.tsx","system/base/design/thema/themaColorNormal.tsx","system/contents/dialog/sysModalDialog.tsx","system/base/components/tab/channelPane.tsx","system/base/components/tab/tabbedPane.tsx","system/base/design/styles.tsx","system/contents/score/manage/scoreBuilder.tsx","system/contents/score/manage/manageTab.tsx","system/contents/score/edit/harmonize/input/symbolEditor.tsx","system/contents/score/edit/harmonize/elements/calc/calcChord.tsx","system/contents/score/edit/harmonize/elements/calc/calcSection.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailChange.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailChord.tsx","system/contents/score/edit/harmonize/elements/elementFixedBorder.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailInit.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailSection.tsx","system/contents/score/edit/harmonize/elements/calc/calcChange.tsx","system/contents/score/edit/harmonize/elements/scoreElement.tsx","system/contents/score/edit/harmonize/harmNote.tsx","system/utils/harmonizeUtil.tsx","system/contents/score/edit/harmonize/input/noteInput.tsx","system/contents/score/edit/harmonize/input/noteBasicInput.tsx","system/contents/score/edit/harmonize/input/backingEditorInput.tsx","system/contents/score/edit/harmonize/side/sideFormChord.tsx","system/contents/score/edit/harmonize/side/sideFormInit.tsx","system/contents/score/edit/harmonize/side/sideFormSection.tsx","system/contents/score/edit/harmonize/side/noteSideForm.tsx","system/contents/score/edit/harmonize/measure/harmMeasure.tsx","system/contents/score/edit/harmonize/info/chordInfo.tsx","system/contents/score/edit/harmonize/initial/initialBeat.tsx","system/contents/backing/pattern/builder/patternLength.tsx","system/contents/backing/pattern/builder/patternTable.tsx","system/contents/backing/pattern/builder/patternVelocity.tsx","system/contents/backing/pattern/builder/patternBuilder.tsx","system/contents/backing/pattern/channel/channelItem.tsx","system/contents/backing/pattern/channel/patternChannel.tsx","system/contents/backing/pattern/patternStatus.tsx","system/contents/backing/pattern/patternFrame.tsx","system/contents/backing/voicing/voicingChooser.tsx","system/contents/backing/backingEditorFrame.tsx","system/contents/score/edit/harmonize/harmHideFrame.tsx","system/contents/score/edit/harmonize/harmonizeFrame.tsx","system/contents/score/edit/harmonize/harmSections.tsx","system/contents/score/edit/melody/melodyTimeline.tsx","system/contents/score/edit/melody/melodyPitchList.tsx","system/contents/score/edit/melody/item/instrumentSwitch.tsx","system/contents/score/edit/melody/item/quantizeSwitch.tsx","system/contents/score/edit/melody/item/controlButton.tsx","system/contents/score/edit/melody/melodyHeader.tsx","system/contents/score/edit/melody/util/melodyMouseOperation.tsx","system/contents/score/edit/harmonize/input/melodyInput.tsx","system/contents/score/edit/melody/melodyFrame.tsx","system/contents/score/edit/editTab.tsx","system/contents/score/scoreChannel.tsx","system/contents/setting/settingChannel.tsx","system/contents/perform/performChannel.tsx","system/contents/entry/mainFrame.tsx","system/contents/entry/splash.tsx","system/contents/entry/totalHeader.tsx","system/contents/entry/systemEntry.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["ActionType","SCALE_INDEX","ROOT_ALL","index","isFlat","DEGREE12_FLAT_LIST","DEGREE12_SHARP_LIST","getDegreeRoot","props","KEY12_FLAT_LIST","KEY12_SHARP_LIST","getChordRoot","baseKeyIndex","KEY12_MAJOR_SCALE_LIST","KEY12_MINOR_SCALE_LIST","SYMBOL_LIST","key","name","base","structs","attr","IntervalRelationProps","DIATONIC_MAJOR_SCALE_LIST","root","symbolKey","DIATONIC_MAJOR_SCALE_DEGREE_NAMES","getSymbolFromKey","ret","find","symbol","undefined","getSymbolDerives","list","forEach","push","reducer","store","action","type","payload","SET_SYSTEM_STATE","systemState","SET_SCORE_STATE","scoreState","SET_SCORE_DATA","scoreData","SET_TUNE_STATE","melodyState","tuneState","SET_REFS","refs","SET_INSTRUMENTS","instruments","SET_BACKING_STATE","backingState","SET_RESERVE_TASKS","reserveTasks","SET_INVALIDATE","invalidate","getDefaultBacking","voicingList","struct","octave","pattern","divCount","Array","fill","table","channels","i","length","j","structIndex","editorPattern","channelSize","layers","layer","divs","noteDivList","signals","record","cell","x","y","status","notesList","vels","velocityList","slice","voicingStructs","size","channel","reverse","scoreLayers","console","log","JSON","stringify","scoreLayer","notes","rootIndex","map","item","interval","bpm","backing","pitchIndexList","chordTime","soundName","Math","floor","playHarmony","startTimeList","total","div","normal","rate","isDot","div3","startTime","sustainTime","gain","setTimeout","state","dispatcher","harmony","stop","isPreview","id","clearInterval","setState","getLimitLen","chordInfo","minute","beatLen","head","tail","getTotalLenFromDivs","reduce","prev","cur","len","checkOverlapBackLayer","hasError","limitLen","totalLen","layerIndex","channelIndex","divIndex","baseLayer","backLayer","getDivRange","left","right","isOverlap","backLeft","backRight","BackingUtil","getKeyIndexFromPitcher","PITCH_MAX","getNormalizeLenFromNotes","len4","len8","len16","len4div3","len8div3","getAdditionNotsLen","notes1","notes2","getSortetdNotesLen","len8div3Cnt3","len8div3Cnt2","len4div3Cnt3","len16Cnt2","len8Cnt2","getNotesLenFromQuantize","quantize","count","getMinimumLenUnit","playSoundfont","keyIndex","instrument","soundfontPlayer","play","duration","soundFullName","alert","stopPreview","focusIndex","lastFocus","distIndex","sampler","releaseAll","tune","adjustScrollX","previewHarmony","start","cacheList","elementCacheList","chordList","init","detail","cache","element","pastSecond","pitchList","getPitchListFromVoicing","playBacking","mouseState","curChord","previewCurHarmony","TUNE_PITCH_WIDTH","TUNE_PITCH_HEIGHT","PATTERN_HEADER_HEIGHT","PATTERN_BODY_HEIGHT","NOTES_1BAR_WIDTH","Dispatcher","dispatch","system","switchSplashToMain","isSplash","setMainTabIndex","mainChannelIndex","setRefs","setReserveTasks","setInvalidate","score","setPiano","setScoreTabIndex","scoreTabIndex","setScoreState","setKeySwitch","keySwitch","setScoreData","moveElement","isNext","sub","moveSection","curSectionIndex","sectionNo","sectionCacheList","curSectionInfo","curElementType","rangeIndexStart","rangeIndexEnd","incrementDegreeRoot","isUp","data","includes","incrementBeatLen","incrementMinuteVal","pos","isTail","value","target","incrementMinuteValRelation","nearIndex","addChordElement","initialBeat","on","splice","addSectionElement","labelName","addChangeElement","changeType","modulateRelation","domminantValue","keyAdjust","tempoRelation","tempoDiff","tempoRate","tempoAbsolute","beatSignature","removeCurElement","wrapRef","reffers","wrap","body","style","opacity","overflow","width","clientWidth","incrementSymbol","setDiatonicChord","scaleIndex","chord","setDefaultBacking","cloneBacking","parse","pastBacking","toNext","mng","symbolMng","curLine","toBase","parentLine","toDerive","childrenLine","allSelect","setNotesList","setInstrument","incrementCurNoteKey","isUpper","mode","scaleIndexies","prevPitchIndex","pitchIndex","tempPitchIndex","adjustScrollY","moveFocus","updateCurChord","moveDistFocus","beatWidth","searchedChord","addNotes","newLeftNormal","nextNormalPos","newRightNormal","removeNotes","delNum","releaseRange","end","resizeNotes","isSpread","curLenNormal","curNormalRight","resizeNormal","moveNotes","isBehind","prevNormalRight","nextNormalLeft","moveNormal","curNormalLeft","firstNotes","melody","notesX","scrollTo","behavior","notesY","top","clientHeight","previewStart","firstTime","pitch","time","isSolo","copyNotes","focusStart","num","cloneNotesList","baseUnit","unit","useUnit","normalPos","pasteNotes","newLeft","pastList","pastLast","concat","sort","a","b","posA","posB","openBackingEditor","hideMenu","voicingTable","getInitVoicingTable","patternProps","buildChannels","lenIndex","isUsePedal","getChannels","convertEditorLayerFromScore","closeBackingEditor","getInitialLayer","col","isExist","voicing","mappingEditorToScore","editor","getVoicingListFromTable","buildPatternProps","addPatternColumn","lenList","newLen","column","updateErrorState","movePatternColumn","isRight","tempIndex","moveChannelIndex","isDown","setCurrentDivRate","toggleCurrentDivHalf","getNotes","setNotes","incrementVel","after","deleteColumn","changeLayer","testBacking","checkError","this","DataHistory","manager","initialStore","userEnv","keyConfig","note","prevElement","nextElement","prevSection","nextSection","addChord","addSection","addChange","deleteCur","editMode","incRoot","decRoot","incBeat","decBeat","symbolMode","colorProps","entryBackground","dialogMode","isTune","isPut","lock","prevRight","nextLeft","notesState","side","isResize","isMove","mousePitchIndex","mouseMeasurePos","soundfontInfo","scaleMode","resize","move","shift","control","dataHistory","getInitialData","Sampler","toDestination","harmonize","measure","harmoniizeInvalidate","SysModalDialog","useContext","GlobalContext","isDisplay","_Blind","_Frame","styled","ChannelPane","useState","activeNo","setActiveNo","useEffect","_LabelList","tabElements","tab","icon","isActive","isDisable","disable","selectTab","selectTabIndex","_ContList","cont","ChannelLabel","_Item","onClick","_Icon","_Label","ChannelContents","_Contents","css","TabbedPane","TabLabel","_TabLabel","TabContents","_CSS_LABEL_MIDIUM","_CSS_DISABLE","ScoreBuilder","curIndex","addChordDiatonic","getScoreData","fixed","ManageTab","source","setSource","_Wrap","_Left","_Link","scale","timeSignature","builder","_Right","_Source","onChange","e","_ButtonsDiv","_Button","textarea","SymbolEditor","curSymbol","baseSymbol","derives","parentJsx","curJsx","childrenJsx","_Header","_Row","CalcChord","symbolName","chordRoot","bar","prevCache","isError","beat","chordName","_Detail","_Chord","_Pos","_Section","_Beat","_PastSecond","round","ELEMENT_POS_INFO_WIDTH","CalcSection","curSection","barSum","beatSum","barRem","_Len","_Border","ElementDetailChange","_Type","ElementDetailChord","degreeRoot","degreeOn","useMemo","_Degree","isSwitch","isCurrent","scaleRelation","isOnChordScale","_DegreeRoot","_DegreeSymbol","_DegreeOnChord","_Tip","jsxList","lenType","valueType","abs","_TipItem","_Voicing","_Pattern","_Backing","ElementFixedBorder","ElementDetailInit","_Title","_Value","_Record","ElementDetailSection","CalcChange","ScoreElement","useRef","bodyRef","current","isFocus","isSameSection","chordDetail","ref","isSelectable","isInactive","isChord","_Head","_CurKey","_Form","isAnytime","_Operations","_OperationItem","ELEMENT_HEAD_WIDTH","ELEMENT_OPERATIONS_WIDTH","HarmNote","_Note","HarmonizeUtil","update","clearTimeout","NoteKeyDown","config","isElement","Number","NoteBasicInput","signal","timing","velAdj","backingEditorInput","NoteKeySwitch","isPress","SideFormChord","beatItemsJsx","_BeatItem","rootItemsJsx","isRootActive","isOnActive","_RootItem","isDiatonic","onContextMenu","symbolItemsJsx","_SymbolItem","_Timing","_LabelBeat","_Minute","_LabelMinute","_MinuteItem","isReverse","step","min","max","_Root","_Symbol","input","SideFormInit","scaleItemJsxList","_ScaleItem","keyItemJsxList","_KeyItem","rateItemJsxList","_RateItem","_LabelTitle","_ScaleWrap","_KeyWrap","_TempoWrap","currentTarget","valueAsNumber","_RateWrap","SideFormSection","setLabelName","templateItemJsxList","indexOf","_TemplateItem","numberItemJsxList","toString","_NumberItem","_DirectText","_TemplateFrame","_NumberFrame","_ItemBase","NoteSideForm","HarmMeasure","dataList","curBeatJsx","prevBeatJsx","nextBeatJsx","curMinuteJsx","prevMinuteJsx","nextMinuteJsx","memoriJsxList","prevIndex","nextIndex","temp","add","sustain","adjust","bean","height","color","_Memori","_Bar","_Prev","_Start","_Cur","_Next","_Blocks","_Measure","BEAT_WIDTH","ChordInfo","scaleList","structJsxList","tipJsxList","relation","getIntervalValues","_InfoItem","isScale","isUse","isBlack","_Struct","WIDTH","InitialBeatTip","_WrapTip","PatternLength","itemJsxList","isEdit","PatternTable","channelCount","curLayer","layerJsxList","jsxLsit","notesJsxLsit","k","setNotesStatus","_Notes","isBack","_State","isEven","isFront","jsx","_Layer","zIndex","PatternVelocity","vel","PatternBuilder","useTotalLen","isLenOverError","_LengthDiv","_MeasureDiv","_MemoriList","_ChordLenLine","_OverCover","_Body","_Footer","ChannelItem","_Option","isEnable","initialCellArray","getInitialRecord","PatternChannel","channelJsxList","soundIndex","_LayerItem","proops","PatternStatus","createItem","callback","createRateItem","String","setRate","sizeJsxList","CHANNEL_MAX","_ListItem","lenModeJsx","_WrapLen","_List","prevSize","newSize","delCnt","selectedCell","editModeJsx","_WrapEdit","select","option","PatternFrame","isUsePattern","_UseSwitch","_Main","_StatusDiv","_MainDiv","_ChannelDiv","_BuilderDiv","PATTERN_OPERATION_HEIGHT","VoicingChooser","voicingLaneJsxList","channelLimitNum","OCTAVE_NUM","STRUCT_NUM","isSelected","chordIndex","_VoicingItem","isOver","soundfont","_VoicingLane","relationJsxList","_Relation","_Info","TIP_WIDTH","BackingEditorFrame","_PrevireBrind","_FooterDiv","HarmHideFrame","isOpen","isBackingEnable","HarmonizeTab","focus","prevBeat","totalBeat","prevMinute","totalMinute","sectionBeatSum","beatRate","getBeatRate","tabIndex","onKeyDown","onKeyUp","_Middle","_Foot","_TIMELINE_WRAP","_INFO_WRAP","HARMONIZE_HEAD_WIDTH","HarmSections","sections","curSectionNo","section","_Total","MelodyTimeline","measureRef","chordRef","barLength","timelineLength","measureJsxList","barJsx","_Scale","isHead","chordJsxList","symbolNmae","degreeName","_ChordItem","_DegreeName","_ChordName","_ChordWrap","_MousePos","span","MelodyPitchList","pitchItemJsxList","structIndexList","getOctaveName","_PitchItem","isStruct","_OctaveWrap","_OctaveItem","_PitchWrap","InstrumentSwitch","info","Soundfont","AudioContext","release","then","soundFontPlayer","QuantizeSwitch","ControlButton","MelodyHeader","_OperationDiv","_QuantizeSelector","_Control","_InstrumentSelector","MelodyMouseOperation","mouseDownEvent","button","mouse","getNextLeft","next","rect","getBoundingClientRect","clientX","scrollLeft","clientY","scrollTop","mouseMoveEvent","curPos","posX","lenWidth","prevFocus","mouseUpEvent","MelodyInput","keyDownEvent","isSingle","keySwitchEvent","MelodyFrame","tableRef","pitchRef","barCount","scaleLineJsxList","_ScaleLine","isBase","notesJsxList","scroll","notesLeft","focusEnd","unitPos","unitLen","_NotesWrap","isOctave","_Timeline","_Pitch","_TableWrap","onScroll","_TableMeasure","_TablePitch","_TableNotes","onMouseDown","onMouseMove","onMouseUp","_Test","editAnimation","keyframes","EditTab","switchMode","preview","toggleEnsamble","_Mode","_ModeItem","_Buttons","_Switch","_SwitchInner","_SECTIONS","ScoreChannel","isAccept","SCORE_TAB_MARGIN","SettingChannel","PerformChannel","createLane","label","items","degree","degreeRootName","chordRootName","triggerAttack","_Lane","_Box","MainFrame","MAIN_FRAME_MARGIN","Splash","setSwitch","timerId","setTimerId","fadeIn","TotalHeader","_ACCENT","_NORMAL","_Menu","_LoginButton","_Language","_MenuItem","TOTAL_HEADER_WIDTH","createContext","SystemEntry","useReducer","Provider","App","document","oncontextmenu","window","addEventListener","keyCode","preventDefault","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.84b8a08d.chunk.js","sourcesContent":["import { Store } from \"./store/store\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum ActionType {\r\n    SET_SYSTEM_STATE,\r\n    SET_SCORE_STATE,\r\n    SET_TUNE_STATE,\r\n    SET_SCORE_DATA,\r\n    SET_REFS,\r\n    SET_INSTRUMENTS,\r\n    SET_BACKING_STATE,\r\n    SET_RESERVE_TASKS,\r\n    SET_INVALIDATE,\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport type Action = {\r\n    type: ActionType;\r\n    payload: any;\r\n}\r\n\r\nexport const reducer = (store: Store, action: Action): Store => {\r\n    const type = action.type;\r\n    const payload = action.payload;\r\n    switch (type) {\r\n        case ActionType.SET_SYSTEM_STATE:\r\n            store.systemState = payload.systemState;\r\n            break;\r\n        case ActionType.SET_SCORE_STATE:\r\n            store.scoreState = payload.scoreState;\r\n            break;\r\n        case ActionType.SET_SCORE_DATA:\r\n            store.scoreData = payload.scoreData;\r\n            break;\r\n        case ActionType.SET_TUNE_STATE:\r\n            store.melodyState = payload.tuneState;\r\n            break;\r\n        case ActionType.SET_REFS:\r\n            store.refs = payload.refs;\r\n            break;\r\n        case ActionType.SET_INSTRUMENTS:\r\n            store.instruments = payload.instruments;\r\n            break;\r\n        case ActionType.SET_BACKING_STATE:\r\n            store.backingState = payload.backingState;\r\n            break;\r\n        case ActionType.SET_RESERVE_TASKS:\r\n            store.reserveTasks = payload.reserveTasks;\r\n            break;\r\n        case ActionType.SET_INVALIDATE:\r\n            store.invalidate = payload.invalidate;\r\n            break;\r\n    }\r\n    return { ...store };\r\n}","import { BeatSignature } from \"../redux/store/scoreData\";\r\n\r\nexport const SCALE_INDEX = [0, 2, 4, 5, 7, 9, 11];\r\n\r\nexport type DegreeProps = {\r\n    index: number;\r\n    isFlat: boolean;\r\n};\r\n\r\nexport type ChordProps = {\r\n    root: DegreeProps;\r\n    symbolKey: SymbolKey;\r\n};\r\n\r\nexport const ROOT_ALL: readonly (DegreeProps | null)[] = [\r\n    null,\r\n    { index: 0, isFlat: false },\r\n    { index: 1, isFlat: false },\r\n    { index: 1, isFlat: true },\r\n    { index: 2, isFlat: false },\r\n    { index: 3, isFlat: false },\r\n    { index: 3, isFlat: true },\r\n    { index: 4, isFlat: false },\r\n    { index: 5, isFlat: false },\r\n    { index: 6, isFlat: false },\r\n    { index: 6, isFlat: true },\r\n    { index: 7, isFlat: false },\r\n    { index: 8, isFlat: false },\r\n    { index: 8, isFlat: true },\r\n    { index: 9, isFlat: false },\r\n    { index: 10, isFlat: false },\r\n    { index: 10, isFlat: true },\r\n    { index: 11, isFlat: false }\r\n];\r\n\r\n\r\nexport const DEGREE12_FLAT_LIST = [\r\n    '', 'b', '', 'b', '', '', 'b', '', 'b', '', 'b', ''\r\n];\r\n// export const DEGREE12_FLAT_LIST = [\r\n//     'I', 'bII', 'II', 'bIII', 'III', 'IV', 'bV', 'V', 'bVI', 'VI', 'bVII', 'VII'\r\n// ];\r\nexport const DEGREE12_SHARP_LIST = [\r\n    '', '#', '', '#', '', '', '#', '', '#', '', '#', ''\r\n];\r\n\r\nexport const getDegreeRoot = (props: DegreeProps) => {\r\n    const list = props.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST;\r\n    return list[props.index];\r\n}\r\n\r\nexport const KEY12_FLAT_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\nexport const KEY12_SHARP_LIST = [\r\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'\r\n];\r\n\r\nexport const getChordRoot = (props: DegreeProps, baseKeyIndex: number) => {\r\n    const list = props.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST;\r\n    return list[(baseKeyIndex + props.index) % 12];\r\n}\r\n\r\n\r\nexport const KEY12_MAJOR_SCALE_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\n// export const KEY12_MINOR_SCALE_LIST = [\r\n//     'Cm', 'C#m', 'Dm', 'D#m', 'Em', 'Fm', 'F#m', 'Gm', 'G#m', 'Am', 'Bbm', 'Bm'\r\n// ];\r\nexport const KEY12_MINOR_SCALE_LIST = [\r\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B'\r\n];\r\n\r\nexport type ScaleRelation = 'diatonic' | 'secondaly' | 'none'\r\n\r\nexport type SymbolKey =\r\n    'major' |\r\n    'minor' |\r\n    'suspend4th' |\r\n    'diminish' |\r\n    'augument' |\r\n    'major-maj7th' |\r\n    'major-min7th' |\r\n    'minor-7th' |\r\n    'minor-maj7th' |\r\n    'sus4-7th' |\r\n    'diminish-7th' |\r\n    'augument-7th' |\r\n    'major-add9th' |\r\n    'minor-add9th' |\r\n    'sixth-9th' |\r\n    'minor-minus5' |\r\n    'minor7-minus5' |\r\n    'major-maj9th' |\r\n    'major-9th'\r\n    ;\r\n\r\n\r\nexport type SymbolAttribute =\r\n    'triad' |\r\n    'seventh' |\r\n    'add9th'\r\n    ;\r\n\r\nexport type SymbolParams = {\r\n    key: SymbolKey;\r\n    name: string;\r\n    base: null | SymbolKey;\r\n    attr?: SymbolAttribute;\r\n    structs: IntervalRelation[];\r\n}\r\n\r\nexport const SYMBOL_LIST: readonly SymbolParams[] = [\r\n    {\r\n        key: 'major', name: '',\r\n        base: null,\r\n        structs: ['p1', 'M3', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'minor', name: 'm',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'suspend4th', name: 'sus4',\r\n        base: null,\r\n        structs: ['p1', 'p4', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'diminish', name: 'dim',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'd5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'diminish-7th', name: 'dim7',\r\n        base: 'diminish',\r\n        structs: ['p1', 'm3', 'd5', 'd7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'augument', name: 'aug',\r\n        base: null,\r\n        structs: ['p1', 'M3', 'a5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'augument-7th', name: 'aug7',\r\n        base: 'augument',\r\n        structs: ['p1', 'M3', 'a5', 'm7']\r\n    },\r\n    {\r\n        key: 'minor-minus5', name: 'm(-5)',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'd5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'minor7-minus5', name: 'm7(-5)',\r\n        base: 'minor-minus5',\r\n        structs: ['p1', 'm3', 'd5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-maj7th', name: 'maj7',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'M7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-min7th', name: '7',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'minor-7th', name: 'm7',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'sus4-7th', name: '7sus4',\r\n        base: 'suspend4th',\r\n        structs: ['p1', 'p4', 'p5']\r\n    },\r\n    {\r\n        key: 'minor-maj7th', name: 'mmaj7',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'M7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-add9th', name: 'add9',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'M2'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'minor-add9th', name: 'madd9',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'M2'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'major-maj9th', name: 'maj9',\r\n        base: 'major-maj7th',\r\n        structs: ['p1', 'm3', 'p5'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'major-9th', name: '9',\r\n        base: 'major-min7th',\r\n        structs: ['p1', 'm3', 'p5']\r\n    },\r\n];\r\n\r\nexport type IntervalRelation =\r\n    'p1' | 'm2' | 'M2' | 'm3' | 'M3' | 'p4' |\r\n    'd5' | 'p5' | 'a5' | 'm6' | 'M6' |\r\n    'd7' | 'm7' | 'M7'\r\n    ;\r\n\r\nexport const IntervalRelationProps = {\r\n    'p1': 0,\r\n    'm2': 1,\r\n    'M2': 2,\r\n    'm3': 3,\r\n    'M3': 4,\r\n    'p4': 5,\r\n    'd5': 6,\r\n    'p5': 7,\r\n    'a5': 8,\r\n    'm6': 8,\r\n    'M6': 9,\r\n    'd7': 9,\r\n    'm7': 10,\r\n    'M7': 11\r\n}\r\n\r\nexport const DIATONIC_MAJOR_SCALE_LIST: readonly ChordProps[] = [\r\n    { root: { index: 0, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 2, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 4, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 5, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 7, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 9, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 11, isFlat: false }, symbolKey: 'minor-minus5' },\r\n];\r\n\r\nexport const DIATONIC_MAJOR_SCALE_DEGREE_NAMES = [\r\n    '', 'maj7',\r\n    'm', 'm7',\r\n    'm', 'm7',\r\n    '', 'maj7',\r\n    '', '7',\r\n    'm', 'm7',\r\n    'm(-5)', 'm7(-5)'\r\n];\r\n\r\nexport const DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES = [\r\n    'm', 'm7',\r\n    'm(-5)', 'm7(-5)',\r\n    'b', 'bM7',\r\n    'm', 'm7',\r\n    'm', 'm7',\r\n    'b', 'bM7',\r\n    'b', 'b7'\r\n];\r\n\r\nexport const getSymbolFromKey = (key: SymbolKey): SymbolParams => {\r\n    const ret = SYMBOL_LIST.find((symbol) => {\r\n        if (key === symbol.key) {\r\n            return symbol;\r\n        }\r\n    });\r\n    return ret != undefined ? ret : SYMBOL_LIST[0];\r\n}\r\n\r\nexport const getSymbolDerives = (key: SymbolKey): SymbolKey[] => {\r\n    let list: SymbolKey[] = [];\r\n    SYMBOL_LIST.forEach((symbol) => {\r\n        if (key === symbol.base) {\r\n            list.push(symbol.key);\r\n        }\r\n    });\r\n    return list;\r\n}\r\n\r\nexport const getIntervalValues = (rootIndex: number, structs: IntervalRelation[]): number[] => {\r\n    return structs.map(relation => rootIndex + IntervalRelationProps[relation]);\r\n}\r\n\r\nexport const getBeatRate = (beatSignature: BeatSignature): [number, number] => {\r\n\r\n    switch (beatSignature) {\r\n        case '4/4': return [4, 4];\r\n        case '3/4': return [3, 4];\r\n    }\r\n    return [0, 0];\r\n}","import { Dispatcher } from \"../redux/dispatcher/dispatcher\";\r\nimport BackingState from \"../redux/store/backingState\";\r\nimport { BackingLayerData, BackingSignalProps, ChordBacking, VoicingProps } from \"../redux/store/scoreData\";\r\nimport { Store } from \"../redux/store/store\";\r\nimport { playHarmony } from \"./melodyUtil\";\r\nimport { NOTES_1BAR_WIDTH } from \"./systemConst\";\r\nimport { IntervalRelationProps, KEY12_SHARP_LIST, SymbolParams } from \"./theoryUtils\";\r\n\r\n\r\n\r\nexport namespace BackingUtil {\r\n\r\n    // \r\n    export const OCTAVE_NUM = 8;\r\n    // \r\n    export const STRUCT_NUM = 6;\r\n    // \r\n    export const CHANNEL_MAX = 12;\r\n\r\n    export const getInitialRecord = (divCount: number) => {\r\n        return new Array<BackingState.NoteStatus | null>(divCount).fill(null);\r\n    }\r\n\r\n    export const buildChannels = (table: boolean[][]): BackingState.ChannelParam[] => {\r\n        const channels: BackingState.ChannelParam[] = [];\r\n        for (let i = 0; i < table.length; i++) {\r\n            for (let j = 0; j < table[i].length; j++) {\r\n                if (table[i][j]) {\r\n                    channels.push({ octave: i, structIndex: j });\r\n                }\r\n            }\r\n        }\r\n        if (channels.length === 0) {\r\n            channels.push({ octave: -1, structIndex: 0 });\r\n        }\r\n        return channels;\r\n    }\r\n\r\n    export const getVoicingListFromTable = (table: boolean[][]) => {\r\n\r\n        const voicingList: VoicingProps[] = [];\r\n        // \r\n        if (table != null) {\r\n            for (let i = 0; i < table.length; i++) {\r\n                for (let j = 0; j < table[i].length; j++) {\r\n                    if (table[i][j]) {\r\n                        voicingList.push({ octave: i, struct: j });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return voicingList;\r\n    }\r\n\r\n    export const buildPatternProps = (editorPattern: BackingState.Pattern) => {\r\n        const channelSize = editorPattern.channels.length;\r\n        const layers: BackingLayerData[] = [];\r\n        editorPattern.layers.forEach(layer => {\r\n            const divs: BackingState.NoteDiv[] = layer.noteDivList;\r\n            const signals: BackingSignalProps[] = [];\r\n            layer.table.forEach((record, i) => {\r\n                record.forEach((cell, j) => {\r\n                    if (cell != null) {\r\n                        signals.push({ x: j, y: i, status: cell });\r\n                    }\r\n                });\r\n            });\r\n            layers.push({ divs, notesList: signals, vels: layer.velocityList.slice() });\r\n        });\r\n        return { channelSize, layers };\r\n    }\r\n\r\n    export const getChannels = (voicingStructs: BackingState.ChannelParam[], size: number) => {\r\n        const channels: BackingState.ChannelParam[] = [];\r\n        for (let i = 0; i < size; i++) {\r\n            const channel: BackingState.ChannelParam = { octave: -1, structIndex: 0 };\r\n            if (i < voicingStructs.length) {\r\n                channel.octave = voicingStructs[i].octave;\r\n                channel.structIndex = voicingStructs[i].structIndex;\r\n            }\r\n            channels.push(channel);\r\n        }\r\n        return channels.reverse();\r\n    }\r\n\r\n    export const convertEditorLayerFromScore = (channelSize: number, scoreLayers: BackingLayerData[]) => {\r\n\r\n        const layers: BackingState.Layer[] = [];\r\n        console.log(JSON.stringify(scoreLayers));\r\n        scoreLayers.forEach(scoreLayer => {\r\n            const table: (BackingState.NoteStatus | null)[][] = [];\r\n            for (let i = 0; i < channelSize; i++) {\r\n                const record: (BackingState.NoteStatus | null)[] = [];\r\n                for (let j = 0; j < scoreLayer.divs.length; j++) {\r\n                    const notes = scoreLayer.notesList.find(notes => notes.x === j && notes.y === i);\r\n                    record.push(notes == null ? null : notes.status);\r\n                }\r\n                table.push(record);\r\n            }\r\n            layers.push({\r\n                noteDivList: scoreLayer.divs,\r\n                table,\r\n                velocityList: scoreLayer.vels\r\n            });\r\n        });\r\n        console.log(JSON.stringify(layers));\r\n        return layers;\r\n    }\r\n\r\n    export const getPitchListFromVoicing = (voicingList: VoicingProps[], rootIndex: number, symbol: SymbolParams) => {\r\n        return voicingList.map((item) => {\r\n            const interval = IntervalRelationProps[symbol.structs[item.struct]];\r\n            return 12 * item.octave + rootIndex + interval;\r\n        });\r\n    }\r\n\r\n    export const playBacking = (store: Store, reserveTasks: NodeJS.Timeout[], bpm: number, backing: ChordBacking, pitchIndexList: number[], chordTime: number) => {\r\n        if (backing.pattern == null) {\r\n            pitchIndexList.forEach((index, j) => {\r\n                const soundName = KEY12_SHARP_LIST[index % 12];\r\n                const octave = Math.floor(index / 12);\r\n                const soundFullName = soundName + octave;\r\n                playHarmony(soundFullName, store, chordTime, 5);\r\n            });\r\n        } else {\r\n            const pattern = backing.pattern;\r\n            pattern.layers.forEach(layer => {\r\n                const startTimeList: number[] = [];\r\n                let total = 0;\r\n                layer.divs.forEach(div => {\r\n                    startTimeList.push(60 / bpm * total);\r\n                    let normal = 4 / div.rate;\r\n                    if (div.isDot) normal *= 1.5;\r\n                    else if (div.div3 > 0) normal /= 3 * div.div3;\r\n                    total += normal;\r\n                });\r\n                layer.notesList.forEach((notes, j) => {\r\n\r\n                    const startTime = startTimeList[notes.x];\r\n                    const sustainTime = chordTime - startTime;\r\n                    const gain = layer.vels[j];\r\n                    reserveTasks.push(\r\n                        setTimeout(() => {\r\n                            const index = pitchIndexList[notes.y];\r\n                            const soundName = KEY12_SHARP_LIST[index % 12];\r\n                            const octave = Math.floor(index / 12);\r\n                            const soundFullName = soundName + octave;\r\n                            playHarmony(soundFullName, store, sustainTime, gain);\r\n                        }, startTime * 1000)\r\n                    );\r\n                });\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    export const stopPreview = (store: Store, state: BackingState.Editor, dispatcher: Dispatcher, reserveTasks: NodeJS.Timeout[]) => {\r\n        store.instruments.harmony?.stop();\r\n        state.isPreview = false;\r\n        reserveTasks.forEach(id => clearInterval(id));\r\n        dispatcher.backing.setState(state);\r\n    }\r\n\r\n    export const getLimitLen = (chordInfo: BackingState.ChordInfo) => {\r\n        const minute = chordInfo.minute;\r\n        return (chordInfo.beatLen + minute.head + minute.tail);\r\n    }\r\n\r\n    export const getTotalLenFromDivs = (divs: BackingState.NoteDiv[]) => {\r\n        return divs.reduce((prev, cur) => {\r\n            let len = 1 / cur.rate;\r\n            if (cur.isDot) len *= 1.5;\r\n            if (cur.div3 !== 0) len *= cur.div3 / 3;\r\n            return prev + len * 4;\r\n        }, 0);\r\n    }\r\n\r\n    export const checkError = (chordInfo: BackingState.ChordInfo, voicingList: VoicingProps[], pattern: null | BackingState.Pattern): boolean => {\r\n        let hasError = false;\r\n        if (pattern != null) {\r\n\r\n            // \r\n            if (voicingList.length < pattern.channels.length) hasError = true;\r\n\r\n            const limitLen = getLimitLen(chordInfo);\r\n            pattern.layers.forEach(layer => {\r\n\r\n                const totalLen = getTotalLenFromDivs(layer.noteDivList);\r\n                // \r\n                if (limitLen < totalLen) hasError = true;\r\n            });\r\n\r\n            // \r\n            pattern.layers[0].table.forEach((record, i) => {\r\n                record.forEach((cell, j) => {\r\n                    if(cell != null) {\r\n                        if(checkOverlapBackLayer(pattern.layers, 0, i, j)) {\r\n                            hasError = true;\r\n                        }\r\n                    }\r\n                });\r\n            })\r\n        }\r\n\r\n        return hasError;\r\n    }\r\n\r\n    export const checkOverlapBackLayer = (layers: BackingState.Layer[], layerIndex: number, channelIndex: number, divIndex: number): boolean => {\r\n        const baseLayer = layers[layerIndex];\r\n        const backLayer = layers[layerIndex === 0 ? 1 : 0];\r\n        const [left, right] = getDivRange(baseLayer.noteDivList, divIndex);\r\n        console.log(`left=${left}, right=${right}`);\r\n        let isOverlap = false;\r\n        for (let i = 0; i < backLayer.noteDivList.length; i++) {\r\n            if(backLayer.table[channelIndex][i] != null) {\r\n                const [backLeft, backRight] = getDivRange(backLayer.noteDivList, i);\r\n                if(right > backLeft && left < backRight) {\r\n                    isOverlap = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return isOverlap;\r\n    }\r\n\r\n    export const getDivRange = (divs: BackingState.NoteDiv[], divIndex: number): [number, number] => {\r\n        let [left, right] = [0, 0];\r\n        \r\n        divs.slice(0, divIndex + 1).forEach((cur, i) => {\r\n            let len = 1 / cur.rate;\r\n            if (cur.isDot) len *= 1.5;\r\n            if (cur.div3 !== 0) len *= cur.div3 / 3;\r\n            left = right;\r\n            right += len * 4;\r\n        });\r\n        return [left, right];\r\n    }\r\n}\r\n\r\nexport default BackingUtil;","import { Sampler } from \"tone\";\r\nimport { ChordBacking, DetailChord, VoicingProps } from \"../redux/store/scoreData\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST, SymbolAttribute } from \"./theoryUtils\";\r\nimport Soundfont from 'soundfont-player';\r\n\r\n// export const getDefaultSampler = () => {\r\n//     return new Sampler({\r\n//         \"C2\": \"https://dl.dropbox.com/s/9v1e4vb2y49kvxe/KEPSREC036.mp3?dl=0\",\r\n//         \"C3\": \"https://dl.dropbox.com/s/qjkoqqdkqwtnctj/KEPSREC048.mp3?dl=0\",\r\n//         \"C4\": \"https://dl.dropbox.com/s/9fgqyu7hsj8fncc/KEPSREC060.mp3?dl=0\",\r\n//         \"C5\": \"https://dl.dropbox.com/s/0v042zfk67q4a8d/KEPSREC072.mp3?dl=0\",\r\n//         \"C6\": \"https://dl.dropbox.com/s/3u2c7qsmhnse575/KEPSREC084.mp3?dl=0\",\r\n//     }).toDestination();\r\n// }\r\nexport const getDefaultSampler = () => {\r\n    return new Sampler({\r\n        \"C2\": \"https://dl.dropbox.com/s/ebta7izw1zdphki/KEPSREC036.mp3?dl=0\",\r\n        \"D2\": \"https://dl.dropbox.com/s/d8bel1c9d1utk25/KEPSREC038.mp3?dl=0\",\r\n        \"E2\": \"https://dl.dropbox.com/s/qe48401jgb2cewo/KEPSREC040.mp3?dl=0\",\r\n        \"F2\": \"https://dl.dropbox.com/s/3s7sc8btjob8gru/KEPSREC041.mp3?dl=0\",\r\n        \"G2\": \"https://dl.dropbox.com/s/zzxvr0p4j37n9i0/KEPSREC043.mp3?dl=0\",\r\n        \"A2\": \"https://dl.dropbox.com/s/vcrs90e06djj7sx/KEPSREC045.mp3?dl=0\",\r\n        \"B2\": \"https://dl.dropbox.com/s/yvkrz0ngkijjngq/KEPSREC047.mp3?dl=0\",\r\n        \"C3\": \"https://dl.dropbox.com/s/qjkoqqdkqwtnctj/KEPSREC048.mp3?dl=0\",\r\n        \"D3\": \"https://dl.dropbox.com/s/jjyithbiwmxfn5m/KEPSREC050.mp3?dl=0\",\r\n        \"E3\": \"https://dl.dropbox.com/s/2s4p06g2gw2lcf7/KEPSREC052.mp3?dl=0\",\r\n        \"F3\": \"https://dl.dropbox.com/s/7mo0mm2bbc3im60/KEPSREC053.mp3?dl=0\",\r\n        \"G3\": \"https://dl.dropbox.com/s/qqrrlwogz0orihq/KEPSREC055.mp3?dl=0\",\r\n        \"A3\": \"https://dl.dropbox.com/s/o6oycmolcn7rhbs/KEPSREC057.mp3?dl=0\",\r\n        \"B3\": \"https://dl.dropbox.com/s/3s05r18hsd19t6e/KEPSREC059.mp3?dl=0\",\r\n        \"C4\": \"https://dl.dropbox.com/s/9fgqyu7hsj8fncc/KEPSREC060.mp3?dl=0\",\r\n        \"D4\": \"https://dl.dropbox.com/s/ja1d04dgy9v98x9/KEPSREC062.mp3?dl=0\",\r\n        \"E4\": \"https://dl.dropbox.com/s/y2379pix35gto7u/KEPSREC064.mp3?dl=0\",\r\n        \"F4\": \"https://dl.dropbox.com/s/h1sq8yikmdfvzqc/KEPSREC065.mp3?dl=0\",\r\n        \"G4\": \"https://dl.dropbox.com/s/hvzvcrm1emfum0d/KEPSREC067.mp3?dl=0\",\r\n        \"A4\": \"https://dl.dropbox.com/s/vy56xbt7w78o41o/KEPSREC069.mp3?dl=0\",\r\n        \"B4\": \"https://dl.dropbox.com/s/e9kv77pym1wtujc/KEPSREC071.mp3?dl=0\",\r\n        \"C5\": \"https://dl.dropbox.com/s/0v042zfk67q4a8d/KEPSREC072.mp3?dl=0\",\r\n        \"C6\": \"https://dl.dropbox.com/s/3u2c7qsmhnse575/KEPSREC084.mp3?dl=0\",\r\n    }).toDestination();\r\n}\r\n\r\n\r\nexport const playChordSampler = (sampler: Sampler, detail: DetailChord, bpm: number) => {\r\n\r\n    sampler.releaseAll();\r\n    if (detail.root == null) return;\r\n\r\n    const rootIndex = detail.root.index;\r\n    const symbol = getSymbolFromKey(detail.symbolKey);\r\n\r\n    const channelList = detail.backing.voicingList.map((item) => {\r\n        const interval = IntervalRelationProps[symbol.structs[item.struct]];\r\n        return 12 * item.octave + rootIndex + interval;\r\n    });\r\n\r\n    channelList.forEach((index, i) => {\r\n        const soundName = KEY12_SHARP_LIST[index % 12];\r\n        const octave = Math.floor(index / 12);\r\n        const soundFullName = soundName + octave;\r\n\r\n        sampler.triggerAttack(soundFullName, '+0', 0.5);\r\n    });\r\n\r\n    setTimeout(() => {\r\n        // sampler.triggerRelease('C3');\r\n        sampler.releaseAll();\r\n    }, 2000);\r\n}\r\n\r\nexport const playChordSoundfont = (soundfont: Soundfont.Player, detail: DetailChord) => {\r\n\r\n    soundfont.stop();\r\n    if (detail.root == null) return;\r\n\r\n    const rootIndex = detail.root.index;\r\n    const symbol = getSymbolFromKey(detail.symbolKey);\r\n\r\n    const channelList = detail.backing.voicingList.map((item) => {\r\n        const interval = IntervalRelationProps[symbol.structs[item.struct]];\r\n        return 12 * item.octave + rootIndex + interval;\r\n    });\r\n\r\n    channelList.forEach((index) => {\r\n        const soundName = KEY12_SHARP_LIST[index % 12];\r\n        const octave = Math.floor(index / 12);\r\n        const soundFullName = soundName + octave;\r\n\r\n        soundfont.play(soundFullName, 0, { duration: 1 });\r\n    });\r\n}\r\n\r\n\r\nexport const getDefaultBacking = (attr: SymbolAttribute) => {\r\n    let voicingList: VoicingProps[] = [];\r\n    switch (attr) {\r\n        case 'triad': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 },\r\n            // { struct: 0, octave: 3 },\r\n            // { struct: 2, octave: 3 },\r\n            // { struct: 0, octave: 4 },\r\n            // { struct: 1, octave: 4 },\r\n            // { struct: 2, octave: 4 },\r\n            // { struct: 0, octave: 5 },\r\n        ]; break;\r\n        case 'seventh': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 },\r\n            { struct: 3, octave: 3 },\r\n            // { struct: 0, octave: 3 },\r\n            // { struct: 2, octave: 3 },\r\n            // { struct: 0, octave: 4 },\r\n            // { struct: 1, octave: 4 },\r\n            // { struct: 2, octave: 4 },\r\n            // { struct: 3, octave: 4 },\r\n        ]; break;\r\n        case 'add9th': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 },\r\n            { struct: 3, octave: 3 },\r\n            // { struct: 0, octave: 3 },\r\n            // { struct: 2, octave: 3 },\r\n            // { struct: 3, octave: 3 },\r\n            // { struct: 0, octave: 4 },\r\n            // { struct: 1, octave: 4 },\r\n            // { struct: 3, octave: 4 },\r\n        ]; break;\r\n    }\r\n    const backing: ChordBacking = {\r\n        voicingList,\r\n        pattern: null\r\n    };\r\n    return backing;\r\n}","import { isatty } from \"tty\";\r\nimport { MelodyState } from \"../redux/store/melodyState\";\r\nimport { ChordElement, DetailChord, DetailInit, MelodyLength, ScoreData } from \"../redux/store/scoreData\";\r\nimport { Store } from \"../redux/store/store\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"./theoryUtils\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { Dispatcher } from \"../redux/dispatcher/dispatcher\";\r\nimport { ScoreState } from \"../redux/store/scoreState\";\r\nimport ElementDetailChord from \"../contents/score/edit/harmonize/elements/form/elementDetailChord\";\r\nimport BackingUtil from \"./backingUtil\";\r\n\r\nexport const PITCH_MAX = 60;\r\n\r\nexport const getKeyIndexFromPitcher = (index: number) => {\r\n    return (PITCH_MAX - 1 - index + 9) % 12;\r\n}\r\n\r\nexport const getNormalizeLenFromNotes = (notes: MelodyLength) => {\r\n    let total = 0;\r\n    total += notes.len4;\r\n    total += notes.len8 / 2;\r\n    total += notes.len16 / 4;\r\n    total += notes.len4div3 / 3;\r\n    total += notes.len8div3 / 6;\r\n    return total;\r\n}\r\n\r\nexport const getAdditionNotsLen = (notes1: MelodyLength, notes2: MelodyLength) => {\r\n    return getSortetdNotesLen({\r\n        len4: notes1.len4 + notes2.len4,\r\n        len8: notes1.len8 + notes2.len8,\r\n        len16: notes1.len16 + notes2.len16,\r\n        len4div3: notes1.len4div3 + notes2.len4div3,\r\n        len8div3: notes1.len8div3 + notes2.len8div3\r\n    });\r\n}\r\n\r\nexport const getSortetdNotesLen = (base: MelodyLength) => {\r\n\r\n    const len8div3Cnt3 = Math.floor(base.len8div3 / 3);\r\n    base.len8div3 -= len8div3Cnt3 * 3;\r\n    base.len8 += len8div3Cnt3;\r\n\r\n    const len8div3Cnt2 = Math.floor(base.len8div3 / 2);\r\n    base.len8div3 -= len8div3Cnt2 * 2;\r\n    base.len4div3 += len8div3Cnt2;\r\n\r\n    const len4div3Cnt3 = Math.floor(base.len4div3 / 3);\r\n    base.len4div3 -= len4div3Cnt3 * 3;\r\n    base.len4 += len4div3Cnt3;\r\n\r\n    const len16Cnt2 = Math.floor(base.len16 / 2);\r\n    base.len16 -= len16Cnt2 * 2;\r\n    base.len8 += len16Cnt2;\r\n\r\n    const len8Cnt2 = Math.floor(base.len8 / 2);\r\n    base.len8 -= len8Cnt2 * 2;\r\n    base.len4 += len8Cnt2;\r\n\r\n    return base;\r\n}\r\n\r\nexport const getNotesLenFromQuantize = (quantize: number, count: number): MelodyLength => {\r\n\r\n    let len4 = 0;\r\n    let len8 = 0;\r\n    let len16 = 0;\r\n    let len4div3 = 0;\r\n    let len8div3 = 0;\r\n\r\n    switch (quantize) {\r\n        case 1: len4 = count; break;\r\n        case 2: len8 = count; break;\r\n        case 3: len4div3 = count; break;\r\n        case 4: len16 = count; break;\r\n        case 6: len8div3 = count; break;\r\n    }\r\n    return getSortetdNotesLen({\r\n        len4, len8, len16, len4div3, len8div3\r\n    });\r\n}\r\n// export const getNotesLenFromNormal = (normal: number): MelodyLength => {\r\n//     // let normal = a;\r\n//     let len4 = 0;\r\n//     let len8 = 0;\r\n//     let len16 = 0;\r\n//     let len4div3 = 0;\r\n//     let len8div3 = 0;\r\n\r\n//     normal *= 12;\r\n\r\n//     len4 = Math.floor(normal / 12);\r\n//     normal -= len4 * 12;\r\n//     if (normal - Math.floor(normal / 12 * 3) !== 0) {\r\n//         len8 = Math.floor(normal / 12 * 2);\r\n//         normal -= len8 * 12 / 2;\r\n//     }\r\n//     len4div3 = Math.floor(normal / 12 * 3);\r\n//     normal -= len4div3 * 12 / 3;\r\n//     if (normal - Math.floor(normal / 12 * 6) !== 0) {\r\n//         len16 = Math.floor(normal / 12 * 4);\r\n//         normal -= len16 * 12 / 4;\r\n//     }\r\n//     len8div3 = Math.floor(normal / 12 * 6);\r\n//     return {\r\n//         len4, len8, len16, len4div3, len8div3\r\n//     };\r\n// }\r\n\r\nexport const getMinimumLenUnit = (notes: MelodyLength): number => {\r\n\r\n    if (notes.len8div3 > 0) return 6;\r\n    else if (notes.len16 > 0) return 4;\r\n    else if (notes.len4div3 > 0) return 3;\r\n    else if (notes.len8 > 0) return 2;\r\n    else if (notes.len4 > 0) return 1;\r\n    else return 0;\r\n}\r\n\r\nexport const playSoundfont = (i: number, store: Store) => {\r\n    const keyIndex = ((59 - i) + 9) % 12;\r\n    const octave = Math.floor(((59 - i) + 9) / 12) + 1;\r\n    const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n    const instrument = store.instruments.soundfontPlayer;\r\n    if (instrument != null) {\r\n        instrument.stop();\r\n        instrument.play(soundName + octave, 0, { duration: 0.5 });\r\n    }\r\n}\r\n\r\nexport const playHarmony = (soundFullName: string, store: Store, duration: number, gain: number) => {\r\n    const instrument = store.instruments.harmony;\r\n    if (instrument != null) {\r\n        instrument.play(soundFullName, 0, {gain, duration });\r\n    } else {\r\n        alert('null');\r\n    }\r\n}\r\n\r\nexport const stopPiano = (store: Store) => {\r\n    const instrument = store.instruments.harmony;\r\n    if (instrument != null) {\r\n        instrument.stop();\r\n    }\r\n}\r\n\r\nexport const searchCurChord = (store: Store, focusIndex: number) => {\r\n    const state = store.melodyState;\r\n    const chordList = store.scoreData.chordList;\r\n    const x = getNormalizeLenFromNotes(store.scoreData.notesList[focusIndex].pos) * state.beatWidth;\r\n    let left = 0;\r\n    const searchedChord = chordList.find((element) => {\r\n        if (element.type === 'chord') {\r\n            const detail = element.detail as DetailChord;\r\n            const width = detail.beatLen * state.beatWidth;\r\n            if (x >= left && x < left + width) {\r\n                return element;\r\n            }\r\n            left += width;\r\n        }\r\n    });\r\n    return searchedChord == undefined ? null : searchedChord;\r\n}\r\n\r\nexport const previewStart = (store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const state = store.melodyState;\r\n    const data = store.scoreData;\r\n    const reserveTasks: NodeJS.Timeout[] = [];\r\n    const instrument = store.instruments.soundfontPlayer;\r\n    const init = data.chordList[0].detail as DetailInit;\r\n    const bpm = init.bpm;\r\n    state.lastFocus = state.focusIndex;\r\n    state.isPreview = true;\r\n    let firstTime = -1;\r\n    for (let i = state.focusIndex; i < data.notesList.length; i++) {\r\n        const notes = data.notesList[i];\r\n        const pos = getNormalizeLenFromNotes(notes.pos);\r\n        const len = getNormalizeLenFromNotes(notes.len);\r\n        const pitch = notes.pitchIndex;\r\n        const time = 60 / bpm * pos;\r\n\r\n        // \r\n        if (firstTime === -1) {\r\n            firstTime = time;\r\n        }\r\n\r\n        reserveTasks.push(\r\n            setTimeout(() => {\r\n                state.focusIndex = i;\r\n                state.distIndex = state.focusIndex;\r\n                // state.mouseState.curChord = searchCurChord(store, i);\r\n                dispatcher.tune.setState(state);\r\n                dispatcher.tune.adjustScrollX();\r\n                if (instrument != null) {\r\n                    const keyIndex = getKeyIndexFromPitcher(pitch);\r\n                    const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n                    const octave = Math.floor(((59 - pitch) + 9) / 12) + 1;\r\n                    instrument.stop();\r\n                    instrument.play(soundName + octave, 0, { duration: 60 / bpm * len });\r\n                }\r\n            }, (time - firstTime) * 1000)\r\n        );\r\n\r\n        if (i === data.notesList.length - 1) {\r\n            reserveTasks.push(\r\n                setTimeout(() => {\r\n                    stopPreview(store, dispatcher, reserveTasks);\r\n                }, (time - firstTime + 60 / bpm * len) * 1000)\r\n            );\r\n        }\r\n    }\r\n\r\n    // \r\n    if (!state.isSolo) {\r\n        previewHarmony(firstTime * 1000, store, dispatcher, reserveTasks);\r\n    }\r\n\r\n\r\n    dispatcher.system.setReserveTasks(reserveTasks);\r\n    dispatcher.tune.setState(state);\r\n}\r\n\r\nexport const stopPreview = (store: Store, dispatcher: Dispatcher, reserveTasks: NodeJS.Timeout[]) => {\r\n\r\n    const state = store.melodyState;\r\n    state.isPreview = false;\r\n    state.focusIndex = state.lastFocus;\r\n    state.distIndex = state.focusIndex;\r\n    reserveTasks.forEach(id => clearInterval(id));\r\n    store.instruments.sampler.releaseAll();\r\n    dispatcher.tune.setState(state);\r\n    dispatcher.tune.adjustScrollX();\r\n}\r\n\r\nexport const previewHarmony = (start: number, store: Store, dispatcher: Dispatcher, reserveTasks: NodeJS.Timeout[]) => {\r\n    const state = store.scoreState;\r\n    const sampler = store.instruments.sampler;\r\n    const cacheList = state.elementCacheList;\r\n    const chordList = store.scoreData.chordList;\r\n    // const reserveTasks = store.reserveTasks;\r\n    const init = chordList[0].detail as DetailInit;\r\n    const adjsut = 0;\r\n    for (let i = 3; i < chordList.length; i++) {\r\n        const cache = cacheList[i];\r\n        const element = chordList[i];\r\n        if (element.type === 'chord') {\r\n            if (cache.pastSecond < start) continue;\r\n\r\n            const detail = element.detail as DetailChord;\r\n\r\n            if (detail.root == null) return;\r\n\r\n            const rootIndex = (detail.root.index + init.keyIndex) % 12;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            const len = detail.beatLen + detail.minute.head + detail.minute.tail;\r\n\r\n            const backing = detail.backing;\r\n            const pitchList = BackingUtil.getPitchListFromVoicing(backing.voicingList, rootIndex, symbol);\r\n\r\n            const chordTime = 60 / init.bpm * len;\r\n            reserveTasks.push(\r\n                setTimeout(() => {\r\n                    // sampler.releaseAll();\r\n                    // stopPiano(store);\r\n\r\n                    const pickingDelay = 60 / init.bpm * 0.1 * 1000;\r\n                    const div = pickingDelay / pitchList.length;\r\n\r\n                    // pitchList.forEach((index, j) => {\r\n                    //     const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //     const octave = Math.floor(index / 12);\r\n                    //     const soundFullName = soundName + octave;\r\n                    //     playPiano(soundFullName, store, chordTime);\r\n                    // });\r\n\r\n                    BackingUtil.playBacking(store, reserveTasks, init.bpm, backing, pitchList, chordTime);\r\n\r\n                    store.melodyState.mouseState.curChord = element;\r\n                    dispatcher.tune.setState(store.melodyState);\r\n                    //     stopPiano(store);\r\n                    //     channelList.forEach((index, j) => {\r\n\r\n                    //         reserveTasks.push(\r\n                    //             setTimeout(() => {\r\n                    //                 const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //                 const octave = Math.floor(index / 12);\r\n                    //                 const soundFullName = soundName + octave;\r\n                    //                 playPiano(soundFullName, store, chordTime);\r\n                    //             }, div * j)\r\n                    //         );\r\n                    //     });\r\n                    //     channelList.forEach((index, j) => {\r\n\r\n                    //         reserveTasks.push(\r\n                    //             setTimeout(() => {\r\n                    //                 const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //                 const octave = Math.floor(index / 12);\r\n                    //                 const soundFullName = soundName + octave;\r\n                    //                 playPiano(soundFullName, store, chordTime);\r\n                    //             }, chordTime * 1000 / 4 + div * j)\r\n                    //         );\r\n                    //     });\r\n                    //     channelList.reverse().forEach((index, j) => {\r\n\r\n                    //         reserveTasks.push(\r\n                    //             setTimeout(() => {\r\n                    //                 const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //                 const octave = Math.floor(index / 12);\r\n                    //                 const soundFullName = soundName + octave;\r\n                    //                 playPiano(soundFullName, store, chordTime);\r\n                    //             }, chordTime * 1000 / 8 * 3 + div * j)\r\n                    //         );\r\n                    //     });\r\n                    //     channelList.reverse().forEach((index, j) => {\r\n\r\n                    //         reserveTasks.push(\r\n                    //             setTimeout(() => {\r\n                    //                 const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //                 const octave = Math.floor(index / 12);\r\n                    //                 const soundFullName = soundName + octave;\r\n                    //                 playPiano(soundFullName, store, chordTime);\r\n                    //             }, chordTime * 1000 / 8 * 5 +  div * j)\r\n                    //         );\r\n                    //     });\r\n                    //     channelList.forEach((index, j) => {\r\n\r\n                    //         reserveTasks.push(\r\n                    //             setTimeout(() => {\r\n                    //                 const soundName = KEY12_SHARP_LIST[index % 12];\r\n                    //                 const octave = Math.floor(index / 12);\r\n                    //                 const soundFullName = soundName + octave;\r\n                    //                 playPiano(soundFullName, store, chordTime);\r\n                    //             }, chordTime * 1000 / 8 * 6 +  div * j)\r\n                    //         );\r\n                    //     });\r\n                }, cache.pastSecond - start - adjsut)\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nexport const previewCurHarmony = (store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const state = store.melodyState;\r\n    const chordList = store.scoreData.chordList;\r\n    const init = chordList[0].detail as DetailInit;\r\n    const curChord = state.mouseState.curChord;\r\n    const reserveTasks = store.reserveTasks;\r\n    if (curChord != null) {\r\n\r\n        const detail = curChord.detail as DetailChord;\r\n\r\n        if (detail.root == null) return;\r\n\r\n        const rootIndex = (detail.root.index + init.keyIndex) % 12;\r\n        const symbol = getSymbolFromKey(detail.symbolKey);\r\n        const len = detail.beatLen + detail.minute.head + detail.minute.tail;\r\n\r\n        const backing = detail.backing;\r\n        const pitchList = BackingUtil.getPitchListFromVoicing(backing.voicingList, rootIndex, symbol);\r\n        const chordTime = 60 / init.bpm * len;\r\n\r\n        BackingUtil.playBacking(store, reserveTasks, init.bpm, backing, pitchList, chordTime);\r\n\r\n        reserveTasks.push(setTimeout(() => {\r\n            state.isPreview = false;\r\n            dispatcher.tune.setState(state);\r\n        }, chordTime * 1000));\r\n        state.isPreview = true;\r\n        dispatcher.tune.setState(state);\r\n\r\n    }\r\n}","\r\nexport const APP_MIN_WIDTH = 800;\r\nexport const APP_MIN_HEIGHT = 600;\r\n\r\nexport const TOTAL_HEADER_WIDTH = 44;\r\n\r\nexport const MAIN_FRAME_MARGIN = 15;\r\nexport const SCORE_TAB_MARGIN = 8;\r\n\r\nexport const BUTTON_SMALL_HEIGHT = 18;\r\nexport const BUTTON_MIDIUM_HEIGHT = 28;\r\nexport const BUTTON_LARGE_HEIGHT = 34;\r\n\r\n// \r\n\r\nexport const FIRST_CHORD_INDEX = 3;\r\n\r\nexport const HARMONIZE_RIGHT_WIDTH = 220;\r\nexport const HARMONIZE_HEAD_WIDTH = 35;\r\nexport const HARMONIZE_FOOT_WIDTH = 80;\r\nexport const HARMONIZE_STRUCT_WIDTH = 380;\r\nexport const HARMONIZE_SECTIONS_WIDTH = 110;\r\n\r\nexport const ELEMENT_HEIGHT = 134;\r\nexport const ELEMENT_HEAD_WIDTH = 15;\r\nexport const ELEMENT_FOOT_WIDTH = 60;\r\nexport const ELEMENT_SIDE_PADDING = 8;\r\nexport const ELEMENT_NOTE_PADDING_LEN = 10;\r\nexport const ELEMENT_NOTE_PADDING_SID = 30;\r\nexport const ELEMENT_POS_INFO_WIDTH = 50;\r\nexport const ELEMENT_OPERATIONS_WIDTH = 20;\r\n\r\nexport const TIMELINE_BEAT_WIDTH = 80;\r\n\r\n\r\nexport const TUNE_HEADER_WIDTH = 80;\r\nexport const TUNE_TIMELINE_WIDTH = 70;\r\nexport const TUNE_PITCH_WIDTH = 100;\r\nexport const TUNE_PITCH_HEIGHT = 30;\r\n\r\n\r\n\r\nexport const PATTERN_OPERATION_HEIGHT = 30;\r\nexport const PATTERN_HEADER_HEIGHT = 50;\r\nexport const PATTERN_BODY_HEIGHT = 240;\r\nexport const PATTERN_FOOTER_HEIGHT = 50;\r\nexport const PATTERN_FRAME_HEIGHT = PATTERN_OPERATION_HEIGHT + PATTERN_HEADER_HEIGHT + PATTERN_BODY_HEIGHT + PATTERN_FOOTER_HEIGHT;\r\n\r\n\r\nexport const NOTES_1BAR_WIDTH = 480;","import { DegreeProps, DIATONIC_MAJOR_SCALE_LIST, getChordRoot, getSymbolFromKey, SCALE_INDEX, SymbolKey } from \"../../utils/theoryUtils\";\r\nimport { Action, ActionType } from \"../reducer\";\r\nimport { RefsCache } from \"../store/refsCache\";\r\nimport { BackingLayerData, BackingSignalProps, ChordBacking, ChordElement, DetailChange, DetailChord, DetailInit, DetailSection, ScoreData, TuneNotes, VoicingProps } from \"../store/scoreData\";\r\nimport { NoteKeySwitch, ScoreState, SymbolDiagram } from \"../store/scoreState\";\r\nimport { Store } from \"../store/store\";\r\nimport { MelodyKeySwitch, MelodyPitchMode, MelodyState } from \"../store/melodyState\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { SystemState } from \"../store/systemState\";\r\nimport { getDefaultBacking } from \"../../utils/instrumentsUtil\";\r\nimport { getAdditionNotsLen, getKeyIndexFromPitcher, getMinimumLenUnit, getNormalizeLenFromNotes, getNotesLenFromQuantize, PITCH_MAX, playSoundfont, previewStart } from \"../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../utils/systemConst\";\r\nimport { Invalidate } from \"../store/invalidate\";\r\nimport BackingState from \"../store/backingState\";\r\nimport BackingUtil from \"../../utils/backingUtil\";\r\n\r\nexport class Dispatcher {\r\n\r\n    private store: Store;\r\n    private dispatch: Function;\r\n\r\n    constructor(store: Store, dispatch: React.Dispatch<Action>) {\r\n        this.store = store;\r\n        this.dispatch = (type: ActionType, payload: object) => dispatch({ type, payload });\r\n    }\r\n\r\n    public system = {\r\n\r\n        setState: (systemState: SystemState) => {\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        switchSplashToMain: () => {\r\n            const systemState = this.store.systemState;\r\n            systemState.isSplash = false;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setMainTabIndex: (index: number) => {\r\n            const systemState = this.store.systemState;\r\n            systemState.mainChannelIndex = index;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setRefs: (refs: RefsCache) => {\r\n            this.dispatch(ActionType.SET_REFS, { refs });\r\n        },\r\n\r\n        setReserveTasks: (reserveTasks: NodeJS.Timeout[]) => {\r\n            this.dispatch(ActionType.SET_RESERVE_TASKS, { reserveTasks });\r\n        },\r\n\r\n        setInvalidate: (invalidate: Invalidate) => {\r\n            this.dispatch(ActionType.SET_INVALIDATE, { invalidate });\r\n        }\r\n    }\r\n\r\n    public score = {\r\n        setPiano: (soundfontPlayer: Soundfont.Player) => {\r\n            this.dispatch(ActionType.SET_INSTRUMENTS, {\r\n                instruments: {\r\n                    ...this.store.instruments, harmony: soundfontPlayer\r\n                }\r\n            });\r\n        },\r\n\r\n        setScoreTabIndex: (index: number) => {\r\n            const systemState = this.store.systemState;\r\n            systemState.scoreTabIndex = index;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setScoreState: (scoreState: ScoreState) => {\r\n            this.dispatch(ActionType.SET_SCORE_STATE, { scoreState });\r\n        },\r\n\r\n        setKeySwitch: (keySwitch: NoteKeySwitch) => {\r\n            const state = this.store.scoreState;\r\n            state.keySwitch = keySwitch;\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        setScoreData: (scoreData: ScoreData) => {\r\n            this.dispatch(ActionType.SET_SCORE_DATA, { scoreData });\r\n        },\r\n\r\n        moveElement: (isNext: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const list = this.store.scoreData.chordList;\r\n            const sub = isNext ? 1 : -1;\r\n            if (list[state.focusIndex + sub].type !== 'fixed') {\r\n                state.focusIndex += sub;\r\n                this.score.setScoreState(state);\r\n            }\r\n        },\r\n\r\n        moveSection: (isNext: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const curSectionIndex = state.elementCacheList[state.focusIndex].sectionNo;\r\n            const sectionCacheList = state.sectionCacheList;\r\n            const curSectionInfo = sectionCacheList[curSectionIndex];\r\n            const curElementType = this.store.scoreData.chordList[state.focusIndex].type;\r\n            if (!isNext) {\r\n                // alert('prev');\r\n                if (curElementType === 'section' && curSectionIndex > 0) {\r\n                    // 1\r\n                    state.focusIndex = sectionCacheList[curSectionIndex - 1].rangeIndexStart;\r\n                } else {\r\n                    // \r\n                    state.focusIndex = curSectionInfo.rangeIndexStart;\r\n                }\r\n            } else {\r\n                // alert('next');\r\n                if (curSectionIndex < sectionCacheList.length - 1) {\r\n                    // \r\n                    state.focusIndex = sectionCacheList[curSectionIndex + 1].rangeIndexStart;\r\n                } else {\r\n                    // \r\n                    state.focusIndex = curSectionInfo.rangeIndexEnd;\r\n                }\r\n            }\r\n            // alert(`totalSection=${sectionCacheList.length}, curSection=${curSectionIndex}, focus=${state.focusIndex}`);\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        incrementDegreeRoot: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.root == null) {\r\n                detail.root = { index: 0, isFlat: false };\r\n                this.score.setScoreData(data);\r\n            } else if (detail.root.index + sub >= 0 && detail.root.index + sub <= 11) {\r\n                detail.root.index += sub;\r\n                detail.root.isFlat = !isUp && ![0, 2, 4, 5, 7, 9, 11].includes(detail.root.index);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementBeatLen: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const chordList = data.chordList.slice();\r\n            const detail = chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.beatLen + sub >= 1 && detail.beatLen + sub <= 4) {\r\n                detail.beatLen += sub;\r\n                data.chordList = chordList;\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementMinuteVal: (pos: number, isTail: boolean, value: number) => {\r\n            const data = this.store.scoreData;\r\n            const cur = data.chordList[pos];\r\n            const detail = cur.detail as DetailChord;\r\n            let target = !isTail ? detail.minute.head : detail.minute.tail;\r\n            target += value;\r\n            if (target >= -0.5 && target <= 0.5) {\r\n                if (!isTail) detail.minute.head = target;\r\n                else detail.minute.tail = target;\r\n                // data.chordList[this.store.scoreState.focusIndex].detail = detail;\r\n                data.chordList = data.chordList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementMinuteValRelation: (isTail: boolean, value: number) => {\r\n            const focusIndex = this.store.scoreState.focusIndex;\r\n            const chordList = this.store.scoreData.chordList;\r\n\r\n            let nearIndex = -1;\r\n            if (!isTail) {\r\n                for (let i = focusIndex - 1; i > 2; i--) {\r\n                    if (chordList[i].type === 'chord') {\r\n                        nearIndex = i;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = focusIndex + 1; i < chordList.length - 1; i++) {\r\n                    if (chordList[i].type === 'chord') {\r\n                        nearIndex = i;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (nearIndex != -1) {\r\n                this.score.incrementMinuteVal(focusIndex, isTail, value);\r\n                this.score.incrementMinuteVal(nearIndex, !isTail, -value);\r\n            }\r\n        },\r\n\r\n        addChordElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'chord', detail: {\r\n                    beatLen: state.initialBeat,\r\n                    minute: { head: 0, tail: 0 },\r\n                    // degreeIndex: 0,\r\n                    // isFlat: false,\r\n                    root: null,\r\n                    on: null,\r\n                    symbolKey: 'major',\r\n                    backing: {\r\n                        voicingList: [],\r\n                        pattern: null\r\n                    }\r\n                } as DetailChord\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n\r\n            // const cache = state.elementCacheList[state.focusIndex + 1];\r\n            // const wrapRef = cache.reffers.wrap as HTMLDivElement;\r\n            // const baseWidth = wrapRef.clientWidth;\r\n            // wrapRef.style.width = '0';\r\n            // setTimeout(() => {\r\n            //     wrapRef.style.width = `${baseWidth}px`;\r\n            // }, 1);\r\n            // setTimeout(() => {\r\n            //     wrapRef.style.width = '';\r\n            // }, 1000);\r\n        },\r\n\r\n        addSectionElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'section', detail: {\r\n                    labelName: 'Section'\r\n                } as DetailSection\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        addChangeElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'change', detail: {\r\n                    changeType: null,\r\n                    modulateRelation: null,\r\n                    domminantValue: 0,\r\n                    keyAdjust: 0,\r\n                    tempoRelation: null,\r\n                    tempoDiff: 0,\r\n                    tempoRate: 1,\r\n                    tempoAbsolute: 0,\r\n                    beatSignature: '4/4'\r\n                } as DetailChange\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        removeCurElement: () => {\r\n            const state = this.store.scoreState;\r\n            const element = this.store.scoreData.chordList[state.focusIndex];\r\n            const sectionNo = this.store.scoreState.elementCacheList[state.focusIndex].sectionNo;\r\n            if (element.type === 'section' && sectionNo === 0) {\r\n                return;\r\n            }\r\n            const cache = state.elementCacheList[state.focusIndex];\r\n\r\n            const wrapRef = cache.reffers.wrap as HTMLDivElement;\r\n            const bodyRef = cache.reffers.body as HTMLDivElement;\r\n            // reffer.style.width = '300px';\r\n            wrapRef.style.opacity = '0';\r\n            wrapRef.style.overflow = 'hidden';\r\n            // wrapRef.style.padding = '0';\r\n            wrapRef.style.width = `${wrapRef.clientWidth}px`;\r\n            setTimeout(() => {\r\n                wrapRef.style.width = '0';\r\n            }, 1);\r\n            setTimeout(() => {\r\n                wrapRef.style.opacity = '';\r\n                wrapRef.style.width = '';\r\n                wrapRef.style.overflow = '';\r\n                // wrapRef.style.padding = '';\r\n                const data = this.store.scoreData;\r\n                data.chordList.splice(state.focusIndex, 1);\r\n                this.score.setScoreData(data);\r\n                state.focusIndex--;\r\n                this.score.setScoreState(state);\r\n                // setTimeout(() => {\r\n                //     reffer.style.opacity = '';\r\n                //     reffer.style.width = '';\r\n                //     const data = this.store.scoreData;\r\n                //     data.chordList.splice(state.focusIndex, 1);\r\n                //     this.score.setScoreData(data);\r\n                // }, 200);\r\n            }, 200);\r\n        },\r\n\r\n        incrementSymbol: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.root == null) {\r\n                detail.root = { index: 0, isFlat: false };\r\n                this.score.setScoreData(data);\r\n            } else if (detail.root.index + sub >= 0 && detail.root.index + sub <= 11) {\r\n                detail.root.index += sub;\r\n                detail.root.isFlat = !isUp && ![0, 2, 4, 5, 7, 9, 11].includes(detail.root.index);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        setDiatonicChord: (scaleIndex: number) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const chord = DIATONIC_MAJOR_SCALE_LIST[scaleIndex];\r\n            detail.root = { ...chord.root };\r\n            detail.symbolKey = chord.symbolKey;\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        setDefaultBacking: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            if (symbol.attr != undefined) {\r\n                detail.backing = getDefaultBacking(symbol.attr);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        cloneBacking: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            state.cloneBacking = JSON.parse(JSON.stringify(detail.backing));\r\n            this.score.setScoreState(state);\r\n            console.log(`clone backing! \\n${JSON.stringify(state.cloneBacking)}`);\r\n        },\r\n\r\n        pastBacking: () => {\r\n            const state = this.store.scoreState;\r\n            if (state.cloneBacking != null) {\r\n                console.log(`paste backing! \\n${JSON.stringify(state.cloneBacking)}`);\r\n                const data = this.store.scoreData;\r\n                const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n                detail.backing = JSON.parse(JSON.stringify(state.cloneBacking));\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n    }\r\n\r\n    public symbol = {\r\n\r\n        toNext: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            const index = mng.index + sub;\r\n            if (index >= 0 && index <= mng.curLine.length - 1) {\r\n                mng.index += sub;\r\n                detail.symbolKey = mng.curLine[mng.index];\r\n                this.score.setScoreState(state);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        toBase: () => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            if (mng.parentLine.length > 0) {\r\n                detail.symbolKey = mng.parentLine[0];\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        toDerive: () => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            if (mng.childrenLine.length > 0) {\r\n                detail.symbolKey = mng.childrenLine[0];\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n    }\r\n\r\n    public tune = {\r\n\r\n        setState: (tuneState: MelodyState) => {\r\n            this.dispatch(ActionType.SET_TUNE_STATE, { tuneState });\r\n        },\r\n\r\n        allSelect: () => {\r\n            const state = this.store.melodyState;\r\n            const notesList = this.store.scoreData.notesList;\r\n            if (notesList.length > 0) {\r\n                state.focusIndex = 0;\r\n                state.distIndex = notesList.length - 1;\r\n                this.tune.setState(state);\r\n            }\r\n        },\r\n\r\n        setNotesList: (notesList: TuneNotes[]) => {\r\n            const data = this.store.scoreData;\r\n            data.notesList = notesList;\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        setInstrument: (soundfontPlayer: Soundfont.Player) => {\r\n            this.dispatch(ActionType.SET_INSTRUMENTS, {\r\n                instruments: {\r\n                    ...this.store.instruments, soundfontPlayer\r\n                }\r\n            });\r\n        },\r\n\r\n        incrementCurNoteKey: (isUpper: boolean, mode: MelodyPitchMode) => {\r\n\r\n            const focusIndex = this.store.melodyState.focusIndex;\r\n            if (focusIndex === -1) return;\r\n\r\n            const init = this.store.scoreData.chordList[0].detail as DetailInit;\r\n            const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n            const notesList = this.store.scoreData.notesList;\r\n\r\n            const cur = notesList[focusIndex];\r\n            const prevPitchIndex = cur.pitchIndex;\r\n            const interval = mode !== 'octave' ? 1 : 12;\r\n            let tempPitchIndex = cur.pitchIndex;\r\n\r\n            while (isUpper ? cur.pitchIndex > 0 : cur.pitchIndex < PITCH_MAX - 1) {\r\n                tempPitchIndex += interval * (isUpper ? -1 : 1);\r\n\r\n                if (mode !== 'scale' ||\r\n                    (mode === 'scale' && scaleIndexies.includes(getKeyIndexFromPitcher(tempPitchIndex)))\r\n                ) {\r\n                    cur.pitchIndex = tempPitchIndex;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // \r\n            if (prevPitchIndex !== cur.pitchIndex) {\r\n                playSoundfont(cur.pitchIndex, this.store);\r\n                // \r\n                this.tune.setNotesList(notesList.slice());\r\n\r\n                this.tune.adjustScrollY();\r\n            }\r\n        },\r\n\r\n        setKeySwitch: (keySwitch: MelodyKeySwitch) => {\r\n            const state = this.store.melodyState;\r\n            state.keySwitch = keySwitch;\r\n            this.tune.setState(state);\r\n        },\r\n\r\n        moveFocus: (isNext: boolean) => {\r\n            const state = this.store.melodyState;\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n\r\n            // \r\n            if (state.focusIndex === -1) {\r\n                if (notesList.length > 0) {\r\n                    state.focusIndex = state.lastFocus;\r\n                    state.distIndex = state.focusIndex;\r\n                    this.tune.setState(state);\r\n                }\r\n            } else {\r\n                if (!isNext ? state.focusIndex > 0 : state.focusIndex < notesList.length - 1) {\r\n                    state.focusIndex += (isNext ? 1 : -1);\r\n                    state.distIndex = state.focusIndex;\r\n                    this.tune.setState(state);\r\n                }\r\n            }\r\n\r\n            this.tune.adjustScrollX();\r\n            this.tune.updateCurChord(state.focusIndex);\r\n        },\r\n\r\n        moveDistFocus: (isNext: boolean) => {\r\n            const state = this.store.melodyState;\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n\r\n            if (state.focusIndex === -1) return;\r\n\r\n            if (!isNext ? state.distIndex > 0 : state.distIndex < notesList.length - 1) {\r\n                state.distIndex += (isNext ? 1 : -1);\r\n                this.tune.setState(state);\r\n            }\r\n            this.tune.adjustScrollX();\r\n        },\r\n\r\n        updateCurChord: (focusIndex: number) => {\r\n            const state = this.store.melodyState;\r\n            const chordList = this.store.scoreData.chordList;\r\n            const x = getNormalizeLenFromNotes(this.store.scoreData.notesList[focusIndex].pos) * state.beatWidth;\r\n            let left = 0;\r\n            const searchedChord = chordList.find((element) => {\r\n                if (element.type === 'chord') {\r\n                    const detail = element.detail as DetailChord;\r\n                    const width = detail.beatLen * state.beatWidth;\r\n                    if (x >= left && x < left + width) {\r\n                        // alert(`x=${x}, left=${left}`);\r\n                        return element;\r\n                    }\r\n                    left += width;\r\n                }\r\n            });\r\n            state.mouseState.curChord = searchedChord == undefined ? null : searchedChord;\r\n            this.tune.setState(state);\r\n        },\r\n\r\n        addNotes: () => {\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const pos = getAdditionNotsLen(cur.pos, cur.len);\r\n            const newLeftNormal = getNormalizeLenFromNotes(pos);\r\n            const nextNormalPos = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const newRightNormal = newLeftNormal + 1 / state.quantize;\r\n            // \r\n            if (nextNormalPos === -1 || newRightNormal <= nextNormalPos) {\r\n                data.notesList.splice(state.focusIndex + 1, 0, {\r\n                    pos,\r\n                    pitchIndex: cur.pitchIndex,\r\n                    len: getNotesLenFromQuantize(state.quantize, 1)\r\n                });\r\n                this.score.setScoreData(data);\r\n                state.focusIndex++;\r\n                state.distIndex = state.focusIndex;\r\n                this.tune.setState(state);\r\n            }\r\n\r\n            this.tune.adjustScrollX();\r\n        },\r\n\r\n        removeNotes: () => {\r\n            const state = this.store.melodyState;\r\n            const notesList = this.store.scoreData.notesList;\r\n            const [start, end] = state.focusIndex < state.distIndex ? [state.focusIndex, state.distIndex] : [state.distIndex, state.focusIndex];\r\n            const delNum = end - start + 1;\r\n            notesList.splice(start, delNum);\r\n            this.tune.setNotesList(notesList);\r\n            state.focusIndex = start - 1;\r\n            state.distIndex = state.focusIndex;\r\n            this.tune.setState(state);\r\n            this.tune.adjustScrollX();\r\n        },\r\n\r\n        releaseRange: (isTail: boolean) => {\r\n            const state = this.store.melodyState;\r\n            const [start, end] = state.focusIndex < state.distIndex ? [state.focusIndex, state.distIndex] : [state.distIndex, state.focusIndex];\r\n            state.focusIndex = (!isTail ? start : end);\r\n            state.distIndex = state.focusIndex;\r\n            this.tune.setState(state);\r\n            this.tune.adjustScrollX();\r\n            this.tune.updateCurChord(state.focusIndex);\r\n        },\r\n\r\n        resizeNotes: (isSpread: boolean) => {\r\n\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const curLenNormal = getNormalizeLenFromNotes(cur.len);\r\n            const curNormalRight = getNormalizeLenFromNotes(cur.pos) + curLenNormal;\r\n            const nextNormalPos = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const resizeNormal = 1 / state.quantize;\r\n            const condition = !isSpread ?\r\n                // \r\n                curLenNormal > resizeNormal :\r\n                // \r\n                nextNormalPos === -1 || curNormalRight + resizeNormal <= nextNormalPos\r\n            // \r\n            if (condition) {\r\n                const normal = getNormalizeLenFromNotes(cur.len) + resizeNormal * (isSpread ? 1 : -1);\r\n                cur.len = getNotesLenFromQuantize(state.quantize, normal * state.quantize);\r\n                data.notesList = notesList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        moveNotes: (isBehind: boolean) => {\r\n\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n\r\n            const distIndex = state.distIndex;\r\n            const focusIndex = state.focusIndex;\r\n\r\n            const [start, end] = distIndex > focusIndex ? [focusIndex, distIndex] : [distIndex, focusIndex];\r\n            const prevNormalRight = start === 0 ? 0 : getNormalizeLenFromNotes(notesList[start - 1].pos) +\r\n                getNormalizeLenFromNotes(notesList[state.focusIndex - 1].len);\r\n            const nextNormalLeft = end === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[end + 1].pos);\r\n            const moveNormal = 1 / state.quantize;\r\n\r\n            const curNormalLeft = getNormalizeLenFromNotes(notesList[start].pos);\r\n            const curNormalRight = getNormalizeLenFromNotes(notesList[end].pos) + getNormalizeLenFromNotes(notesList[end].len);\r\n\r\n            const condition = !isBehind ?\r\n                // \r\n                curNormalLeft - moveNormal >= prevNormalRight :\r\n                // \r\n                nextNormalLeft === -1 || curNormalRight + moveNormal <= nextNormalLeft\r\n            // \r\n            if (condition) {\r\n                for (let i = start; i <= end; i++) {\r\n                    const cur = notesList[i];\r\n                    const normal = getNormalizeLenFromNotes(cur.pos) + moveNormal * (isBehind ? 1 : -1);\r\n                    cur.pos = getNotesLenFromQuantize(state.quantize, normal * state.quantize);\r\n                }\r\n                data.notesList = notesList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        firstNotes: () => {\r\n            const state = this.store.melodyState;\r\n            const notesList = this.store.scoreData.notesList;\r\n\r\n            if (notesList.length > 0) {\r\n                state.focusIndex = 0;\r\n                state.distIndex = state.focusIndex;\r\n                this.tune.setState(state);\r\n                this.tune.adjustScrollX();\r\n                // this.tune.adjustScrollY();\r\n            }\r\n        },\r\n\r\n        adjustScrollX: () => {\r\n            const state = this.store.melodyState;\r\n            const table = this.store.refs.melody.table;\r\n            const focusIndex = state.distIndex;\r\n            if (focusIndex !== -1 && table != null) {\r\n                const notesX = getNormalizeLenFromNotes(this.store.scoreData.notesList[focusIndex].pos) * state.beatWidth;\r\n                table.scrollTo({ left: notesX - 300, behavior: \"smooth\" });\r\n            }\r\n        },\r\n\r\n        adjustScrollY: () => {\r\n            const state = this.store.melodyState;\r\n            const table = this.store.refs.melody.table;\r\n            if (state.focusIndex !== -1 && table != null) {\r\n                const notesY = this.store.scoreData.notesList[state.focusIndex].pitchIndex * TUNE_PITCH_HEIGHT;\r\n                table.scrollTo({ top: notesY - table.clientHeight / 2, behavior: \"smooth\" });\r\n            }\r\n        },\r\n\r\n        previewStart: () => {\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            previewStart(this.store, this);\r\n        },\r\n\r\n        copyNotes: () => {\r\n\r\n            const state = this.store.melodyState;\r\n            const notesList = this.store.scoreData.notesList;\r\n            const [focusStart, focusEnd] = state.focusIndex < state.distIndex ? [state.focusIndex, state.distIndex] : [state.distIndex, state.focusIndex];\r\n            const num = focusEnd - focusStart + 1;\r\n\r\n            const cloneNotesList: TuneNotes[] = [];\r\n            const base = notesList[focusStart].pos;\r\n            const baseUnit = getMinimumLenUnit(base);\r\n            for (let i = 0; i < num; i++) {\r\n                const notes = notesList[i + focusStart];\r\n                const unit = getMinimumLenUnit(notes.pos);\r\n                const useUnit = baseUnit > unit ? baseUnit : unit;\r\n                const normalPos = getNormalizeLenFromNotes(notes.pos) - getNormalizeLenFromNotes(base);\r\n                const pos = getNotesLenFromQuantize(useUnit, normalPos / (1 / useUnit));\r\n                console.log(`normalPos = ${normalPos}, unit = ${useUnit}`);\r\n                console.log(JSON.stringify(pos));\r\n                cloneNotesList.push({\r\n                    pitchIndex: notes.pitchIndex,\r\n                    pos,\r\n                    len: { ...notes.len }\r\n                });\r\n            }\r\n            state.cloneNotesList = cloneNotesList;\r\n            // notesList.splice(state.focusIndex, num);\r\n            // this.tune.setNotesList(notesList);\r\n            // state.focusIndex = focusStart - 1;\r\n            // state.distIndex = state.focusIndex;\r\n            this.tune.setState(state);\r\n            // alert(JSON.stringify(state.cloneNotesList));\r\n        },\r\n\r\n        pasteNotes: () => {\r\n            // alert('pasteNotes');\r\n\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const newLeft = getAdditionNotsLen(cur.pos, cur.len);\r\n            const nextNormalPos = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const pastList: TuneNotes[] = JSON.parse(JSON.stringify(state.cloneNotesList));\r\n            pastList.forEach(notes => {\r\n                notes.pos = getAdditionNotsLen(notes.pos, newLeft);\r\n            });\r\n            // \r\n            const pastLast = pastList[pastList.length - 1];\r\n            const newRightNormal = getNormalizeLenFromNotes(pastLast.pos) + getNormalizeLenFromNotes(pastLast.len);\r\n            // \r\n            console.log(`newRight: ${newRightNormal}, nextLeft: ${nextNormalPos}`);\r\n            if (nextNormalPos === -1 || newRightNormal <= nextNormalPos) {\r\n                data.notesList = notesList.concat(pastList);\r\n                // \r\n                data.notesList.sort((a, b) => {\r\n                    const posA = getNormalizeLenFromNotes(a.pos);\r\n                    const posB = getNormalizeLenFromNotes(b.pos);\r\n                    return posA === posB ? 0 : (\r\n                        posA < posB ? -1 : 1\r\n                    );\r\n                });\r\n                this.score.setScoreData(data);\r\n\r\n                state.focusIndex++;\r\n                state.distIndex = state.focusIndex + pastList.length - 1;\r\n                this.tune.setState(state);\r\n            }\r\n\r\n            // this.tune.adjustScrollX();\r\n        }\r\n    }\r\n\r\n    public backing = {\r\n\r\n        openBackingEditor: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const init = data.chordList[0].detail as DetailInit;\r\n            // const cache = state.elementCacheList[state.focusIndex];\r\n            state.hideMenu = 'backing';\r\n            this.score.setScoreState(state);\r\n            const voicingTable = this.backing.getInitVoicingTable(detail.backing.voicingList);\r\n\r\n            let pattern: BackingState.Pattern | null = null;\r\n            if (detail.backing.pattern != null) {\r\n                const patternProps = detail.backing.pattern;\r\n                const voicingStructs = BackingUtil.buildChannels(voicingTable);\r\n                const channels = BackingUtil.getChannels(voicingStructs, patternProps.channelSize);\r\n                const layers = BackingUtil.convertEditorLayerFromScore(patternProps.channelSize, patternProps.layers);;\r\n                pattern = {\r\n                    channelIndex: -1,\r\n                    lenIndex: 0,\r\n                    isUsePedal: false,\r\n                    layerIndex: 0,\r\n                    channels,\r\n                    layers\r\n                };\r\n            }\r\n            this.backing.setState({\r\n                chordInfo: {\r\n                    root: (detail.root as DegreeProps),\r\n                    on: (detail.on),\r\n                    beatLen: detail.beatLen,\r\n                    minute: detail.minute,\r\n                    symbolKey: detail.symbolKey,\r\n                    init: { ...init }\r\n                },\r\n                voicingTable,\r\n                pattern,\r\n                isPreview: false,\r\n                hasError: false\r\n            });\r\n        },\r\n\r\n        closeBackingEditor: () => {\r\n            const state = this.store.scoreState;\r\n            state.hideMenu = 'none';\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        setState: (backingState: BackingState.Editor) => {\r\n            this.dispatch(ActionType.SET_BACKING_STATE, { backingState });\r\n        },\r\n\r\n        getInitialLayer: (): BackingState.Layer => {\r\n            return {\r\n                noteDivList: [{ rate: 4, isDot: false, div3: 0 }],\r\n                table: [[null]],\r\n                velocityList: [5]\r\n            } as BackingState.Layer;\r\n        },\r\n\r\n        getInitVoicingTable: (voicingList: VoicingProps[]): boolean[][] => {\r\n            const table = new Array<boolean[]>(8);\r\n            for (let i = 0; i < table.length; i++) {\r\n                table[i] = new Array<boolean>(6);\r\n                const col = table[i];\r\n                for (let j = 0; j < col.length; j++) {\r\n                    const isExist = voicingList.find(voicing => {\r\n                        if (voicing.octave === i && voicing.struct === j) {\r\n                            return voicing;\r\n                        }\r\n                    });\r\n                    table[i][j] = isExist != null;\r\n                }\r\n            }\r\n            return table;\r\n        },\r\n\r\n        // \r\n        mappingEditorToScore: () => {\r\n            const scoreState = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[scoreState.focusIndex].detail as DetailChord;\r\n            const editor = this.store.backingState as BackingState.Editor;\r\n\r\n            detail.backing = {\r\n                voicingList: BackingUtil.getVoicingListFromTable(editor.voicingTable),\r\n                pattern: editor.pattern == null ? null : BackingUtil.buildPatternProps(editor.pattern)\r\n            };\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        // getChannels: (table: boolean[][]): ChannelParam[] => {\r\n        //     const channels: ChannelParam[] = [];\r\n        //     for (let i = 0; i < table.length; i++) {\r\n        //         for (let j = 0; j < table[i].length; j++) {\r\n        //             if (table[i][j]) {\r\n        //                 channels.push({ octave: i, structIndex: j });\r\n        //             }\r\n        //         }\r\n        //     }\r\n        //     if (channels.length === 0) {\r\n        //         channels.push({ octave: -1, structIndex: 0 });\r\n        //     }\r\n        //     return channels;\r\n        // },\r\n\r\n        addPatternColumn: () => {\r\n\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const lenList = layer.noteDivList;\r\n            const newLen: BackingState.NoteDiv = { rate: lenList[pattern.lenIndex].rate, div3: 0, isDot: false };\r\n            lenList.splice(pattern.lenIndex + 1, 0, newLen);\r\n\r\n            // \r\n            layer.table.forEach((column) => {\r\n                column.splice(pattern.lenIndex + 1, 0, null);\r\n            });\r\n\r\n            // \r\n            layer.velocityList.splice(pattern.lenIndex + 1, 0, 5);\r\n            this.backing.updateErrorState();\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        movePatternColumn: (isRight: boolean) => {\r\n\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n\r\n            let tempIndex = pattern.lenIndex;\r\n            tempIndex += 1 * (isRight ? 1 : -1);\r\n            if (tempIndex >= 0 && tempIndex <= layer.noteDivList.length - 1) {\r\n                pattern.lenIndex = tempIndex;\r\n            }\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        moveChannelIndex: (isDown: boolean) => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const index = pattern.channelIndex;\r\n\r\n            if (!isDown ? index > 0 : index < pattern.channels.length - 1) {\r\n                pattern.channelIndex += (!isDown ? -1 : 1);\r\n            }\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        setCurrentDivRate: (rate: BackingState.NoteRate) => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const cur = layer.noteDivList[pattern.lenIndex];\r\n            cur.rate = rate;\r\n            this.backing.updateErrorState();\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        toggleCurrentDivHalf: () => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const cur = layer.noteDivList[pattern.lenIndex];\r\n            cur.isDot = !cur.isDot;\r\n            this.backing.setState(state);\r\n            this.backing.updateErrorState();\r\n        },\r\n\r\n\r\n        getNotes: () => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            return layer.table[pattern.channels.length - 1 - pattern.channelIndex][pattern.lenIndex];\r\n        },\r\n\r\n        setNotes: (notes: BackingState.NoteStatus | null) => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            layer.table[pattern.channels.length - 1 - pattern.channelIndex][pattern.lenIndex] = notes;\r\n            this.backing.updateErrorState();\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        incrementVel: (value: number) => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const after = layer.velocityList[pattern.lenIndex] + value;\r\n            if(after >= 1 && after <= 10) {\r\n                layer.velocityList[pattern.lenIndex] = after;\r\n                this.backing.setState(state);\r\n            }\r\n        },\r\n\r\n        deleteColumn: () => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            // 2\r\n            if (layer.noteDivList.length >= 2) {\r\n                layer.noteDivList.splice(pattern.lenIndex, 1);\r\n                layer.table.forEach((column) => {\r\n                    column.splice(pattern.lenIndex, 1);\r\n                });\r\n                layer.velocityList.splice(pattern.lenIndex, 1);\r\n                // for(let i = 0; i < pattern.channels.length; i ++) {\r\n                //     layer.table[i].splice(pattern.lenIndex, 1);\r\n                // }\r\n                if (pattern.lenIndex > 0) {\r\n                    pattern.lenIndex--;\r\n                }\r\n                this.backing.setState(state);\r\n            }\r\n            this.backing.updateErrorState();\r\n        },\r\n\r\n        changeLayer: () => {\r\n            const state = this.store.backingState as BackingState.Editor;\r\n            const pattern = state.pattern as BackingState.Pattern;\r\n            pattern.layerIndex = pattern.layerIndex === 0 ? 1 : 0;\r\n            pattern.lenIndex = 0;\r\n            pattern.channelIndex = -1;\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        testBacking: () => {\r\n            const init = this.store.scoreData.chordList[0].detail as DetailInit;\r\n            const editor = this.store.backingState as BackingState.Editor;\r\n            const reserveTasks = this.store.reserveTasks;\r\n            const chordInfo = editor.chordInfo;\r\n\r\n            const rootIndex = (chordInfo.root.index + chordInfo.init.keyIndex) % 12;\r\n            const symbol = getSymbolFromKey(chordInfo.symbolKey);\r\n            const len = chordInfo.beatLen + chordInfo.minute.head + chordInfo.minute.tail;\r\n            const chordTime = 60 / init.bpm * len;\r\n            const backing: ChordBacking = {\r\n                voicingList: BackingUtil.getVoicingListFromTable(editor.voicingTable as boolean[][]),\r\n                pattern: editor.pattern == null ? null : BackingUtil.buildPatternProps(editor.pattern)\r\n            };\r\n            const pitchList = BackingUtil.getPitchListFromVoicing(backing.voicingList, rootIndex, symbol);\r\n\r\n            BackingUtil.playBacking(this.store, reserveTasks, init.bpm, backing, pitchList, chordTime);\r\n\r\n            reserveTasks.push(setTimeout(() => {\r\n                editor.isPreview = false;\r\n                this.backing.setState(editor);\r\n            }, chordTime * 1000));\r\n\r\n            editor.isPreview = true;\r\n            this.backing.setState(editor);\r\n        },\r\n\r\n        updateErrorState: () => {\r\n            const editor = this.store.backingState as BackingState.Editor;\r\n            const voicingList = BackingUtil.getVoicingListFromTable(editor.voicingTable);\r\n            editor.hasError = BackingUtil.checkError(editor.chordInfo, voicingList, editor.pattern);\r\n            this.backing.setState(editor);\r\n        }\r\n    }\r\n}","\r\n\r\nnamespace DataHistory {\r\n\r\n    export type Manger = {\r\n        cur: number;\r\n        list: string[];\r\n    }\r\n\r\n    export const getInitialData = () => {\r\n        return {\r\n            cur: -1,\r\n            list: []\r\n        };\r\n    }\r\n\r\n    export const backup = (manager: Manger, data: string) => {\r\n        if (manager.cur === -1) {\r\n            manager.list.push(data);\r\n        } else {\r\n            // manager.list.splice(cur,);\r\n            manager.cur = -1;\r\n        }\r\n    }\r\n\r\n    export const undo = (manager: Manger): string => {\r\n        if (manager.cur === -1) {\r\n            manager.cur = manager.list.length - 1;\r\n        } else {\r\n            if(manager.cur > 0) {\r\n                manager.cur --;\r\n            }\r\n        }\r\n        return manager.list[manager.cur];\r\n    }\r\n}\r\n\r\nexport default DataHistory;\r\n","import { themaColorNormal } from \"../../base/design/thema/themaColorNormal\"\r\nimport { getDefaultSampler } from \"../../utils/instrumentsUtil\"\r\nimport { RefsCache as RefsCache } from \"./refsCache\"\r\nimport { Instruments } from \"./instrument\"\r\nimport { ScoreData } from \"./scoreData\"\r\nimport { ScoreState } from \"./scoreState\"\r\nimport { SystemState } from \"./systemState\"\r\nimport { MelodyState } from \"./melodyState\"\r\nimport { getDefaultKeyConfig, UserEnv } from \"./userEnv\"\r\nimport { Invalidate } from \"./invalidate\"\r\nimport DataHistory from \"./state/dataHistory\"\r\nimport BackingState from \"./backingState\"\r\n\r\n\r\nexport type Store = {\r\n    userEnv: UserEnv;\r\n    systemState: SystemState;\r\n    scoreState: ScoreState;\r\n    backingState: null | BackingState.Editor;\r\n    melodyState: MelodyState;\r\n    scoreData: ScoreData;\r\n    instruments: Instruments;\r\n    refs: RefsCache;\r\n    reserveTasks: NodeJS.Timeout[];\r\n\r\n    invalidate: Invalidate;\r\n}\r\n\r\nexport const initialStore: Store = {\r\n    userEnv: {\r\n        keyConfig: getDefaultKeyConfig(),\r\n        colorProps: themaColorNormal,\r\n    },\r\n    systemState: {\r\n        isSplash: true,\r\n        mainChannelIndex: 0,\r\n        scoreTabIndex: 0,\r\n        dialogMode: 'none'\r\n    },\r\n    backingState: null,\r\n    scoreState: {\r\n        isTune: false,\r\n        initialBeat: 4,\r\n        focusIndex: -1,\r\n        elementCacheList: [],\r\n        sectionCacheList: [],\r\n        keySwitch: {\r\n            editMode: false,\r\n            symbolMode: false\r\n        },\r\n        symbolMng: null,\r\n        hideMenu: 'none',\r\n        isPreview: false,\r\n        isSolo: false,\r\n        cloneBacking: null\r\n    },\r\n    melodyState: {\r\n        focusIndex: -1,\r\n        distIndex: -1,\r\n        lastFocus: -1,\r\n        quantize: 4,\r\n        beatWidth: 120,\r\n        mouseState: {\r\n            isPut: false,\r\n            lock: { x: 0, y: 0 },\r\n            width: 0,\r\n            prevRight: 0,\r\n            nextLeft: 0,\r\n            notesState: { index: -1, side: 'normal', isResize: false, isMove: false },\r\n            curChord: null,\r\n            mousePitchIndex: -1,\r\n            mouseMeasurePos: -1\r\n        },\r\n        soundfontInfo: {\r\n            name: 'violin',\r\n            gain: 5\r\n        },\r\n        keySwitch: {\r\n            scaleMode: false,\r\n            octave: false,\r\n            resize: false,\r\n            move: false,\r\n            shift: false,\r\n            control: false,\r\n        },\r\n        isPreview: false,\r\n        isSolo: false,\r\n        cloneNotesList: [],\r\n\r\n        dataHistory: DataHistory.getInitialData()\r\n    },\r\n    scoreData: {\r\n        chordList: [],\r\n        notesList: []\r\n    },\r\n    instruments: {\r\n        sampler: getDefaultSampler(),\r\n        harmony: null,\r\n        soundfontPlayer: null\r\n    },\r\n\r\n    refs: {\r\n        harmonize: {\r\n            note: {} as HTMLDivElement\r\n        },\r\n        melody: {\r\n            table: null,\r\n            measure: null,\r\n            chord: null,\r\n            pitch: null,\r\n        }\r\n    },\r\n    reserveTasks: [],\r\n    invalidate: {\r\n        harmoniizeInvalidate: {},\r\n        harmonize: null,\r\n        melody: null\r\n    },\r\n}","import { ColorProps } from \"../../base/design/colorProps\";\r\n\r\nexport type UserEnv = {\r\n    keyConfig: KeyConfig;\r\n    colorProps: ColorProps;\r\n}\r\n\r\nexport type KeyConfig = {\r\n    note : {\r\n        prevElement: string;\r\n        nextElement: string;\r\n        prevSection: string;\r\n        nextSection: string;\r\n        addChord: string;\r\n        addSection: string;\r\n        addChange: string;\r\n        deleteCur: string;\r\n        editMode: string;\r\n        incRoot: string;\r\n        decRoot: string;\r\n        incBeat: string;\r\n        decBeat: string;\r\n        symbolMode: string;\r\n    }\r\n}\r\n\r\nexport const getDefaultKeyConfig = ()=> {\r\n    return {\r\n        note: {\r\n            prevElement: 'ArrowLeft',\r\n            nextElement: 'ArrowRight',\r\n            prevSection: 'ArrowUp',\r\n            nextSection: 'ArrowDown',\r\n            addChord: 'a',\r\n            addSection: 's',\r\n            addChange: 'f',\r\n            deleteCur: 'Delete',\r\n            editMode: 'Shift',\r\n            incRoot: 'ArrowUp',\r\n            decRoot: 'ArrowDown',\r\n            incBeat: 'ArrowRight',\r\n            decBeat: 'ArrowLeft',\r\n            symbolMode: 'c',\r\n        }\r\n    } as KeyConfig;\r\n}","import { ColorProps } from \"../colorProps\";\r\n\r\nexport const themaColorNormal: ColorProps = {\r\n    entryBackground: '#e2a9ae',\r\n}","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst SysModalDialog = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const mode = store.systemState.dialogMode;\r\n    const isDisplay = mode !== 'none';\r\n\r\n    return (\r\n        <_Blind isDisplay={isDisplay}>\r\n            <_Frame>\r\n\r\n            </_Frame>\r\n        </_Blind>\r\n    );\r\n}\r\n\r\nexport default SysModalDialog;\r\n\r\nconst _Blind = styled.div<{\r\n    isDisplay: boolean;\r\n}>`\r\n    display: ${props => props.isDisplay ? 'block' : 'none'};\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #000000d8;\r\n    z-index: 10;\r\n`;\r\nconst _Frame = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: 50px;\r\n    top: 50px;\r\n    width: 500px;\r\n    height: 400px;\r\n    background-color: #464646cc;\r\n    border: 1px solid #dadada;\r\n`;","import { useEffect, useState } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\ntype ChannelPaneProps = {\r\n    activeNo: number;\r\n    tabElements: ChannelElements[];\r\n    selectTabIndex?: Function;\r\n}\r\n\r\ntype ChannelElements = {\r\n    name: string;\r\n    icon: JSX.Element;\r\n    disable: boolean;\r\n    cont: JSX.Element;\r\n}\r\n\r\nexport const ChannelPane = (props: ChannelPaneProps) => {\r\n    const [activeNo, setActiveNo] = useState(props.activeNo);\r\n\r\n    // \r\n    const selectTabIndex = (index: number) => {\r\n        if (props.selectTabIndex != undefined) {\r\n            props.selectTabIndex(index);\r\n        } else {\r\n            setActiveNo(index);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setActiveNo(props.activeNo);\r\n    }, [props.activeNo]);\r\n\r\n    return (\r\n        <>\r\n            <_LabelList>\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <ChannelLabel\r\n                            key={index} name={tab.name} icon={tab.icon} isActive={index == activeNo} isDisable={tab.disable}\r\n                            selectTab={() => selectTabIndex(index)}\r\n                        />\r\n                    })\r\n                }\r\n            </_LabelList>\r\n            <_ContList>\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <ChannelContents key={index} cont={tab.cont} isActive={index === activeNo} />\r\n                    })\r\n                }\r\n            </_ContList>\r\n        </>\r\n    );\r\n}\r\n\r\nconst ChannelLabel = (props: {\r\n    name: string;\r\n    icon: JSX.Element;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    selectTab: Function;\r\n}) => {\r\n    return (\r\n        <_Item\r\n            isActive={props.isActive}\r\n            onClick={() => props.selectTab()}\r\n        >\r\n            <_Icon>{props.icon}</_Icon>\r\n            <_Label>{props.name}</_Label>\r\n        </_Item>\r\n    );\r\n}\r\n\r\nconst ChannelContents = (props: {\r\n    isActive: boolean;\r\n    cont: JSX.Element;\r\n}) => {\r\n    return (\r\n        <_Contents isActive={props.isActive}>\r\n            {props.cont}\r\n        </_Contents>\r\n    );\r\n}\r\n\r\nconst _LabelList = styled.div`\r\n    display: inline-block;\r\n    width: 100px;\r\n    margin-right: 5px;\r\n    height: 100%;\r\n    background-color: #b9b9b9;\r\n    border: 1px solid #707070;\r\n    box-sizing: border-box;\r\n    border-radius: 10px 0 0 10px;\r\n    vertical-align: top;\r\n    box-shadow: 1px 2px 12px #aaaaaa;\r\n`;\r\nconst _ContList = styled.div`\r\n    display: inline-block;\r\n    background-color: #b9b9b9;\r\n    border: 1px solid #707070;\r\n    box-sizing: border-box;\r\n    width: calc(100% - 105px);\r\n    height: 100%;\r\n    border-radius: 0 6px 6px 0;\r\n    box-shadow: 1px 2px 12px #aaaaaa;\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    /* margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px); */\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: #ece6e6; */\r\n    ${props => !props.isActive ? css`display: none;` : css`display: inline-block;`}\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 90px;\r\n    height: 90px;\r\n    margin: 5px 0 0 5px;\r\n    border-radius: 10px;\r\n    ${props => {\r\n        if (props.isActive) {\r\n            return css`\r\n                background-color: #e4e3e1;\r\n                border: 1px solid #949494\r\n            `;\r\n        } else {\r\n            return css`\r\n                background-color: #d1d1d1;\r\n                opacity: 0.8;\r\n            `;\r\n        }\r\n    }}\r\n    transition: background-color 500ms;\r\n    & *{\r\n        transition: color 150ms;\r\n    }\r\n    // hover\r\n    ${props => props.isActive ? '' : css`\r\n        &:hover {\r\n            & *{\r\n                transition: color 150ms;\r\n                /* background-color: #e2d6d6; */\r\n                text-shadow: 1px 2px 22px #f7f7f7ea;\r\n                color: #a7a7a7;\r\n            }\r\n        }\r\n    `}\r\n`;\r\n\r\nconst IconHover = css`\r\n    text-shadow: 1px 2px 22px #f7f7f7cf;\r\n    color: #a3a3a3;\r\n`;\r\n\r\nconst _Icon = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 60px;\r\n    /* background-color: #df828221; */\r\n    font-size: 50px;\r\n    color: #757575;\r\n    text-align: center;\r\n    padding-top: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    /* background-color: #8482df20; */\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    color: #757575;\r\n    text-align: center;\r\n`;","import { useEffect, useState } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\ntype TabbedPaneProps = {\r\n    activeNo: number;\r\n    tabElements: TabElements[];\r\n    selectTabIndex?: Function;\r\n}\r\n\r\ntype TabElements = {\r\n    name: string;\r\n    disable: boolean;\r\n    cont: JSX.Element;\r\n}\r\n\r\nexport const TabbedPane = (props: TabbedPaneProps) => {\r\n    const [activeNo, setActiveNo] = useState(props.activeNo);\r\n\r\n    // \r\n    const selectTabIndex = (index: number) => {\r\n        if (props.selectTabIndex != undefined) {\r\n            props.selectTabIndex(index);\r\n        } else {\r\n            setActiveNo(index);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setActiveNo(props.activeNo);\r\n    }, [props.activeNo]);\r\n\r\n    return (\r\n        <>\r\n            <_LabelList>\r\n                {/* {tabList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabLabel\r\n                            key={index} name={tab.name} isActive={index == activeNo} isDisable={tab.disable}\r\n                            selectTab={() => selectTabIndex(index)}\r\n                        />\r\n                    })\r\n                }\r\n            </_LabelList>\r\n            <_ContList>\r\n                {/* {contList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabContents key={index} cont={tab.cont} isActive={index === activeNo} />\r\n                    })\r\n                }\r\n            </_ContList>\r\n        </>\r\n    );\r\n}\r\n\r\nconst TabLabel = (props: {\r\n    name: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    selectTab: Function;\r\n}) => {\r\n    return (\r\n        <_TabLabel\r\n            isDisable={props.isDisable}\r\n            isActive={props.isActive}\r\n            onClick={() => props.selectTab()}>\r\n            {props.name}\r\n        </_TabLabel>\r\n    );\r\n}\r\n\r\nconst TabContents = (props: {\r\n    isActive: boolean;\r\n    cont: JSX.Element;\r\n}) => {\r\n    // return props.isActive ?\r\n    //     <div className=\"tab-cont\">{props.cont}</div>\r\n    //     :\r\n    //     <></>\r\n    //     ;\r\n    return (\r\n        <_Contents isActive={props.isActive}>\r\n            {props.cont}\r\n        </_Contents>\r\n    );\r\n}\r\n\r\nconst _LabelList = styled.div`\r\n    display: inline-block;\r\n    height: 35px;\r\n`;\r\nconst _ContList = styled.div`\r\n    display: block;\r\n    background-color: #999999;\r\n    height: calc(100% - 35px);\r\n    border-radius: 0 6px 6px 6px;\r\n    box-shadow: 0 2px 0 0 #000b3a48;\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px);\r\n    ${props => !props.isActive ? css`display: none;` : css`display: inline-block;`}\r\n`;\r\n\r\nconst _TabLabel = styled.div<{\r\n    isDisable: boolean;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    /* width: 100px; */\r\n    padding: 0 10px;\r\n    ${props => {\r\n        if (props.isActive) {\r\n            return css`\r\n                color: #ebebeb;\r\n                padding: 0 35px;\r\n                background-color: #999999;\r\n                height: 35px;\r\n                font-size: 24px;\r\n                border-radius: 3px 15px 0 0;\r\n                text-shadow: 1px 2px 3px #00000065;\r\n            `;\r\n        } else {\r\n            return css`\r\n                height: 100%;\r\n                color: #555;\r\n                /* background-color: #90909b; */\r\n                background: linear-gradient(to bottom, #999999, #7a7a7a);\r\n                height: 30px;\r\n                font-size: 18px;\r\n                border-radius: 3px 10px 0 0;\r\n                ${!props.isDisable ? '' : css`\r\n                    pointer-events: none;\r\n                    opacity: 0.7;\r\n                `}\r\n            `;\r\n        }\r\n    }}\r\n    /* opacity: 0.7; */\r\n    user-select: none;\r\n    margin-right: 6px;\r\n    font-weight: 600;\r\n    box-sizing: border-box;\r\n    line-height: 30px;\r\n    vertical-align: bottom;\r\n    transition: padding 100ms;\r\n`;","import styled, { css } from \"styled-components\";\r\n\r\nexport const _WrapperFrame = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n`;\r\n\r\nexport const _Object = styled.div`\r\n    display: inline-block;\r\n`;\r\n\r\nexport const _Record = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n`;\r\n\r\nexport const _CSS_LABEL_SMALL = css`\r\n    display: inline-block;\r\n    height: 30px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: black;\r\n    line-height: 18px;\r\n`;\r\n\r\n\r\nexport const _CSS_LABEL_MIDIUM = css`\r\n    display: inline-block;\r\n    height: 30px;\r\n    font-size: 24px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    color: black;\r\n    line-height: 24px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nexport const _CSS_DISABLE = css`\r\n    opacity: 0.6;\r\n    pointer-events: none;\r\n`;","import { Dispatcher } from \"../../../redux/dispatcher/dispatcher\";\r\nimport { ChordBacking, DetailChord, DetailFixed, DetailInit, DetailSection, ScoreData, VoicingProps } from \"../../../redux/store/scoreData\";\r\nimport { Store } from \"../../../redux/store/store\";\r\nimport { getDefaultBacking } from \"../../../utils/instrumentsUtil\";\r\nimport { DegreeProps, DIATONIC_MAJOR_SCALE_LIST, getSymbolFromKey, SymbolKey } from \"../../../utils/theoryUtils\";\r\n\r\n\r\nclass ScoreBuilder {\r\n\r\n    private scoreData: ScoreData\r\n\r\n    private curIndex: number;\r\n\r\n    constructor(init: DetailInit) {\r\n        this.scoreData = {\r\n            chordList: [\r\n                { type: 'init', detail: init },\r\n                { type: 'fixed', detail: { fixed: 'Start' } as DetailFixed },\r\n                { type: 'section', detail: { labelName: 'Section' } as DetailSection },\r\n                { type: 'fixed', detail: { fixed: 'End' } as DetailFixed },\r\n            ],\r\n            notesList: []\r\n        };\r\n\r\n        this.curIndex = 3;\r\n    }\r\n\r\n    public addChord = (beatLen: number, root: DegreeProps, symbolKey: SymbolKey) => {\r\n\r\n        const symbol = getSymbolFromKey(symbolKey);\r\n        const backing: ChordBacking = symbol.attr == undefined ? { voicingList: [], pattern: null } : getDefaultBacking(symbol.attr);\r\n        this.scoreData.chordList.splice(this.curIndex, 0, {\r\n            type: 'chord', detail: {\r\n                beatLen, minute: { head: 0, tail: 0 }, root, on: null, symbolKey,\r\n                backing\r\n            } as DetailChord\r\n        });\r\n        this.curIndex++;\r\n    }\r\n\r\n    public addChordDiatonic = (beatLen: number, scaleIndex: number) => {\r\n        const chord = DIATONIC_MAJOR_SCALE_LIST[scaleIndex];\r\n        this.addChord(beatLen, chord.root, chord.symbolKey);\r\n    }\r\n\r\n    public getScoreData = () => { return this.scoreData; }\r\n}\r\n\r\nexport default ScoreBuilder;","import { useContext, useState } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../base/components/button/executableButton\";\r\nimport { _CSS_LABEL_MIDIUM } from \"../../../base/design/styles\";\r\nimport { ChordBacking, DetailChord, DetailFixed, DetailInit, DetailSection, ScoreData } from \"../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\nimport ScoreBuilder from \"./scoreBuilder\";\r\n\r\nconst ManageTab = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [source, setSource] = useState<string>('');\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Left>\r\n                <_Link onClick={() => {\r\n\r\n                    const data: ScoreData = {\r\n                        chordList: [\r\n                            { type: 'init', detail: { keyIndex: 0, bpm: 100, scale: 'major', timeSignature: '4/4' } as DetailInit },\r\n                            { type: 'fixed', detail: { fixed: 'Start' } as DetailFixed },\r\n                            { type: 'section', detail: { labelName: 'Section' } as DetailSection },\r\n                            {\r\n                                type: 'chord', detail: {\r\n                                    beatLen: 4, minute: { head: 0, tail: 0 }, root: null, on: null, symbolKey: 'major',\r\n                                    backing: {\r\n                                        voicingList: [],\r\n                                        pattern: null\r\n                                    }\r\n                                } as DetailChord\r\n                            },\r\n                            { type: 'fixed', detail: { fixed: 'End' } as DetailFixed },\r\n                        ],\r\n                        notesList: []\r\n                    };\r\n                    setSource(JSON.stringify(data));\r\n                }} >Create an empty score.</_Link>\r\n                <_Link onClick={() => {\r\n                    const builder = new ScoreBuilder({ keyIndex: 0, bpm: 100, scale: 'major', timeSignature: '4/4' });\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 2);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 1);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 2);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 1);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    setSource(JSON.stringify(builder.getScoreData()));\r\n                }} >mm</_Link>\r\n                <_Link onClick={() => {\r\n                    const builder = new ScoreBuilder({ keyIndex: 0, bpm: 100, scale: 'major', timeSignature: '4/4' });\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 0);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    builder.addChordDiatonic(2, 3);\r\n                    builder.addChordDiatonic(2, 4);\r\n                    builder.addChordDiatonic(2, 5);\r\n                    setSource(JSON.stringify(builder.getScoreData()));\r\n                }} >mm</_Link>\r\n                <_Link onClick={() => {\r\n                    const builder = new ScoreBuilder({ keyIndex: 0, bpm: 100, scale: 'major', timeSignature: '4/4' });\r\n                    builder.addChordDiatonic(4, 3);\r\n                    builder.addChordDiatonic(4, 4);\r\n                    builder.addChordDiatonic(4, 2);\r\n                    builder.addChordDiatonic(4, 5);\r\n                    builder.addChordDiatonic(4, 1);\r\n                    builder.addChordDiatonic(4, 4);\r\n                    builder.addChord(4, { index: 0, isFlat: false }, 'suspend4th');\r\n                    builder.addChordDiatonic(4, 0);\r\n                    setSource(JSON.stringify(builder.getScoreData()));\r\n                }} >mmmsus4</_Link>\r\n            </_Left>\r\n            <_Right>\r\n                <_Source value={source} onChange={e => setSource(e.target.value)} />\r\n                <_ButtonsDiv>\r\n                    <_Button onClick={() => {\r\n                        setSource(JSON.stringify(store.scoreData));\r\n                    }}>Reload</_Button>\r\n                    <_Button onClick={() => {\r\n                        const data = JSON.parse(source);\r\n                        dispatcher.score.setScoreData(data);\r\n                        store.scoreState.focusIndex = 2;\r\n                        dispatcher.score.setScoreState({ ...store.scoreState });\r\n\r\n                        dispatcher.score.setScoreTabIndex(1);\r\n                    }}>Apply</_Button>\r\n                </_ButtonsDiv>\r\n            </_Right>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ManageTab;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #7e7e7e;\r\n    text-align: left;\r\n`;\r\n\r\nconst _Left = styled.div`\r\n    display: inline-block;\r\n    width: 50%;\r\n    height: 100%;\r\n    background-color: #7e7e7e;\r\n    text-align: left;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _Right = styled.div`\r\n    display: inline-block;\r\n    width: 50%;\r\n    height: 100%;\r\n    background-color: #888999;\r\n    text-align: left;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _Link = styled.div`\r\n    \r\n    display: inline-block;\r\n    width: calc(100% - 50px);\r\n    height: 50px;\r\n    margin: 20px 25px;\r\n    border: 2px solid #cacaca;\r\n    /* background: linear-gradient(to bottom, #585858, #a7a7a7, #585858); */\r\n    background-color: #000;\r\n    color: #ccc;\r\n    font-size: 30px;\r\n    font-weight: 600;\r\n    text-align: left;\r\n    box-sizing: border-box;\r\n    padding-left: 20px;\r\n    border-radius: 6px;\r\n\r\n    &:hover {\r\n        background-color: #616161;\r\n    }\r\n`;\r\n\r\nconst _Source = styled.textarea`\r\n    display: inline-block;\r\n    width: calc(100% - 8px);\r\n    margin: 4px 0 0 4px;\r\n    height: calc(100% - 44px);\r\n    /* background-color: #7e7e7e; */\r\n    text-align: left;\r\n    font-size: 20px;\r\n    resize: none;\r\n    box-sizing: border-box;\r\n    color: #060053;\r\n`;\r\n\r\nconst _ButtonsDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 40px;\r\n    background-color: #5f5f5f;\r\n    box-sizing: border-box;\r\n    text-align: left;\r\n`;\r\n\r\nconst _Button = styled.div`\r\n    ${_CSS_LABEL_MIDIUM}\r\n    width: 100px;\r\n    background-color: #afafaf;\r\n    border: 1px solid #4d4d4d;\r\n    color: #292929;\r\n    border-radius: 4px;\r\n    margin: 5px 0 0 4px;\r\n    &:hover {\r\n        background-color: #c4c4c4;\r\n    }\r\n`;","import { useContext, useEffect, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { SymbolDiagram } from \"../../../../../redux/store/scoreState\";\r\nimport { getSymbolDerives as getSymbolDerives, getSymbolFromKey, SymbolKey, SymbolParams, SYMBOL_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SymbolEditor = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const detail = store.scoreData.chordList[state.focusIndex].detail as DetailChord;\r\n\r\n    // \r\n    useEffect(() => {\r\n\r\n        const curSymbol = getSymbolFromKey(detail.symbolKey) as SymbolParams;\r\n        const baseSymbol = curSymbol.base == null ? null : getSymbolFromKey(curSymbol.base);\r\n\r\n        const curLine: SymbolKey[] = [];\r\n        const parentLine: SymbolKey[] = [];\r\n        const childrenLine: SymbolKey[] = [];\r\n        let index = 0;\r\n\r\n        if (baseSymbol == null) {\r\n            curLine.push('major');\r\n            curLine.push('minor');\r\n            curLine.push('suspend4th');\r\n            curLine.push('diminish');\r\n            curLine.push('augument');\r\n            curLine.push('minor-minus5');\r\n        } else {\r\n            SYMBOL_LIST.forEach((symbol) => {\r\n                if (symbol.key === baseSymbol.key) {\r\n                    parentLine.push(symbol.key);\r\n                }\r\n            });\r\n            const derives = getSymbolDerives(baseSymbol.key);\r\n            SYMBOL_LIST.forEach((symbol) => {\r\n                if (derives.includes(symbol.key)) {\r\n                    curLine.push(symbol.key);\r\n                }\r\n            });\r\n        }\r\n        curLine.forEach((symbol, i)=> {\r\n            if(symbol === detail.symbolKey) {\r\n                index = i;\r\n            }\r\n        });\r\n        const derives = getSymbolDerives(curSymbol.key);\r\n        SYMBOL_LIST.forEach((symbol) => {\r\n            if (derives.includes(symbol.key)) {\r\n                childrenLine.push(symbol.key);\r\n            }\r\n        });\r\n        state.symbolMng = {\r\n            index,\r\n            curLine,\r\n            parentLine,\r\n            childrenLine\r\n        };\r\n        dispatcher.score.setScoreState(state);\r\n    }, [detail.symbolKey]);\r\n\r\n    // const bodyRef = state.elementCacheList[state.focusIndex].reffers.wrap as HTMLDivElement;\r\n\r\n    // const [posX, posY]: [number, number] = useMemo(() => {\r\n    //     return [bodyRef.clientLeft, bodyRef.clientTop + bodyRef.clientHeight];\r\n    // }, []);\r\n    // const posX = bodyRef.getBoundingClientRect().left;\r\n    // const posY = bodyRef.getBoundingClientRect().bottom;\r\n    // alert(`${posX}, ${posY}`);\r\n\r\n    const symbolMng = state.symbolMng as SymbolDiagram;\r\n\r\n    const parentJsx: JSX.Element[] = [];\r\n    const curJsx: JSX.Element[] = [];\r\n    const childrenJsx: JSX.Element[] = [];\r\n\r\n    if (symbolMng != null) {\r\n        parentJsx.push(<_Header key={parentJsx.length}>Base</_Header>);\r\n        symbolMng.parentLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            parentJsx.push(\r\n                <_Item key={parentJsx.length}\r\n                    isActive={false}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n        curJsx.push(<_Header key={curJsx.length}>Current</_Header>);\r\n        symbolMng.curLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            curJsx.push(\r\n                <_Item key={curJsx.length}\r\n                    isActive={symbolMng.index === i}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n        childrenJsx.push(<_Header key={childrenJsx.length}>Derives</_Header>);\r\n        symbolMng.childrenLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            childrenJsx.push(\r\n                <_Item key={childrenJsx.length}\r\n                    isActive={false}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Row>{parentJsx}</_Row>\r\n            <_Row>{curJsx}</_Row>\r\n            <_Row>{childrenJsx}</_Row>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SymbolEditor;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 30;\r\n    top: 100px;\r\n    left: 0;\r\n    width: 250px;\r\n    height: 160px;\r\n    background-color: #a9cfd422;\r\n    border: 2px solid #000000ec;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    opacity: 0.9;\r\n    box-shadow: 0 4px 16px 4px #000b3a48;\r\n    backdrop-filter: blur(6px);\r\n`;\r\n\r\nconst _Row = styled.div`\r\n    display: inline-block;\r\n    width: 80px;\r\n    height: 100%;\r\n    /* background-color: #e6e6e6; */\r\n    margin: 1px;\r\n    vertical-align: top;\r\n`;\r\n\r\n\r\nconst _Header = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    box-sizing: border-box;\r\n    /* background-color: #78dab4;\r\n    border: 1px solid #000000; */\r\n    background: linear-gradient(to bottom, #7a9ea3, #78cfda, #7a9ea3);\r\n    /* background: linear-gradient(to bottom, #a37a7a, #da7878, #a37a7a); */\r\n    margin: 1px;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #f3f3f3;\r\n    line-height: 17px;\r\n`;\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: 20px;\r\n    box-sizing: border-box;\r\n    background-color: #dbdbdb;\r\n    ${props => !props.isActive ? '' : css`background-color: #ffef64;`}\r\n    border: 1px solid #000000;\r\n    margin: 1px;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #000000;\r\n    line-height: 16px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../../redux/store/scoreData\";\r\nimport { ElementCache } from \"../../../../../../redux/store/scoreState\";\r\nimport { getChordRoot, getDegreeRoot, getSymbolFromKey } from \"../../../../../../utils/theoryUtils\";\r\nimport { ELEMENT_POS_INFO_WIDTH, FIRST_CHORD_INDEX } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcChord = (props: {\r\n    index: number;\r\n    detail: DetailChord;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const chordList = store.scoreData.chordList;\r\n    const element = chordList[props.index];\r\n    const cache = state.elementCacheList[props.index];\r\n\r\n    const symbolName = getSymbolFromKey(props.detail.symbolKey)?.name;\r\n\r\n    let degreeRoot: null | string = null;\r\n    let degreeOn: null | string = null;\r\n    let chordRoot: null | string = null;\r\n    let chordOn: null | string = null;\r\n    if (props.detail.root != null) {\r\n        degreeRoot = getDegreeRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        });\r\n        chordRoot = getChordRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        }, cache.keyIndex);\r\n\r\n        if (props.detail.on != null) {\r\n            degreeOn = getDegreeRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.on.isFlat\r\n            });\r\n            chordOn = getChordRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.root.isFlat\r\n            }, cache.keyIndex);\r\n        }\r\n    }\r\n\r\n    let bar = -1;\r\n    const prevCache = state.elementCacheList[props.index - 1];\r\n    // \r\n    // 1\r\n    if (props.index === FIRST_CHORD_INDEX || prevCache.bar !== cache.bar) {\r\n        bar = cache.bar + 1;\r\n    }\r\n    const isError = bar !== -1 && cache.beat !== 0;\r\n\r\n    let chordName = '-';\r\n    if (chordRoot != null) {\r\n        chordName = `${chordRoot}${symbolName}`;\r\n    }\r\n\r\n    return (\r\n        <_Detail>\r\n            <_Chord>{chordName}</_Chord>\r\n            {/* <_Backing>\r\n            </_Backing> */}\r\n            <_Pos>\r\n                <_Section\r\n                    isError={isError}\r\n                >\r\n                    {bar === -1 ? <>&nbsp;</> : bar}\r\n                </_Section>\r\n                <_Beat>\r\n                    <span>\r\n                        {cache.beat === 0 ? <>&nbsp;</> : cache.beat}\r\n                        {/* {` (+0.25)`} */}\r\n                    </span>\r\n                    {cache.minute === 0 ? '' : ` (${cache.minute})`}\r\n                </_Beat>\r\n                <_PastSecond>\r\n                    {Math.round(cache.pastSecond / 100) / 10}s\r\n                </_PastSecond>\r\n            </_Pos>\r\n        </_Detail>\r\n    );\r\n}\r\n\r\nexport default CalcChord;\r\n\r\n\r\n\r\nconst _Section = styled.div<{\r\n    isError: boolean;\r\n}>`\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #c72929;\r\n    ${props => !props.isError ? '' : css`\r\n        background-color: #ee5959;\r\n        color: #ffffff;\r\n        /* border: 2px solid #c72929; */\r\n        border-radius: 2px;\r\n    `}\r\n    box-sizing: border-box;\r\n`;\r\nconst _PastSecond = styled.div`\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #000000a0;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Beat = styled.div``;\r\n\r\nconst _Detail = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    // background-color: #00ff2a11;\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    // width: calc(100% - ${ELEMENT_POS_INFO_WIDTH + 10}px);\r\n    width: 100%;\r\n    height: 18px;\r\n    // background-color: #ffc4001c;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #2b2b2b;\r\n`;\r\n\r\nconst _Backing = styled.div`\r\n    display: inline-block;\r\n    width: 56px;\r\n    height: 30px;\r\n    background-color: #1100ff1c;\r\n`;\r\n\r\nconst _Pos = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 5;\r\n    width: ${ELEMENT_POS_INFO_WIDTH}px;\r\n    height: 100%;\r\n    // background-color: #0000ff11;\r\n    top: 0;\r\n    left: -${ELEMENT_POS_INFO_WIDTH / 2}px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    \r\n    & ${_Section} {\r\n    }\r\n    & ${_Beat} {\r\n        font-size: 12px;\r\n        color: #333;\r\n        & span {\r\n            color: #00a;\r\n            font-weight: 600;\r\n        }\r\n    }\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ELEMENT_POS_INFO_WIDTH } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcSection = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sectionNo = state.elementCacheList[props.index].sectionNo;\r\n    const curSection = state.sectionCacheList[sectionNo];\r\n\r\n    const barSum = Math.floor(curSection.beatSum / 4);\r\n    const barRem = curSection.beatSum % 4;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Len>{barSum}{barRem === 0 ? '' : ` (${barRem})`}</_Len>\r\n            <_Border />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default CalcSection;\r\n\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    /* background-color: #ff000011; */\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Len = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    /* min-width: 80px; */\r\n    height: 16px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #474386cf;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    /* background-color: #00000042; */\r\n`;\r\n\r\nconst _Border = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 8px;\r\n    height: calc(100% - 16px);\r\n    background-color: #db0000cf;\r\n    border-radius: 4px 4px 0 0;\r\n`;\r\n","import styled from \"styled-components\";\r\nimport { DetailChange } from \"../../../../../../redux/store/scoreData\";\r\n\r\nconst ElementDetailChange = (props: {\r\n    detail: DetailChange;\r\n}) => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Type>\r\n                Modulation\r\n            </_Type>\r\n            <_Detail>\r\n                Domm+1\r\n            </_Detail>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailChange;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: red; */\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    min-width: 100px;\r\n    height: 20px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    line-height: 20px;\r\n    /* background-color: #1000eb42; */\r\n    margin-top: 3px;\r\n`;\r\n\r\nconst _Type = styled(_Label)`\r\n    color: #0014cc;\r\n`;\r\n\r\nconst _Detail = styled(_Label)`\r\n    color: #5e5e5e;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../../redux/store/scoreData\";\r\nimport { DIATONIC_MAJOR_SCALE_DEGREE_NAMES, getChordRoot, getDegreeRoot, getSymbolFromKey, ScaleRelation } from \"../../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\ntype TipLenType = 'short' | 'normal' | 'long';\r\ntype TipValueType = 0 | 0.5 | 0.25;\r\n\r\nconst ElementDetailChord = (props: {\r\n    detail: DetailChord;\r\n    isCurrent: boolean;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n\r\n    const minute = props.detail.minute;\r\n\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    let degreeRoot: null | string = null;\r\n    let degreeOn: null | string = null;\r\n    let chordRoot: null | string = null;\r\n    let chordOn: null | string = null;\r\n    if (props.detail.root != null) {\r\n        degreeRoot = getDegreeRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        });\r\n        chordRoot = getChordRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        }, cache.keyIndex);\r\n\r\n        if (props.detail.on != null) {\r\n            degreeOn = getDegreeRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.on.isFlat\r\n            });\r\n            chordOn = getChordRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.root.isFlat\r\n            }, cache.keyIndex);\r\n        }\r\n    }\r\n\r\n    const symbolName = getSymbolFromKey(props.detail.symbolKey)?.name;\r\n    return useMemo(() =>\r\n        <_Wrap>\r\n            <_Degree\r\n                isSwitch={keySwitch.editMode && props.isCurrent}\r\n                scaleRelation={degreeRoot != null && DIATONIC_MAJOR_SCALE_DEGREE_NAMES.includes(degreeRoot + symbolName) ? 'diatonic' : 'none'}\r\n                isOnChordScale={props.detail.on != null && [0, 2, 4, 5, 7, 9, 11].includes(props.detail.on.index)}\r\n            >\r\n                {degreeRoot == null ? 'none' : (<>\r\n                    <_DegreeRoot>{degreeRoot}</_DegreeRoot>\r\n                    <_DegreeSymbol>{symbolName}</_DegreeSymbol>\r\n                    <_DegreeOnChord>{degreeOn == null ? '' : `/${degreeOn}`}</_DegreeOnChord>\r\n                </>)}\r\n            </_Degree>\r\n            {/* <_Chord>\r\n                {chordRoot == null ? '-' : (<>\r\n                    {chordRoot}{symbolName}{chordOn == null ? '' : `/${chordOn}`}\r\n                </>)}\r\n            </_Chord> */}\r\n            <_Tip isSwitch={keySwitch.editMode && props.isCurrent}>\r\n                {(() => {\r\n                    const jsxList: JSX.Element[] = [];\r\n                    for (let i = 0; i < props.detail.beatLen; i++) {\r\n                        let lenType: TipLenType = 'normal';\r\n                        let valueType: TipValueType = 0;\r\n                        if ([0, props.detail.beatLen - 1].includes(i)) {\r\n                            const target = i === 0 ? minute.head : minute.tail;\r\n                            if (target !== 0) {\r\n                                lenType = target > 0 ? 'long' : 'short';\r\n                                valueType = Math.abs(target) as TipValueType;\r\n                            }\r\n                        }\r\n                        jsxList.push(\r\n                            <_TipItem\r\n                                key={i}\r\n                                lenType={lenType}\r\n                                valueType={valueType}\r\n                            />\r\n                        );\r\n                    }\r\n                    return jsxList;\r\n                })()}\r\n            </_Tip>\r\n            <_Backing>\r\n                {props.detail.backing.voicingList.length === 0 ? '' : <_Voicing />}\r\n                {props.detail.backing.voicingList.length === 0 ? '' : props.detail.backing.pattern == null ? '' : <_Pattern />}\r\n            </_Backing>\r\n        </_Wrap>\r\n        , [\r\n            props.isCurrent, props.detail.beatLen, props.detail.root?.index,\r\n            props.detail.on?.index,\r\n            props.detail.symbolKey,\r\n            state.keySwitch.editMode,\r\n            cache.keyIndex,\r\n            props.detail.minute.head,\r\n            props.detail.minute.tail,\r\n            props.detail.backing\r\n        ]);\r\n}\r\n\r\nexport default ElementDetailChord;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    /* border: 1px solid #c5c5cc; */\r\n    /* padding: 4px; */\r\n    box-sizing: border-box;\r\n    /* background-color: #00000013; */\r\n`;\r\n\r\n\r\nconst _DegreeRoot = styled.div``;\r\nconst _DegreeSymbol = styled.div``;\r\nconst _DegreeOnChord = styled.div``;\r\nconst _Degree = styled.div<{\r\n    isSwitch: boolean;\r\n    scaleRelation: ScaleRelation;\r\n    isOnChordScale: boolean;\r\n}>`\r\n    display: block;\r\n    /* width: 100%; */\r\n    height: 25px;\r\n    /* background-color: #f700d616; */\r\n    ${props => !props.isSwitch ? '' : css`background-color: #0004f729;`}\r\n    font-size: 18px;\r\n    /* color: #4e516394; */\r\n    text-align: center;\r\n\r\n    & * {\r\n        display: inline-block;\r\n    }\r\n\r\n    & ${_DegreeRoot} {\r\n        color: #4e5163cc;\r\n        ${props =>\r\n        props.scaleRelation === 'diatonic' ? css`color: #4e516394;` :\r\n            props.scaleRelation === 'secondaly' ? css`color: #00116e93;` :\r\n                css`color: #70000093;`\r\n    }\r\n        font-weight: 600;\r\n    }\r\n    & ${_DegreeSymbol} {\r\n        color: #4e5163cc;\r\n        ${props =>\r\n        props.scaleRelation === 'diatonic' ? css`color: #4e516394;` :\r\n            props.scaleRelation === 'secondaly' ? css`color: #00116e93;` :\r\n                css`color: #70000093;`\r\n    }\r\n    }\r\n    & ${_DegreeOnChord} {\r\n        color: #422e3099;\r\n        ${props => props.isOnChordScale ? '' : css`color: #70000093;`}\r\n        font-weight: 600;\r\n    }\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 22px;\r\n    /* background-color: #d37979b2; */\r\n    font-size: 14px;\r\n    /* font-weight: 600; */\r\n    color: #9c5f74;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Tip = styled.div<{\r\n    isSwitch: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    ${props => !props.isSwitch ? '' : css`background-color: #0004f729;`}\r\n    /* background-color: #d8ccccb1; */\r\n    text-align: center;\r\n`;\r\n\r\nconst _TipItem = styled.div<{\r\n    lenType: TipLenType;\r\n    valueType: TipValueType;\r\n}>`\r\n    display: inline-block;\r\n    width: 8px;\r\n    ${props => props.lenType === 'short' ? css`\r\n        width: 4px;\r\n    ` : props.lenType === 'long' ? css`\r\n        width: 12px;\r\n    ` : ''}\r\n    height: calc(100% - 4px);\r\n    margin: 2px 2px 0 2px;\r\n    background-color: #e0e0e088;\r\n    ${props => props.valueType === 0.5 ? css`\r\n        background-color: #db828287;\r\n    ` : props.valueType === 0.25 ? css`\r\n        background-color: #9394dd87;\r\n    ` : ''}\r\n    /* background: linear-gradient(to bottom, #9b9b9bc3, #85858514); */\r\n    border: solid 1px #0000004e;\r\n    /* border-radius: 2px; */\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Backing = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 6px;\r\n    /* background-color: #00a048; */\r\n    text-align: left;\r\n`;\r\n\r\nconst _Voicing = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: calc(50% - 2px);\r\n    margin-top: 2px;\r\n    height: 4px;\r\n    background-color: #7c89a1;\r\n`;\r\n\r\nconst _Pattern = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: calc(50% - 2px);\r\n    margin: 2px 0 0 4px;\r\n    height: 4px;\r\n    background-color: #a8c7a8;\r\n`;","import styled from \"styled-components\";\r\nimport { DetailFixed } from \"../../../../../redux/store/scoreData\";\r\nimport { ELEMENT_HEAD_WIDTH } from \"../../../../../utils/systemConst\";\r\n\r\nconst ElementFixedBorder = (props: {\r\n    detail: DetailFixed;\r\n}) => {\r\n\r\n    const jsxList: JSX.Element[] = [];\r\n    jsxList.push(<_Border key={0} />);\r\n    jsxList.push(<_Label key={1}>{props.detail.fixed}</_Label>);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {props.detail.fixed === 'Start' ? jsxList : jsxList.reverse()}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementFixedBorder;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 80px;\r\n    height: calc(100% - ${ELEMENT_HEAD_WIDTH}px);\r\n    /* border: 1px solid #00000083; */\r\n    background-color: #c2c2c237;\r\n`;\r\n\r\nconst _Border = styled.div`\r\n    display: inline-block;\r\n    width: 10px;\r\n    height: 100%;\r\n    background-color: #d1d1d1;\r\n    vertical-align: middle;\r\n`;\r\n\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 10px);\r\n    height: 48px;\r\n    /* background-color: #47438678; */\r\n    font-size: 26px;\r\n    font-weight: 600;\r\n    font-style: italic;\r\n    line-height: 46px;\r\n    color: #1b003d6f;\r\n    text-align: center;\r\n    vertical-align: middle;\r\n`;\r\n","import styled from \"styled-components\";\r\nimport { DetailInit } from \"../../../../../../redux/store/scoreData\";\r\nimport { KEY12_MAJOR_SCALE_LIST } from \"../../../../../../utils/theoryUtils\";\r\n\r\nconst ElementDetailInit = (props: {\r\n    detail: DetailInit;\r\n}) => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Record>\r\n                <_Title>Scale:</_Title>\r\n                <_Value>{props.detail.scale}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>Key:</_Title>\r\n                <_Value>{KEY12_MAJOR_SCALE_LIST[props.detail.keyIndex]}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>tempo:</_Title>\r\n                <_Value>{props.detail.bpm}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>Rate:</_Title>\r\n                <_Value>{props.detail.timeSignature}</_Value>\r\n            </_Record>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailInit;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100px;\r\n`;\r\n\r\nconst _Record = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100px;\r\n    height: 16px;\r\n    margin: 1px 0;\r\n    /* background-color: #0066ff16; */\r\n    /* border-bottom: 1px solid #000; */\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #2a2a2c;\r\n    line-height: 16px;\r\n`;\r\nconst _Title = styled.div`\r\n    display: inline-block;\r\n    margin: 0 2px;\r\n    width: 50px;\r\n    height: 100%;\r\n    color: #14a800;\r\n    /* background-color: #ff00b329; */\r\n`;\r\nconst _Value = styled.div`\r\n    display: inline-block;\r\n    margin: 0 2px;\r\n    width: 40px;\r\n    height: 100%;\r\n    color: #000000;\r\n    /* background-color: #ff00b329; */\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst ElementDetailSection = (props: {\r\n    index: number;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sectionNo = state.elementCacheList[props.index].sectionNo;\r\n    const curSection = state.sectionCacheList[sectionNo];\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Label>{curSection.labelName}</_Label>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailSection;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    position: relative;\r\n    /* width: 100px; */\r\n    text-align: center;\r\n    border: 1px;\r\n    /* border: 1px solid #c5c5cc; */\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    min-width: 80px;\r\n    height: 20px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #c00;\r\n    text-align: center;\r\n    line-height: 20px;\r\n    /* background-color: #1000eb42; */\r\n    margin-top: 13px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ELEMENT_POS_INFO_WIDTH } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcChange = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Type>Key</_Type>\r\n            <_Detail>CAm</_Detail>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default CalcChange;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    /* background-color: #ff000011; */\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    /* min-width: 80px; */\r\n    height: 16px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    /* background-color: #00000042; */\r\n`;\r\n\r\nconst _Type = styled(_Label)`\r\n    color: #0b00a8cf;\r\n`;\r\n\r\nconst _Detail = styled(_Label)`\r\n    color: #050505cf;\r\n`;","import { ElementType, useContext, useEffect, useRef } from \"react\";\r\nimport { CgDetailsLess } from \"react-icons/cg\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { TypeElement } from \"typescript\";\r\nimport { DetailChange, DetailChord, DetailFixed, DetailInit, DetailSection, TypeDetail } from \"../../../../../redux/store/scoreData\";\r\nimport { KEY12_SHARP_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { ELEMENT_FOOT_WIDTH, ELEMENT_HEAD_WIDTH, ELEMENT_HEIGHT, ELEMENT_OPERATIONS_WIDTH, ELEMENT_POS_INFO_WIDTH, ELEMENT_SIDE_PADDING, FIRST_CHORD_INDEX } from \"../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport SymbolEditor from \"../input/symbolEditor\";\r\nimport CalcChord from \"./calc/calcChord\";\r\nimport CalcSection from \"./calc/calcSection\";\r\nimport ElementDetailChange from \"./form/elementDetailChange\";\r\nimport ElementDetailChord from \"./form/elementDetailChord\";\r\nimport ElementFixedBorder from \"./elementFixedBorder\";\r\nimport ElementDetailInit from \"./form/elementDetailInit\";\r\nimport ElementDetailSection from \"./form/elementDetailSection\";\r\nimport CalcChange from \"./calc/calcChange\";\r\n\r\nconst ScoreElement = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const wrapRef = useRef({} as HTMLDivElement);\r\n    const bodyRef = useRef({} as HTMLDivElement);\r\n\r\n    const state = store.scoreState;\r\n    const isCurrent = state.focusIndex == props.index;\r\n    const chordList = store.scoreData.chordList;\r\n    const element = chordList[props.index];\r\n    const cache = state.elementCacheList[props.index];\r\n\r\n    useEffect(() => {\r\n        cache.reffers.wrap = wrapRef.current;\r\n        cache.reffers.body = bodyRef.current;\r\n        dispatcher.score.setScoreState(state);\r\n    }, [state.elementCacheList.length]);\r\n\r\n    // if (props.index > state.elementCacheList.length - 1) {\r\n    //     return <></>;\r\n    // }\r\n\r\n    const isFocus = state.focusIndex === props.index;\r\n    const isSameSection = state.elementCacheList[state.focusIndex].sectionNo === cache.sectionNo;\r\n\r\n    const chordDetail = element.type !== 'chord' ? null : element.detail as DetailChord;\r\n    return (\r\n        <_Wrap\r\n            ref={wrapRef}\r\n            isSelectable={element.type !== 'fixed'}\r\n            isActive={isFocus}\r\n            isInactive={!isSameSection}\r\n            isChord={element.type === 'chord'}\r\n        >\r\n            <_Head>\r\n                {element.type !== 'chord' ? <></> : (\r\n                    <_CurKey>{KEY12_SHARP_LIST[cache.keyIndex]}</_CurKey>\r\n                )}\r\n            </_Head>\r\n\r\n            {/*  */}\r\n            {['init', 'chord', 'section', 'change'].includes(element.type) ? (\r\n                <_Form\r\n                    ref={bodyRef}\r\n                    isActive={isFocus}\r\n                    isInactive={!isSameSection}\r\n                    type={element.type}\r\n                    isAnytime={['fixed', 'init'].includes(element.type) || state.focusIndex === 0}\r\n                    onClick={() => {\r\n                        if (element.type === 'fixed') {\r\n                            return;\r\n                        }\r\n                        state.focusIndex = props.index;\r\n                        dispatcher.score.setScoreState(state);\r\n                    }}\r\n                >{(() => {\r\n                    switch (element.type) {\r\n                        case 'init': {\r\n                            const detail = element.detail as DetailInit;\r\n                            return (<ElementDetailInit detail={detail} />);\r\n                        }\r\n                        case 'section': {\r\n                            const detail = element.detail as DetailSection;\r\n                            return (<ElementDetailSection index={props.index} />);\r\n                        }\r\n                        case 'chord': {\r\n                            const detail = element.detail as DetailChord;\r\n                            return (<ElementDetailChord detail={detail} isCurrent={isFocus} />);\r\n                        }\r\n                        case 'change': {\r\n                            const detail = element.detail as DetailChange;\r\n                            return (<ElementDetailChange detail={detail} />);\r\n                        }\r\n                    }\r\n                })()}\r\n                </_Form>\r\n            ) : (<ElementFixedBorder detail={element.detail as DetailFixed} />)}\r\n\r\n            {/*  */}\r\n            {\r\n                element.type === 'chord' ? (<CalcChord index={props.index} detail={chordDetail as DetailChord} />) :\r\n                    element.type === 'section' ? (<CalcSection index={props.index} />) :\r\n                        element.type === 'change' ? (<CalcChange index={props.index} />) :\r\n                            <></>\r\n            }\r\n            <>{!(isCurrent && chordDetail != null && chordDetail.root != null && store.scoreState.keySwitch.symbolMode) ? '' :\r\n                <SymbolEditor />\r\n            }</>\r\n            {['fixed', 'init'].includes(element.type) ? <></> : (\r\n                <_Operations>\r\n                    <_OperationItem>-</_OperationItem>\r\n                    <_OperationItem onClick={() => dispatcher.score.addChordElement()}>+</_OperationItem>\r\n                </_Operations>\r\n            )}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ScoreElement;\r\n\r\nconst _NextLine = styled.div`\r\n    display: block;\r\n    width: 1px;\r\n    height: 10px;\r\n    background-color: #ad0c0c;\r\n`;\r\n\r\nconst _Form = styled.div<{\r\n    isActive: boolean;\r\n    isInactive: boolean;\r\n    //\r\n    isAnytime: boolean;\r\n    type: TypeDetail;\r\n}>`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    min-width: 80px;\r\n    height: calc(100% - ${ELEMENT_HEAD_WIDTH + ELEMENT_FOOT_WIDTH}px);\r\n    border: solid 1px #00000049;\r\n    ${props => props.type !== 'section' ? '' : css`\r\n        border: solid 1px #ff000084;\r\n    ` }\r\n    ${props => props.type !== 'init' ? '' : css`\r\n        border: solid 1px #006823a7;\r\n        height: 85px;\r\n    ` }\r\n    ${props => props.type !== 'change' ? '' : css`\r\n        border: solid 1px #1800a1a7;\r\n    ` }\r\n\r\n    opacity: 0.4;\r\n    border-radius: 6px;\r\n    ${props => props.isInactive ? '' : css`\r\n        background-color: #ebebeb84;\r\n        opacity: 1;\r\n    ` }\r\n    ${props => !props.isAnytime ? '' : css`\r\n        opacity: 1;\r\n    ` }\r\n    box-sizing: border-box;\r\n    padding: 4px;\r\n    transition: background-color 100ms;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #d85cce5a;\r\n        box-shadow: 0 0 8px 0 #000b3a48;\r\n    `}\r\n`;\r\n\r\nconst _Operations = styled.div``;\r\nconst _OperationItem = styled.div``;\r\n\r\nconst _Wrap = styled.div<{\r\n    // \r\n    isSelectable: boolean;\r\n    isActive: boolean;\r\n    isInactive: boolean;\r\n    isChord: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    height: ${ELEMENT_HEIGHT}px;\r\n    padding: 0 ${ELEMENT_SIDE_PADDING}px;\r\n    box-sizing: border-box;\r\n    /* margin: 10px 5px 5px 5px; */\r\n    border-bottom: 1px solid #47438678;\r\n    margin-bottom: 4px;\r\n    vertical-align: top;\r\n    /* width: 1px; */\r\n    transition: width 500ms, opacity 300ms;\r\n    /* border: 1px solid #00000015; */\r\n    ${props => props.isInactive || !props.isChord ? '' : css`\r\n        background-color: #e4ecd039;\r\n    `}\r\n\r\n    & ${_Operations} {\r\n        display: none;\r\n        position: absolute;\r\n        z-index: 5;\r\n        width: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n        height: 44px;\r\n        /* background-color: #0000ff11; */\r\n        top: ${35}px;\r\n        right: -${ELEMENT_OPERATIONS_WIDTH / 2}px;\r\n\r\n        /* background-color: #0400d84e; */\r\n        & ${_OperationItem} {\r\n            display: inline-block;\r\n            width: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n            height: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n            background-color: #ebebeb6e;\r\n            border: 1px solid #818181;\r\n            margin: 1px 0;\r\n            font-size: 15px;\r\n            font-weight: 600;\r\n            text-align: center;\r\n            color: #818181;\r\n            box-sizing: border-box;\r\n            line-height: 15px;\r\n\r\n            &:hover {\r\n                background-color: #fffb0b9d\r\n            }\r\n        }\r\n    }\r\n\r\n    &:hover {\r\n        ${props => !props.isSelectable ? '' : css<{\r\n    isActive: boolean;\r\n}>`\r\n            & ${_Form} {\r\n                ${props => props.isActive ? '' : css`background-color: #fffb0018;`}\r\n                opacity: 1;\r\n            }\r\n            & ${_Operations} {\r\n                display: inline-block;\r\n            }\r\n        `}\r\n    }\r\n`;\r\n\r\nconst _CurKey = styled.div``;\r\nconst _Head = styled.div`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    width: 100%;\r\n    height: ${ELEMENT_HEAD_WIDTH}px;\r\n    /* background-color: #eca8813b; */\r\n\r\n    & ${_CurKey} {\r\n        display: inline-block;\r\n        position: absolute;\r\n        top: -2px;\r\n        left: 10px;\r\n        width: 50px;\r\n        font-size: 12px;\r\n        color: #ca0000;\r\n        /* background-color: #fff; */\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ELEMENT_NOTE_PADDING_LEN, ELEMENT_NOTE_PADDING_SID } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport ScoreElement from \"./elements/scoreElement\";\r\nimport SymbolEditor from \"./input/symbolEditor\";\r\n\r\n\r\nconst HarmNote = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const num = store.scoreData.chordList.length;\r\n\r\n    // alert(`num=${num}, cache=${store.scoreState.elementCacheList.length}`);\r\n    const list: JSX.Element[] = [];\r\n    if (store.scoreState.elementCacheList.length === num) {\r\n        for (let i = 0; i < num; i++) {\r\n            list.push(\r\n                <ScoreElement key={i} index={i} />\r\n            );\r\n        };\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            {/* <_Frame> */}\r\n            <_Note>\r\n                {list}\r\n            </_Note>\r\n            <_Note>\r\n            </_Note>\r\n            {/* </_Frame> */}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default HarmNote;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: 4px 0 0 4px;\r\n    width: calc(100% - 8px);\r\n    height: calc(100% - 8px);\r\n    /* background-color: #e7dddd; */\r\n    background-color: #e9e9e9;\r\n    border: 1px solid #b3b3b3;\r\n    border-radius: 2px;\r\n    box-sizing: border-box;\r\n    text-align: left;\r\n    overflow: auto;\r\n    \r\n    &::-webkit-scrollbar {\r\n        width: 10px;\r\n        height: 10px;\r\n    }\r\n    &::-webkit-scrollbar-thumb {\r\n        border-radius: 5px;\r\n        background: #1959A8;\r\n    }\r\n    &::-webkit-scrollbar-track {\r\n        border-radius: 5px;\r\n        box-shadow: 0 0 4px #aaa inset;\r\n    }\r\n`;\r\n\r\nconst _Frame = styled.div`\r\n    transform-origin: top left;\r\n    /* width: 100%;\r\n    height: 100%; */\r\n    transform: scale(1);\r\n`;\r\n\r\nconst _Note = styled.div`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    padding: ${ELEMENT_NOTE_PADDING_LEN}px ${ELEMENT_NOTE_PADDING_SID}px;\r\n    width: ${891}px;\r\n    height: ${1260}px;\r\n    background-color: #f1f1f1;\r\n    /* overflow: hidden; */\r\n    margin: 10px 0 0 10px;\r\n    box-shadow: 0 0 18px 0 #000b3a48;\r\n`;","import { Dispatcher } from \"../redux/dispatcher/dispatcher\";\r\nimport { DetailChord, DetailInit } from \"../redux/store/scoreData\";\r\nimport { Store } from \"../redux/store/store\";\r\nimport BackingUtil from \"./backingUtil\";\r\nimport { playHarmony } from \"./melodyUtil\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"./theoryUtils\";\r\n\r\nnamespace HarmonizeUtil {\r\n\r\n    export const previewStart = (store: Store, dispatcher: Dispatcher) => {\r\n        const state = store.scoreState;\r\n        const sampler = store.instruments.sampler;\r\n        const cacheList = state.elementCacheList;\r\n        const chordList = store.scoreData.chordList;\r\n        const reserveTasks = store.reserveTasks;\r\n        let firstTime = -1;\r\n        const update = () => {\r\n            // if (store.invalidate.harmonize) {\r\n            //     store.invalidate.harmonize();\r\n            // }\r\n            dispatcher.score.setScoreState(state);\r\n        }\r\n        // const reserveTasks = store.reserveTasks;\r\n        const init = chordList[0].detail as DetailInit;\r\n        const adjsut = 0;\r\n        for (let i = state.focusIndex; i < chordList.length; i++) {\r\n            const cache = cacheList[i];\r\n            const element = chordList[i];\r\n            if (element.type === 'chord') {\r\n                const detail = element.detail as DetailChord;\r\n                // \r\n                if (firstTime === -1) {\r\n                    firstTime = cache.pastSecond;\r\n                }\r\n\r\n\r\n                if (detail.root == null) continue;\r\n\r\n                const rootIndex = (detail.root.index + init.keyIndex) % 12;\r\n                const symbol = getSymbolFromKey(detail.symbolKey);\r\n                const len = detail.beatLen + detail.minute.head + detail.minute.tail;\r\n\r\n                const backing = detail.backing;\r\n                const pitchList = BackingUtil.getPitchListFromVoicing(backing.voicingList, rootIndex, symbol);\r\n\r\n                const chordTime = 60 / init.bpm * len;\r\n                reserveTasks.push(\r\n                    setTimeout(() => {\r\n                        // sampler.releaseAll();\r\n                        // stopPiano(store);\r\n                        // store.melodyState.mouseState.curChord = element;\r\n                        // dispatcher.tune.setState(store.melodyState);\r\n\r\n                        BackingUtil.playBacking(store, reserveTasks, init.bpm, backing, pitchList, chordTime);\r\n                        state.focusIndex = i;\r\n                        update();\r\n\r\n                    }, cache.pastSecond - firstTime - adjsut)\r\n                );\r\n            }\r\n\r\n            if (i === chordList.length - 1) {\r\n                reserveTasks.push(\r\n                    setTimeout(() => {\r\n                        HarmonizeUtil.stopPreview(store, dispatcher, reserveTasks);\r\n                    }, (cache.pastSecond - firstTime - adjsut))\r\n                );\r\n            }\r\n        }\r\n        state.isPreview = true;\r\n        update();\r\n    }\r\n\r\n    export const stopPreview = (store: Store, dispatcher: Dispatcher, reserveTasks: NodeJS.Timeout[]) => {\r\n        const state = store.scoreState;\r\n        state.isPreview = false;\r\n        // store.instruments.sampler.releaseAll();\r\n        // state.focusIndex = state.lastFocus;\r\n        reserveTasks.forEach(id => clearTimeout(id));\r\n        dispatcher.system.setReserveTasks([]);\r\n        dispatcher.score.setScoreState(state);\r\n\r\n        store.instruments.harmony?.stop();\r\n    }\r\n\r\n    export const previewCurHarmony = (store: Store, dispatcher: Dispatcher) => {\r\n\r\n        const state = store.scoreState;\r\n        const reserveTasks = store.reserveTasks;\r\n        const chordList = store.scoreData.chordList;\r\n        const init = chordList[0].detail as DetailInit;\r\n        const curChord = store.scoreData.chordList[state.focusIndex];\r\n        if (curChord != null) {\r\n\r\n            const detail = curChord.detail as DetailChord;\r\n\r\n            if (detail.root == null) return;\r\n\r\n            const rootIndex = (detail.root.index + init.keyIndex) % 12;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            const len = detail.beatLen + detail.minute.head + detail.minute.tail;\r\n\r\n            const backing = detail.backing;\r\n            const pitchList = BackingUtil.getPitchListFromVoicing(backing.voicingList, rootIndex, symbol);\r\n            const chordTime = 60 / init.bpm * len;\r\n\r\n            BackingUtil.playBacking(store, store.reserveTasks, init.bpm, backing, pitchList, chordTime);\r\n            \r\n            reserveTasks.push(setTimeout(() => {\r\n                state.isPreview = false;\r\n                dispatcher.score.setScoreState(state);\r\n            }, chordTime * 1000));\r\n            state.isPreview = true;\r\n            dispatcher.score.setScoreState(state);\r\n        }\r\n    }\r\n}\r\n\r\nexport default HarmonizeUtil;\r\n","import { KeyboardEvent } from \"react\";\r\nimport { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport HarmonizeUtil from \"../../../../../utils/harmonizeUtil\";\r\nimport { backingEditorInput } from \"./backingEditorInput\";\r\nimport { NoteBasicInput } from \"./noteBasicInput\";\r\n\r\nexport const NoteKeyDown = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.scoreState;\r\n    const curType = data.chordList[state.focusIndex].type;\r\n    const isElement = curType !== 'init'\r\n\r\n\r\n    // \r\n    if (state.isPreview) {\r\n        switch (e.key) {\r\n            case ' ': {\r\n                HarmonizeUtil.stopPreview(store, dispatcher, store.reserveTasks);\r\n            }\r\n                break;\r\n        }\r\n        return;\r\n    } else {\r\n        if (store.scoreState.hideMenu === 'none') {\r\n            if (isElement) {\r\n                if (keySwitch.editMode) {\r\n                    switch (e.key) {\r\n                        case config.decRoot: {\r\n                            dispatcher.score.incrementDegreeRoot(false);\r\n                        }\r\n                            break;\r\n                        case config.incRoot: {\r\n                            dispatcher.score.incrementDegreeRoot(true);\r\n                        }\r\n                            break;\r\n                        case config.decBeat: {\r\n                            dispatcher.score.incrementBeatLen(false);\r\n                        }\r\n                            break;\r\n                        case config.incBeat: {\r\n                            dispatcher.score.incrementBeatLen(true);\r\n                        }\r\n                            break;\r\n                        case 'A': dispatcher.score.incrementMinuteValRelation(false, -0.25); break;\r\n                        case 'S': dispatcher.score.incrementMinuteValRelation(false, 0.25); break;\r\n                        case 'D': dispatcher.score.incrementMinuteValRelation(true, -0.25); break;\r\n                        case 'F': dispatcher.score.incrementMinuteValRelation(true, 0.25); break;\r\n                    }\r\n                } else if (keySwitch.symbolMode) {\r\n                    switch (e.key) {\r\n                        case 'ArrowUp': {\r\n                            dispatcher.symbol.toNext(false);\r\n                        }\r\n                            break;\r\n                        case 'ArrowDown': {\r\n                            dispatcher.symbol.toNext(true);\r\n                        }\r\n                            break;\r\n                        case 'ArrowLeft': {\r\n                            dispatcher.symbol.toBase();\r\n                        }\r\n                            break;\r\n                        case 'ArrowRight': {\r\n                            dispatcher.symbol.toDerive();\r\n                        }\r\n                            break;\r\n                    }\r\n                } else {\r\n                    NoteBasicInput(e, store, dispatcher);\r\n                }\r\n            }\r\n        } else if (store.scoreState.hideMenu === 'backing') {\r\n            backingEditorInput(e, store, dispatcher);\r\n        }\r\n    }\r\n}\r\n\r\nexport const NoteKeySwitch = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher, isPress: boolean) => {\r\n\r\n    const state = store.scoreState;\r\n    if (!state.isPreview) {\r\n        if (state.hideMenu === 'none') {\r\n            const config = store.userEnv.keyConfig.note;\r\n            const keySwitch = store.scoreState.keySwitch;\r\n            // alert(e.key);\r\n            // alnfig.nextElement);\r\n            switch (e.key) {\r\n                case config.editMode: {\r\n                    keySwitch.editMode = isPress;\r\n                    dispatcher.score.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n                case config.symbolMode: {\r\n                    keySwitch.symbolMode = isPress;\r\n                    dispatcher.score.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    if (isPress) {\r\n        NoteKeyDown(e, store, dispatcher);\r\n    }\r\n\r\n}","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { KeyboardEvent } from \"react\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { playChordSoundfont } from \"../../../../../utils/instrumentsUtil\";\r\nimport HarmonizeUtil from \"../../../../../utils/harmonizeUtil\";\r\n\r\nexport const NoteBasicInput = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.scoreState;\r\n    const curType = data.chordList[state.focusIndex].type;\r\n    const isElement = curType !== 'init'\r\n\r\n    switch (curType) {\r\n        case 'chord': {\r\n            const hideMode = store.scoreState.hideMenu;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            switch (e.key) {\r\n                case 'z': {\r\n                    HarmonizeUtil.previewCurHarmony(store, dispatcher);\r\n                }\r\n                    break;\r\n                case 'e': {\r\n                    dispatcher.score.setDefaultBacking();\r\n                }\r\n                    break;\r\n                case 'b': {\r\n                    if (detail.root != null) {\r\n                        dispatcher.backing.openBackingEditor();\r\n                    }\r\n                }\r\n                    break;\r\n                case 'x': {\r\n                    if (detail.root != null) {\r\n                        dispatcher.score.cloneBacking();\r\n                    }\r\n                }\r\n                    break;\r\n                case 'v': {\r\n                    if (detail.root != null) {\r\n                        dispatcher.score.pastBacking();\r\n                    }\r\n                }\r\n                    break;\r\n                case '1':\r\n                case '2':\r\n                case '3':\r\n                case '4':\r\n                case '5':\r\n                case '6':\r\n                case '7': {\r\n                    dispatcher.score.setDiatonicChord(Number(e.key) - 1);\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n            break;\r\n    }\r\n    switch (e.key) {\r\n        // \r\n        case config.prevElement: {\r\n            dispatcher.score.moveElement(false);\r\n        }\r\n            break;\r\n        case config.nextElement: {\r\n            dispatcher.score.moveElement(true);\r\n        }\r\n            break;\r\n        // \r\n        case config.prevSection: {\r\n            dispatcher.score.moveSection(false);\r\n        }\r\n            break;\r\n        case config.nextSection: {\r\n            dispatcher.score.moveSection(true);\r\n        }\r\n            break;\r\n        case config.addChord: {\r\n            dispatcher.score.addChordElement();\r\n        }\r\n            break;\r\n        case config.addSection: {\r\n            dispatcher.score.addSectionElement();\r\n        }\r\n            break;\r\n        case 'm': {\r\n            dispatcher.score.addChangeElement();\r\n        }\r\n            break;\r\n        case config.deleteCur: {\r\n            dispatcher.score.removeCurElement();\r\n        }\r\n            break;\r\n        case ' ': {\r\n            HarmonizeUtil.previewStart(store, dispatcher);\r\n        }\r\n            break;\r\n    }\r\n}","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { KeyboardEvent } from \"react\";\r\nimport BackingState from \"../../../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../../../utils/backingUtil\";\r\n\r\nexport const backingEditorInput = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.backingState;\r\n\r\n    if (state == null) return;\r\n\r\n\r\n    const update = () => dispatcher.backing.setState(state);\r\n    const pattern = state.pattern;\r\n\r\n\r\n    if (!state.isPreview) {\r\n        switch (e.key) {\r\n            case 'b': {\r\n                dispatcher.backing.closeBackingEditor();\r\n            }\r\n                break;\r\n            case 'Enter': {\r\n                dispatcher.backing.mappingEditorToScore();\r\n            }\r\n                break;\r\n            case ' ': {\r\n                if (!state.hasError) {\r\n                    dispatcher.backing.testBacking();\r\n                }\r\n            }\r\n                break;\r\n        }\r\n\r\n        if (pattern != null) {\r\n            switch (e.key) {\r\n                case 'ArrowLeft': {\r\n                    dispatcher.backing.movePatternColumn(false);\r\n                }\r\n                    break;\r\n                case 'ArrowRight': {\r\n                    dispatcher.backing.movePatternColumn(true);\r\n                }\r\n                    break;\r\n            }\r\n            if (pattern.channelIndex === -1) {\r\n\r\n                switch (e.key) {\r\n                    case 'ArrowUp': {\r\n                        dispatcher.backing.incrementVel(1);\r\n                    }\r\n                        break;\r\n                    case 'ArrowDown': {\r\n                        dispatcher.backing.incrementVel(-1);\r\n                    }\r\n                        break;\r\n                    case 'a': {\r\n                        dispatcher.backing.addPatternColumn();\r\n                    }\r\n                        break;\r\n                    case 'w': {\r\n                        dispatcher.backing.changeLayer();\r\n                    }\r\n                        break;\r\n                    case '1': {\r\n                        dispatcher.backing.setCurrentDivRate(16);\r\n                    }\r\n                        break;\r\n                    case '2': {\r\n                        dispatcher.backing.setCurrentDivRate(8);\r\n                    }\r\n                        break;\r\n                    case '3': {\r\n                        dispatcher.backing.setCurrentDivRate(4);\r\n                    }\r\n                        break;\r\n                    case '4': {\r\n                        dispatcher.backing.setCurrentDivRate(2);\r\n                    }\r\n                        break;\r\n                    case '5': {\r\n                        dispatcher.backing.setCurrentDivRate(1);\r\n                    }\r\n                        break;\r\n                    case '.': {\r\n                        dispatcher.backing.toggleCurrentDivHalf();\r\n                    }\r\n                        break;\r\n                    case 'Delete': {\r\n                        dispatcher.backing.deleteColumn();\r\n                    }\r\n                        break;\r\n                    case 'f': {\r\n                        pattern.channelIndex = 0;\r\n                        update();\r\n                    }\r\n                        break;\r\n\r\n                }\r\n            } else {\r\n\r\n                switch (e.key) {\r\n                    case 'ArrowUp': {\r\n                        dispatcher.backing.moveChannelIndex(false);\r\n                    }\r\n                        break;\r\n                    case 'ArrowDown': {\r\n                        dispatcher.backing.moveChannelIndex(true);\r\n                    }\r\n                        break;\r\n                    case 'f': {\r\n                        pattern.channelIndex = -1;\r\n                        update();\r\n                    }\r\n                        break;\r\n                    case 'Enter': {\r\n                        const curNotes = dispatcher.backing.getNotes();\r\n                        const notes: BackingState.NoteStatus | null = curNotes == null ? { signal: 'n', timing: 0, velAdj: 0 } : null;\r\n                        dispatcher.backing.setNotes(notes);\r\n                        dispatcher.backing.updateErrorState();\r\n                    }\r\n                        break;\r\n\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n\r\n        switch (e.key) {\r\n            case ' ': {\r\n                BackingUtil.stopPreview(store, state, dispatcher, store.reserveTasks);\r\n            }\r\n                break;\r\n        }\r\n    }\r\n}","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { ROOT_ALL, getChordRoot, getDegreeRoot, SYMBOL_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport MinuteForm from \"./minuteForm\";\r\n\r\nconst SideFormChord = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    \r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const detail = cur.detail as DetailChord;\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n\r\n    const beatItemsJsx: JSX.Element[] = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        const isExist = detail.beatLen >= (i + 1);\r\n        beatItemsJsx.push(\r\n            <_BeatItem key={i} isExist={isExist} onClick={() => {\r\n                const data = store.scoreData;\r\n                data.chordList = data.chordList.slice();\r\n                detail.beatLen = (i + 1);\r\n                data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                <span></span>\r\n            </_BeatItem>\r\n        );\r\n    }\r\n\r\n    const rootItemsJsx: JSX.Element[] = [];\r\n    ROOT_ALL.forEach((root, i) => {\r\n        const isRootActive = JSON.stringify(detail.root) === JSON.stringify(root);\r\n        const isOnActive = detail.on != null && JSON.stringify(detail.on) === JSON.stringify(root);\r\n        rootItemsJsx.push(\r\n            <_RootItem key={i}\r\n                isRootActive={isRootActive}\r\n                isOnActive={isOnActive}\r\n                isDiatonic={root != null && [0, 2, 4, 5, 7, 9, 11].includes(root.index)}\r\n                onClick={() => {\r\n                    const data = store.scoreData;\r\n                    // \r\n                    if (isOnActive || root == null) {\r\n                        detail.on = null;\r\n                    }\r\n                    detail.root = root == null ? null : { ...root };\r\n                    data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                    dispatcher.score.setScoreData(data);\r\n                }}\r\n                onContextMenu={() => {\r\n                    const data = store.scoreData;\r\n                    // \r\n                    if (detail.root != null && !isRootActive) {\r\n                        // \r\n                        if (isOnActive) {\r\n                            detail.on = null;\r\n                        } else {\r\n                            detail.on = root == null ? null : { ...root };\r\n                        }\r\n                        data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                        dispatcher.score.setScoreData(data);\r\n                    }\r\n                }}\r\n            >\r\n                {root == null ? '-' : <>\r\n                    {getDegreeRoot(root)} ({getChordRoot(root, cache.keyIndex)})\r\n                </>}\r\n            </_RootItem>\r\n        );\r\n    });\r\n\r\n    const symbolItemsJsx: JSX.Element[] = [];\r\n    SYMBOL_LIST.forEach((symbol, i) => {\r\n        const isActive = detail.root != null && symbol.key === detail.symbolKey;\r\n        symbolItemsJsx.push(\r\n            <_SymbolItem key={i}\r\n                isActive={isActive}\r\n                isDiatonic={true}\r\n                onClick={() => {\r\n                    const data = store.scoreData;\r\n                    detail.symbolKey = symbol.key;\r\n                    data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                    dispatcher.score.setScoreData(data);\r\n                }}\r\n            >\r\n                [{symbol.name}]\r\n            </_SymbolItem>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Timing>\r\n                <_LabelBeat>{'Beat Length'}</_LabelBeat>\r\n                <_Beat>\r\n                    {beatItemsJsx}\r\n                </_Beat>\r\n                <_Minute>\r\n                    <_LabelMinute>{'Minute Head'}</_LabelMinute>\r\n                    {/* <MinuteForm isHeadAdjust={true} /> */}\r\n                    <_MinuteItem isReverse={true} type=\"range\" step={0.25} min={-0.5} max={0.5}\r\n                        value={detail.minute.head}\r\n                        onChange={(e) => {\r\n                            const data = store.scoreData;\r\n                            data.chordList = data.chordList.slice();\r\n                            detail.minute.head = Number(e.target.value);\r\n                            data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                            dispatcher.score.setScoreData(data);\r\n                        }}\r\n                    />\r\n                    <_LabelMinute>{'Minute Tail'}</_LabelMinute>\r\n                    {/* <MinuteForm isHeadAdjust={false} /> */}\r\n                    <_MinuteItem isReverse={false} type=\"range\" step={0.25} min={-0.5} max={0.5}\r\n                        value={detail.minute.tail}\r\n                        onChange={(e) => {\r\n                            const data = store.scoreData;\r\n                            data.chordList = data.chordList.slice();\r\n                            detail.minute.tail = Number(e.target.value);\r\n                            data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                            dispatcher.score.setScoreData(data);\r\n                        }}\r\n                    />\r\n                </_Minute>\r\n            </_Timing>\r\n            <_Chord>\r\n                <_Root>\r\n                    {rootItemsJsx}\r\n                </_Root>\r\n                <_Symbol\r\n                    isDisable={detail.root == null}\r\n                >\r\n                    {symbolItemsJsx}\r\n                </_Symbol>\r\n            </_Chord>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormChord;\r\n\r\n\r\nconst _LabelBeat = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    /* border: 1px solid #c50000; */\r\n    text-align: center;\r\n`;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #8a8a8a;\r\n`;\r\n\r\nconst _Timing = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100px;\r\n    text-align: left;\r\n    background-color: #9c93b9;\r\n`;\r\n\r\nconst _Beat = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 25px;\r\n    text-align: left;\r\n    background-color: #afafaf;\r\n`;\r\nconst _BeatItem = styled.div<{\r\n    isExist: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 25%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #696969;\r\n\r\n    & span{\r\n        display: inline-block;\r\n        margin: 2px 0 0 2px;\r\n        width: calc(100% - 4px);\r\n        height: calc(100% - 4px);\r\n        background-color: #9b8585;\r\n        ${props => !props.isExist ? '' : css`\r\n            /* background-color: #ebf37eb7; */\r\n            background: linear-gradient(to bottom, #c5c5c5d2, #f3f3f3d2, #c5c5c5d2);\r\n        `}\r\n    }\r\n`;\r\n\r\nconst _Minute = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 75px;\r\n    text-align: left;\r\n    background-color: #cecece;\r\n`;\r\n\r\nconst _LabelMinute = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    border: 1px solid #222222;\r\n    text-align: center;\r\n`;\r\n// const _Minutetem = styled.div<{\r\n//     isExist: boolean;\r\n// }>`\r\n//     display: inline-block;\r\n//     width: 20%;\r\n//     height: 20px;\r\n//     text-align: left;\r\n//     background-color: #4c3696;\r\n//     font-size: 18px;\r\n//     font-weight: 600;\r\n//     color: #ce0000;\r\n//     line-height: 12px;\r\n//     text-align: center;\r\n\r\n//     & span{\r\n//         display: inline-block;\r\n//         margin: 2px 0 0 2px;\r\n//         width: calc(100% - 4px);\r\n//         height: calc(100% - 4px);\r\n//         background-color: #9b8585;\r\n//         ${props => !props.isExist ? '' : css`\r\n//             /* background-color: #ebf37eb7; */\r\n//             background: linear-gradient(to bottom, #bdb652d2, #fff56cd3, #bdb652d2);\r\n//         `}\r\n//     }\r\n// `;\r\nconst _MinuteItem = styled.input<{\r\n    isReverse: boolean;\r\n}>`\r\n    display: inline-block;\r\n    margin: 0 0 0 5px;\r\n    width: calc(100% - 10px);\r\n    height: 20px;\r\n    color: #3b51d1;\r\n    ${props => !props.isReverse ? '' : css`\r\n        transform: rotateY(180deg);\r\n    `}\r\n`;\r\n\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 360px;\r\n    text-align: left;\r\n    background-color: #78b48c;\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Root = styled.div`\r\n    display: inline-block;\r\n    width: 90px;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #e6e6e6;\r\n`;\r\nconst _RootItem = styled.div<{\r\n    isRootActive: boolean;\r\n    isOnActive: boolean;\r\n    isDiatonic: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #75757575;\r\n    ${props => !props.isRootActive ? '' : css`background-color: #ff6060bd;`}\r\n    ${props => !props.isOnActive ? '' : css`background-color: #6070ffbc;`}\r\n    border: 1px solid #000;\r\n    box-sizing: border-box;\r\n    color: #3030308d;\r\n    ${props => !props.isDiatonic ? '' : css`color: #17007e;`}\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 16px;\r\n    text-align: center;\r\n    & span {\r\n        color: #9e9e9e;\r\n    }\r\n    &:hover {\r\n        background-color: #fffdfd40;\r\n        ${props => !props.isRootActive ? '' : css`background-color: #ff9090bc;`}\r\n        ${props => !props.isOnActive ? '' : css`background-color: #90d3ffbb;`}\r\n    }\r\n`;\r\n\r\nconst _Symbol = styled.div<{\r\n    isDisable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 90px);\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #99e07d;\r\n    ${props => !props.isDisable ? '' : css`\r\n        opacity: 0.3;\r\n        pointer-events: none;\r\n    `}\r\n`;\r\n\r\nconst _SymbolItem = styled.div<{\r\n    isActive: boolean;\r\n    isDiatonic: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #75757575;\r\n    ${props => !props.isActive ? '' : css`background-color: #ff6060bd;`}\r\n    border: 1px solid #000;\r\n    box-sizing: border-box;\r\n    color: #3030308d;\r\n    ${props => !props.isDiatonic ? '' : css`color: #17007e;`}\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 16px;\r\n    text-align: center;\r\n    & span {\r\n        color: #9e9e9e;\r\n    }\r\n    &:hover {\r\n        background-color: #fffdfd40;\r\n        ${props => !props.isActive ? '' : css`background-color: #ff9090bc;`}\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord, DetailInit, DetailSection, Scale, BeatSignature } from \"../../../../../redux/store/scoreData\";\r\nimport { KEY12_MAJOR_SCALE_LIST, KEY12_MINOR_SCALE_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SideFormInit = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const data = store.scoreData;\r\n    const detail = data.chordList[0].detail as DetailInit;\r\n\r\n    const scaleItemJsxList: JSX.Element[] = ['major', 'minor'].map((item, i) => {\r\n        return (\r\n            <_ScaleItem key={i} isActive={detail.scale === item} onClick={() => {\r\n                detail.scale = item as Scale;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {item}\r\n            </_ScaleItem>\r\n        )\r\n    });\r\n\r\n    const keyList = detail.scale === 'major' ? KEY12_MAJOR_SCALE_LIST : KEY12_MINOR_SCALE_LIST;\r\n    const keyItemJsxList: JSX.Element[] = keyList.map((item, i) => {\r\n        const scale = detail.scale;\r\n        return (\r\n            <_KeyItem key={i} isActive={detail.keyIndex === i} onClick={() => {\r\n                detail.keyIndex = i;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {`${item} ${scale}`}\r\n            </_KeyItem>\r\n        )\r\n    });\r\n\r\n\r\n    const rateItemJsxList: JSX.Element[] = ['4/4', '3/4'].map((item, i) => {\r\n        return (\r\n            <_RateItem key={i} isActive={detail.timeSignature === item} onClick={() => {\r\n                detail.timeSignature = item as BeatSignature;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {item}\r\n            </_RateItem>\r\n        )\r\n    });\r\n\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_LabelTitle>Scale</_LabelTitle>\r\n            <_ScaleWrap>{scaleItemJsxList}</_ScaleWrap>\r\n            <_LabelTitle>Key</_LabelTitle>\r\n            <_KeyWrap>{keyItemJsxList}</_KeyWrap>\r\n            <_LabelTitle>Tempo</_LabelTitle>\r\n            <_TempoWrap>\r\n                <input\r\n                    type=\"number\" min={30} max={220} step={1}\r\n                    value={detail.bpm}\r\n                    onChange={(e) => {\r\n                        detail.bpm = e.currentTarget.valueAsNumber;\r\n                        data.chordList = data.chordList.slice();\r\n                        dispatcher.score.setScoreData(data);\r\n                    }}\r\n                />\r\n                <input\r\n                    type=\"range\" min={30} max={220} step={1}\r\n                    value={detail.bpm}\r\n                    onChange={(e) => {\r\n                        detail.bpm = e.currentTarget.valueAsNumber;\r\n                        data.chordList = data.chordList.slice();\r\n                        dispatcher.score.setScoreData(data);\r\n                    }}\r\n                />\r\n            </_TempoWrap>\r\n            <_LabelTitle>Rate</_LabelTitle>\r\n            <_RateWrap>{rateItemJsxList}</_RateWrap>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormInit;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #9b9eb8;\r\n`;\r\n\r\nconst _LabelTitle = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    margin: 5px 0 0 0;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n`;\r\n\r\nconst _ScaleWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _ScaleItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 50%;\r\n    height: 100%;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #6182b4;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;\r\n\r\n\r\nconst _KeyWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 24px; */\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _KeyItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #61b47d;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;\r\n\r\n\r\nconst _TempoWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    background-color: #ececec;\r\n\r\n    & * {\r\n        display: inline-block;\r\n        box-sizing: border-box;\r\n        vertical-align: top;\r\n    }\r\n    & input:nth-child(1) {\r\n        background-color: #dddddd;\r\n        width: 60px;\r\n        height: calc(100% - 4px);\r\n        margin: 2px 0 0 0;\r\n        border: 1px solid #9b9b9b;\r\n        border-radius: 4px;\r\n    }\r\n    & input:nth-child(2) {\r\n        margin-left: 5px;\r\n        background-color: #f00;\r\n        width: calc(100% - 70px);\r\n        height: 100%;\r\n    }\r\n`;\r\n\r\n\r\nconst _RateWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 24px; */\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _RateItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #61b47d;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord, DetailSection } from \"../../../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SideFormSection = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const detail = cur.detail as DetailSection;\r\n\r\n    const setLabelName = (value: string) => {\r\n        detail.labelName = value;\r\n        store.scoreData.chordList = store.scoreData.chordList.slice();\r\n        dispatcher.score.setScoreData(store.scoreData);\r\n    }\r\n\r\n    const templateItemJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        ['Intro', 'A-mero', 'B-mero', 'Sabi', 'C-mero', 'Outro'].forEach((item) => {\r\n            const isActive = detail.labelName.indexOf(item) === 0;\r\n            jsxList.push(\r\n                <_TemplateItem key={jsxList.length} isActive={isActive}\r\n                    onClick={()=>{\r\n                        setLabelName(item);\r\n                    }}\r\n                >\r\n                    {item}\r\n                </_TemplateItem>\r\n            );\r\n        });\r\n        return jsxList;\r\n    }, []);\r\n\r\n    const numberItemJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        [1, 2, 3, 4].forEach((item) => {\r\n            const isActive = detail.labelName.indexOf(item.toString()) !== -1;\r\n            jsxList.push(\r\n                <_NumberItem key={jsxList.length} isActive={isActive}>\r\n                    {item}\r\n                </_NumberItem>\r\n            );\r\n        });\r\n        return jsxList;\r\n    }, []);\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_DirectText type=\"text\"\r\n                value={detail.labelName}\r\n                onChange={(e) => {\r\n                    setLabelName(e.target.value);\r\n                }}\r\n            />\r\n            <_TemplateFrame>{templateItemJsxList}</_TemplateFrame>\r\n            <_NumberFrame>{numberItemJsxList}</_NumberFrame>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormSection;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #b89b9b;\r\n`;\r\n\r\nconst _DirectText = styled.input`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    text-align: left;\r\n    background-color: #bbbbbb;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    color: #a30000;\r\n    box-sizing: border-box;\r\n    outline: none;\r\n    border: 1px solid black;\r\n    border-radius: 4px;\r\n`;\r\n\r\n\r\n\r\nconst _ItemBase = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 24px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _TemplateFrame = styled.div`\r\n    display: inline-block;\r\n    width: 60%;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: center;\r\n    background-color: #dac3d8;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _NumberFrame = styled.div`\r\n    display: inline-block;\r\n    width: 40%;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: center;\r\n    background-color: #dac3d8;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _TemplateItem = styled(_ItemBase)<{\r\n    isActive: boolean;\r\n}>`\r\n    background-color: #6182b4;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #ad993fe6;\r\n    `}\r\n`;\r\n\r\nconst _NumberItem = styled(_ItemBase)<{\r\n    isActive: boolean;\r\n}>`\r\n    background-color: #61b4b0;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #ad993fe6;\r\n    `}\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DetailChord, DetailInit, DetailSection } from \"../../../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport SideFormChord from \"./sideFormChord\";\r\nimport SideFormInit from \"./sideFormInit\";\r\nimport SideFormSection from \"./sideFormSection\";\r\n\r\nconst NoteSideForm = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.scoreState;\r\n    const chordList = store.scoreData.chordList;\r\n\r\n    if (state.focusIndex === -1 || state.focusIndex > chordList.length - 1) {\r\n        return <></>;\r\n    }\r\n\r\n    const element = chordList[state.focusIndex];\r\n\r\n    return (\r\n        <_Wrap>\r\n            {(() => {\r\n                switch (element.type) {\r\n                    case 'init': return <SideFormInit />;\r\n                    case 'section': return <SideFormSection />;\r\n                    case 'chord': return <SideFormChord />;\r\n                    case 'change': return <></>;\r\n                }\r\n            })()}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default NoteSideForm;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px);\r\n    text-align: left;\r\n    background-color: #8a8a8a;\r\n`;\r\n","import { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { ElementCache } from \"../../../../../redux/store/scoreState\";\r\nimport { TIMELINE_BEAT_WIDTH } from \"../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport BlockItem from \"./blockItem\";\r\n\r\nconst HarmMeasure = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const dataList = store.scoreData.chordList;\r\n    const focusIndex = state.focusIndex;\r\n    const cacheList = state.elementCacheList;\r\n\r\n    let curBeatJsx: JSX.Element = <></>;\r\n    let prevBeatJsx: JSX.Element = <></>;\r\n    let nextBeatJsx: JSX.Element = <></>;\r\n    let curMinuteJsx: JSX.Element = <></>;\r\n    let prevMinuteJsx: JSX.Element = <></>;\r\n    let nextMinuteJsx: JSX.Element = <></>;\r\n\r\n    const memoriJsxList: JSX.Element[] = [];\r\n\r\n    //\r\n\r\n    let curIndex = 2;\r\n    let prevIndex = 2;\r\n    let nextIndex = dataList.length - 1;\r\n    let temp = focusIndex;\r\n    while (temp > 2) {\r\n        const element = dataList[temp];\r\n        if (element.type === 'chord') {\r\n            curIndex = temp;\r\n            break;\r\n        }\r\n        temp--;\r\n    }\r\n    // \r\n    if (curIndex > 2) {\r\n        temp = curIndex - 1;\r\n        while (temp > 2) {\r\n            const element = dataList[temp];\r\n            if (element.type === 'chord') {\r\n                prevIndex = temp;\r\n                break;\r\n            }\r\n            temp--;\r\n        }\r\n    }\r\n    temp = focusIndex + 1;\r\n    while (temp < dataList.length - 1) {\r\n        const element = dataList[temp];\r\n        if (element.type === 'chord') {\r\n            nextIndex = temp;\r\n            break;\r\n        }\r\n        temp++;\r\n    }\r\n    if (state.focusIndex === -1 || state.focusIndex > state.elementCacheList.length) {\r\n        return <></>;\r\n    }\r\n\r\n    const add = (sustain: number, cache: ElementCache): void => {\r\n        const adjust = cache.beat + cache.minute;\r\n        for (let i = 0; i < Math.floor(sustain / 0.25); i++) {\r\n            const pos = i + Math.floor(adjust / 0.25);\r\n            let bean: { width: number, height: number, color: string } = { width: 1, height: 10, color: '#555' }\r\n            switch (true) {\r\n                case pos % 16 === 0: bean = { width: 2, height: 22, color: '#747474' }; break;\r\n                case pos % 4 === 0: bean = { width: 1, height: 18, color: '#646464' }; break;\r\n                case pos % 2 === 0: bean = { width: 1, height: 14, color: '#7a7a7a' }; break;\r\n            }\r\n            memoriJsxList.push(\r\n                <_Memori\r\n                    key={memoriJsxList.length}\r\n                    width={bean.width}\r\n                    height={bean.height}\r\n                    color={bean.color}\r\n                >\r\n                    {pos % 16 === 0 ? <_Bar>{cache.bar + 1 + (adjust === 0 ? 0 : 1)}</_Bar> : ''}\r\n                </_Memori>\r\n            );\r\n        }\r\n    }\r\n\r\n    if (curIndex > 2) {\r\n\r\n        if (prevIndex === 2) {\r\n            prevBeatJsx = (\r\n                <_Prev sustain={4}>start</_Prev>\r\n            );\r\n            prevMinuteJsx = (\r\n                <_Prev sustain={4} />\r\n            );\r\n\r\n            memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n        } else {\r\n            const chord = dataList[prevIndex].detail as DetailChord;\r\n            const cache = cacheList[prevIndex];\r\n            const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n            prevBeatJsx = (\r\n                <_Prev sustain={chord.beatLen}>Prev</_Prev>\r\n            );\r\n            prevMinuteJsx = (\r\n                <_Prev sustain={sustain} />\r\n            );\r\n\r\n            add(sustain, cache);\r\n        }\r\n    }\r\n    if (curIndex === 2) {\r\n        curBeatJsx = (\r\n            <_Cur sustain={4}>start</_Cur>\r\n        );\r\n        curMinuteJsx = (\r\n            <_Cur sustain={4} />\r\n        );\r\n\r\n        memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n    } else {\r\n        const chord = dataList[curIndex].detail as DetailChord;\r\n        const cache = cacheList[curIndex];\r\n        const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n        curBeatJsx = (\r\n            <_Cur sustain={chord.beatLen}>Cur</_Cur>\r\n        );\r\n        curMinuteJsx = (\r\n            <_Cur sustain={sustain} />\r\n        );\r\n\r\n        add(sustain, cache);\r\n    }\r\n    if (nextIndex === dataList.length - 1) {\r\n        nextBeatJsx = (\r\n            <_Next sustain={4}>end</_Next>\r\n        );\r\n        nextMinuteJsx = (\r\n            <_Next sustain={4} />\r\n        );\r\n\r\n        memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n    } else {\r\n        const chord = dataList[nextIndex].detail as DetailChord;\r\n        const cache = cacheList[nextIndex];\r\n        const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n        nextBeatJsx = (\r\n            <_Next sustain={chord.beatLen}>Next</_Next>\r\n        );\r\n        nextMinuteJsx = (\r\n            <_Next sustain={sustain} />\r\n        );\r\n\r\n        add(sustain + 0.25, cache);\r\n    }\r\n\r\n    // const curSustain = nextCache.beat - curCache.beat;\r\n    return (\r\n        <_Wrap>\r\n            <_Blocks>\r\n                <_Beat>\r\n                    {prevBeatJsx}\r\n                    {curBeatJsx}\r\n                    {nextBeatJsx}\r\n                </_Beat>\r\n                <_Minute>\r\n                    {prevMinuteJsx}\r\n                    {curMinuteJsx}\r\n                    {nextMinuteJsx}\r\n                </_Minute>\r\n            </_Blocks>\r\n            <_Measure>\r\n                {memoriJsxList}\r\n            </_Measure>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default HarmMeasure;\r\n\r\nconst BEAT_WIDTH = 50;\r\n\r\nconst _Wrap = styled.div`\r\n    overflow: hidden;\r\n    text-align: left;\r\n    white-space: nowrap;  \r\n`;\r\n\r\nconst _Blocks = styled.div`\r\n    display: block;\r\n    /* position: relative; */\r\n    height: 40px;\r\n    /* width: 2200px; */\r\n    background-color: rgb(131, 131, 131);\r\n`;\r\n\r\nconst _Beat = styled.div`\r\n    display: block;\r\n    height: 30px;\r\n`;\r\n\r\nconst _Minute = styled.div`\r\n    display: block;\r\n    height: 10px;\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    sustain: number;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.sustain * BEAT_WIDTH}px;\r\n    height: 100%;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: white;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Prev = styled(_Item) <{\r\n}>`\r\n    background-color: rgba(0, 21, 211, 0.158);\r\n`;\r\n\r\nconst _Cur = styled(_Item) <{\r\n}>`\r\n    background-color: rgb(233, 5, 5);\r\n`;\r\n\r\nconst _Next = styled(_Item) <{\r\n}>`\r\n    background-color: rgba(31, 189, 0, 0.144);\r\n`;\r\n\r\nconst _Measure = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    height: 38px;\r\n    background-color: rgb(48, 48, 48);\r\n    border-top: solid 2px rgb(128, 128, 128);\r\n    background: linear-gradient(to bottom, rgb(255, 255, 255), rgb(98, 97, 114));\r\n`;\r\n\r\n\r\nconst _Start = styled.div`\r\n    display: inline-block;\r\n    width: ${BEAT_WIDTH * 4}px;\r\n    height: 100%;\r\n    background-color: #cecece;\r\n    box-sizing: border-box;\r\n`;\r\nconst _Memori = styled.div<{\r\n    width: number;\r\n    height: number;\r\n    color: string;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: ${BEAT_WIDTH / 4}px;\r\n    height: ${props => props.height}px;\r\n    border-left: solid ${props => props.width}px ${props => props.color};\r\n    box-sizing: border-box;\r\n`;\r\nconst _Bar = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: -5px;\r\n    top: 18px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #dd0000;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { getIntervalValues, getSymbolFromKey, IntervalRelationProps } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst ChordInfo = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n    const scaleList = cache == null ? [] : [0, 2, 4, 5, 7, 9, 11].map(value => (cache.keyIndex + value) % 12);\r\n    let structs: number[] = [];\r\n\r\n    const [structJsxList, tipJsxList]: [JSX.Element[], JSX.Element[]] = useMemo(() => {\r\n\r\n        const structJsxList: JSX.Element[] = [];\r\n        let tipJsxList: JSX.Element[] = [];\r\n\r\n        if (cur.type === 'chord') {\r\n            const detail = cur.detail as DetailChord;\r\n            const root = detail.root;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            if (root != null && symbol != null) {\r\n                structs = getIntervalValues((root.index + cache.keyIndex) % 12, symbol.structs);\r\n                // alert(structs);\r\n\r\n                tipJsxList = symbol.structs.map((struct, i) => <_InfoItem key={i}>\r\n                    <span>{struct}</span><span>{IntervalRelationProps[struct]}</span>\r\n                </_InfoItem>)\r\n            }\r\n        }\r\n        for (let i = 0; i < 14; i++) {\r\n            {\r\n                const curIndex = structJsxList.length;\r\n                const isScale = scaleList.includes(curIndex % 12);\r\n                const isUse = structs.includes(curIndex);\r\n                structJsxList.push(\r\n                    <_Item key={structJsxList.length} isBlack={false} index={i} isScale={isScale} isUse={isUse}></_Item>\r\n                );\r\n            }\r\n            if ([0, 1, 3, 4, 5].includes(i % 7)) {\r\n                const curIndex = structJsxList.length;\r\n                const isScale = scaleList.includes(curIndex % 12);\r\n                const isUse = structs.includes(curIndex);\r\n                structJsxList.push(\r\n                    <_Item key={structJsxList.length} isBlack={true} index={i} isScale={isScale} isUse={isUse}></_Item>\r\n                );\r\n            }\r\n        }\r\n        return [structJsxList, tipJsxList];\r\n    }, [structs]);\r\n\r\n    return (\r\n        <_Wrap isUse={structs.length > 0}>\r\n            {/* <_Info>{tipJsxList}</_Info> */}\r\n            <_Struct>{structJsxList}</_Struct>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ChordInfo;\r\n\r\nconst _Wrap = styled.div<{\r\n    isUse: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    ${props => props.isUse ? '' : css`\r\n        opacity: 0.5;\r\n    `}\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _Info = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 100%;\r\n    background-color: #949494;\r\n    /* border: solid 1px #a3a3a3; */\r\n    box-sizing: border-box;\r\n    /* padding: 2px 0 0 0; */\r\n`;\r\nconst _InfoItem = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 15px;\r\n    box-sizing: border-box;\r\n\r\n    /* background-color: #4b4b4b; */\r\n    /* background: linear-gradient(to bottom, #adac6c, #e0df7d, #adac6c); */\r\n    /* background: linear-gradient(to bottom, #858585, #4b4b4b, #858585); */\r\n    border: solid 1px rgb(207, 207, 207);\r\n    margin-bottom: 1px;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    line-height: 12px;\r\n    text-align: center;\r\n\r\n    & span:nth-child(1){\r\n        color: #f5e400;\r\n    }\r\n    & span:nth-child(2){\r\n        margin-left: 10px;\r\n        color: #ffffff;\r\n    }\r\n`;\r\n\r\nconst _Struct = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - 50px);\r\n    height: 100%;\r\n    /* background-color: #383838; */\r\n    /* padding: 12px 0 0 2px;\r\n    box-sizing: border-box; */\r\n`;\r\n\r\nconst WIDTH = 25;\r\nconst MARGIN = 2;\r\nconst HEIGHT_WHITE = 43;\r\nconst HEIGHT_BLACK = 32;\r\nconst INTERVAL = WIDTH + MARGIN;\r\nconst _Item = styled.div<{\r\n    isScale: boolean;\r\n    isUse: boolean;\r\n    isBlack: boolean;\r\n    index: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: ${props => 2 + (!props.isBlack ? HEIGHT_BLACK : 0)}px;\r\n    left: ${props => 2 + (props.index * INTERVAL) + (!props.isBlack ? 0 : WIDTH / 2)}px;\r\n    z-index: 2;\r\n    border: 1px solid #ffffffda;\r\n    border-radius: 20px;\r\n    width: 25px;\r\n    height: ${props => !props.isBlack ? HEIGHT_WHITE : HEIGHT_BLACK}px;\r\n    /* background-color: #7d7d9e; */\r\n    ${props => props.isScale ? css`\r\n    background: radial-gradient(#c3c3d6, #8989a8);\r\n    ` : css`\r\n    background: radial-gradient(#d6c3ca, #a88995);\r\n    `}\r\n    ${props => !props.isUse ? '' : props.isScale ? css`\r\n        background: radial-gradient(#3e9ef7, #254e74);\r\n    ` : css`\r\n        background: radial-gradient(#d43131, #722a2a);\r\n    `}\r\n    box-sizing: border-box;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst InitialBeatTip = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const tipJsxList:JSX.Element[] = [];\r\n    for(let i = 0; i < 4; i ++) {\r\n        tipJsxList.push(\r\n            <_Tip key={i} isActive={state.initialBeat > i} onClick={()=> {\r\n                state.initialBeat = i + 1;\r\n                dispatcher.score.setScoreState(state);\r\n            }}/>\r\n        );\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Label>inital beat</_Label>\r\n            <_WrapTip>{tipJsxList}</_WrapTip>\r\n        </_Wrap>\r\n    );\r\n\r\n}\r\n\r\nexport default InitialBeatTip;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    /* background-color: red; */\r\n    & *{\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #979797;\r\n    margin-left: 4px;\r\n    font-style: italic;\r\n    line-height: 38px;\r\n    /* background-color: yellow; */\r\n`;\r\nconst _WrapTip = styled.div`\r\n    display: inline-block;\r\n    width: 142px;\r\n    height: calc(100% - 6px);\r\n    margin: 3px 0 0 8px;\r\n    border-radius: 4px;\r\n    border: solid 1px #747474;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Tip = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 30px;\r\n    height: calc(100% - 6px);\r\n    margin: 3px 0 0 4px;\r\n    background-color: #d6d6d6;\r\n    ${props => !props.isActive ? '' : css`background-color: #eeedcf;`}\r\n    border: solid 1px #b9b9b9;\r\n    box-sizing: border-box;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst PatternLength = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n\r\n    const itemJsxList: JSX.Element[] = [];\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n    const update = () => dispatcher.backing.setState(state);\r\n\r\n    layer.noteDivList.forEach((note, i) => {\r\n        const isActive = pattern.lenIndex === i;\r\n        const isEdit = isActive && pattern.channelIndex !== -1;\r\n        let rate = note.rate;\r\n        if (note.isDot) rate /= 1.5;\r\n        if (note.div3 !== 0) rate /= note.div3 / 3;\r\n        itemJsxList.push(\r\n            <_Item key={i} rate={rate} isActive={isActive} isEdit={isEdit}\r\n                onClick={() => {\r\n                    pattern.channelIndex = -1;\r\n                    pattern.lenIndex = i;\r\n                    update();\r\n                }}\r\n            >\r\n                {note.rate}{!note.isDot ? '' : '.'}{note.div3 === 0 ? '' : '/'}\r\n            </_Item>\r\n        );\r\n    });\r\n\r\n    return (<_Wrap>\r\n        {itemJsxList}\r\n    </_Wrap>);\r\n}\r\n\r\nexport default PatternLength;\r\n\r\nconst _Wrap = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    white-space: nowrap;\r\n`;\r\n\r\n\r\nconst _Item = styled.div<{\r\n    rate: number;\r\n    isActive: boolean;\r\n    isEdit: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => NOTES_1BAR_WIDTH / props.rate - 1}px;\r\n    height: calc(100% - 4px);\r\n    margin: 2px 0 0 1px;\r\n    background-color: #1616beb0;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #6363eeaf;\r\n    `}\r\n    ${props => !props.isEdit ? '' : css`\r\n        background-color: #b40000af;\r\n    `}\r\n    box-sizing: border-box;\r\n\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #ffffffba;\r\n    text-align: center;\r\n`;\r\n\r\n","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../../utils/backingUtil\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst PatternTable = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n    const channelCount = pattern.channels.length;\r\n    // const layer = pattern.layers[pattern.layerIndex];\r\n    const curLayer = pattern.layers[pattern.layerIndex];\r\n\r\n    const update = () => dispatcher.backing.setState(state);\r\n\r\n    const layerJsxList = useMemo(() => {\r\n\r\n        const layerJsxList: JSX.Element[][] = Array(2);\r\n\r\n        pattern.layers.forEach((layer, j) => {\r\n    \r\n            const jsxLsit: JSX.Element[] = [];\r\n            for (let i = 0; i < channelCount; i++) {\r\n                const notesJsxLsit: JSX.Element[] = [];\r\n    \r\n                layer.noteDivList.forEach((note, k) => {\r\n                    // \r\n                    const channelIndex = (channelCount - 1) - i;\r\n                    const isActive = pattern.lenIndex === k;\r\n                    const cell = layer.table[channelIndex][k];\r\n                    const setNotesStatus = (status: BackingState.NoteStatus | null) => layer.table[channelIndex][k] = status;\r\n    \r\n                    const isUse = cell != null;\r\n                    // \r\n                    const isError = pattern.layerIndex !== j ? false :\r\n                        isUse && BackingUtil.checkOverlapBackLayer(pattern.layers, j, channelIndex, k);\r\n                    const isEdit = isActive && pattern.channelIndex === i;\r\n                    let rate = note.rate;\r\n                    if (note.isDot) rate /= 1.5;\r\n                    if (note.div3 !== 0) rate /= note.div3 / 3;\r\n                    notesJsxLsit.push(\r\n                        <_Notes key={k} rate={rate} isActive={isActive} isEdit={isEdit} isBack={pattern.layerIndex !== j}>\r\n                            <_State isUse={isUse} isError={isError} signal={'n'} isBack={pattern.layerIndex !== j}\r\n                                onClick={() => {\r\n                                    if (cell == null) {\r\n                                        setNotesStatus({ signal: 'n', timing: 0, velAdj: 0 });\r\n                                    } else {\r\n                                        setNotesStatus(null);\r\n                                    }\r\n                                    curLayer.table = curLayer.table.slice();\r\n                                    update();\r\n                                    dispatcher.backing.updateErrorState();\r\n                                }}\r\n                                onContextMenu={() => {\r\n                                    pattern.channelIndex = i;\r\n                                    pattern.lenIndex = k;\r\n                                    update();\r\n                                }}\r\n                            />\r\n                        </_Notes>\r\n                    );\r\n                });\r\n                jsxLsit.push(\r\n                    <_Record key={i} isEven={i % 2 == 0} isFront={true}>\r\n                        {notesJsxLsit}\r\n                    </_Record>\r\n                );\r\n            }\r\n            layerJsxList[j] = jsxLsit;\r\n        });\r\n        return layerJsxList;\r\n    }, [pattern.channels, pattern.layerIndex, pattern.lenIndex,\r\n        curLayer.table\r\n    ]);\r\n\r\n    const jsx = pattern.layerIndex === 0 ? layerJsxList : layerJsxList.reverse();\r\n    return (<>\r\n        <_Layer zIndex={2}>{jsx[1]}</_Layer>\r\n        <_Layer zIndex={1}>{jsx[0]}</_Layer>\r\n    </>);\r\n}\r\n\r\nexport default PatternTable;\r\n\r\nconst _Layer = styled.div<{\r\n    zIndex: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n    /* background-color: #000000f; */\r\n`;\r\n\r\nconst _Record = styled.div<{\r\n    isEven: boolean;\r\n    isFront: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    ${props => !props.isFront ? '' : css<{\r\n    isEven: boolean;\r\n}>`\r\n        ${props => !props.isEven ? css`\r\n            background-color: #3a3a502f;\r\n        ` : css`\r\n            background-color: #42425542;\r\n        `}\r\n    `}\r\n`;\r\n\r\nconst _Notes = styled.div<{\r\n    rate: number;\r\n    isActive: boolean;\r\n    isEdit: boolean;\r\n    isBack: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => NOTES_1BAR_WIDTH / props.rate - 1}px;\r\n    height: calc(100% - 1px);\r\n    margin: 1px 0 0 1px;\r\n    ${props => props.isBack ? '' : css<{\r\n    isActive: boolean;\r\n}>`\r\n        background-color: #00000013;\r\n        ${props => !props.isActive ? '' : css`\r\n            background-color: #9b9b9b1d;\r\n        `}\r\n    `}\r\n    ${props => !props.isEdit ? '' : css`\r\n        border: 2px solid #d80000ba;\r\n    `}\r\n    box-sizing: border-box;\r\n\r\n    &:hover {\r\n        background-color: #82f7ff57;\r\n    }\r\n`;\r\n\r\nconst _State = styled.div<{\r\n    isUse: boolean;\r\n    isError: boolean;\r\n    signal: BackingState.NoteSignal;\r\n    isBack: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: calc(100% - 2px);\r\n    margin: 1px 0 0 1px;\r\n    background-color: #a7a7a754;\r\n    ${props => !props.isUse ? '' : css<{\r\n        isBack: boolean;\r\n        isError: boolean;\r\n    }>`\r\n        /* background-color: #f8fc029b; */\r\n        background: linear-gradient(to bottom, #9b9e00, #f8fc02, #9b9e00);\r\n        // \r\n        ${props => !props.isError ? '' : css`\r\n            opacity: 0.5;\r\n        `}\r\n        // \r\n        ${props => !props.isBack ? '' : css`\r\n            background: linear-gradient(to bottom, #9e0000, #fc0202, #9e0000);\r\n            opacity: 0.5;\r\n        `}\r\n    `}\r\n    box-sizing: border-box;\r\n    &:hover {\r\n        background-color: #ffffff63;\r\n        ${props => !props.isUse ? '' : css`\r\n            background-color: #fdff719b;\r\n        `}\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst PatternVelocity = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n\r\n    const itemJsxList: JSX.Element[] = [];\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n\r\n    layer.velocityList.forEach((vel, i) => {\r\n        const isActive = pattern.lenIndex === i;\r\n\r\n        const note = layer.noteDivList[i];\r\n        let rate = note.rate;\r\n        if (note.isDot) rate /= 1.5;\r\n        if (note.div3 !== 0) rate /= note.div3 / 3;\r\n        itemJsxList.push(\r\n            <_Item key={i} rate={rate} isActive={isActive} >\r\n                <_Value value={vel} />\r\n            </_Item>\r\n        );\r\n    });\r\n\r\n    return (<_Wrap>\r\n        {itemJsxList}\r\n    </_Wrap>);\r\n}\r\n\r\nexport default PatternVelocity;\r\n\r\nconst _Wrap = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    white-space: nowrap;\r\n`;\r\n\r\n\r\nconst _Item = styled.div<{\r\n    rate: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: ${props => NOTES_1BAR_WIDTH / props.rate - 1}px;\r\n    height: calc(100% - 4px);\r\n    margin: 2px 0 0 1px;\r\n    background-color: #001763ac;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #173494ac;\r\n    `}\r\n    box-sizing: border-box;\r\n    /* text-align: center; */\r\n`;\r\n\r\nconst _Value = styled.div<{\r\n    value: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: calc(50% - 6px);\r\n    width: 10px;\r\n    height: ${props => props.value * 10}%;\r\n    background-color: #5cceddaf;\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport { ElementCache } from \"../../../../redux/store/scoreState\";\r\nimport BackingUtil from \"../../../../utils/backingUtil\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport PatternLength from \"./patternLength\";\r\nimport PatternTable from \"./patternTable\";\r\nimport PatternVelocity from \"./patternVelocity\";\r\n\r\nconst PatternBuilder = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const chordInfo = state.chordInfo;\r\n\r\n    const isUsePattern = state.pattern != null;\r\n\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n    const divs = layer.noteDivList;\r\n    const limitLen = BackingUtil.getLimitLen(chordInfo);\r\n    const useTotalLen = BackingUtil.getTotalLenFromDivs(divs);\r\n    const isLenOverError = 0 <= limitLen - useTotalLen;\r\n\r\n    const viewRate = NOTES_1BAR_WIDTH / 4;\r\n\r\n\r\n    // JSX\r\n    const memoriJsxList: JSX.Element[] = [];\r\n    for (let i = 0; i < Math.floor(useTotalLen / 0.25) + 1; i++) {\r\n        const pos = i;\r\n        let bean: { width: number, height: number, color: string } = { width: 1, height: 10, color: '#555' }\r\n        switch (true) {\r\n            case pos % 16 === 0: bean = { width: 2, height: 22, color: '#747474' }; break;\r\n            case pos % 4 === 0: bean = { width: 1, height: 18, color: '#646464' }; break;\r\n            case pos % 2 === 0: bean = { width: 1, height: 14, color: '#7a7a7a' }; break;\r\n        }\r\n        memoriJsxList.push(\r\n            <_Memori\r\n                key={memoriJsxList.length}\r\n                width={bean.width}\r\n                height={bean.height}\r\n                color={bean.color}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (<>\r\n        <_Header>\r\n            <_LengthDiv>\r\n                <PatternLength />\r\n            </_LengthDiv>\r\n            <_MeasureDiv>\r\n                <_MemoriList>{memoriJsxList}</_MemoriList>\r\n                {isLenOverError ? (\r\n                    <_ChordLenLine pos={limitLen * viewRate} />\r\n                ) : (\r\n                    <_OverCover pos={limitLen * viewRate} width={(useTotalLen - limitLen) * viewRate} />\r\n                )}\r\n            </_MeasureDiv>\r\n        </_Header>\r\n        <_Body>\r\n            <PatternTable />\r\n        </_Body>\r\n        <_Footer>\r\n            <PatternVelocity />\r\n        </_Footer>\r\n    </>);\r\n}\r\n\r\nexport default PatternBuilder;\r\n\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT}px;\r\n    background-color: #9292bdd6;\r\n`;\r\nconst _LengthDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2}px;\r\n    background-color: #9292bdd6;\r\n`;\r\nconst _MeasureDiv = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2}px;\r\n    background-color: #b492bdd5;\r\n    background: linear-gradient(to bottom, rgb(255, 255, 255), rgb(98, 97, 114));\r\n`;\r\n\r\nconst _MemoriList = styled.div`\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n`;\r\n\r\nconst _Memori = styled.div<{\r\n    width: number;\r\n    height: number;\r\n    color: string;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: ${NOTES_1BAR_WIDTH / 16}px;\r\n    height: ${props => props.height}px;\r\n    border-left: solid ${props => props.width}px ${props => props.color};\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _OverCover = styled.div<{\r\n    pos: number;\r\n    width: number;\r\n}>`\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: ${props => props.pos}px;\r\n    width: ${props => props.width}px;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2 + PATTERN_BODY_HEIGHT}px;\r\n    background-color: #f8000053;\r\n    pointer-events: none;\r\n`;\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${PATTERN_BODY_HEIGHT}px;\r\n    background-color: #97d3cec8;\r\n`;\r\nconst _Footer = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_FOOTER_HEIGHT}px;\r\n    background-color: #898997cc;\r\n`;\r\n\r\nconst _ChordLenLine = styled.div<{\r\n    pos: number;\r\n}>`\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: ${props => props.pos}px;\r\n    width: 4px;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2 + PATTERN_BODY_HEIGHT}px;\r\n    background-color: #ffffffc7;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { _CSS_DISABLE } from \"../../../../base/design/styles\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../../utils/backingUtil\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst ChannelItem = (props: {\r\n    index: number;\r\n    soundFullName: string;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n    const index = pattern.channels.length - 1 - props.index;\r\n    const channelCount = pattern.channels.length;\r\n\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n        dispatcher.backing.updateErrorState();\r\n    }\r\n    const addRecord = () => {\r\n        pattern.layers.forEach((layer) => {\r\n            const initialCellArray = BackingUtil.getInitialRecord(layer.noteDivList.length);\r\n            layer.table.splice(index, 0, initialCellArray);\r\n        });\r\n        // alert(pattern.layers[0].table.length);\r\n        const structs = BackingUtil.buildChannels(state.voicingTable as boolean[][]);\r\n        pattern.channels = BackingUtil.getChannels(structs, pattern.channels.length + 1);\r\n        update();\r\n    }\r\n\r\n    const deleteRecord = () => {\r\n        pattern.layers.forEach((layer) => {\r\n            layer.table.splice(index, 1);\r\n        });\r\n        // alert(pattern.layers[0].table.length);\r\n        const structs = BackingUtil.buildChannels(state.voicingTable as boolean[][]);\r\n        pattern.channels = BackingUtil.getChannels(structs, pattern.channels.length - 1);\r\n        update();\r\n    }\r\n\r\n    return (<>\r\n        <_Wrap isError={props.soundFullName === '-'}>\r\n            <_Struct>{props.soundFullName}</_Struct>\r\n            <_Option isEnable={channelCount > 1} onClick={deleteRecord}>-</_Option>\r\n            <_Option isEnable={channelCount < 12} onClick={addRecord}>+</_Option>\r\n        </_Wrap>\r\n    </>);\r\n}\r\n\r\nexport default ChannelItem;\r\n\r\nconst _Wrap = styled.div<{\r\n    isError: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 19px;\r\n    background-color: #b4b3b36f;\r\n    ${props => !props.isError ? '' : css`\r\n        background-color: #ff0000c3;\r\n    `}\r\n    margin: 0 0 1px 0;\r\n`;\r\n\r\nconst _Item = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    margin: 0 1px 0 0;\r\n    border: 1px solid #322e4292;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Struct = styled(_Item)`\r\n    width: 47px;\r\n\r\n`;\r\n\r\nconst _Option = styled(_Item)<{\r\n    isEnable: boolean;\r\n}>`\r\n    width: 25px;\r\n    &:hover {\r\n        background-color: #f1ef866c;\r\n    }\r\n    ${props => props.isEnable ? '' : _CSS_DISABLE}\r\n    \r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../../utils/theoryUtils\";\r\nimport { PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport ChannelItem from \"./channelItem\";\r\nimport BackingState from \"../../../../redux/store/backingState\";\r\nimport { _CSS_LABEL_MIDIUM, _CSS_LABEL_SMALL } from \"../../../../base/design/styles\";\r\n\r\nconst PatternChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const chordInfo = state.chordInfo;\r\n    const symbol = getSymbolFromKey(chordInfo.symbolKey);\r\n    const pattern = state.pattern;\r\n    const chordRoot = (chordInfo.root.index + chordInfo.init.keyIndex) % 12;\r\n\r\n    const channelJsxList: JSX.Element[] = [];\r\n    const layerJsxList: JSX.Element[] = [];\r\n    if (pattern != null) {\r\n        const channels = pattern.channels;\r\n        channels.forEach((channel, i) => {\r\n            let name = '-';\r\n            if (channel.octave !== -1) {\r\n                const soundIndex = chordRoot + IntervalRelationProps[symbol.structs[channel.structIndex]];\r\n                const octave = channel.octave + Math.floor(soundIndex / 12);\r\n                name = KEY12_SHARP_LIST[soundIndex % 12] + octave;\r\n            }\r\n            channelJsxList.push(\r\n                <ChannelItem key={i}\r\n                    index={i}\r\n                    soundFullName={name}\r\n                />\r\n            );\r\n        });\r\n\r\n        pattern.layers.forEach((layer, i) => {\r\n            const labelName = i === 0 ? 'L-HAND' : 'R-HAND';\r\n            layerJsxList.push(\r\n                <_LayerItem key={i} isActive={pattern.layerIndex === i}\r\n                    onClick={()=>{\r\n                        if(i !== pattern.layerIndex) {\r\n                            dispatcher.backing.changeLayer();\r\n                        }\r\n                    }}\r\n                >\r\n                    {labelName}\r\n                </_LayerItem>\r\n            );\r\n        });\r\n    }\r\n\r\n    return (<>\r\n        <_Header>\r\n            {layerJsxList}\r\n        </_Header>\r\n        <_Body>\r\n            {channelJsxList}\r\n        </_Body>\r\n        <_Footer>\r\n        </_Footer>\r\n    </>);\r\n}\r\n\r\nexport default PatternChannel;\r\n\r\nconst _Header = styled.div`\r\n    /* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT}px;\r\n    background-color: #929292;\r\n`;\r\n\r\nconst _LayerItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    height: 22px;\r\n    width: calc(100% - 4px);\r\n    margin: 2px 0 0 2px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    \r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #3b3b3b;\r\n    line-height: 20px;\r\n    background-color: #b8b8b8;\r\n    border: 1px solid #7a7a7a;\r\n    border-radius: 2px;\r\n\r\n    ${proops => !proops.isActive ? '' : css`\r\n        background-color: #dad600;\r\n        color: #c40000;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #d4d4d4;\r\n    }\r\n`;\r\n\r\nconst _Body = styled.div`\r\n/* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_BODY_HEIGHT}px;\r\n    background-color: #97d3cec8;\r\n`;\r\nconst _Footer = styled.div`\r\n/* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_FOOTER_HEIGHT}px;\r\n    background-color: #898997cc;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../utils/backingUtil\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\n\r\nconst PatternStatus = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const pattern = state.pattern as BackingState.Pattern;\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n    const cur = layer.noteDivList[pattern.lenIndex];\r\n    const chordInfo = state.chordInfo;\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n        dispatcher.backing.updateErrorState();\r\n    }\r\n\r\n    const setRate = (rate: BackingState.NoteRate) => {\r\n        cur.rate = rate;\r\n        update();\r\n    }\r\n\r\n    const createItem = (name: string, isActive: boolean, callback: () => void): JSX.Element => {\r\n        return (\r\n            <_Item isEnable={true} isActive={isActive}\r\n                onClick={callback}>\r\n                {name}\r\n            </_Item>\r\n        );\r\n    }\r\n    const createRateItem = (rate: BackingState.NoteRate): JSX.Element => {\r\n        return createItem(String(rate), cur.rate === rate, () => setRate(rate));\r\n    }\r\n\r\n    const sizeJsxList: JSX.Element[] = [];\r\n    for (let i = 0; i < BackingUtil.CHANNEL_MAX; i++) {\r\n        const value = i + 1;\r\n        sizeJsxList.push(\r\n            <_ListItem key={i}\r\n                value={value}>\r\n                {value}\r\n            </_ListItem>\r\n        );\r\n    }\r\n\r\n    const lenModeJsx = <_WrapLen>\r\n        <_List\r\n            value={pattern.channels.length}\r\n            onChange={(e) => {\r\n                const prevSize = pattern.channels.length;\r\n                const newSize = Number(e.target.value);\r\n                const voicingStructs = BackingUtil.buildChannels(state.voicingTable as boolean[][]);\r\n                pattern.channels = BackingUtil.getChannels(voicingStructs, newSize);\r\n                const sub = Number(e.target.value) - prevSize;\r\n                pattern.layers.forEach((layer, i) => {\r\n                    if (sub > 0) {\r\n                        const initialCellArray = new Array<BackingState.NoteStatus | null>(layer.noteDivList.length).fill(null);\r\n                        for (let j = 0; j < sub; j++) layer.table.push(JSON.parse(JSON.stringify(initialCellArray)));\r\n                    } else {\r\n                        const delCnt = Math.abs(sub);\r\n                        layer.table.splice(-delCnt, delCnt);\r\n                    }\r\n                });\r\n                update();\r\n            }}>\r\n            {sizeJsxList}\r\n        </_List>\r\n        {createRateItem(16)}\r\n        {createRateItem(8)}\r\n        {createRateItem(4)}\r\n        {createRateItem(2)}\r\n        {createRateItem(1)}\r\n        {createItem('.', cur.isDot, () => {\r\n            cur.isDot = !cur.isDot;\r\n            update();\r\n        })}\r\n        {createItem('1/3', cur.div3 === 1, () => {\r\n            if (cur.div3 === 1) cur.div3 = 0;\r\n            else cur.div3 = 1;\r\n            update();\r\n        })}\r\n        {createItem('2/3', cur.div3 === 2, () => {\r\n            if (cur.div3 === 2) cur.div3 = 0;\r\n            else cur.div3 = 2;\r\n            update();\r\n        })}\r\n    </_WrapLen>;\r\n\r\n\r\n    const selectedCell = pattern.channelIndex === -1 ? null :\r\n        pattern.layers[pattern.layerIndex].table[pattern.channels.length - 1 - pattern.channelIndex][pattern.lenIndex];\r\n    const editModeJsx = <_WrapEdit>\r\n\r\n        {createItem('-', selectedCell == null, () => {\r\n\r\n            update();\r\n        })}\r\n\r\n        {createItem('', selectedCell != null && selectedCell.signal === 'n', () => {\r\n\r\n            update();\r\n        })}\r\n        {createItem('', selectedCell != null && selectedCell.signal === 's', () => {\r\n\r\n            update();\r\n        })}\r\n        {createItem('', selectedCell != null && selectedCell.signal === 't', () => {\r\n\r\n            update();\r\n        })}\r\n    </_WrapEdit>;\r\n    return (pattern.channelIndex === - 1 ? lenModeJsx : editModeJsx);\r\n}\r\n\r\nexport default PatternStatus;\r\n\r\nconst _WrapLen = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #86c5b2;\r\n`;\r\nconst _WrapEdit = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #86b8c5;\r\n`;\r\n\r\n\r\nconst _List = styled.select<{\r\n\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    color: #eeff00;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    background-color: #d4d4d422;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n    outline: none;\r\n`;\r\nconst _ListItem = styled.option<{\r\n}>`\r\n    background-color: black;\r\n    color: white;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    isEnable: boolean;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #ff008023;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #fbff0050;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n        ${props => !props.isActive ? '' : css`\r\n            background-color: #dfe07850;\r\n        `}\r\n    }\r\n`;","\r\nimport { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../utils/backingUtil\";\r\nimport { PATTERN_FRAME_HEIGHT, PATTERN_OPERATION_HEIGHT as PATTERN_STATUS_HEIGHT } from \"../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\nimport PatternBuilder from \"./builder/patternBuilder\";\r\nimport PatternChannel from \"./channel/patternChannel\";\r\nimport PatternStatus from \"./patternStatus\";\r\n\r\nconst PatternFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const chordInfo = state.chordInfo;\r\n\r\n    const isUsePattern = state.pattern != null;\r\n\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n    }\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Header>\r\n                <_UseSwitch>\r\n                    <_Label>Pattern</_Label>\r\n                    <_Button isActive={isUsePattern}\r\n                        onClick={() => {\r\n                            if (!isUsePattern) {\r\n                                const table = state.voicingTable as boolean[][];\r\n                                const voicingStructs = BackingUtil.buildChannels(table);\r\n                                const channels = BackingUtil.getChannels(voicingStructs, 1);\r\n                                state.pattern = {\r\n                                    layerIndex: 0,\r\n                                    lenIndex: 0,\r\n                                    channelIndex: -1,\r\n                                    channels,\r\n                                    isUsePedal: false,\r\n                                    layers: [dispatcher.backing.getInitialLayer(), dispatcher.backing.getInitialLayer()],\r\n                                } as BackingState.Pattern;\r\n                                update();\r\n                            } else {\r\n                                state.pattern = null;\r\n                                update();\r\n                            }\r\n                        }}>Use\r\n                    </_Button>\r\n                </_UseSwitch>\r\n            </_Header>\r\n            <_Main isActive={isUsePattern}>\r\n                {!isUsePattern ? <></> : (<>\r\n                    <_StatusDiv><PatternStatus /></_StatusDiv>\r\n                    <_MainDiv>\r\n                        <_ChannelDiv>\r\n                            <PatternChannel />\r\n                        </_ChannelDiv>\r\n                        <_BuilderDiv>\r\n                            <PatternBuilder />\r\n                        </_BuilderDiv>\r\n                    </_MainDiv>\r\n                </>)}\r\n            </_Main>\r\n        </_Wrap>\r\n    )\r\n}\r\n\r\nexport default PatternFrame;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 300px; */\r\n    background-color: #001279;\r\n\r\n    & *{\r\n        /* display: inline-block;\r\n        width: 100%; */\r\n    }\r\n`;\r\n\r\nconst _Header = styled.div`\r\n    height: 30px;\r\n    background-color: #a5d1c3;\r\n`;\r\n\r\n\r\nconst _Label = styled.div``;\r\nconst _UseSwitch = styled.div`\r\n    display: inline-block;\r\n    width: 200px;\r\n    height: 100%;\r\n    /* background-color: #7986d1; */\r\n\r\n    & * {\r\n        display: inline-block;\r\n        height: calc(100% - 4px);\r\n        margin-top: 2px;\r\n        box-sizing: border-box;        \r\n    }\r\n\r\n    & ${_Label} {\r\n        width: 80px;\r\n        font-size: 20px;\r\n        color: #f1fffb;\r\n        font-weight: 600;\r\n        /* background-color: #00000028; */\r\n        margin: 2px 2px 0 2px;\r\n        line-height: 22px;\r\n        text-align: center;\r\n    }\r\n`;\r\n\r\nconst _Button = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    width: 100px;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #ff008023;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => !props.isActive ? '' : css`\r\n        /* background-color: #b1dfc979; */\r\n        color: #e00000;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n    }\r\n`;\r\n\r\nconst _Main = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    overflow: hidden;\r\n    height: ${PATTERN_FRAME_HEIGHT}px;\r\n    ${props => props.isActive ? '' : css`\r\n        height: 0;\r\n    `}\r\n    transition: height 100ms;\r\n`;\r\n\r\nconst _StatusDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_STATUS_HEIGHT}px;\r\n    background-color: #8d98d4;\r\n    text-align: left;\r\n`;\r\n\r\nconst _MainDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #d48d8d;\r\n\r\n    /* & *{\r\n        display: inline-block;\r\n        height: 100%;\r\n    } */\r\n`;\r\n\r\nconst _ChannelDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100px;\r\n    background-color: #ff0000;\r\n`;\r\n\r\nconst _BuilderDiv = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 100px);\r\n    background-color: #76af90;\r\n`;","\r\nimport { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../utils/backingUtil\";\r\nimport { playChordSoundfont } from \"../../../utils/instrumentsUtil\";\r\nimport { getChordRoot, getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\n\r\nconst VoicingChooser = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n    const chordInfo = state.chordInfo;\r\n    const symbol = getSymbolFromKey(chordInfo.symbolKey);\r\n\r\n    const table = state.voicingTable as boolean[][];\r\n    const pattern = state.pattern;\r\n    const chordRoot = (chordInfo.root.index + chordInfo.init.keyIndex) % 12;\r\n    const chordName = KEY12_SHARP_LIST[chordRoot] + symbol.name;\r\n\r\n    const voicingLaneJsxList: JSX.Element[] = [];\r\n    const channelLimitNum = pattern == null ? BackingUtil.OCTAVE_NUM * BackingUtil.STRUCT_NUM : pattern.channels.length;\r\n    let total = 0;\r\n    for (let i = 0; i < BackingUtil.OCTAVE_NUM; i++) {\r\n        const tipJsxList: JSX.Element[] = [];\r\n        for (let j = 0; j < BackingUtil.STRUCT_NUM; j++) {\r\n            let isEnable: boolean = symbol.structs.length > j;\r\n            let isSelected: boolean = table[i][j];\r\n            if (isSelected) {\r\n                total++;\r\n            }\r\n\r\n            const interval = IntervalRelationProps[symbol.structs[j]];\r\n            const chordIndex = (chordRoot + interval) % 12;\r\n            const octave = i + Math.floor((chordRoot + interval) / 12);\r\n\r\n            const name = !isEnable ? '' : `${KEY12_SHARP_LIST[chordIndex]}${octave}`;\r\n            tipJsxList.push(\r\n                <_VoicingItem key={j}\r\n                    isEnable={isEnable}\r\n                    isSelected={isSelected}\r\n                    isOver={isSelected && total > channelLimitNum}\r\n                    onClick={() => {\r\n                        table[i][j] = !isSelected;\r\n                        if (pattern != null) {\r\n                            const voicingStructs: BackingState.ChannelParam[] = BackingUtil.buildChannels(table);\r\n                            pattern.channels = BackingUtil.getChannels(voicingStructs, pattern.channels.length);\r\n                        }\r\n                        dispatcher.backing.setState({ ...state, voicingTable: table, pattern });\r\n                        dispatcher.backing.updateErrorState();\r\n                    }}\r\n                    onContextMenu={() => {\r\n                        const soundfont = store.instruments.harmony;\r\n                        if (soundfont != null) {\r\n                            soundfont.play(name, 0, { duration: 1 });\r\n                        }\r\n                    }}\r\n                >\r\n                    {name}\r\n                </_VoicingItem>\r\n            );\r\n        }\r\n        voicingLaneJsxList.push(\r\n            <_VoicingLane key={i}>\r\n                {tipJsxList}\r\n            </_VoicingLane>\r\n        );\r\n    }\r\n\r\n\r\n    const relationJsxList: JSX.Element[] = [];\r\n    symbol.structs.forEach((struct, i) => {\r\n        const interval = IntervalRelationProps[struct];\r\n        const chordIndex = (+ interval) % 12;\r\n        relationJsxList.push(\r\n            <_Relation key={i}>{struct} [{KEY12_SHARP_LIST[chordIndex]}]</_Relation>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Info>\r\n                <_InfoItem>\r\n                    <_Label>Chord</_Label>\r\n                    <_Value>{chordName}</_Value>\r\n                </_InfoItem>\r\n                <_InfoItem>\r\n                    <_Label>Type</_Label>\r\n                    <_Value>{symbol.attr}</_Value>\r\n                </_InfoItem>\r\n            </_Info>\r\n            <_Main>\r\n                <_Left>\r\n                    {relationJsxList}\r\n                </_Left>\r\n                <_Right>{voicingLaneJsxList}</_Right>\r\n            </_Main>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default VoicingChooser;\r\n\r\nconst TIP_WIDTH = 60;\r\nconst TIP_HEIGHT = 22;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 600px;\r\n`;\r\n\r\nconst _Info = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    background-color: #338f8f;\r\n`;\r\n\r\nconst _InfoItem = styled.div`\r\n    display: inline-block;\r\n    width: 50%;\r\n    height: 100%;\r\n    /* background-color: #89dada; */\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    margin-top: 4px;\r\n    margin-left: 5px;\r\n    height: calc(100% - 8px);\r\n    width: 80px;\r\n    background-color: #69bcdd;\r\n    font-size: 18px;\r\n    line-height: 18px;\r\n    font-weight: 600;\r\n    color: #026c86;\r\n    border: 1px solid #303030;\r\n    border-radius: 2px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Value = styled.div`\r\n    display: inline-block;\r\n    margin-top: 4px;\r\n    margin-left: 6px;\r\n    height: calc(100% - 8px);\r\n    /* background-color: #cccccc; */\r\n    font-size: 18px;\r\n    line-height: 18px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n`;\r\n\r\nconst _Main = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${(TIP_HEIGHT + 1) * 6 + 4}px;\r\n    background-color: #c09e05;\r\n    border: solid 1px #888;\r\n    border-radius: 5px;\r\n    box-sizing: border-box;\r\n\r\n    & *{\r\n        vertical-align: top;\r\n        height: 100%;\r\n    }\r\n`;\r\n\r\nconst _Left = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${TIP_WIDTH * 8}px);\r\n    /* width: 100px; */\r\n    background-color: #8fb5bc;\r\n`;\r\n\r\nconst _Relation = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: ${TIP_HEIGHT}px;\r\n    margin-top: 1px;\r\n    /* width: 100px; */\r\n    /* background-color: #8fb5bc; */\r\n    background: linear-gradient(to bottom, #10828a, #76d5db, #10828a);\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: white;\r\n    padding-left: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Right = styled.div`\r\n    display: inline-block;\r\n    background-color: #a7acd8;\r\n`;\r\n\r\nconst _VoicingLane = styled.div`\r\n    display: inline-block;\r\n    width: ${TIP_WIDTH}px;\r\n    height: 100%;\r\n    /* margin-left: 1px; */\r\n    background-color: #a7d8c4;\r\n    padding-bottom: 2px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _VoicingItem = styled.div<{\r\n    isEnable: boolean;\r\n    isSelected: boolean;\r\n    isOver: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 1px);\r\n    height: ${TIP_HEIGHT}px;\r\n    margin: 1px 0 0 1px;\r\n    background-color: #409ca3;\r\n    color: #01004e;\r\n    ${props => !props.isSelected ? '' : css`\r\n        background-color: #e5e747;\r\n    `}\r\n    ${props => !props.isOver ? '' : css`\r\n        background-color: #c40000;\r\n        color: #ffffff;\r\n    `}\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n    /* border: 1px solid #ffffff; */\r\n    box-sizing: border-box;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    &:hover {\r\n        background-color: #117dbb;\r\n        ${props => !props.isSelected ? '' : css`\r\n            background-color: #b9bb3f;\r\n        `}\r\n        ${props => !props.isOver ? '' : css`\r\n            background-color: #bb3f3f;\r\n        `}\r\n    }\r\n`;\r\n\r\n","\r\nimport { useContext, useEffect } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingState from \"../../redux/store/backingState\";\r\nimport BackingUtil from \"../../utils/backingUtil\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\nimport PatternFrame from \"./pattern/patternFrame\";\r\nimport VoicingChooser from \"./voicing/voicingChooser\";\r\n\r\nconst BackingEditorFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState.Editor;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_PrevireBrind isUse={state.isPreview} />\r\n            <VoicingChooser />\r\n            <PatternFrame />\r\n            <_FooterDiv>\r\n                <_Button isEnable={!state.hasError} onClick={() => {\r\n\r\n                    if (!state.isPreview) {\r\n                        dispatcher.backing.testBacking();\r\n                    } else {\r\n                        BackingUtil.stopPreview(store, state, dispatcher, store.reserveTasks);\r\n                    }\r\n                }}>{!state.isPreview ? 'Test' : 'Stop'}</_Button>\r\n                <_Button isEnable={!state.isPreview} onClick={() => {\r\n                    dispatcher.backing.closeBackingEditor();\r\n                }}>Cancel</_Button>\r\n                <_Button isEnable={!state.isPreview} onClick={() => {\r\n                    dispatcher.backing.mappingEditorToScore();\r\n                    dispatcher.backing.closeBackingEditor();\r\n                }}>Update</_Button>\r\n            </_FooterDiv>\r\n        </_Wrap>\r\n    )\r\n}\r\n\r\nexport default BackingEditorFrame;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 600px;\r\n`;\r\n\r\nconst _FooterDiv = styled.div`\r\n    display: inline-block;\r\n    height: 30px;\r\n    width: 100%;\r\n    /* background-color: #bd4646; */\r\n    text-align: right;\r\n`;\r\n\r\nconst _Button = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #0051ff21;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n    }\r\n`;\r\n\r\nconst _PrevireBrind = styled.div<{\r\n    isUse: boolean;\r\n}>`\r\n    position: absolute;\r\n    display: ${props => props.isUse ? 'block' : 'none'};\r\n    z-index: 80;\r\n    width: 100%;\r\n    height: calc(100% - 30px);\r\n    background-color: #7a270028;\r\n`;","import { useContext } from \"react\";\r\nimport { Stream } from \"stream\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../redux/store/scoreData\";\r\nimport BackingEditorFrame from \"../../../backing/backingEditorFrame\";\r\nimport PatternFrame from \"../../../backing/pattern/patternFrame\";\r\nimport VoicingChooser from \"../../../backing/voicing/voicingChooser\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst HarmHideFrame = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const isOpen = state.hideMenu === 'backing';\r\n\r\n    const chordList = store.scoreData.chordList;\r\n    const focusIndex = store.scoreState.focusIndex;\r\n    const cur = chordList[focusIndex];\r\n    const isBackingEnable = cur.type === 'chord' && (cur.detail as DetailChord).root != null;\r\n    return (<>\r\n        <_Blind isOpen={isOpen} onClick={() => {\r\n            dispatcher.backing.closeBackingEditor();\r\n        }} />\r\n        <_Wrap>\r\n            <_Contents isOpen={isOpen}>\r\n                {store.backingState == null ? <></> : <BackingEditorFrame />}\r\n            </_Contents>\r\n            <_Label\r\n                isEnable={isBackingEnable}\r\n                onClick={() => {\r\n                    if (state.hideMenu === 'none') {\r\n                        dispatcher.backing.openBackingEditor();\r\n                    } else if (state.hideMenu === 'backing') {\r\n                        dispatcher.backing.closeBackingEditor();\r\n                    }\r\n                }}>\r\n                <div>Backing</div>\r\n            </_Label>\r\n        </_Wrap>\r\n    </>);\r\n}\r\n\r\nexport default HarmHideFrame;\r\n\r\nconst _Blind = styled.div<{\r\n    isOpen: boolean;\r\n}>`\r\n    display: ${props => props.isOpen ? 'inline-block' : 'none'};\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #01004216;\r\n    backdrop-filter: blur(6px);\r\n`;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 11;\r\n    left: 0;\r\n    top: 0;\r\n    /* width: 525px; */\r\n\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isOpen: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.isOpen ? '600px' : 0};\r\n    /* height: 400px; */\r\n    background-color: #a3a3a3;\r\n    opacity: 0.9;\r\n    transition: width 0.1s;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _Label = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 25px;\r\n    height: 150px;\r\n    background-color: #e4e4e4;\r\n    border-top: 1px solid #5a5a5a;\r\n    border-right: 1px solid #5a5a5a;\r\n    border-bottom: 1px solid #5a5a5a;\r\n    border-radius: 0 10px 10px 0;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #5a5a5a;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    box-sizing: border-box;\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n    \r\n    & div {\r\n        width: 150px;\r\n        transform-origin: top left;\r\n        transform: rotate(-90deg) translateX(-100%);\r\n        /* background-color: #fff; */\r\n    }\r\n\r\n    &:hover {\r\n        background-color: #d1e5eb;\r\n    }\r\n`;","import styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../../base/components/button/executableButton\";\r\nimport { HARMONIZE_FOOT_WIDTH, HARMONIZE_HEAD_WIDTH, HARMONIZE_STRUCT_WIDTH, HARMONIZE_RIGHT_WIDTH, HARMONIZE_SECTIONS_WIDTH } from \"../../../../utils/systemConst\";\r\nimport HarmNote from \"./harmNote\";\r\nimport HarmSections from \"./harmSections\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport { KeyboardEvent, useContext, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { DetailChord, DetailFixed, DetailInit, DetailSection } from \"../../../../redux/store/scoreData\";\r\nimport { ElementCache, SectionCache } from \"../../../../redux/store/scoreState\";\r\nimport { NoteKeyDown, NoteKeySwitch } from \"./input/noteInput\";\r\nimport NoteSideForm from \"./side/noteSideForm\";\r\nimport HarmMeasure from \"./measure/harmMeasure\";\r\nimport { Timeline } from \"tone\";\r\nimport ChordInfo from \"./info/chordInfo\";\r\nimport InitialBeatTip from \"./initial/initialBeat\";\r\nimport { getBeatRate } from \"../../../../utils/theoryUtils\";\r\nimport HarmHideFrame from \"./harmHideFrame\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { _CSS_DISABLE } from \"../../../../base/design/styles\";\r\n\r\nconst HarmonizeTab = (props: {\r\n    isActive: boolean;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const wrapRef = useRef<HTMLDivElement>({} as HTMLDivElement);\r\n    const [invalidate, setInvalidate] = useState<{}>({});\r\n\r\n    const chordList = store.scoreData.chordList;\r\n    const state = store.scoreState;\r\n    const init = (store.scoreData.chordList[0].detail as DetailInit);\r\n\r\n    const isTune = store.scoreState.isTune;\r\n\r\n    useEffect(() => {\r\n        dispatcher.system.setInvalidate({\r\n            ...store.invalidate, harmonize: () => {\r\n                dispatcher.system.setInvalidate({\r\n                    ...store.invalidate, harmoniizeInvalidate: {}\r\n                });\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!isTune) {\r\n            wrapRef.current.focus();\r\n        }\r\n    }, [isTune]);\r\n\r\n    useEffect(() => {\r\n        const elementCacheList: ElementCache[] = [];\r\n        const sectionCacheList: SectionCache[] = [];\r\n\r\n        let prevBeat = 0;\r\n        let totalBeat = 0;\r\n        let prevMinute = 0;\r\n        let totalMinute = 0;\r\n        let sectionNo = -1;\r\n        let keyIndex = -1;\r\n        let sectionBeatSum = 0;\r\n\r\n        chordList.forEach((element, i) => {\r\n            const type = element.type;\r\n            switch (type) {\r\n                case 'fixed': {\r\n                    const detail = element.detail as DetailFixed;\r\n                    if (detail.fixed === 'End') {\r\n                        prevBeat = totalBeat;\r\n                        prevMinute = totalMinute;\r\n                    }\r\n                }\r\n                    break;\r\n                case 'init': {\r\n                    const detail = element.detail as DetailInit;\r\n                    keyIndex = detail.keyIndex;\r\n                }\r\n                    break;\r\n                case 'section': {\r\n                    const detail = element.detail as DetailSection;\r\n                    sectionCacheList.push({\r\n                        labelName: detail.labelName,\r\n                        beatSum: 0,\r\n                        rangeIndexStart: i,\r\n                        rangeIndexEnd: chordList.length - 2\r\n                    });\r\n                    sectionNo++;\r\n                    // 21End\r\n                    if (sectionNo > 0) {\r\n                        sectionCacheList[sectionNo - 1].rangeIndexEnd = i - 1;\r\n                        sectionCacheList[sectionNo - 1].beatSum = sectionBeatSum;\r\n                        sectionBeatSum = 0;\r\n                    }\r\n                }\r\n                    break;\r\n                case 'chord': {\r\n                    const detail = element.detail as DetailChord;\r\n                    prevBeat = totalBeat;\r\n                    totalBeat += detail.beatLen;\r\n                    sectionBeatSum += detail.beatLen;\r\n\r\n                    prevMinute = totalMinute;\r\n                    totalMinute += detail.minute.head;\r\n                    totalMinute += detail.minute.tail;\r\n                }\r\n                    break;\r\n                case 'change': {\r\n\r\n                }\r\n                    break;\r\n            }\r\n\r\n            const pastSecond = 60000 / init.bpm * (prevBeat + prevMinute);\r\n            const beatRate = getBeatRate(init.timeSignature)[0];\r\n            elementCacheList.push({\r\n                bar: Math.floor(prevBeat / beatRate),\r\n                beat: prevBeat % beatRate,\r\n                minute: prevMinute,\r\n                keyIndex,\r\n                sectionNo,\r\n                pastSecond,\r\n                reffers: {}\r\n            });\r\n        });\r\n        sectionCacheList[sectionNo].beatSum = sectionBeatSum;\r\n\r\n        store.scoreState.elementCacheList = elementCacheList;\r\n        store.scoreState.sectionCacheList = sectionCacheList;\r\n        dispatcher.score.setScoreState(store.scoreState);\r\n    }, [chordList, chordList.length, init.bpm]);\r\n\r\n    return (\r\n        <_Wrap\r\n            tabIndex={999}\r\n            ref={wrapRef}\r\n            isActive={props.isActive}\r\n            // onKeyDown={(e: KeyboardEvent) => noteKeyDown(e, store, dispatcher)}\r\n            onKeyDown={(e: KeyboardEvent) => NoteKeySwitch(e, store, dispatcher, true)}\r\n            onKeyUp={(e: KeyboardEvent) => NoteKeySwitch(e, store, dispatcher, false)}\r\n        >\r\n            <_Left>\r\n                <_Head isEnable={!state.isPreview}>\r\n                    <InitialBeatTip />\r\n                </_Head>\r\n                <_Middle>\r\n                    <HarmHideFrame />\r\n                    <_Main><HarmNote /></_Main>\r\n                    <_PrevireBrind isUse={state.isPreview} />\r\n                </_Middle>\r\n                <_Foot>\r\n                    <_TIMELINE_WRAP><HarmMeasure /></_TIMELINE_WRAP>\r\n                    <_INFO_WRAP><ChordInfo /></_INFO_WRAP>\r\n                </_Foot>\r\n            </_Left>\r\n            <_Right isEnable={!state.isPreview}>\r\n                <NoteSideForm />\r\n            </_Right>\r\n        </_Wrap>\r\n    );\r\n}\r\nexport default HarmonizeTab;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: ${props => !props.isActive ? 'none' : 'inline-block'};\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst _Left = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_RIGHT_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #c7c7c7;\r\n    vertical-align: top;\r\n`;\r\nconst _Right = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_RIGHT_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #d6d6d6;\r\n    vertical-align: top;\r\n    ${props => props.isEnable ? '' : _CSS_DISABLE}\r\n`;\r\n\r\nconst _Head = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${HARMONIZE_HEAD_WIDTH}px;\r\n    background-color: #d4d4d4;\r\n    ${props => props.isEnable ? '' : _CSS_DISABLE}\r\n`;\r\n\r\nconst _Middle = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: calc(100% - ${HARMONIZE_HEAD_WIDTH + HARMONIZE_FOOT_WIDTH}px);\r\n    background-color: #e0e0e0;\r\n`;\r\n\r\nconst _Main = styled.div`\r\n    position: absolute;\r\n    margin-left: 25px;\r\n    width: calc(100% - 25px);\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _Foot = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${HARMONIZE_FOOT_WIDTH}px;\r\n    background-color: #cacaca;\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _TIMELINE_WRAP = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_STRUCT_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #ddc2c2;\r\n`;\r\nconst _INFO_WRAP = styled.div`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_STRUCT_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #757575;\r\n`;\r\n\r\nconst _PrevireBrind = styled.div<{\r\n    isUse: boolean;\r\n}>`\r\n    position: absolute;\r\n    display: ${props => props.isUse ? 'block' : 'none'};\r\n    z-index: 80;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #7a270028;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst HarmSections = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sections = state.sectionCacheList;\r\n\r\n    if (state.focusIndex === -1 || state.focusIndex > state.elementCacheList.length) {\r\n        return <></>;\r\n    }\r\n\r\n    const curSectionNo = state.elementCacheList[state.focusIndex].sectionNo;\r\n\r\n    const list: JSX.Element[] = [];\r\n    sections.forEach((section, i) => {\r\n        const barSum = Math.floor(section.beatSum / 4);\r\n        const barRem = section.beatSum % 4;\r\n        const isActive = i === curSectionNo;\r\n        list.push(\r\n            <_Item\r\n                key={i}\r\n                isActive={isActive}\r\n                onClick={() => {\r\n                    state.focusIndex = section.rangeIndexStart;\r\n                    dispatcher.score.setScoreState(state);\r\n                }}\r\n            >\r\n                <_Label>{section.labelName}</_Label>\r\n                <_Total>{barSum}{barRem === 0 ? '' : ` (${barRem})`}</_Total>\r\n            </_Item>\r\n        );\r\n    });\r\n\r\n    return (<>\r\n        {list}\r\n    </>);\r\n}\r\n\r\nexport default HarmSections;\r\n\r\n\r\nconst _Label = styled.div``;\r\nconst _Total = styled.div``;\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    margin: 4px 4px 0 4px;\r\n    width: calc(100% - 8px);\r\n    height: 36px;\r\n    background-color: ${props => props.isActive ? css`\r\n        #e7e7e6be;\r\n        box-shadow: 0 0 8px 0 #000b3a48;\r\n    ` : css`\r\n        #c4c4c42b;\r\n    `} ;\r\n    border: 1px solid #aaaaaa;\r\n    border-radius: 20px 20px 20px 20px;\r\n\r\n    text-align: center;\r\n\r\n    & ${_Label} {\r\n        display: inline-block;\r\n        width: 100%;\r\n        height: 20px;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #888;\r\n        /* background-color: #c500003b; */\r\n        line-height: 18px;\r\n    }\r\n    & ${_Total} {\r\n        display: inline-block;\r\n        width: 100%;\r\n        height: 16px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #003eb3;\r\n        /* background-color: #10c5003a; */\r\n        line-height: 16px;\r\n    }\r\n`;","import { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ChordElement, DetailChord, DetailInit } from \"../../../../redux/store/scoreData\";\r\nimport HarmonizeUtil from \"../../../../utils/harmonizeUtil\";\r\nimport { previewCurHarmony } from \"../../../../utils/melodyUtil\";\r\nimport { getChordRoot, getDegreeRoot, getSymbolFromKey } from \"../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst MelodyTimeline = (props: {\r\n    barLength: number;\r\n    beatWidth: number;\r\n    curChord: ChordElement | null;\r\n    timelineLength: number;\r\n    mouseMeasurePos: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const measureRef = useRef<null | HTMLDivElement>(null);\r\n    const chordRef = useRef<null | HTMLDivElement>(null);\r\n\r\n    const state = store.scoreState;\r\n\r\n    const chordList = store.scoreData.chordList;\r\n    const barLength = props.barLength;\r\n    const beatWidth = props.beatWidth;\r\n    const curChord = props.curChord;\r\n    const timelineLength = props.timelineLength;\r\n    const mouseMeasurePos = props.mouseMeasurePos;\r\n    const rate = 1 / store.melodyState.quantize;\r\n    const init = store.scoreData.chordList[0].detail as DetailInit;\r\n\r\n    useEffect(() => {\r\n        store.refs.melody.measure = measureRef.current;\r\n        store.refs.melody.chord = chordRef.current;\r\n    }, []);\r\n\r\n    const measureJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        for (let i = 0; i <= barLength * 4 * 4; i++) {\r\n            let barJsx = <></>;\r\n            if (i % 16 == 0) {\r\n                barJsx = <_Bar>{Math.floor(i / 16) + 1}</_Bar>\r\n            }\r\n            jsxList.push(\r\n                <_Scale key={i} isHead={i % 4 === 0} beatWidth={beatWidth}>\r\n                    {barJsx}\r\n                </_Scale>\r\n            );\r\n        }\r\n        return jsxList;\r\n    }, [barLength]);\r\n\r\n    const chordJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        chordList.forEach((element, i) => {\r\n            if (element.type === 'chord') {\r\n                const detail = element.detail as DetailChord;\r\n                const symbolNmae = getSymbolFromKey(detail.symbolKey)?.name;\r\n                const degreeName = detail.root == null ? '-' :\r\n                    getDegreeRoot(detail.root) + symbolNmae;\r\n                const chordName = detail.root == null ? '-' :\r\n                    getChordRoot(detail.root, init.keyIndex) + symbolNmae;\r\n                jsxList.push(\r\n                    <_ChordItem key={jsxList.length}\r\n                        width={beatWidth * (detail.beatLen + detail.minute.head + detail.minute.tail)}\r\n                        isActive={element == curChord}\r\n                        onClick={() => {\r\n                            state.isTune = false;\r\n                            state.focusIndex = i;\r\n                            dispatcher.score.setScoreState(state);\r\n                        }}\r\n                        onContextMenu={() => {\r\n                            previewCurHarmony(store, dispatcher);\r\n                        }}\r\n                    >\r\n                        <_DegreeName>{degreeName}</_DegreeName><_ChordName> ({chordName})</_ChordName>\r\n                    </_ChordItem>\r\n                );\r\n            }\r\n        });\r\n        return jsxList;\r\n    }, [chordList, curChord]);\r\n\r\n    return (<>\r\n        <_Chord ref={chordRef}>\r\n            <_ChordWrap width={timelineLength}>\r\n                {chordJsxList}\r\n            </_ChordWrap>\r\n        </_Chord>\r\n        <_Measure ref={measureRef}>\r\n            {measureJsxList}\r\n            <_MousePos\r\n                left={mouseMeasurePos * beatWidth * rate}\r\n                width={beatWidth * rate}\r\n            />\r\n        </_Measure>\r\n    </>);\r\n}\r\n\r\nexport default MelodyTimeline;\r\n\r\nconst _Measure = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    background: linear-gradient(to bottom, #ffffff, #808080);\r\n    width: 100%;\r\n    height: 40px;\r\n    text-align: left;\r\n    border-top: solid 2px #000;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n`;\r\n\r\n\r\nconst _MousePos = styled.div<{\r\n    left: number;\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: ${props => props.left}px;\r\n    top: 0px;\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    background-color: #ffff006c;\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    background-color: #c0c0c0;\r\n    width: 100%;\r\n    height: calc(100% - 40px);\r\n    text-align: left;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _ChordWrap = styled.div<{\r\n    width: number;\r\n}>`\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _ChordItem = styled.div<{\r\n    width: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.width - 1}px;\r\n    height: calc(100% - 2px);\r\n    box-sizing: border-box;\r\n    border: 1px solid #646464;\r\n    border-left: 4px solid #940000;\r\n    background-color: #ffffff22;\r\n    ${props => !props.isActive ? '' : css`background-color: #ffce2c9b;`}\r\n    margin: 1px 0 0 1px;\r\n    \r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    &:hover {\r\n        background-color: #fffb0037;\r\n    }\r\n`;\r\n\r\nconst _DegreeName = styled.span`\r\n    color: #d80000;\r\n`;\r\nconst _ChordName = styled.span`\r\n    color: #0000007d;\r\n`;\r\n\r\nconst _Scale = styled.div<{\r\n    isHead: boolean;\r\n    beatWidth: number;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    /* background-color: #ffffffbe; */\r\n    width: ${props => props.beatWidth / 4}px;\r\n    vertical-align: bottom;\r\n    margin-top: 25px;\r\n    height: ${props => props.isHead ? '15px' : '10px'};\r\n    box-sizing: border-box;\r\n    border-left: solid ${props => props.isHead ? '2px' : '1px'} #000;\r\n`;\r\n\r\nconst _Bar = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #ec0000;\r\n    left: -5px;\r\n    top: -20px;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ChordElement, DetailChord, DetailInit } from \"../../../../redux/store/scoreData\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../../utils/theoryUtils\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst MelodyPitchList = (props: {\r\n    mousePitchIndex: number;\r\n    curChord: ChordElement | null;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const init = store.scoreData.chordList[0].detail as DetailInit;\r\n\r\n    // JSX\r\n    const pitchItemJsxList = useMemo(() => {\r\n        const structIndexList: number[] = [];\r\n        if (props.curChord != null) {\r\n            const detail = props.curChord.detail as DetailChord;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            const root = detail.root;\r\n            if (root != null && symbol != null) {\r\n                symbol.structs.forEach((struct) => {\r\n                    structIndexList.push((root.index + init.keyIndex + IntervalRelationProps[struct]) % 12);\r\n                });\r\n            }\r\n        }\r\n\r\n        const list: JSX.Element[] = [];\r\n        for (let i = 0; i < 60; i++) {\r\n            const keyIndex = ((59 - i) + 9) % 12;\r\n            const octave = Math.floor(((59 - i) + 9) / 12) + 1;\r\n            const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n            const octaveName = getOctaveName(octave);\r\n            list.push(\r\n                <_PitchItem key={i}\r\n                    isScale={[0, 2, 4, 5, 7, 9, 11].includes(keyIndex)}\r\n                    isStruct={structIndexList.includes(keyIndex)}\r\n                    isActive={i === props.mousePitchIndex}\r\n                    onClick={() => {\r\n                        const instrument = store.instruments.soundfontPlayer;\r\n                        if (instrument != null) {\r\n                            instrument.stop();\r\n                            instrument.play(soundName + octave, 0, { duration: 1 });\r\n                        }\r\n                    }}\r\n                >\r\n                    {/* {octaveName} */}\r\n                    {soundName}\r\n                </_PitchItem>\r\n            );\r\n        }\r\n        return list;\r\n    }, [props.mousePitchIndex, props.curChord]);\r\n\r\n    return (<>\r\n        <_OctaveWrap>\r\n            <_OctaveItem isActive={false}><div>hihi</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>hi</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>mid2</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>mid1</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>low</div></_OctaveItem>\r\n        </_OctaveWrap>\r\n        <_PitchWrap>\r\n            {pitchItemJsxList}\r\n        </_PitchWrap>\r\n    </>);\r\n};\r\n\r\nexport default MelodyPitchList;\r\n\r\nconst getOctaveName = (num: number) => {\r\n    switch (num) {\r\n        case 0: return 'low';\r\n        case 1: return 'mid1';\r\n        case 2: return 'mid2';\r\n        case 3: return 'hi';\r\n        case 4: return 'hihi';\r\n        default: return '';\r\n    }\r\n}\r\n\r\nconst _OctaveWrap = styled.div`\r\n    display: inline-block;\r\n    width: 30px;\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _PitchWrap = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 30px);\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _OctaveItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    border: 1px solid black;\r\n    width: 100%;\r\n    height: 360px;\r\n    background-color: #758f94;\r\n    ${props => !props.isActive ? '' : css`background-color: #ffc40089;`}\r\n    box-sizing: border-box;\r\n\r\n    font-size: 18px;\r\n    color: #dfdfdf;\r\n    font-weight: 600;\r\n    & div {\r\n        width: 360px;\r\n        transform-origin: top left;\r\n        transform: rotate(-90deg) translateX(-50%);\r\n        /* background-color: #fff; */\r\n    }\r\n`;\r\n\r\nconst _PitchItem = styled.div<{\r\n    isScale: boolean;\r\n    isActive: boolean;\r\n    isStruct: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 20px);\r\n    border: 1px solid black;\r\n    ${props => !props.isScale ? '' : css`\r\n        width: 100%;\r\n    `}\r\n    height: ${TUNE_PITCH_HEIGHT}px;\r\n    background-color: #637596;\r\n    ${props => !props.isStruct ? '' : css`background-color: #949494;`}\r\n    ${props => !props.isActive ? '' : css`background-color: #9e9e6c;`}\r\n    box-sizing: border-box;\r\n\r\n    padding-left: 5px;\r\n    line-height: 28px;\r\n    font-size: 18px;\r\n    color: #dfdfdf;\r\n    font-weight: 600;\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { SoundfontInfo } from \"../../../../../redux/store/melodyState\";\r\n\r\n\r\nconst InstrumentSwitch = (props: {\r\n    labelName: string;\r\n    icon: JSX.Element;\r\n    soundfontInfo: SoundfontInfo;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    return (\r\n        <_Wrap\r\n            isActive={props.soundfontInfo.name === state.soundfontInfo.name}\r\n            onClick={() => {\r\n                // state.quantize = props.value;\r\n                // dispatcher.tune.setState(state);\r\n\r\n                state.soundfontInfo = props.soundfontInfo;\r\n                state.isPreview = true;\r\n                dispatcher.tune.setState(state);\r\n\r\n                const info = props.soundfontInfo;\r\n                Soundfont.instrument(new AudioContext(), info.name,\r\n                    { gain: info.gain, release: 0.5 }).then((soundFontPlayer) => {\r\n                        dispatcher.tune.setInstrument(soundFontPlayer);\r\n                    }).then(() => {\r\n                        state.isPreview = false;\r\n                        dispatcher.tune.setState(state);\r\n                    });\r\n            }}\r\n        >\r\n            <_Icon>{props.icon}</_Icon>\r\n            <_Label>{props.labelName}</_Label>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default InstrumentSwitch;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 85px;\r\n    height: 40px;\r\n    text-align: center;\r\n    border: 1px solid #4b4b4b;\r\n    background-color: #c7c6abda;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #fffd7eda;\r\n    `}\r\n    border-radius: 6px;\r\n    margin-left: 4px;\r\n    box-sizing: border-box;\r\n\r\n    &:hover {\r\n        background-color: #e6e2c5da;\r\n        ${props => !props.isActive ? '' : css`\r\n            background-color: #fffd7eda;\r\n        `}\r\n    }\r\n`;\r\n\r\n\r\nconst _Icon = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    /* background-color: #ff0000da; */\r\n    font-size: 20px;\r\n    color: #4b4b4b;\r\n    text-align: center;\r\n    /* padding-top: 5px; */\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 10px;\r\n    /* background-color: #0400ffdc; */\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 0;\r\n    color: #3b3b3b;\r\n    text-align: center;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { _CSS_DISABLE } from \"../../../../../base/design/styles\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\n\r\nconst QuantizeSwitch = (props: {\r\n    labelName: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    callback: () => void;\r\n}) => {\r\n    // const { store, dispatcher } = useContext(GlobalContext);\r\n    // const state = store.melodyState;\r\n\r\n    return (\r\n        <_Wrap\r\n            isActive={props.isActive}\r\n            isDisable={props.isDisable}\r\n            onClick={props.callback}\r\n        >\r\n            {props.labelName}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default QuantizeSwitch;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100px;\r\n    height: 28px;\r\n    background: linear-gradient(to bottom, #e0e0e0, #aaaaaa, #e0e0e0);\r\n    ${props => !props.isActive ? '' : css`\r\n        background: linear-gradient(to bottom, #b7d9df, #59c6da, #b7d9df);\r\n    `}\r\n    ${props => !props.isDisable ? '' : _CSS_DISABLE}\r\n    color: #5d6e63;\r\n    border-radius: 2px;\r\n    border: solid 1px #747373;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    margin-left: 4px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { _CSS_DISABLE } from \"../../../../../base/design/styles\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\n\r\nconst ControlButton = (props: {\r\n    labelName: string;\r\n    isDisable: boolean;\r\n    callback: () => void;\r\n}) => {\r\n    // const { store, dispatcher } = useContext(GlobalContext);\r\n    // const state = store.melodyState;\r\n\r\n    return (\r\n        <_Wrap\r\n            isDisable={props.isDisable}\r\n            onClick={props.callback}\r\n        >\r\n            {props.labelName}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ControlButton;\r\n\r\nconst _Wrap = styled.div<{\r\n    isDisable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100px;\r\n    height: 28px;\r\n    background: linear-gradient(to bottom, #a8bae0, #818ada, #a8bae0);\r\n    ${props => !props.isDisable ? '' : _CSS_DISABLE}\r\n    color: #5d5d6e;\r\n    border-radius: 2px;\r\n    border: solid 1px #737374;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    margin-left: 4px;\r\n    &:hover {\r\n        background: linear-gradient(to bottom, #c2d0f0, #929beb, #c2d0f0);\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport InstrumentSwitch from \"./item/instrumentSwitch\";\r\nimport QuantizeSwitch from \"./item/quantizeSwitch\";\r\n\r\n\r\nimport { GiViolin, GiGuitar, GiSaxophone, GiViola, GiTrumpet, GiClarinet, GiOcarina } from 'react-icons/gi'\r\nimport ControlButton from \"./item/controlButton\";\r\n\r\n\r\n\r\nconst MelodyHeader = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    return (<>\r\n        <_OperationDiv>\r\n            <_QuantizeSelector>\r\n                <QuantizeSwitch labelName={'16'} isDisable={false} isActive={state.quantize === 4} callback={() => {\r\n                    state.quantize = 4;\r\n                    dispatcher.tune.setState(state);\r\n                }} />\r\n                <QuantizeSwitch labelName={'8'} isDisable={false} isActive={[2, 6].includes(state.quantize)} callback={() => {\r\n                    state.quantize = 2;\r\n                    dispatcher.tune.setState(state);\r\n                }} />\r\n                <QuantizeSwitch labelName={'4'} isDisable={false} isActive={[1, 3].includes(state.quantize)} callback={() => {\r\n                    state.quantize = 1;\r\n                    dispatcher.tune.setState(state);\r\n                }} />\r\n                <QuantizeSwitch labelName={'/3'} isDisable={state.quantize === 4} isActive={[3, 6].includes(state.quantize)} callback={() => {\r\n                    if ([3, 6].includes(state.quantize)) {\r\n                        state.quantize /= 3;\r\n                    } else {\r\n                        state.quantize *= 3;\r\n                    }\r\n                    dispatcher.tune.setState(state);\r\n                }} />\r\n            </_QuantizeSelector>\r\n            <_Control>\r\n                <ControlButton labelName={'Up'} isDisable={false} callback={() => {\r\n                    const list = store.scoreData.notesList;\r\n                    list.forEach(notes => {\r\n                        notes.pitchIndex--;\r\n                    });\r\n                    dispatcher.tune.setNotesList(list.slice());\r\n                }} />\r\n                <ControlButton labelName={'Down'} isDisable={false} callback={() => {\r\n                    const list = store.scoreData.notesList;\r\n                    list.forEach(notes => {\r\n                        notes.pitchIndex++;\r\n                    });\r\n                    dispatcher.tune.setNotesList(list.slice());\r\n                }} />\r\n                <ControlButton labelName={'Reset'} isDisable={false} callback={() => {\r\n                    dispatcher.tune.setNotesList([]);\r\n                }} />\r\n            </_Control>\r\n        </_OperationDiv>\r\n        <_InstrumentSelector>\r\n            <InstrumentSwitch icon={<GiViolin />} labelName=\"violin\" soundfontInfo={{ name: 'violin', gain: 6 }} />\r\n            <InstrumentSwitch icon={<GiGuitar />} labelName=\"e-guitar\" soundfontInfo={{ name: 'distortion_guitar', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiSaxophone />} labelName=\"saxphone\" soundfontInfo={{ name: 'tenor_sax', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiViola />} labelName=\"viola\" soundfontInfo={{ name: 'viola', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiTrumpet />} labelName=\"trumpet\" soundfontInfo={{ name: 'trumpet', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"clarinet\" soundfontInfo={{ name: 'clarinet', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"oboe\" soundfontInfo={{ name: 'oboe', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"flute\" soundfontInfo={{ name: 'flute', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiOcarina />} labelName=\"ocarina\" soundfontInfo={{ name: 'ocarina', gain: 4 }} />\r\n            <InstrumentSwitch icon={<GiGuitar />} labelName=\"shamisen\" soundfontInfo={{ name: 'shamisen', gain: 9 }} />\r\n        </_InstrumentSelector>\r\n    </>);\r\n}\r\n\r\nexport default MelodyHeader;\r\n\r\nconst _OperationDiv = styled.div<{\r\n}>`\r\n    display: block;\r\n    padding: 4px 4px 4px 0;\r\n    background-color: #bbbbbb;\r\n`;\r\n\r\nconst _QuantizeSelector = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    /* margin-left: 20px; */\r\n`;\r\nconst _Control = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    margin-left: 20px;\r\n`;\r\n\r\nconst _InstrumentSelector = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    /* padding: 4px 4px 4px 0; */\r\n    background-color: #e4e4e486;\r\n`;\r\n\r\n","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { DetailChord, TuneNotes } from \"../../../../../redux/store/scoreData\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { getNormalizeLenFromNotes, getNotesLenFromQuantize, playSoundfont } from \"../../../../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../../utils/systemConst\";\r\n\r\nclass MelodyMouseOperation {\r\n\r\n    static mouseDownEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const refs = store.refs.melody;\r\n        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n            const state = store.melodyState;\r\n            const mouse = store.melodyState.mouseState;\r\n            const notesState = mouse.notesState;\r\n            const notesList = store.scoreData.notesList;\r\n            const rate = 1 / state.quantize;\r\n\r\n            const getNextLeft = () => {\r\n                const next = notesList.find(note => x < getNormalizeLenFromNotes(note.pos) * state.beatWidth);\r\n                let nextLeft = timelineLength;\r\n                if (next != undefined) {\r\n                    nextLeft = getNormalizeLenFromNotes(next.pos) * state.beatWidth;\r\n                }\r\n                return nextLeft;\r\n            }\r\n\r\n            const rect = refs.table.getBoundingClientRect();\r\n            const x = e.clientX + refs.table.scrollLeft - rect.left;\r\n            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n\r\n            // \r\n            if (notesState.index === -1) {\r\n\r\n                mouse.isPut = true;\r\n                mouse.lock = {\r\n                    x: Math.floor(x / state.beatWidth / rate) * state.beatWidth * rate,\r\n                    y: Math.floor(y / TUNE_PITCH_HEIGHT) * TUNE_PITCH_HEIGHT\r\n                };\r\n\r\n                mouse.nextLeft = getNextLeft();\r\n                mouse.width = 0;\r\n\r\n\r\n            } else {\r\n                if (notesState.side === 'normal') {\r\n\r\n                        const refs = store.refs.melody;\r\n                        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n                            const rect = refs.table.getBoundingClientRect();\r\n                            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n                            const pitchIndex = Math.floor(y / TUNE_PITCH_HEIGHT);\r\n                            notesList[notesState.index].pitchIndex = pitchIndex;\r\n                            store.scoreData.notesList = notesList.slice();\r\n\r\n                            playSoundfont(pitchIndex, store);\r\n                        }\r\n                } else {\r\n                    const notes = notesList[notesState.index];\r\n                    mouse.lock = {\r\n                        // x: (Math.floor(x / state.beatWidth / rate) * state.beatWidth * rate) - getNormalizeLenFromNotes(notes.len) * state.beatWidth,\r\n                        x: getNormalizeLenFromNotes(notes.pos) * state.beatWidth,\r\n                        y: 0\r\n                    };\r\n                    mouse.nextLeft = getNextLeft();\r\n\r\n                    if (notesState.side === 'left') {\r\n                        notesState.isMove = true;\r\n                        mouse.prevRight = 0;\r\n                        if (notesState.index > 0) {\r\n                            const prev = notesList[notesState.index - 1];\r\n                            mouse.prevRight = (getNormalizeLenFromNotes(prev.pos) + getNormalizeLenFromNotes(prev.len)) * state.beatWidth;\r\n                        }\r\n                    }\r\n                    else if (notesState.side === 'right') {\r\n                        notesState.isResize = true;\r\n                    }\r\n\r\n                    mouse.notesState = { ...notesState };\r\n                }\r\n            }\r\n\r\n            update();\r\n        }\r\n    }\r\n\r\n    static mouseMoveEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const refs = store.refs.melody;\r\n        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n            const state = store.melodyState;\r\n            const mouse = store.melodyState.mouseState;\r\n            // const update = () => dispatcher.tune.setState(state);\r\n            const notesState = mouse.notesState;\r\n            const notesList = store.scoreData.notesList;\r\n            const chordList = store.scoreData.chordList;\r\n            const rate = 1 / state.quantize;\r\n\r\n            const rect = refs.table.getBoundingClientRect();\r\n            const x = e.clientX + refs.table.scrollLeft - rect.left;\r\n            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n\r\n            if (!mouse.isPut && !notesState.isResize && !notesState.isMove) {\r\n                mouse.mousePitchIndex = Math.floor(y / TUNE_PITCH_HEIGHT);\r\n                mouse.mouseMeasurePos = Math.floor(x / state.beatWidth / rate);\r\n\r\n                let left = 0;\r\n                const searchedChord = chordList.find((element) => {\r\n                    if (element.type === 'chord') {\r\n                        const detail = element.detail as DetailChord;\r\n                        const width = detail.beatLen * state.beatWidth;\r\n                        if (x >= left && x < left + width) {\r\n                            return element;\r\n                        }\r\n                        left += width;\r\n                    }\r\n                });\r\n                mouse.curChord = searchedChord == undefined ? null : searchedChord;\r\n\r\n                notesState.index = -1;\r\n                const prevFocus = state.focusIndex;\r\n                state.focusIndex = -1;\r\n                notesState.side = 'normal';\r\n                for (let i = 0; i < notesList.length; i++) {\r\n                    const notes = notesList[i];\r\n                    const left = getNormalizeLenFromNotes(notes.pos) * state.beatWidth;\r\n                    const right = left + getNormalizeLenFromNotes(notes.len) * state.beatWidth;\r\n                    if (x >= left && x <= right) {\r\n                        notesState.index = i;\r\n                        state.focusIndex = i;\r\n\r\n                        if (x < left + 10) notesState.side = 'left';\r\n                        else if (x > right - 10) notesState.side = 'right';\r\n                        break;\r\n                    }\r\n                };\r\n                // Dist\r\n                state.distIndex = state.focusIndex;\r\n                if (prevFocus !== -1 && prevFocus !== state.focusIndex) {\r\n                    state.lastFocus = prevFocus;\r\n                    // dispatcher.tune.setState(state);\r\n                }\r\n                // dispatcher.tune.setState(state);\r\n                mouse.notesState = { ...notesState };\r\n            } else {\r\n                if (mouse.isPut) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 1) * state.beatWidth * rate;\r\n                    mouse.width = (curPos > mouse.nextLeft ? mouse.nextLeft : curPos) - mouse.lock.x;\r\n                } else if (notesState.isResize) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 1) * state.beatWidth * rate;\r\n                    const notes = notesList[notesState.index];\r\n                    // console.log(`${mouse.nextLeft}, ${curPos}`);\r\n                    let posX = curPos - mouse.lock.x;\r\n                    // \r\n                    if (curPos > mouse.nextLeft) {\r\n                        posX = mouse.nextLeft - mouse.lock.x;\r\n                    }\r\n                    // \r\n                    if (curPos <= mouse.lock.x) {\r\n                        posX = state.beatWidth / state.quantize;\r\n                    }\r\n                    notes.len = getNotesLenFromQuantize(state.quantize, Math.floor(posX / state.beatWidth * state.quantize));\r\n                    // dispatcher.tune.setNotesList(notesList.slice());\r\n                    store.scoreData.notesList = notesList.slice();\r\n                } else if (notesState.isMove) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 0) * state.beatWidth * rate;\r\n                    const notes = notesList[notesState.index];\r\n                    const lenWidth = getNormalizeLenFromNotes(notes.len) * state.beatWidth;\r\n                    // console.log(`${mouse.nextLeft}, ${curPos}`);\r\n                    let posX = curPos;\r\n                    // \r\n                    if (curPos + lenWidth > mouse.nextLeft) {\r\n                        posX = mouse.nextLeft - lenWidth;\r\n                    }\r\n                    // \r\n                    if (curPos < mouse.prevRight) {\r\n                        posX = mouse.prevRight;\r\n                    }\r\n                    notes.pos = getNotesLenFromQuantize(state.quantize, Math.floor(posX / state.beatWidth * state.quantize));\r\n                    // dispatcher.tune.setNotesList(notesList.slice());\r\n                    store.scoreData.notesList = notesList.slice();\r\n                }\r\n            }\r\n            update();\r\n        }\r\n    }\r\n\r\n    static mouseUpEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const state = store.melodyState;\r\n        const mouse = store.melodyState.mouseState;\r\n        // const update = () => dispatcher.tune.setState(state);\r\n        const notesState = mouse.notesState;\r\n        const notesList = store.scoreData.notesList;\r\n        const quantize = state.quantize;\r\n\r\n        if (mouse.isPut) {\r\n            mouse.isPut = false;\r\n            if (mouse.width > 0) {\r\n                const pitchIndex = Math.floor(mouse.lock.y / TUNE_PITCH_HEIGHT);\r\n                // alert(mouse.width / state.beatWidth * quantize);\r\n                // const a = getNotesLenFromQuantize(quantize, Math.floor(mouse.lock.x / state.beatWidth * quantize));\r\n                // const b = getNotesLenFromQuantize(quantize, Math.floor(mouse.width / state.beatWidth * quantize));\r\n                // alert(`lockX: ${JSON.stringify(a)},/n width: ${JSON.stringify(b)}`);\r\n                notesList.push({\r\n                    pos: getNotesLenFromQuantize(quantize, Math.floor(mouse.lock.x / state.beatWidth * quantize)),\r\n                    pitchIndex,\r\n                    len: getNotesLenFromQuantize(quantize, Math.floor(mouse.width / state.beatWidth * quantize)),\r\n\r\n                });\r\n                // \r\n                notesList.sort((a, b) => {\r\n                    const posA = getNormalizeLenFromNotes(a.pos);\r\n                    const posB = getNormalizeLenFromNotes(b.pos);\r\n                    return posA === posB ? 0 : (\r\n                        posA < posB ? -1 : 1\r\n                    );\r\n                });\r\n                dispatcher.tune.setNotesList(notesList);\r\n\r\n                playSoundfont(pitchIndex, store);\r\n            }\r\n        } else {\r\n            notesState.isMove = false;\r\n            notesState.isResize = false;\r\n            mouse.notesState = { ...notesState };\r\n            dispatcher.tune.setNotesList(notesList.slice());\r\n        }\r\n        update();\r\n    }\r\n}\r\n\r\nexport default MelodyMouseOperation;","import { KeyboardEvent } from \"react\";\r\nimport { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { MelodyPitchMode } from \"../../../../../redux/store/melodyState\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport HarmonizeUtil from \"../../../../../utils/harmonizeUtil\";\r\nimport { previewCurHarmony, stopPreview } from \"../../../../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../../utils/systemConst\";\r\n\r\n\r\nclass MelodyInput {\r\n\r\n    static keyDownEvent = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n        const config = store.userEnv.keyConfig.note;\r\n        const keySwitch = store.melodyState.keySwitch;\r\n        // alert(e.key);\r\n        // alert(config.nextElement);\r\n\r\n        const state = store.melodyState;\r\n        const isSingle = state.focusIndex === state.distIndex;\r\n        // const notesList = store.scoreData.notesList;\r\n        const mouse = state.mouseState;\r\n\r\n        // \r\n        if (state.isPreview) {\r\n            switch (e.key) {\r\n                case ' ': {\r\n                    stopPreview(store, dispatcher, store.reserveTasks);\r\n                }\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // \r\n        if (mouse.notesState.index !== -1) {\r\n            mouse.notesState.index = -1;\r\n            mouse.notesState.isResize = false;\r\n            mouse.notesState.side = 'normal';\r\n        }\r\n        mouse.mouseMeasurePos = -1;\r\n        mouse.mousePitchIndex = -1;\r\n\r\n        if (keySwitch.scaleMode || keySwitch.octave || keySwitch.resize || keySwitch.move || keySwitch.shift || keySwitch.control) {\r\n            if (keySwitch.control) {\r\n                // alert(e.key);\r\n                switch (e.key) {\r\n                    case 'c': dispatcher.tune.copyNotes(); break;\r\n                    case 'v': dispatcher.tune.pasteNotes(); break;\r\n                    case 'a': {\r\n                        dispatcher.tune.allSelect();\r\n                    }\r\n                        break;\r\n                }\r\n            } else if (keySwitch.scaleMode || keySwitch.octave) {\r\n                const mode: MelodyPitchMode = keySwitch.scaleMode ? 'scale' : 'octave';\r\n                switch (e.key) {\r\n                    case 'ArrowUp': {\r\n                        dispatcher.tune.incrementCurNoteKey(true, mode);\r\n                    }\r\n                        break;\r\n                    case 'ArrowDown': {\r\n                        dispatcher.tune.incrementCurNoteKey(false, mode);\r\n                    }\r\n                        break;\r\n                }\r\n            } else if (keySwitch.resize) {\r\n                switch (e.key) {\r\n                    case 'ArrowLeft': dispatcher.tune.resizeNotes(false); break;\r\n                    case 'ArrowRight': dispatcher.tune.resizeNotes(true); break;\r\n                }\r\n            } else if (keySwitch.move) {\r\n                switch (e.key) {\r\n                    case 'ArrowLeft': dispatcher.tune.moveNotes(false); break;\r\n                    case 'ArrowRight': dispatcher.tune.moveNotes(true); break;\r\n                }\r\n            } else if (keySwitch.shift) {\r\n                switch (e.key) {\r\n                    case 'ArrowLeft': dispatcher.tune.moveDistFocus(false); break;\r\n                    case 'ArrowRight': dispatcher.tune.moveDistFocus(true); break;\r\n                }\r\n            }\r\n        } else {\r\n            switch (e.key) {\r\n                case 'ArrowUp': dispatcher.tune.incrementCurNoteKey(true, 'normal'); break;\r\n                case 'ArrowDown': dispatcher.tune.incrementCurNoteKey(false, 'normal'); break;\r\n                case 'ArrowLeft': {\r\n                    if (isSingle) {\r\n                        dispatcher.tune.moveFocus(false);\r\n                    } else {\r\n                        dispatcher.tune.releaseRange(false);\r\n                    }\r\n                }\r\n                    break;\r\n                case 'ArrowRight': {\r\n                    if (isSingle) {\r\n                        dispatcher.tune.moveFocus(true);\r\n                    } else {\r\n                        dispatcher.tune.releaseRange(true);\r\n                    }\r\n                }\r\n                    break;\r\n                case 'a': dispatcher.tune.addNotes(); break;\r\n                case 'q': {\r\n                    alert(JSON.stringify(store.scoreData.notesList[state.focusIndex].len));\r\n                }\r\n                    break;\r\n                case 'w': dispatcher.tune.adjustScrollX(); break;\r\n                case 'e': dispatcher.tune.adjustScrollY(); break;\r\n                case 'z': {\r\n                    previewCurHarmony(store, dispatcher);\r\n                }\r\n                    break;\r\n                case 'p': {\r\n                    state.isSolo = !state.isSolo;\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n                case 'Home': {\r\n                    dispatcher.tune.firstNotes();\r\n                }\r\n                    break;\r\n                case '1': {\r\n                    state.quantize = 4;\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n                case '2': {\r\n                    state.quantize = 2;\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n                case '3': {\r\n                    state.quantize = 1;\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n                case '/': {\r\n                    if ([3, 6].includes(state.quantize)) {\r\n                        state.quantize /= 3;\r\n                    } else {\r\n                        state.quantize *= 3;\r\n                    }\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n                case 'Delete': {\r\n                    dispatcher.tune.removeNotes();\r\n                }\r\n                    break;\r\n                case ' ': {\r\n                    dispatcher.tune.previewStart();\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    static keySwitchEvent = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher, isPress: boolean) => {\r\n\r\n        const config = store.userEnv.keyConfig.note;\r\n        const keySwitch = store.melodyState.keySwitch;\r\n        const state = store.melodyState;\r\n        // alert(e.key);\r\n        // alnfig.nextElement);\r\n\r\n        if (!state.isPreview) {\r\n\r\n            if (e.key === 'Control') {\r\n                keySwitch.control = isPress;\r\n                dispatcher.tune.setKeySwitch(keySwitch);\r\n            }\r\n            if (!keySwitch.control) {\r\n\r\n                const isSingle = state.focusIndex === state.distIndex;\r\n                switch (e.key) {\r\n                    case 'x': {\r\n                        keySwitch.octave = isPress;\r\n                        dispatcher.tune.setKeySwitch(keySwitch);\r\n                    }\r\n                        break;\r\n                    case 'c': {\r\n                        if (isSingle) {\r\n                            keySwitch.scaleMode = isPress;\r\n                            dispatcher.tune.setKeySwitch(keySwitch);\r\n                        }\r\n                    }\r\n                        break;\r\n                    case 'f': {\r\n                        if (isSingle) {\r\n                            keySwitch.resize = isPress;\r\n                            dispatcher.tune.setKeySwitch(keySwitch);\r\n                        }\r\n                    }\r\n                        break;\r\n                    case 'd': {\r\n                        keySwitch.move = isPress;\r\n                        dispatcher.tune.setKeySwitch(keySwitch);\r\n                    }\r\n                        break;\r\n                    case 'Shift': {\r\n                        keySwitch.shift = isPress;\r\n                        dispatcher.tune.setKeySwitch(keySwitch);\r\n                    }\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isPress) {\r\n            MelodyInput.keyDownEvent(e, store, dispatcher);\r\n        }\r\n    }\r\n}\r\n\r\nexport default MelodyInput;","import { posix } from \"path\";\r\nimport { KeyboardEvent, useContext, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport styled, { css, keyframes } from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../../base/components/button/executableButton\";\r\nimport { ChordElement, DetailChord, DetailInit } from \"../../../../redux/store/scoreData\";\r\nimport { getChordRoot, getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST, SCALE_INDEX } from \"../../../../utils/theoryUtils\";\r\nimport { TUNE_HEADER_WIDTH, TUNE_PITCH_HEIGHT, TUNE_PITCH_WIDTH, TUNE_TIMELINE_WIDTH } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport MelodyTimeline from \"./melodyTimeline\";\r\nimport MelodyPitchList from \"./melodyPitchList\";\r\nimport MelodyHeader from \"./melodyHeader\";\r\nimport { getKeyIndexFromPitcher, getMinimumLenUnit, getNormalizeLenFromNotes, PITCH_MAX, playSoundfont } from \"../../../../utils/melodyUtil\";\r\nimport MelodyMouseOperation from \"./util/melodyMouseOperation\";\r\nimport { Side } from \"../../../../redux/store/melodyState\";\r\nimport MelodyInput from \"../harmonize/input/melodyInput\";\r\nimport { _CSS_DISABLE } from \"../../../../base/design/styles\";\r\n\r\n\r\nconst MelodyFrame = (props: {\r\n    isActive: boolean;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    const wrapRef = useRef<null | HTMLDivElement>(null);\r\n    const tableRef = useRef<null | HTMLDivElement>(null);\r\n    const pitchRef = useRef<null | HTMLDivElement>(null);\r\n\r\n    const [invalidate, setInvalidate] = useState<{}>({});\r\n    const update = () => setInvalidate({});\r\n\r\n    const mouse = state.mouseState;\r\n    const isPut = mouse.isPut;\r\n    const notesState = mouse.notesState;\r\n    const curChord = mouse.curChord;\r\n    const mouseMeasurePos = mouse.mouseMeasurePos;\r\n    const mousePitchIndex = mouse.mousePitchIndex;\r\n    const width = mouse.width;\r\n    const lock = mouse.lock;\r\n\r\n    const barCount = 20;\r\n\r\n    const timelineLength = barCount * state.beatWidth * 4;\r\n    const notesList = store.scoreData.notesList;\r\n\r\n    // const rate = 4 / state.quantize;\r\n\r\n    const isTune = store.scoreState.isTune;\r\n\r\n    const tableWidth = tableRef.current == null ? 0 : tableRef.current.scrollLeft + tableRef.current.clientWidth;\r\n\r\n    useEffect(() => {\r\n        dispatcher.system.setRefs({\r\n            ...store.refs, melody: {\r\n                ...store.refs.melody,\r\n                table: tableRef.current,\r\n                pitch: pitchRef.current\r\n            }\r\n        });\r\n\r\n        dispatcher.system.setInvalidate({\r\n            ...store.invalidate, melody: () => setInvalidate({})\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (isTune && wrapRef.current != null) {\r\n            wrapRef.current.focus();\r\n        }\r\n    }, [isTune]);\r\n\r\n    const measureJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        for (let i = 0; i <= barCount * 4 * 4; i++) {\r\n            jsxList.push(\r\n                <_Scale key={i} isHead={i % 4 === 0} beatWidth={state.beatWidth} />\r\n            );\r\n        }\r\n        return jsxList;\r\n    }, [barCount]);\r\n\r\n    const init = store.scoreData.chordList[0].detail as DetailInit;\r\n    const scaleLineJsxList = useMemo(() => {\r\n        const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n        const list: JSX.Element[] = [];\r\n        for (let i = 0; i < PITCH_MAX; i++) {\r\n            const keyIndex = getKeyIndexFromPitcher(i);\r\n            list.push(\r\n                <_ScaleLine key={i}\r\n                    isScale={scaleIndexies.includes(keyIndex)}\r\n                    isBase={keyIndex === scaleIndexies[0]}\r\n                />\r\n            );\r\n        }\r\n        return list;\r\n    }, [init.keyIndex]);\r\n\r\n    const notesJsxList = useMemo(() => {\r\n        const list: JSX.Element[] = [];\r\n        // notesList.forEach((notes, i) => {\r\n        let count = 0;\r\n        for (let i = 0; i < notesList.length; i++) {\r\n            const notes = notesList[i];\r\n            if (tableRef.current != null) {\r\n                const scroll = tableRef.current.scrollLeft;\r\n                const notesLeft = getNormalizeLenFromNotes(notes.pos) * state.beatWidth;\r\n                const notesRight = notesLeft + getNormalizeLenFromNotes(notes.len) * state.beatWidth;\r\n                if (notesRight - scroll < 0 ||\r\n                    notesLeft - scroll > tableRef.current.clientWidth) {\r\n                    continue;\r\n                }\r\n            }\r\n            count++;\r\n            const [focusStart, focusEnd] = state.focusIndex < state.distIndex ? [state.focusIndex, state.distIndex] : [state.distIndex, state.focusIndex];\r\n            const isActive = focusStart <= i && focusEnd >= i;\r\n            const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n            const keyIndex = getKeyIndexFromPitcher(notes.pitchIndex);\r\n            const isScale = scaleIndexies.includes(keyIndex);\r\n\r\n            // \r\n            const unitPos = getMinimumLenUnit(notes.pos);\r\n            const unitLen = getMinimumLenUnit(notes.len);\r\n            list.push(\r\n                <_NotesWrap key={i}\r\n                    left={getNormalizeLenFromNotes(notes.pos) * state.beatWidth}\r\n                    width={getNormalizeLenFromNotes(notes.len) * state.beatWidth}\r\n                    side={notesState.side}\r\n                    isActive={isActive}\r\n                    isScale={state.keySwitch.scaleMode}\r\n                    isResize={state.keySwitch.resize}\r\n                    isMove={state.keySwitch.move}\r\n                    isOctave={state.keySwitch.octave}\r\n                    isPreview={state.isPreview}\r\n                    onContextMenu={() => {\r\n                        dispatcher.tune.removeNotes();\r\n                    }}\r\n                >\r\n                    <_Notes\r\n                        y={notes.pitchIndex * TUNE_PITCH_HEIGHT}\r\n                        lenType={unitPos > unitLen ? unitPos : unitLen}\r\n                        isScale={isScale}\r\n                    >\r\n                        {/* {notes.posX} */}\r\n                    </_Notes>\r\n                </_NotesWrap>\r\n            );\r\n        }\r\n        console.log('cnt: ' + count);\r\n        // });\r\n        return list;\r\n    }, [notesList, notesList.length, state.focusIndex, state.distIndex, notesState, state.isPreview,\r\n        state.keySwitch.scaleMode, state.keySwitch.octave, state.keySwitch.resize, state.keySwitch.move,\r\n        invalidate]);\r\n\r\n    return (\r\n        <_Wrap\r\n            tabIndex={999}\r\n            ref={wrapRef}\r\n            isActive={props.isActive}\r\n            onKeyDown={(e: KeyboardEvent) => MelodyInput.keySwitchEvent(e, store, dispatcher, true)}\r\n            onKeyUp={(e: KeyboardEvent) => MelodyInput.keySwitchEvent(e, store, dispatcher, false)}\r\n        >\r\n            <_Header isEnable={!state.isPreview}>\r\n                <MelodyHeader />\r\n            </_Header>\r\n            <_Body>\r\n                <_Timeline>\r\n                    <MelodyTimeline\r\n                        barLength={barCount}\r\n                        beatWidth={state.beatWidth}\r\n                        curChord={curChord}\r\n                        timelineLength={timelineLength}\r\n                        mouseMeasurePos={mouseMeasurePos}\r\n                    />\r\n                </_Timeline>\r\n                <_Pitch ref={pitchRef}>\r\n                    <MelodyPitchList mousePitchIndex={mousePitchIndex} curChord={curChord} />\r\n                </_Pitch>\r\n                <_TableWrap ref={tableRef}\r\n                    onScroll={() => {\r\n                        const refs = store.refs.melody;\r\n\r\n                        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n                            const scrollLeft = refs.table.scrollLeft;\r\n                            const scrollTop = refs.table.scrollTop;\r\n                            refs.measure.scrollTo({ left: scrollLeft });\r\n                            refs.chord.scrollTo({ left: scrollLeft });\r\n                            refs.pitch.scrollTo({ top: scrollTop });\r\n                        }\r\n                        update();\r\n                    }}\r\n                >\r\n                    <_TableMeasure\r\n                        width={timelineLength}\r\n                    >\r\n                        {measureJsxList}\r\n                    </_TableMeasure>\r\n                    <_TablePitch\r\n                        width={timelineLength}\r\n                    >\r\n                        {scaleLineJsxList}\r\n                    </_TablePitch>\r\n                    <_TableNotes\r\n                        width={timelineLength}\r\n                        onMouseDown={e => MelodyMouseOperation.mouseDownEvent(e, store, dispatcher, timelineLength, update)}\r\n                        onMouseMove={e => MelodyMouseOperation.mouseMoveEvent(e, store, dispatcher, timelineLength, update)}\r\n                        onMouseUp={e => MelodyMouseOperation.mouseUpEvent(e, store, dispatcher, timelineLength, update)}\r\n                    >\r\n                        {!isPut ? <></> : <_Test x={lock.x} y={lock.y} width={width}\r\n                            lenType={width % state.beatWidth === 0 ? 4 : (width % (state.beatWidth / 2) === 0 ? 8 : 16)}\r\n                        />}\r\n                        {notesJsxList}\r\n                    </_TableNotes>\r\n                    <_PrevireBrind\r\n                        isUse={state.isPreview}\r\n                        width={timelineLength}\r\n                    />\r\n                </_TableWrap>\r\n            </_Body>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default MelodyFrame;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: ${props => !props.isActive ? 'none' : 'inline-block'};\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst editAnimation = keyframes`\r\n  0%,100% {\r\n    opacity: 0.2;\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n  }\r\n`;\r\n\r\nconst _Test = styled.div<{\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    lenType: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: ${props => props.x}px;\r\n    top: ${props => props.y}px;\r\n    width: ${props => props.width}px;\r\n    height: ${props => {\r\n        switch (props.lenType) {\r\n            case 4: return TUNE_PITCH_HEIGHT;\r\n            case 8: return TUNE_PITCH_HEIGHT - 6;\r\n            case 16: return TUNE_PITCH_HEIGHT - 12;\r\n            default: return TUNE_PITCH_HEIGHT - 14;\r\n        }\r\n    }}px;\r\n    background: linear-gradient(to bottom, #dff85230, #fffb00, #dff85230);\r\n    border: 1px solid #fbffd9;\r\n    \r\n    animation: ${editAnimation} .8s linear infinite;\r\n`;\r\n\r\nconst _Header = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${TUNE_HEADER_WIDTH}px;\r\n    background-color: #b3b3b3;\r\n    ${props => props.isEnable ? '' : _CSS_DISABLE}\r\n`;\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - ${TUNE_HEADER_WIDTH}px);\r\n    background-color: #464646;\r\n`;\r\n\r\nconst _Timeline = styled.div`\r\n    display: inline-block;\r\n    margin-left: ${TUNE_PITCH_WIDTH}px;\r\n    width: calc(100% - ${TUNE_PITCH_WIDTH}px - 10px);\r\n    height: ${TUNE_TIMELINE_WIDTH}px;\r\n    background-color: #534b81;\r\n    overflow-y: hidden;\r\n`;\r\n\r\nconst _Pitch = styled.div`\r\n    display: inline-block;\r\n    width: ${TUNE_PITCH_WIDTH}px;\r\n    height: calc(100% - ${TUNE_TIMELINE_WIDTH}px - 10px);\r\n    background-color: #534b81;\r\n    vertical-align: top;\r\n    overflow-y: hidden;\r\n`;\r\n\r\nconst _TableWrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - ${TUNE_PITCH_WIDTH}px);\r\n    height: calc(100% - ${TUNE_TIMELINE_WIDTH}px);\r\n    background-color: #bdbdbd;\r\n    vertical-align: top;\r\n    overflow: scroll;\r\n    &::-webkit-scrollbar {\r\n        width: 10px;\r\n        height: 10px;\r\n    }\r\n    &::-webkit-scrollbar-thumb {\r\n        border-radius: 5px;\r\n        background: #1959A8;\r\n    }\r\n    &::-webkit-scrollbar-track {\r\n        border-radius: 5px;\r\n        box-shadow: 0 0 4px #aaa inset;\r\n    }\r\n`;\r\n\r\nconst _TableMeasure = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 3;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    white-space: nowrap;\r\n`;\r\n\r\nconst _TablePitch = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    /* z-index: 6; */\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    /* pointer-events: none; */\r\n`;\r\n\r\n// \r\nconst _ScaleLine = styled.div<{\r\n    isScale: boolean;\r\n    isBase: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${TUNE_PITCH_HEIGHT - 1}px;\r\n    margin: 1px 0 0 0;\r\n    background-color: #00000024;\r\n    /* border-bottom: 1px solid #00000018; */\r\n    ${props => !props.isScale ? '' : css`\r\n        background-color: #d1d1d11f;\r\n    `}\r\n    ${props => !props.isBase ? '' : css`\r\n        background-color: #e0e0e0;\r\n    `}\r\n`;\r\n\r\nconst _TableNotes = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 5;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    cursor: crosshair;\r\n`;\r\n\r\n\r\nconst _Scale = styled.div<{\r\n    isHead: boolean;\r\n    beatWidth: number;\r\n}>`\r\n    display: inline-block;\r\n    /* background-color: #ffffffbe; */\r\n    width: ${props => props.beatWidth / 4}px;\r\n    vertical-align: top;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    box-sizing: border-box;\r\n    border-left: solid ${props => props.isHead ? '2px' : '1px'} #757575;\r\n`;\r\n\r\n\r\nconst _NotesWrap = styled.div<{\r\n    left: number;\r\n    width: number;\r\n    isActive: boolean;\r\n    isResize: boolean;\r\n    isMove: boolean;\r\n    isOctave: boolean;\r\n    isScale: boolean;\r\n    isPreview: boolean;\r\n    side: Side;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 9;\r\n    left: ${props => props.left}px;\r\n    top: 0;\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    cursor: default;\r\n    background-color: #2727275a;\r\n    box-sizing: border-box;\r\n\r\n    // \r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #00a6cf52;\r\n    `}\r\n    // ON\r\n    ${props => !(props.isActive && props.isScale) ? '' : css`\r\n        background-color: #00cf4552;\r\n    `}\r\n    // ON\r\n    ${props => !(props.isActive && props.isOctave) ? '' : css`\r\n        background-color: #ffa9a952;\r\n    `}\r\n    /* border-left: 1px solid #ff0000b2; */\r\n    ${props => props.isActive ? props.side === 'left' ? css`\r\n        border-left: 3px solid #0026ffb1;\r\n        cursor : col-resize;\r\n        background-color: #1900ff52;\r\n    ` : props.side === 'right' ? css`\r\n        border-right: 3px solid #0026ffb1;\r\n        cursor : col-resize;\r\n        background-color: #ff00006e;\r\n    ` : '' : ''}\r\n\r\n    // ON\r\n    ${props => !(props.isActive && props.isResize) ? '' : css`\r\n        border-right: 3px solid #0026ffb1;\r\n        background-color: #ff00006e;\r\n    `};\r\n    // ON\r\n    ${props => !(props.isActive && props.isMove) ? '' : css`\r\n        border-left: 3px solid #0026ffb1;\r\n        background-color: #1900ff52;\r\n    `};\r\n    // \r\n    ${props => !(props.isActive && props.isPreview) ? '' : css`\r\n        background-color: #fffb006d;\r\n    `}\r\n`;\r\nconst _Notes = styled.div<{\r\n    y: number;\r\n    lenType: number;\r\n    isScale: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    top: ${props => props.y}px;\r\n    width: 100%;\r\n    height: ${props => TUNE_PITCH_HEIGHT - (props.lenType === 1 ? 0 : props.lenType === 2 ? 6 : props.lenType === 4 ? 12 : 14)}px;\r\n    /* background-color: red; */\r\n    /* background: linear-gradient(to bottom, ${props => {\r\n        switch (props.lenType) {\r\n            case 4: return '#f8525232, #ff0000, #f8525232';\r\n            case 8: return '#5d52f831, #0400ff, #5d52f831';\r\n            case 16: return '#52f85a31, #00ff15, #52f85a31';\r\n        }\r\n    }}); */\r\n    background: linear-gradient(to bottom, #f8525232, #ff0000, #f8525232);\r\n    ${props => props.isScale ? '' : css`    \r\n       background: linear-gradient(to bottom, #f8b65231, #ffae00, #f8b65231);\r\n    `}\r\n    /* border: 1px solid #000; */\r\n    box-sizing: border-box;\r\n    font-size: 12px;\r\n    color: #000000;\r\n    box-shadow: 0 0 22px 0 #0000007d;\r\n    &:hover {\r\n        opacity: 0.8;\r\n    }\r\n`;\r\n\r\nconst _PrevireBrind = styled.div<{\r\n    width: number;\r\n    isUse: boolean;\r\n}>`\r\n    position: absolute;\r\n    display: ${props => props.isUse ? 'block' : 'none'};\r\n    z-index: 80;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    background-color: #7a270028;\r\n`;\r\n\r\n// const _Scroll = styled.div<{\r\n//     left: number;\r\n// }>`\r\n//     position: absolute;\r\n//     left: ${props => props.left}px;\r\n//     top: 0px;\r\n//     z-index: 20;\r\n//     width: 4px;\r\n//     height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n//     background-color: #00f;\r\n// `;","import { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\nimport HarmonizeTab from \"./harmonize/harmonizeFrame\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { HARMONIZE_SECTIONS_WIDTH } from \"../../../utils/systemConst\";\r\nimport HarmSections from \"./harmonize/harmSections\";\r\nimport MelodyFrame from \"./melody/melodyFrame\";\r\nimport { _CSS_DISABLE, _CSS_LABEL_MIDIUM } from \"../../../base/design/styles\";\r\nimport { stopPreview } from \"../../../utils/melodyUtil\";\r\nimport HarmonizeUtil from \"../../../utils/harmonizeUtil\";\r\n\r\nconst EditTab = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const melody = store.melodyState;\r\n\r\n    useEffect(() => {\r\n        const info = melody.soundfontInfo;\r\n        Soundfont.instrument(new AudioContext(), info.name,\r\n            { gain: info.gain, release: 0.5 }).then((soundFontPlayer) => {\r\n                dispatcher.tune.setInstrument(soundFontPlayer);\r\n            });\r\n\r\n        // acoustic_guitar_steel\r\n        //bright_acoustic_piano\r\n        Soundfont.instrument(new AudioContext(), 'electric_grand_piano',\r\n            { gain: 3, release: 0.5 }).then((soundFontPlayer) => {\r\n                dispatcher.score.setPiano(soundFontPlayer);\r\n            });\r\n    }, []);\r\n\r\n    const switchMode = () => {\r\n        state.isTune = !state.isTune;\r\n        dispatcher.score.setScoreState(state);\r\n    };\r\n\r\n    if (store.scoreData.chordList.length === 0) {\r\n        return <></>;\r\n    }\r\n\r\n    const isPreview = !state.isTune ? state.isPreview : store.melodyState.isPreview;\r\n    const isSolo = !state.isTune ? state.isSolo : melody.isSolo;\r\n    const preview = !state.isTune ? () => {\r\n\r\n        if (!state.isPreview) {\r\n            HarmonizeUtil.previewStart(store, dispatcher);\r\n        } else {\r\n            HarmonizeUtil.stopPreview(store, dispatcher, store.reserveTasks);\r\n        }\r\n    } : () => {\r\n\r\n        if (!melody.isPreview) {\r\n            dispatcher.tune.previewStart();\r\n        } else {\r\n            stopPreview(store, dispatcher, store.reserveTasks);\r\n        }\r\n    }\r\n    const toggleEnsamble = !state.isTune ? () => {\r\n        state.isSolo = !state.isSolo;\r\n        dispatcher.score.setScoreState(state);\r\n    } : () => {\r\n        melody.isSolo = !melody.isSolo;\r\n        dispatcher.tune.setState(melody);\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Header>\r\n                <_Mode isEnable={!isPreview}>\r\n                    <_ModeItem isActive={!state.isTune} onClick={() => {\r\n                        if (state.isTune) switchMode();\r\n                    }}>Harmony</_ModeItem>\r\n                    <_ModeItem isActive={state.isTune} onClick={() => {\r\n                        if (!state.isTune) switchMode();\r\n                    }}>Melody</_ModeItem>\r\n                </_Mode>\r\n                <_Buttons>\r\n                    <_Switch onClick={preview}><_SwitchInner isActive={isPreview}>Play</_SwitchInner> / <_SwitchInner isActive={!isPreview}>Pause</_SwitchInner></_Switch>\r\n                    <_Switch onClick={toggleEnsamble}><_SwitchInner isActive={!isSolo}>Emsamble</_SwitchInner> / <_SwitchInner isActive={isSolo}>Solo</_SwitchInner></_Switch>\r\n                </_Buttons>\r\n            </_Header>\r\n            <_Body\r\n                tabIndex={999}\r\n                onKeyDown={(e) => {\r\n                    if (!isPreview) {\r\n                        switch (e.key) {\r\n                            case 'r': switchMode(); break;\r\n                        }\r\n                    }\r\n                }}>\r\n                <_SECTIONS><HarmSections /></_SECTIONS>\r\n                <_Main>\r\n                    <HarmonizeTab isActive={!state.isTune} />\r\n                    <MelodyFrame isActive={state.isTune} />\r\n                </_Main>\r\n            </_Body>\r\n        </_Wrap>\r\n    );\r\n}\r\nexport default EditTab;\r\n\r\nconst _Wrap = styled.div`\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 35px;\r\n    background-color: #ececec;\r\n`;\r\n\r\nconst _Mode = styled.div<{\r\n    isEnable: boolean\r\n}>`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    text-align: center;\r\n    margin-right: 20px;\r\n    ${props => props.isEnable ? '' : _CSS_DISABLE}\r\n`;\r\nconst _ModeItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    width: 120px;\r\n    height: calc(100% - 8px);\r\n    /* background-color: #e0ff6f55; */\r\n    ${props => !props.isActive ? '' : css`background-color: #f3b200c0;`}\r\n    margin: 4px 0 0 4px;\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #505050;\r\n    border-radius: 5px;\r\n    border: 1px solid #969696;\r\n    box-sizing: border-box;\r\n    &:hover {\r\n        background-color: #e0ff6f55;\r\n        ${props => !props.isActive ? '' : css`background-color: #f3b200c0;`}\r\n    }\r\n`;\r\nconst _Buttons = styled.div`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    /* background-color: #e0ff6f55; */\r\n\r\n    & * {\r\n        margin: 3px 0 0 5px;\r\n    }\r\n`;\r\n\r\nconst _Switch = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    width: 220px;\r\n    height: calc(100% - 8px);\r\n    background-color: #ecfd5273;\r\n    margin: 4px 0 0 4px;\r\n    text-align: center;\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #000000cf;\r\n    border-radius: 5px;\r\n    border: 1px solid #969696;\r\n    box-sizing: border-box;\r\n    &:hover {\r\n        background-color: #f6ffa373;\r\n    }\r\n`;\r\n\r\nconst _SwitchInner = styled.span<{\r\n    isActive: boolean;\r\n}>`\r\n    color: #00109e6e;\r\n    ${props => !props.isActive ? '' : css`color: #db0000;`}\r\n`;\r\n\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - 35px);\r\n    background-color: #c50000;\r\n    outline: none;\r\n`;\r\n\r\nconst _SECTIONS = styled.div`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_SECTIONS_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #d8d8d8;\r\n    border-right: 1px solid #3e3f57;\r\n    box-sizing: border-box;\r\n    vertical-align: top;\r\n`;\r\nconst _Main = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_SECTIONS_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #dddddd;\r\n    vertical-align: top;\r\n`;\r\n\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\nimport ManageTab from \"./manage/manageTab\";\r\nimport EditTab from \"./edit/editTab\";\r\n\r\nconst ScoreChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const isAccept = store.scoreState.focusIndex !== -1;\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <TabbedPane\r\n                tabElements={[\r\n                    { name: 'Manage', disable: false, cont: <ManageTab /> },\r\n                    { name: 'Edit', disable: !isAccept, cont: <EditTab /> },\r\n                    { name: 'Thema', disable: !isAccept, cont: <div></div> },\r\n                    { name: 'Preview', disable: !isAccept, cont: <div></div> },\r\n                ]}\r\n                activeNo={store.systemState.scoreTabIndex}\r\n                selectTabIndex={(index: number) => dispatcher.score.setScoreTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ScoreChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${SCORE_TAB_MARGIN}px 0 0 ${SCORE_TAB_MARGIN}px;\r\n    width: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    height: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst SettingChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <TabbedPane\r\n                tabElements={[\r\n                    { name: 'Sound', disable: true, cont: <div></div> },\r\n                    { name: 'Design', disable: true, cont: <div></div> }\r\n                ]}\r\n                activeNo={store.systemState.scoreTabIndex}\r\n                selectTabIndex={(index: number) => dispatcher.score.setScoreTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SettingChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${SCORE_TAB_MARGIN}px 0 0 ${SCORE_TAB_MARGIN}px;\r\n    width: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    height: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DEGREE12_FLAT_LIST, DEGREE12_SHARP_LIST, DegreeProps, getSymbolFromKey, IntervalRelationProps, KEY12_FLAT_LIST, KEY12_SHARP_LIST, SymbolKey } from \"../../utils/theoryUtils\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst PerformChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const sampler = store.instruments.sampler;\r\n    const createLane = (label: string, items: {\r\n        degree: DegreeProps;\r\n        symbolKey: SymbolKey;\r\n    }[]): JSX.Element => {\r\n        const jsxList: JSX.Element[] = [];\r\n\r\n\r\n        // \r\n        jsxList.push(<_Header key={jsxList.length}><div>{label}</div></_Header>);\r\n        items.forEach((item) => {\r\n            const degree = item.degree;\r\n            const degreeRootName = (degree.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST)[degree.index];\r\n            const chordRootName = (degree.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST)[degree.index];\r\n            const symbol = getSymbolFromKey(item.symbolKey);\r\n            const symbolName = symbol.name;\r\n            jsxList.push(<_Item key={jsxList.length}\r\n                onMouseDown={(e) => {\r\n                    if (e.button !== 0) return;\r\n                    sampler.releaseAll();\r\n\r\n                    const symbol = getSymbolFromKey(item.symbolKey);\r\n\r\n                    const voicingList = symbol.structs.map((struct) => {\r\n                        const interval = IntervalRelationProps[struct];\r\n                        return 12 * 3 + item.degree.index + interval;\r\n                    });\r\n\r\n                    voicingList.forEach((index) => {\r\n                        const soundName = KEY12_SHARP_LIST[index % 12];\r\n                        const octave = Math.floor(index / 12);\r\n                        const soundFullName = soundName + octave;\r\n                        sampler.triggerAttack(soundFullName, '+0', 0.5);\r\n                    });\r\n                }}\r\n            >\r\n                <div>{degreeRootName}{symbolName}</div>\r\n                <div>{chordRootName}{symbolName}</div>\r\n            </_Item>);\r\n        });\r\n        return (<_Lane>{jsxList}</_Lane>);\r\n    }\r\n\r\n    return (\r\n        <_Wrap\r\n            onMouseDown={(e) => {\r\n                if (e.button !== 2) return;\r\n                sampler.releaseAll();\r\n            }}>\r\n            {createLane('Diatonic Triad', [\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 5, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'minor-minus5' },\r\n            ])}\r\n            {createLane('Diatonic Tetrad', [\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major-maj7th' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 5, isFlat: false }, symbolKey: 'major-maj7th' },\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'minor7-minus5' },\r\n            ])}\r\n            {createLane('Parallel Triad', [\r\n                { degree: { index: 0, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 2, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 3, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 5, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 7, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 8, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 10, isFlat: true }, symbolKey: 'major' },\r\n            ])}\r\n            {createLane('Secondary Dominant', [\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 10, isFlat: false }, symbolKey: 'major-min7th' },\r\n            ])}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default PerformChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - 8px);\r\n    height: calc(100% - 8px);\r\n    margin: 4px 0 0 4px;\r\n    background-color: #c3d8dd6f;\r\n    border: solid 1px #888;\r\n    border-radius: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Lane = styled.div`\r\n    display: inline-block;\r\n    width: 160px;\r\n    background-color: #bbbbbb;\r\n    padding-bottom: 5px;\r\n`;\r\n\r\nconst _Box = styled.div`\r\n    display: inline-block;\r\n    width: 150px;\r\n    height: 80px;\r\n    margin: 5px 0 0 5px;\r\n    box-sizing: border-box;\r\n    border-radius: 4px;\r\n`;\r\n\r\nconst _Header = styled(_Box)`\r\n    background-color: #51608f;\r\n    /* border: 1px solid #dfdfdf; */\r\n    font-weight: 600;\r\n    & div:nth-child(1) {\r\n        width: 100%;\r\n        text-align: center;\r\n        height: 100%;\r\n        font-size: 26px;\r\n        color: #ebebeb;\r\n    }\r\n`;\r\n\r\nconst _Item = styled(_Box)`\r\n    background-color: #e0ebe5;\r\n    border: 1px solid #777;\r\n    & *{\r\n        width: 100%;\r\n        text-align: center;\r\n        height: 50%;\r\n    }\r\n    & div:nth-child(1) {\r\n        font-size: 26px;\r\n        color: #d40000;\r\n    }\r\n    & div:nth-child(2) {\r\n        font-size: 24px;\r\n        color: #000000;\r\n    }\r\n    &:hover {\r\n        background-color: #fcf29f;\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../base/components/button/executableButton\";\r\nimport { ChannelPane } from \"../../base/components/tab/channelPane\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { MAIN_FRAME_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"./systemEntry\";\r\nimport { AiFillHome } from 'react-icons/ai'\r\nimport { CgOptions, CgPiano } from 'react-icons/cg'\r\nimport { GiMusicalScore } from 'react-icons/gi'\r\nimport ScoreChannel from \"../score/scoreChannel\";\r\nimport SettingChannel from \"../setting/settingChannel\";\r\nimport PerformChannel from \"../perform/performChannel\";\r\n\r\nconst MainFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <ChannelPane\r\n                tabElements={[\r\n                    { name: 'Home', icon: <AiFillHome />, disable: true, cont: <div></div> },\r\n                    { name: 'Perform', icon: <CgPiano />, disable: true, cont: <PerformChannel/> },\r\n                    { name: 'Score', icon: <GiMusicalScore />, disable: true, cont: <ScoreChannel /> },\r\n                    { name: 'Option', icon: <CgOptions />, disable: true, cont: <SettingChannel /> }\r\n                ]}\r\n                activeNo={store.systemState.mainChannelIndex}\r\n                selectTabIndex={(index: number) => dispatcher.system.setMainTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default MainFrame;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${MAIN_FRAME_MARGIN}px 0 0 ${MAIN_FRAME_MARGIN}px;\r\n    width: calc(100% - ${MAIN_FRAME_MARGIN * 2}px);\r\n    height: calc(100% - ${MAIN_FRAME_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","\r\nimport { useContext, useEffect, useState } from 'react';\r\nimport styled, { css, keyframes } from 'styled-components';\r\nimport { GlobalContext } from './systemEntry';\r\n\r\nconst Splash = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [isSwitch, setSwitch] = useState<boolean>(false);\r\n    const [timerId, setTimerId] = useState<NodeJS.Timeout>();\r\n\r\n    useEffect(() => {\r\n        setTimerId(setTimeout(() => {\r\n            setSwitch(true);\r\n        }, 3000));\r\n    }, []);\r\n    useEffect(() => {\r\n        if (isSwitch) {\r\n            setTimeout(() => {\r\n                dispatcher.system.switchSplashToMain();\r\n            }, 500);\r\n        }\r\n    }, [isSwitch]);\r\n\r\n    return (\r\n        <_Wrap isSwitch={isSwitch} onClick={(e) => {\r\n            clearTimeout(timerId as NodeJS.Timeout);\r\n            setSwitch(true);\r\n        }}>\r\n            <_Title>\r\n                <span>L</span>iCreSia\r\n            </_Title>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default Splash;\r\n\r\nconst _Wrap = styled.div<{\r\n    isSwitch: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    z-index: 10;\r\n    /* width: 500px;\r\n    height: 500px; */\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: #d8d8d8; */\r\n    background: radial-gradient(#868686, #ffffff);\r\n    opacity: ${props => props.isSwitch ? '0' : '1'};\r\n    transition: opacity 500ms;\r\n`;\r\n\r\n\r\nconst fadeIn = keyframes`\r\n  0%, 100% {\r\n    opacity: 0.4;\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n  }\r\n`;\r\n\r\nconst _Title = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin-top: 15%;\r\n    width: 100%;\r\n    height: 400px;\r\n    background-color: #ffffff1f;\r\n    /* background: linear-gradient(to bottom, #99999913, #ffffff13,#ffffff13,#ffffff13, #99999913); */\r\n    color: white;\r\n    font-size: 130px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    text-shadow: 1px 2px 22px #0000003d;\r\n    line-height: 350px;\r\n    animation: ${fadeIn} 3s linear infinite;\r\n    & span {\r\n        color: red;\r\n        font-size: 160px;\r\n    }\r\n`;","import styled from \"styled-components\";\r\nimport { TOTAL_HEADER_WIDTH } from \"../../utils/systemConst\";\r\nimport { ImUser } from 'react-icons/im'\r\nimport { MdOutlineLanguage } from 'react-icons/md'\r\n\r\nconst TotalHeader = () => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Label>\r\n                <_ACCENT>L</_ACCENT><_NORMAL>iCreSia</_NORMAL>\r\n            </_Label>\r\n            <_Menu>\r\n                <_LoginButton>\r\n                    <div><ImUser /></div>\r\n                    Login / Sign up\r\n                </_LoginButton>\r\n                <_Language>\r\n                    <div><MdOutlineLanguage /></div>\r\n                </_Language>\r\n            </_Menu>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default TotalHeader;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${TOTAL_HEADER_WIDTH}px;\r\n    background: linear-gradient(to bottom, #ececec, #e2e2e2, #eeeeee);\r\n    /* background-color: #c2c2c2; */\r\n    box-shadow: 0 0 8px 0 #000b3a48;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    margin: 2px 0 0 10px;\r\n    width: 200px;\r\n    height: calc(100% - 4px);\r\n    /* background-color: #00000013; */\r\n    font-size: 34px;\r\n    font-weight: 600;\r\n    line-height: 36px;\r\n    text-shadow: 1px 2px 3px #8080806a;\r\n`;\r\n\r\nconst _NORMAL = styled.span`\r\n    color: #ffffff;\r\n`;\r\nconst _ACCENT = styled.span`\r\n    font-size: 34px;\r\n    color: #da4242;\r\n`;\r\n\r\n\r\n\r\nconst _Menu = styled.div`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    position: absolute;\r\n    right: 30px;\r\n    /* background-color: #ff00002b; */\r\n`\r\n\r\nconst _MenuItem = styled.div`\r\n    background-color: #c9c7c7;\r\n    &:hover {\r\n        background-color: #cf9bae;\r\n    }\r\n    transition: background-color 800ms;\r\n`\r\n\r\nconst _LoginButton = styled(_MenuItem)`\r\n    display: inline-block;\r\n    width: 240px;\r\n    margin: 5px 10px 0 0;\r\n    height: calc(100% - 10px);\r\n    border-radius: 20px;\r\n    /* background: linear-gradient(to bottom, #e9baba, #d39d9d, #e9baba); */\r\n    /* background-color: #adadad; */\r\n    /* border: 1px solid #7e7e7e; */\r\n    /* box-shadow: 0 0 8px 0 #000b3a48; */\r\n    /* text-shadow: 1px 2px 3px #808080ba; */\r\n    text-align: center;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    line-height: 28px;\r\n    color: #ffffff;\r\n    vertical-align: top;\r\n\r\n    & div {\r\n        display: inline-block;\r\n        /* background-color: #0000007d; */\r\n        margin: 2px 5px 0 0;\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Language = styled(_MenuItem)`\r\n    display: inline-block;\r\n    width: ${TOTAL_HEADER_WIDTH - 6}px;\r\n    height: ${TOTAL_HEADER_WIDTH - 6}px;\r\n    margin: 3px 0 0 0;\r\n    border-radius: 50%;\r\n    /* background: linear-gradient(to bottom, #e9baba, #d39d9d, #e9baba); */\r\n    /* background-color: #48aa9d; */\r\n    /* border: 1px solid #7e7e7e; */\r\n    /* box-shadow: 0 0 8px 0 #000b3a48; */\r\n    /* text-shadow: 1px 2px 3px #808080ba; */\r\n    /* text-align: center; */\r\n    font-size: 28px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    & div {\r\n        display: inline-block;\r\n        margin: 2px 0 0 5px;\r\n        /* background-color: #0000007d; */\r\n        vertical-align: top;\r\n    }\r\n`;","import { createContext, useReducer } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { ExecutableButton } from '../../base/components/button/executableButton';\r\nimport { DraggableDialog } from '../../base/components/dialog/draggableDialog';\r\nimport { Dispatcher } from '../../redux/dispatcher/dispatcher';\r\nimport { reducer } from '../../redux/reducer';\r\nimport { initialStore, Store } from '../../redux/store/store';\r\nimport { MAIN_FRAME_MARGIN, TOTAL_HEADER_WIDTH } from '../../utils/systemConst';\r\nimport SysModalDialog from '../dialog/sysModalDialog';\r\nimport MainFrame from './mainFrame';\r\nimport Splash from './splash';\r\nimport TotalHeader from './totalHeader';\r\n\r\n\r\ntype GlobalContextType = {\r\n    store: Store;\r\n    dispatcher: Dispatcher;\r\n}\r\n\r\nexport const GlobalContext = createContext({} as GlobalContextType);\r\n\r\nconst SystemEntry = () => {\r\n\r\n    const [store, dispatch] = useReducer(reducer, initialStore);\r\n    const dispatcher = new Dispatcher(store, dispatch);\r\n    return (\r\n        <GlobalContext.Provider value={{ store, dispatcher }}>\r\n            <>\r\n                {!store.systemState.isSplash ? <></> : <Splash />}\r\n                <_Wrap>\r\n                    <SysModalDialog />\r\n                    <TotalHeader />\r\n                    <_MainDiv>\r\n                        <MainFrame />\r\n                    </_MainDiv>\r\n                </_Wrap>\r\n            </>\r\n        </GlobalContext.Provider>\r\n    );\r\n}\r\n\r\nexport default SystemEntry;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #d8d8d8;\r\n`;\r\n\r\nconst _MainDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - ${TOTAL_HEADER_WIDTH}px);\r\n    /* background-color: #c2c2c2; */\r\n`;","import React, { useEffect } from 'react';\nimport logo from './logo.svg';\nimport SystemEntry from './system/contents/entry/systemEntry';\n\nfunction App() {\n  \n  useEffect(() => {\n    // \n    document.oncontextmenu = function () { return false; }\n\n    window.addEventListener(\"keydown\", function (e) {\n      // space and arrow keys\n      if ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {\n        e.preventDefault();\n      }\n    }, false);\n\n  }, []);\n  return (\n    <SystemEntry />\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}