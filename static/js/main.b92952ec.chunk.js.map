{"version":3,"sources":["system/redux/reducer.tsx","system/utils/theoryUtils.tsx","system/utils/melodyUtil.tsx","system/utils/systemConst.tsx","system/redux/dispatcher/dispatcher.tsx","system/utils/instrumentsUtil.tsx","system/redux/store/store.tsx","system/redux/store/userEnv.tsx","system/base/design/thema/themaColorNormal.tsx","system/contents/dialog/sysModalDialog.tsx","system/base/components/tab/channelPane.tsx","system/base/components/tab/tabbedPane.tsx","system/contents/score/manage/manageTab.tsx","system/base/design/styles.tsx","system/base/components/button/executableButton.tsx","system/contents/score/edit/harmonize/input/symbolEditor.tsx","system/contents/score/edit/harmonize/elements/calc/calcChord.tsx","system/contents/score/edit/harmonize/elements/calc/calcSection.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailChange.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailChord.tsx","system/contents/score/edit/harmonize/elements/elementFixedBorder.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailInit.tsx","system/contents/score/edit/harmonize/elements/form/elementDetailSection.tsx","system/contents/score/edit/harmonize/elements/calc/calcChange.tsx","system/contents/score/edit/harmonize/elements/scoreElement.tsx","system/contents/score/edit/harmonize/harmNote.tsx","system/contents/score/edit/harmonize/input/noteBasicInput.tsx","system/contents/score/edit/harmonize/input/noteInput.tsx","system/contents/score/edit/harmonize/input/backingEditorInput.tsx","system/contents/score/edit/harmonize/side/sideFormChord.tsx","system/contents/score/edit/harmonize/side/sideFormInit.tsx","system/contents/score/edit/harmonize/side/sideFormSection.tsx","system/contents/score/edit/harmonize/side/noteSideForm.tsx","system/contents/score/edit/harmonize/measure/harmMeasure.tsx","system/contents/score/edit/harmonize/info/chordInfo.tsx","system/contents/score/edit/harmonize/initial/initialBeat.tsx","system/contents/backing/pattern/builder/patternLength.tsx","system/contents/backing/pattern/builder/patternTable.tsx","system/contents/backing/pattern/builder/patternBuilder.tsx","system/contents/backing/pattern/channel/channelItem.tsx","system/contents/backing/pattern/channel/patternChannel.tsx","system/contents/backing/pattern/patternStatus.tsx","system/contents/backing/pattern/patternFrame.tsx","system/utils/backingUtil.tsx","system/contents/backing/voicing/voicingChooser.tsx","system/contents/backing/backingEditorFrame.tsx","system/contents/score/edit/harmonize/harmHideFrame.tsx","system/contents/score/edit/harmonize/harmonizeFrame.tsx","system/contents/score/edit/harmonize/harmSections.tsx","system/contents/score/edit/melody/melodyTimeline.tsx","system/contents/score/edit/melody/melodyPitchList.tsx","system/contents/score/edit/melody/item/instrumentSwitch.tsx","system/contents/score/edit/melody/item/quantizeSwitch.tsx","system/contents/score/edit/melody/melodyHeader.tsx","system/contents/score/edit/melody/util/melodyMouseOperation.tsx","system/contents/score/edit/harmonize/input/melodyInput.tsx","system/contents/score/edit/melody/melodyFrame.tsx","system/contents/score/edit/editTab.tsx","system/contents/score/scoreChannel.tsx","system/contents/setting/settingChannel.tsx","system/contents/perform/performChannel.tsx","system/contents/entry/mainFrame.tsx","system/contents/entry/splash.tsx","system/contents/entry/totalHeader.tsx","system/contents/entry/systemEntry.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["ActionType","SCALE_INDEX","ROOT_ALL","index","isFlat","DEGREE12_FLAT_LIST","DEGREE12_SHARP_LIST","getDegreeRoot","props","KEY12_FLAT_LIST","KEY12_SHARP_LIST","getChordRoot","baseKeyIndex","KEY12_MAJOR_SCALE_LIST","KEY12_MINOR_SCALE_LIST","SYMBOL_LIST","key","name","base","structs","attr","IntervalRelationProps","DIATONIC_MAJOR_SCALE_LIST","root","symbolKey","DIATONIC_MAJOR_SCALE_DEGREE_NAMES","getSymbolFromKey","ret","find","symbol","undefined","getSymbolDerives","list","forEach","push","reducer","store","action","type","payload","SET_SYSTEM_STATE","systemState","SET_SCORE_STATE","scoreState","SET_SCORE_DATA","scoreData","SET_TUNE_STATE","melodyState","tuneState","SET_REFS","refs","SET_INSTRUMENTS","instruments","SET_BACKING_STATE","backingState","SET_RESERVE_TASKS","reserveTasks","getKeyIndexFromPitcher","PITCH_MAX","getNormalizeLenFromNotes","notes","total","len4","len8","len16","len4div3","len8div3","getSortetdNotesLen","len8div3Cnt3","Math","floor","len8div3Cnt2","len4div3Cnt3","len16Cnt2","len8Cnt2","getNotesLenFromQuantize","quantize","count","getMinimumLenUnit","playSoundfont","i","keyIndex","octave","soundName","instrument","soundfontPlayer","stop","play","duration","TUNE_PITCH_WIDTH","TUNE_PITCH_HEIGHT","Dispatcher","dispatch","system","setState","switchSplashToMain","isSplash","setMainTabIndex","mainChannelIndex","setRefs","setReserveTasks","score","setScoreTabIndex","scoreTabIndex","setScoreState","setKeySwitch","keySwitch","state","setScoreData","moveElement","isNext","sub","chordList","focusIndex","moveSection","curSectionIndex","elementCacheList","sectionNo","sectionCacheList","curSectionInfo","curElementType","length","rangeIndexStart","rangeIndexEnd","incrementDegreeRoot","isUp","data","detail","includes","incrementBeatLen","slice","beatLen","incrementMinuteVal","pos","isTail","value","target","minute","tail","head","incrementMinuteValRelation","nearIndex","addChordElement","element","initialBeat","on","backing","voicingList","pattern","splice","addSectionElement","labelName","addChangeElement","changeType","modulateRelation","domminantValue","keyAdjust","tempoRelation","tempoDiff","tempoRate","tempoAbsolute","beatSignature","removeCurElement","cache","wrapRef","reffers","wrap","body","style","opacity","overflow","width","clientWidth","setTimeout","incrementSymbol","setDiatonicChord","chord","setDefaultBacking","struct","getDefaultBacking","toNext","mng","symbolMng","curLine","toBase","parentLine","toDerive","childrenLine","tune","setNotesList","notesList","setInstrument","incrementCurNoteKey","isUpper","mode","init","scaleIndexies","map","cur","prevPitchIndex","pitchIndex","interval","tempPitchIndex","adjustScrollY","moveFocus","lastFocus","adjustScrollX","addNotes","notes1","notes2","len","newLeftNormal","nextNormalPos","newRightNormal","resizeNotes","isSpread","curLenNormal","curNormalRight","resizeNormal","normal","moveNotes","isBehind","curNormalLeft","prevNormalRight","nextNormalLeft","moveNormal","table","melody","notesX","beatWidth","scrollTo","left","behavior","notesY","top","clientHeight","previewStart","dispatcher","bpm","isPreview","firstTime","pitch","time","openBackingEditor","hideMenu","voicingTable","getInitVoicingTable","chordInfo","chordRoot","closeBackingEditor","getInitialLayer","noteDivList","rate","isHalf","isDiv3","velocityList","Array","col","j","isExist","voicing","applyBackingToChord","getChannels","channels","structIndex","addPatternColumn","layers","layerIndex","lenIndex","movePatternColumn","isRight","layer","tempIndex","setCurrentDivRate","toggleCurrentDivHalf","changeLayer","this","initialStore","userEnv","keyConfig","note","prevElement","nextElement","prevSection","nextSection","addChord","addSection","addChange","deleteCur","editMode","incRoot","decRoot","incBeat","decBeat","symbolMode","colorProps","entryBackground","dialogMode","isTune","mouseState","isPut","lock","x","y","prevRight","nextLeft","notesState","side","isResize","isMove","curChord","mousePitchIndex","mouseMeasurePos","soundfontInfo","gain","scaleMode","resize","move","sampler","Sampler","toDestination","harmonize","measure","SysModalDialog","useContext","GlobalContext","isDisplay","_Blind","_Frame","styled","div","ChannelPane","useState","activeNo","setActiveNo","useEffect","_LabelList","tabElements","tab","icon","isActive","isDisable","disable","selectTab","selectTabIndex","_ContList","cont","ChannelLabel","_Item","onClick","_Icon","_Label","ChannelContents","_Contents","css","TabbedPane","TabLabel","_TabLabel","TabContents","ManageTab","_Wrap","_Link","scale","timeSignature","fixed","_Object","_CSS_DISABLE","ExecutableButton","size","get","height","fontSize","backgroundColor","callback","labelText","SymbolEditor","curSymbol","baseSymbol","derives","parentJsx","curJsx","childrenJsx","_Header","item","_Row","CalcChord","symbolName","bar","prevCache","isError","beat","chordName","_Detail","_Chord","_Pos","_Section","_Beat","_PastSecond","round","pastSecond","ELEMENT_POS_INFO_WIDTH","CalcSection","curSection","barSum","beatSum","barRem","_Len","_Border","ElementDetailChange","_Type","ElementDetailChord","degreeRoot","degreeOn","useMemo","_Degree","isSwitch","isCurrent","scaleRelation","isOnChordScale","_DegreeRoot","_DegreeSymbol","_DegreeOnChord","_Tip","jsxList","lenType","valueType","abs","_TipItem","ElementFixedBorder","reverse","ElementDetailInit","_Title","_Value","_Record","ElementDetailSection","CalcChange","ScoreElement","useRef","bodyRef","current","isFocus","isSameSection","chordDetail","ref","isSelectable","isInactive","isChord","_Head","_CurKey","_Form","isAnytime","_Operations","_OperationItem","ELEMENT_HEAD_WIDTH","ELEMENT_OPERATIONS_WIDTH","HarmNote","num","_Note","NoteBasicInput","e","config","curType","releaseAll","rootIndex","soundFullName","triggerAttack","playChord","Number","NoteKeySwitch","isPress","isElement","backingEditorInput","NoteKeyDown","SideFormChord","beatItemsJsx","_BeatItem","rootItemsJsx","isRootActive","JSON","stringify","isOnActive","_RootItem","isDiatonic","onContextMenu","symbolItemsJsx","_SymbolItem","_Timing","_LabelBeat","_Minute","_LabelMinute","_MinuteItem","isReverse","step","min","max","onChange","_Root","_Symbol","input","SideFormInit","scaleItemJsxList","_ScaleItem","keyItemJsxList","_KeyItem","rateItemJsxList","_RateItem","_LabelTitle","_ScaleWrap","_KeyWrap","_TempoWrap","currentTarget","valueAsNumber","_RateWrap","SideFormSection","setLabelName","templateItemJsxList","indexOf","_TemplateItem","numberItemJsxList","toString","_NumberItem","_DirectText","_TemplateFrame","_NumberFrame","_ItemBase","NoteSideForm","HarmMeasure","dataList","cacheList","curBeatJsx","prevBeatJsx","nextBeatJsx","curMinuteJsx","prevMinuteJsx","nextMinuteJsx","memoriJsxList","curIndex","prevIndex","nextIndex","temp","add","sustain","adjust","bean","color","_Memori","_Bar","_Prev","_Start","_Cur","_Next","_Blocks","_Measure","BEAT_WIDTH","ChordInfo","scaleList","structJsxList","tipJsxList","relation","getIntervalValues","_InfoItem","isScale","isUse","isBlack","_Struct","WIDTH","InitialBeatTip","_WrapTip","PatternLength","itemJsxList","PatternTable","channelCount","layerJsxList","jsxLsit","notesJsxLsit","k","_Notes","_State","signal","isEven","isFront","_Layer","zIndex","PatternBuilder","_LengthDiv","_MeasureDiv","_Body","_Footer","PATTERN_HEADER_HEIGHT","ChannelItem","_Option","PatternChannel","channelJsxList","channel","soundIndex","PatternStatus","update","createItem","isEnable","createRateItem","String","setRate","sizeJsxList","_ListItem","_List","select","option","PatternFrame","isUsePattern","_UseSwitch","_Button","isUsePedal","_Main","_StatusDiv","_MainDiv","_ChannelDiv","_BuilderDiv","PATTERN_OPERATION_HEIGHT","BackingUtil","OCTAVE_NUM","STRUCT_NUM","VoicingChooser","voicingLaneJsxList","isSelected","chordIndex","_VoicingItem","tempChannels","_VoicingLane","_Left","_Relation","_Right","_Info","TIP_WIDTH","BackingEditorFrame","_FooterDiv","HarmHideFrame","isOpen","HarmonizeTab","focus","prevBeat","totalBeat","prevMinute","totalMinute","sectionBeatSum","beatRate","getBeatRate","tabIndex","onKeyDown","onKeyUp","_Middle","_Foot","_TIMELINE_WRAP","_INFO_WRAP","HARMONIZE_HEAD_WIDTH","HarmSections","sections","curSectionNo","section","_Total","MelodyTimeline","measureRef","chordRef","barLength","timelineLength","measureJsxList","barJsx","_Scale","isHead","chordJsxList","_ChordItem","_ChordWrap","_MousePos","MelodyPitchList","pitchItemJsxList","structIndexList","getOctaveName","_PitchItem","isStruct","_OctaveWrap","_OctaveItem","_PitchWrap","InstrumentSwitch","info","Soundfont","AudioContext","release","then","soundFontPlayer","QuantizeSwitch","MelodyHeader","_QuantizeSelector","_InstrumentSelector","MelodyMouseOperation","mouseDownEvent","button","mouse","getNextLeft","next","rect","getBoundingClientRect","clientX","scrollLeft","clientY","scrollTop","prev","mouseMoveEvent","curPos","posX","lenWidth","searchedChord","prevFocus","right","mouseUpEvent","sort","a","b","posA","posB","MelodyInput","keyDownEvent","id","clearTimeout","alert","keySwitchEvent","MelodyFrame","tableRef","pitchRef","invalidate","setInvalidate","tableWidth","barCount","scaleLineJsxList","_ScaleLine","isBase","notesJsxList","normalX","scroll","_NotesWrap","isOctave","_Timeline","_Pitch","_TableWrap","onScroll","_TableMeasure","_TablePitch","_TableNotes","onMouseDown","onMouseMove","onMouseUp","_Test","_PrevireBrind","editAnimation","keyframes","EditTab","switchMode","_Mode","_ModeItem","_Buttons","_SECTIONS","ScoreChannel","isAccept","SCORE_TAB_MARGIN","SettingChannel","PerformChannel","createLane","label","items","degree","degreeRootName","chordRootName","_Lane","_Box","MainFrame","MAIN_FRAME_MARGIN","Splash","setSwitch","timerId","setTimerId","fadeIn","TotalHeader","_ACCENT","_NORMAL","_Menu","_LoginButton","_Language","span","_MenuItem","TOTAL_HEADER_WIDTH","createContext","SystemEntry","useReducer","Provider","App","document","oncontextmenu","window","addEventListener","keyCode","preventDefault","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b92952ec.chunk.js","sourcesContent":["import { Store } from \"./store/store\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum ActionType {\r\n    SET_SYSTEM_STATE,\r\n    SET_SCORE_STATE,\r\n    SET_TUNE_STATE,\r\n    SET_SCORE_DATA,\r\n    SET_REFS,\r\n    SET_INSTRUMENTS,\r\n    SET_BACKING_STATE,\r\n    SET_RESERVE_TASKS,\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport type Action = {\r\n    type: ActionType;\r\n    payload: any;\r\n}\r\n\r\nexport const reducer = (store: Store, action: Action): Store => {\r\n    const type = action.type;\r\n    const payload = action.payload;\r\n    switch (type) {\r\n        case ActionType.SET_SYSTEM_STATE:\r\n            store.systemState = payload.systemState;\r\n            break;\r\n        case ActionType.SET_SCORE_STATE:\r\n            store.scoreState = payload.scoreState;\r\n            break;\r\n        case ActionType.SET_SCORE_DATA:\r\n            store.scoreData = payload.scoreData;\r\n            break;\r\n        case ActionType.SET_TUNE_STATE:\r\n            store.melodyState = payload.tuneState;\r\n            break;\r\n        case ActionType.SET_REFS:\r\n            store.refs = payload.refs;\r\n            break;\r\n        case ActionType.SET_INSTRUMENTS:\r\n            store.instruments = payload.instruments;\r\n            break;\r\n        case ActionType.SET_BACKING_STATE:\r\n            store.backingState = payload.backingState;\r\n            break;\r\n        case ActionType.SET_RESERVE_TASKS:\r\n            store.reserveTasks = payload.reserveTasks;\r\n            break;\r\n    }\r\n    return { ...store };\r\n}","import { BeatSignature } from \"../redux/store/scoreData\";\r\n\r\nexport const SCALE_INDEX = [0, 2, 4, 5, 7, 9, 11];\r\n\r\nexport type DegreeProps = {\r\n    index: number;\r\n    isFlat: boolean;\r\n};\r\n\r\nexport type ChordProps = {\r\n    root: DegreeProps;\r\n    symbolKey: SymbolKey;\r\n};\r\n\r\nexport const ROOT_ALL: readonly (DegreeProps | null)[] = [\r\n    null,\r\n    { index: 0, isFlat: false },\r\n    { index: 1, isFlat: false },\r\n    { index: 1, isFlat: true },\r\n    { index: 2, isFlat: false },\r\n    { index: 3, isFlat: false },\r\n    { index: 3, isFlat: true },\r\n    { index: 4, isFlat: false },\r\n    { index: 5, isFlat: false },\r\n    { index: 6, isFlat: false },\r\n    { index: 6, isFlat: true },\r\n    { index: 7, isFlat: false },\r\n    { index: 8, isFlat: false },\r\n    { index: 8, isFlat: true },\r\n    { index: 9, isFlat: false },\r\n    { index: 10, isFlat: false },\r\n    { index: 10, isFlat: true },\r\n    { index: 11, isFlat: false }\r\n];\r\n\r\n\r\nexport const DEGREE12_FLAT_LIST = [\r\n    '', 'b', '', 'b', '', '', 'b', '', 'b', '', 'b', ''\r\n];\r\n// export const DEGREE12_FLAT_LIST = [\r\n//     'I', 'bII', 'II', 'bIII', 'III', 'IV', 'bV', 'V', 'bVI', 'VI', 'bVII', 'VII'\r\n// ];\r\nexport const DEGREE12_SHARP_LIST = [\r\n    '', '#', '', '#', '', '', '#', '', '#', '', '#', ''\r\n];\r\n\r\nexport const getDegreeRoot = (props: DegreeProps) => {\r\n    const list = props.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST;\r\n    return list[props.index];\r\n}\r\n\r\nexport const KEY12_FLAT_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\nexport const KEY12_SHARP_LIST = [\r\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'\r\n];\r\n\r\nexport const getChordRoot = (props: DegreeProps, baseKeyIndex: number) => {\r\n    const list = props.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST;\r\n    return list[(baseKeyIndex + props.index) % 12];\r\n}\r\n\r\n\r\nexport const KEY12_MAJOR_SCALE_LIST = [\r\n    'C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'Ab', 'A', 'Bb', 'B'\r\n];\r\n// export const KEY12_MINOR_SCALE_LIST = [\r\n//     'Cm', 'C#m', 'Dm', 'D#m', 'Em', 'Fm', 'F#m', 'Gm', 'G#m', 'Am', 'Bbm', 'Bm'\r\n// ];\r\nexport const KEY12_MINOR_SCALE_LIST = [\r\n    'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B'\r\n];\r\n\r\nexport type ScaleRelation = 'diatonic' | 'secondaly' | 'none'\r\n\r\nexport type SymbolKey =\r\n    'major' |\r\n    'minor' |\r\n    'suspend4th' |\r\n    'diminish' |\r\n    'augument' |\r\n    'major-maj7th' |\r\n    'major-min7th' |\r\n    'minor-7th' |\r\n    'minor-maj7th' |\r\n    'sus4-7th' |\r\n    'diminish-7th' |\r\n    'augument-7th' |\r\n    'major-add9th' |\r\n    'minor-add9th' |\r\n    'sixth-9th' |\r\n    'minor-minus5' |\r\n    'minor7-minus5' |\r\n    'major-maj9th' |\r\n    'major-9th'\r\n    ;\r\n\r\n\r\nexport type SymbolAttribute =\r\n    'triad' |\r\n    'seventh' |\r\n    'add9th'\r\n    ;\r\n\r\nexport type SymbolParams = {\r\n    key: SymbolKey;\r\n    name: string;\r\n    base: null | SymbolKey;\r\n    attr?: SymbolAttribute;\r\n    structs: IntervalRelation[];\r\n}\r\n\r\nexport const SYMBOL_LIST: readonly SymbolParams[] = [\r\n    {\r\n        key: 'major', name: '',\r\n        base: null,\r\n        structs: ['p1', 'M3', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'minor', name: 'm',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'suspend4th', name: 'sus4',\r\n        base: null,\r\n        structs: ['p1', 'p4', 'p5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'diminish', name: 'dim',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'd5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'diminish-7th', name: 'dim7',\r\n        base: 'diminish',\r\n        structs: ['p1', 'm3', 'd5', 'd7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'augument', name: 'aug',\r\n        base: null,\r\n        structs: ['p1', 'M3', 'a5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'augument-7th', name: 'aug7',\r\n        base: 'augument',\r\n        structs: ['p1', 'M3', 'a5', 'm7']\r\n    },\r\n    {\r\n        key: 'minor-minus5', name: 'm(-5)',\r\n        base: null,\r\n        structs: ['p1', 'm3', 'd5'],\r\n        attr: 'triad'\r\n    },\r\n    {\r\n        key: 'minor7-minus5', name: 'm7(-5)',\r\n        base: 'minor-minus5',\r\n        structs: ['p1', 'm3', 'd5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-maj7th', name: 'maj7',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'M7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-min7th', name: '7',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'minor-7th', name: 'm7',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'm7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'sus4-7th', name: '7sus4',\r\n        base: 'suspend4th',\r\n        structs: ['p1', 'p4', 'p5']\r\n    },\r\n    {\r\n        key: 'minor-maj7th', name: 'mmaj7',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'M7'],\r\n        attr: 'seventh'\r\n    },\r\n    {\r\n        key: 'major-add9th', name: 'add9',\r\n        base: 'major',\r\n        structs: ['p1', 'M3', 'p5', 'M2'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'minor-add9th', name: 'madd9',\r\n        base: 'minor',\r\n        structs: ['p1', 'm3', 'p5', 'M2'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'major-maj9th', name: 'maj9',\r\n        base: 'major-maj7th',\r\n        structs: ['p1', 'm3', 'p5'],\r\n        attr: 'add9th'\r\n    },\r\n    {\r\n        key: 'major-9th', name: '9',\r\n        base: 'major-min7th',\r\n        structs: ['p1', 'm3', 'p5']\r\n    },\r\n];\r\n\r\nexport type IntervalRelation =\r\n    'p1' | 'm2' | 'M2' | 'm3' | 'M3' | 'p4' |\r\n    'd5' | 'p5' | 'a5' | 'm6' | 'M6' |\r\n    'd7' | 'm7' | 'M7'\r\n    ;\r\n\r\nexport const IntervalRelationProps = {\r\n    'p1': 0,\r\n    'm2': 1,\r\n    'M2': 2,\r\n    'm3': 3,\r\n    'M3': 4,\r\n    'p4': 5,\r\n    'd5': 6,\r\n    'p5': 7,\r\n    'a5': 8,\r\n    'm6': 8,\r\n    'M6': 9,\r\n    'd7': 9,\r\n    'm7': 10,\r\n    'M7': 11\r\n}\r\n\r\nexport const DIATONIC_MAJOR_SCALE_LIST: readonly ChordProps[] = [\r\n    { root: { index: 0, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 2, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 4, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 5, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 7, isFlat: false }, symbolKey: 'major' },\r\n    { root: { index: 9, isFlat: false }, symbolKey: 'minor' },\r\n    { root: { index: 11, isFlat: false }, symbolKey: 'minor-minus5' },\r\n];\r\n\r\nexport const DIATONIC_MAJOR_SCALE_DEGREE_NAMES = [\r\n    '', 'maj7',\r\n    'm', 'm7',\r\n    'm', 'm7',\r\n    '', 'maj7',\r\n    '', '7',\r\n    'm', 'm7',\r\n    'm(-5)', 'm7(-5)'\r\n];\r\n\r\nexport const DIATONIC_NATURAL_MINOR_SCALE_DEGREE_NAMES = [\r\n    'm', 'm7',\r\n    'm(-5)', 'm7(-5)',\r\n    'b', 'bM7',\r\n    'm', 'm7',\r\n    'm', 'm7',\r\n    'b', 'bM7',\r\n    'b', 'b7'\r\n];\r\n\r\nexport const getSymbolFromKey = (key: SymbolKey): SymbolParams => {\r\n    const ret = SYMBOL_LIST.find((symbol) => {\r\n        if (key === symbol.key) {\r\n            return symbol;\r\n        }\r\n    });\r\n    return ret != undefined ? ret : SYMBOL_LIST[0];\r\n}\r\n\r\nexport const getSymbolDerives = (key: SymbolKey): SymbolKey[] => {\r\n    let list: SymbolKey[] = [];\r\n    SYMBOL_LIST.forEach((symbol) => {\r\n        if (key === symbol.base) {\r\n            list.push(symbol.key);\r\n        }\r\n    });\r\n    return list;\r\n}\r\n\r\nexport const getIntervalValues = (rootIndex: number, structs: IntervalRelation[]): number[] => {\r\n    return structs.map(relation => rootIndex + IntervalRelationProps[relation]);\r\n}\r\n\r\nexport const getBeatRate = (beatSignature: BeatSignature): [number, number] => {\r\n\r\n    switch (beatSignature) {\r\n        case '4/4': return [4, 4];\r\n        case '3/4': return [3, 4];\r\n    }\r\n    return [0, 0];\r\n}","import { isatty } from \"tty\";\r\nimport { MelodyState } from \"../redux/store/melodyState\";\r\nimport { DetailInit, MelodyLength, ScoreData } from \"../redux/store/scoreData\";\r\nimport { Store } from \"../redux/store/store\";\r\nimport { KEY12_SHARP_LIST } from \"./theoryUtils\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { Dispatcher } from \"../redux/dispatcher/dispatcher\";\r\n\r\nexport const PITCH_MAX = 60;\r\n\r\nexport const getKeyIndexFromPitcher = (index: number) => {\r\n    return (PITCH_MAX - 1 - index + 9) % 12;\r\n}\r\n\r\nexport const getNormalizeLenFromNotes = (notes: MelodyLength) => {\r\n    let total = 0;\r\n    total += notes.len4;\r\n    total += notes.len8 / 2;\r\n    total += notes.len16 / 4;\r\n    total += notes.len4div3 / 3;\r\n    total += notes.len8div3 / 6;\r\n    return total;\r\n}\r\n\r\nexport const getAdditionNotsLen = (notes1: MelodyLength, notes2: MelodyLength) => {\r\n    return getSortetdNotesLen({\r\n        len4: notes1.len4 + notes2.len4,\r\n        len8: notes1.len8 + notes2.len8,\r\n        len16: notes1.len16 + notes2.len16,\r\n        len4div3: notes1.len4div3 + notes2.len4div3,\r\n        len8div3: notes1.len8div3 + notes2.len8div3\r\n    });\r\n}\r\n\r\nexport const getSortetdNotesLen = (base: MelodyLength) => {\r\n\r\n    const len8div3Cnt3 = Math.floor(base.len8div3 / 3);\r\n    base.len8div3 -= len8div3Cnt3 * 3;\r\n    base.len8 += len8div3Cnt3;\r\n\r\n    const len8div3Cnt2 = Math.floor(base.len8div3 / 2);\r\n    base.len8div3 -= len8div3Cnt2 * 2;\r\n    base.len4div3 += len8div3Cnt2;\r\n\r\n    const len4div3Cnt3 = Math.floor(base.len4div3 / 3);\r\n    base.len4div3 -= len4div3Cnt3 * 3;\r\n    base.len4 += len4div3Cnt3;\r\n\r\n    const len16Cnt2 = Math.floor(base.len16 / 2);\r\n    base.len16 -= len16Cnt2 * 2;\r\n    base.len8 += len16Cnt2;\r\n\r\n    const len8Cnt2 = Math.floor(base.len8 / 2);\r\n    base.len8 -= len8Cnt2 * 2;\r\n    base.len4 += len8Cnt2;\r\n\r\n    return base;\r\n}\r\n\r\nexport const getNotesLenFromQuantize = (quantize: number, count: number): MelodyLength => {\r\n\r\n    let len4 = 0;\r\n    let len8 = 0;\r\n    let len16 = 0;\r\n    let len4div3 = 0;\r\n    let len8div3 = 0;\r\n\r\n    switch (quantize) {\r\n        case 1: len4 = count; break;\r\n        case 2: len8 = count; break;\r\n        case 3: len4div3 = count; break;\r\n        case 4: len16 = count; break;\r\n        case 6: len8div3 = count; break;\r\n    }\r\n    return getSortetdNotesLen({\r\n        len4, len8, len16, len4div3, len8div3\r\n    });\r\n}\r\n// export const getNotesLenFromNormal = (normal: number): MelodyLength => {\r\n//     // let normal = a;\r\n//     let len4 = 0;\r\n//     let len8 = 0;\r\n//     let len16 = 0;\r\n//     let len4div3 = 0;\r\n//     let len8div3 = 0;\r\n\r\n//     normal *= 12;\r\n\r\n//     len4 = Math.floor(normal / 12);\r\n//     normal -= len4 * 12;\r\n//     if (normal - Math.floor(normal / 12 * 3) !== 0) {\r\n//         len8 = Math.floor(normal / 12 * 2);\r\n//         normal -= len8 * 12 / 2;\r\n//     }\r\n//     len4div3 = Math.floor(normal / 12 * 3);\r\n//     normal -= len4div3 * 12 / 3;\r\n//     if (normal - Math.floor(normal / 12 * 6) !== 0) {\r\n//         len16 = Math.floor(normal / 12 * 4);\r\n//         normal -= len16 * 12 / 4;\r\n//     }\r\n//     len8div3 = Math.floor(normal / 12 * 6);\r\n//     return {\r\n//         len4, len8, len16, len4div3, len8div3\r\n//     };\r\n// }\r\n\r\nexport const getMinimumLenUnit = (notes: MelodyLength): number => {\r\n\r\n    if (notes.len8div3 > 0) return 6;\r\n    else if (notes.len16 > 0) return 4;\r\n    else if (notes.len4div3 > 0) return 3;\r\n    else if (notes.len8 > 0) return 2;\r\n    else if (notes.len4 > 0) return 1;\r\n    else return 0;\r\n}\r\n\r\nexport const playSoundfont = (i: number, store: Store) => {\r\n    const keyIndex = ((59 - i) + 9) % 12;\r\n    const octave = Math.floor(((59 - i) + 9) / 12) + 1;\r\n    const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n    const instrument = store.instruments.soundfontPlayer;\r\n    if (instrument != null) {\r\n        instrument.stop();\r\n        instrument.play(soundName + octave, 0, { duration: 0.5 });\r\n    }\r\n}\r\n\r\n\r\nexport const previewStart = (store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const state = store.melodyState;\r\n    const data = store.scoreData;\r\n    const reserveTasks:NodeJS.Timeout[] = [];\r\n    const instrument = store.instruments.soundfontPlayer;\r\n    const init = data.chordList[0].detail as DetailInit;\r\n    const bpm = init.bpm;\r\n    state.lastFocus = state.focusIndex;\r\n    state.isPreview = true;\r\n    let firstTime = -1;\r\n    for (let i = state.focusIndex; i < data.notesList.length; i++) {\r\n        const notes = data.notesList[i];\r\n        const pos = getNormalizeLenFromNotes(notes.pos);\r\n        const len = getNormalizeLenFromNotes(notes.len);\r\n        const pitch = notes.pitchIndex;\r\n        const time = 60 / bpm * pos;\r\n\r\n        // \r\n        if (firstTime === -1) {\r\n            firstTime = time;\r\n        }\r\n\r\n        reserveTasks.push(\r\n            setTimeout(() => {\r\n                state.focusIndex = i;\r\n                dispatcher.tune.setState(state);\r\n                if (instrument != null) {\r\n                    const keyIndex = getKeyIndexFromPitcher(pitch);\r\n                    const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n                    const octave = Math.floor(((59 - pitch) + 9) / 12) + 1;\r\n                    instrument.stop();\r\n                    instrument.play(soundName + octave, 0, { duration: 60 / bpm * len });\r\n                }\r\n            }, (time - firstTime) * 1000)\r\n        );\r\n\r\n        if (i === data.notesList.length - 1) {\r\n            reserveTasks.push(\r\n                setTimeout(() => {\r\n                    state.isPreview = false;\r\n                    state.focusIndex = state.lastFocus;\r\n                    dispatcher.tune.setState(state);\r\n                }, (time - firstTime + 60 / bpm * len) * 1000)\r\n            );\r\n        }\r\n    }\r\n    dispatcher.system.setReserveTasks(reserveTasks);\r\n    dispatcher.tune.setState(state);\r\n}\r\n","\r\nexport const APP_MIN_WIDTH = 800;\r\nexport const APP_MIN_HEIGHT = 600;\r\n\r\nexport const TOTAL_HEADER_WIDTH = 44;\r\n\r\nexport const MAIN_FRAME_MARGIN = 15;\r\nexport const SCORE_TAB_MARGIN = 8;\r\n\r\nexport const BUTTON_SMALL_HEIGHT = 18;\r\nexport const BUTTON_MIDIUM_HEIGHT = 28;\r\nexport const BUTTON_LARGE_HEIGHT = 34;\r\n\r\n// \r\n\r\nexport const FIRST_CHORD_INDEX = 3;\r\n\r\nexport const HARMONIZE_RIGHT_WIDTH = 220;\r\nexport const HARMONIZE_HEAD_WIDTH = 35;\r\nexport const HARMONIZE_FOOT_WIDTH = 80;\r\nexport const HARMONIZE_STRUCT_WIDTH = 380;\r\nexport const HARMONIZE_SECTIONS_WIDTH = 110;\r\n\r\nexport const ELEMENT_HEIGHT = 134;\r\nexport const ELEMENT_HEAD_WIDTH = 15;\r\nexport const ELEMENT_FOOT_WIDTH = 60;\r\nexport const ELEMENT_SIDE_PADDING = 8;\r\nexport const ELEMENT_NOTE_PADDING_LEN = 10;\r\nexport const ELEMENT_NOTE_PADDING_SID = 30;\r\nexport const ELEMENT_POS_INFO_WIDTH = 50;\r\nexport const ELEMENT_OPERATIONS_WIDTH = 20;\r\n\r\nexport const TIMELINE_BEAT_WIDTH = 80;\r\n\r\n\r\nexport const TUNE_HEADER_WIDTH = 80;\r\nexport const TUNE_TIMELINE_WIDTH = 70;\r\nexport const TUNE_PITCH_WIDTH = 100;\r\nexport const TUNE_PITCH_HEIGHT = 30;\r\n\r\n\r\n\r\nexport const PATTERN_OPERATION_HEIGHT = 30;\r\nexport const PATTERN_HEADER_HEIGHT = 50;\r\nexport const PATTERN_BODY_HEIGHT = 240;\r\nexport const PATTERN_FOOTER_HEIGHT = 60;\r\nexport const PATTERN_FRAME_HEIGHT = PATTERN_OPERATION_HEIGHT + PATTERN_HEADER_HEIGHT + PATTERN_BODY_HEIGHT + PATTERN_FOOTER_HEIGHT;\r\n\r\n\r\nexport const NOTES_1BAR_WIDTH = 480;","import { DegreeProps, DIATONIC_MAJOR_SCALE_LIST, getSymbolFromKey, SCALE_INDEX, SymbolKey } from \"../../utils/theoryUtils\";\r\nimport { Action, ActionType } from \"../reducer\";\r\nimport { RefsCache } from \"../store/refsCache\";\r\nimport { ChordElement, DetailChange, DetailChord, DetailInit, DetailSection, ScoreData, TuneNotes, VoicingProps } from \"../store/scoreData\";\r\nimport { NoteKeySwitch, ScoreState, SymbolDiagram } from \"../store/scoreState\";\r\nimport { Store } from \"../store/store\";\r\nimport { MelodyKeySwitch, MelodyPitchMode, MelodyState } from \"../store/melodyState\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { SystemState } from \"../store/systemState\";\r\nimport { BackingLayer, BackingPattern, BackingState, ChannelParam, NoteRate } from \"../store/backingState\";\r\nimport { getDefaultBacking } from \"../../utils/instrumentsUtil\";\r\nimport { getAdditionNotsLen, getKeyIndexFromPitcher, getMinimumLenUnit, getNormalizeLenFromNotes, getNotesLenFromQuantize, PITCH_MAX, playSoundfont, previewStart } from \"../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../utils/systemConst\";\r\n\r\nexport class Dispatcher {\r\n\r\n    private store: Store;\r\n    private dispatch: Function;\r\n\r\n    constructor(store: Store, dispatch: React.Dispatch<Action>) {\r\n        this.store = store;\r\n        this.dispatch = (type: ActionType, payload: object) => dispatch({ type, payload });\r\n    }\r\n\r\n    public system = {\r\n\r\n        setState: (systemState: SystemState) => {\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        switchSplashToMain: () => {\r\n            const systemState = this.store.systemState;\r\n            systemState.isSplash = false;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setMainTabIndex: (index: number) => {\r\n            const systemState = this.store.systemState;\r\n            systemState.mainChannelIndex = index;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setRefs: (refs: RefsCache) => {\r\n            this.dispatch(ActionType.SET_REFS, { refs });\r\n        },\r\n\r\n        setReserveTasks: (reserveTasks: NodeJS.Timeout[]) => {\r\n            this.dispatch(ActionType.SET_RESERVE_TASKS, { reserveTasks });\r\n        }\r\n    }\r\n\r\n    public score = {\r\n\r\n        setScoreTabIndex: (index: number) => {\r\n            const systemState = this.store.systemState;\r\n            systemState.scoreTabIndex = index;\r\n            this.dispatch(ActionType.SET_SYSTEM_STATE, { systemState });\r\n        },\r\n\r\n        setScoreState: (scoreState: ScoreState) => {\r\n            this.dispatch(ActionType.SET_SCORE_STATE, { scoreState });\r\n        },\r\n\r\n        setKeySwitch: (keySwitch: NoteKeySwitch) => {\r\n            const state = this.store.scoreState;\r\n            state.keySwitch = keySwitch;\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        setScoreData: (scoreData: ScoreData) => {\r\n            this.dispatch(ActionType.SET_SCORE_DATA, { scoreData });\r\n        },\r\n\r\n        moveElement: (isNext: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const list = this.store.scoreData.chordList;\r\n            const sub = isNext ? 1 : -1;\r\n            if (list[state.focusIndex + sub].type !== 'fixed') {\r\n                state.focusIndex += sub;\r\n                this.score.setScoreState(state);\r\n            }\r\n        },\r\n\r\n        moveSection: (isNext: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const curSectionIndex = state.elementCacheList[state.focusIndex].sectionNo;\r\n            const sectionCacheList = state.sectionCacheList;\r\n            const curSectionInfo = sectionCacheList[curSectionIndex];\r\n            const curElementType = this.store.scoreData.chordList[state.focusIndex].type;\r\n            if (!isNext) {\r\n                // alert('prev');\r\n                if (curElementType === 'section' && curSectionIndex > 0) {\r\n                    // 1\r\n                    state.focusIndex = sectionCacheList[curSectionIndex - 1].rangeIndexStart;\r\n                } else {\r\n                    // \r\n                    state.focusIndex = curSectionInfo.rangeIndexStart;\r\n                }\r\n            } else {\r\n                // alert('next');\r\n                if (curSectionIndex < sectionCacheList.length - 1) {\r\n                    // \r\n                    state.focusIndex = sectionCacheList[curSectionIndex + 1].rangeIndexStart;\r\n                } else {\r\n                    // \r\n                    state.focusIndex = curSectionInfo.rangeIndexEnd;\r\n                }\r\n            }\r\n            // alert(`totalSection=${sectionCacheList.length}, curSection=${curSectionIndex}, focus=${state.focusIndex}`);\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        incrementDegreeRoot: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.root == null) {\r\n                detail.root = { index: 0, isFlat: false };\r\n                this.score.setScoreData(data);\r\n            } else if (detail.root.index + sub >= 0 && detail.root.index + sub <= 11) {\r\n                detail.root.index += sub;\r\n                detail.root.isFlat = !isUp && ![0, 2, 4, 5, 7, 9, 11].includes(detail.root.index);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementBeatLen: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const chordList = data.chordList.slice();\r\n            const detail = chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.beatLen + sub >= 1 && detail.beatLen + sub <= 4) {\r\n                detail.beatLen += sub;\r\n                data.chordList = chordList;\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementMinuteVal: (pos: number, isTail: boolean, value: number) => {\r\n            const data = this.store.scoreData;\r\n            const cur = data.chordList[pos];\r\n            const detail = cur.detail as DetailChord;\r\n            let target = !isTail ? detail.minute.head : detail.minute.tail;\r\n            target += value;\r\n            if (target >= -0.5 && target <= 0.5) {\r\n                if (!isTail) detail.minute.head = target;\r\n                else detail.minute.tail = target;\r\n                // data.chordList[this.store.scoreState.focusIndex].detail = detail;\r\n                data.chordList = data.chordList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        incrementMinuteValRelation: (isTail: boolean, value: number) => {\r\n            const focusIndex = this.store.scoreState.focusIndex;\r\n            const chordList = this.store.scoreData.chordList;\r\n\r\n            let nearIndex = -1;\r\n            if (!isTail) {\r\n                for (let i = focusIndex - 1; i > 2; i--) {\r\n                    if (chordList[i].type === 'chord') {\r\n                        nearIndex = i;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = focusIndex + 1; i < chordList.length - 1; i++) {\r\n                    if (chordList[i].type === 'chord') {\r\n                        nearIndex = i;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (nearIndex != -1) {\r\n                this.score.incrementMinuteVal(focusIndex, isTail, value);\r\n                this.score.incrementMinuteVal(nearIndex, !isTail, -value);\r\n            }\r\n        },\r\n\r\n        addChordElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'chord', detail: {\r\n                    beatLen: state.initialBeat,\r\n                    minute: { head: 0, tail: 0 },\r\n                    // degreeIndex: 0,\r\n                    // isFlat: false,\r\n                    root: null,\r\n                    on: null,\r\n                    symbolKey: 'major',\r\n                    backing: {\r\n                        voicingList: [],\r\n                        pattern: null\r\n                    }\r\n                } as DetailChord\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n\r\n            // const cache = state.elementCacheList[state.focusIndex + 1];\r\n            // const wrapRef = cache.reffers.wrap as HTMLDivElement;\r\n            // const baseWidth = wrapRef.clientWidth;\r\n            // wrapRef.style.width = '0';\r\n            // setTimeout(() => {\r\n            //     wrapRef.style.width = `${baseWidth}px`;\r\n            // }, 1);\r\n            // setTimeout(() => {\r\n            //     wrapRef.style.width = '';\r\n            // }, 1000);\r\n        },\r\n\r\n        addSectionElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'section', detail: {\r\n                    labelName: 'Section'\r\n                } as DetailSection\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        addChangeElement: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const element = {\r\n                type: 'change', detail: {\r\n                    changeType: null,\r\n                    modulateRelation: null,\r\n                    domminantValue: 0,\r\n                    keyAdjust: 0,\r\n                    tempoRelation: null,\r\n                    tempoDiff: 0,\r\n                    tempoRate: 1,\r\n                    tempoAbsolute: 0,\r\n                    beatSignature: '4/4'\r\n                } as DetailChange\r\n            } as ChordElement;\r\n            data.chordList.splice(state.focusIndex + 1, 0, element);\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        removeCurElement: () => {\r\n            const state = this.store.scoreState;\r\n            const element = this.store.scoreData.chordList[state.focusIndex];\r\n            const sectionNo = this.store.scoreState.elementCacheList[state.focusIndex].sectionNo;\r\n            if (element.type === 'section' && sectionNo === 0) {\r\n                return;\r\n            }\r\n            const cache = state.elementCacheList[state.focusIndex];\r\n\r\n            const wrapRef = cache.reffers.wrap as HTMLDivElement;\r\n            const bodyRef = cache.reffers.body as HTMLDivElement;\r\n            // reffer.style.width = '300px';\r\n            wrapRef.style.opacity = '0';\r\n            wrapRef.style.overflow = 'hidden';\r\n            // wrapRef.style.padding = '0';\r\n            wrapRef.style.width = `${wrapRef.clientWidth}px`;\r\n            setTimeout(() => {\r\n                wrapRef.style.width = '0';\r\n            }, 1);\r\n            setTimeout(() => {\r\n                wrapRef.style.opacity = '';\r\n                wrapRef.style.width = '';\r\n                wrapRef.style.overflow = '';\r\n                // wrapRef.style.padding = '';\r\n                const data = this.store.scoreData;\r\n                data.chordList.splice(state.focusIndex, 1);\r\n                this.score.setScoreData(data);\r\n                state.focusIndex--;\r\n                this.score.setScoreState(state);\r\n                // setTimeout(() => {\r\n                //     reffer.style.opacity = '';\r\n                //     reffer.style.width = '';\r\n                //     const data = this.store.scoreData;\r\n                //     data.chordList.splice(state.focusIndex, 1);\r\n                //     this.score.setScoreData(data);\r\n                // }, 200);\r\n            }, 200);\r\n        },\r\n\r\n        incrementSymbol: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            if (detail.root == null) {\r\n                detail.root = { index: 0, isFlat: false };\r\n                this.score.setScoreData(data);\r\n            } else if (detail.root.index + sub >= 0 && detail.root.index + sub <= 11) {\r\n                detail.root.index += sub;\r\n                detail.root.isFlat = !isUp && ![0, 2, 4, 5, 7, 9, 11].includes(detail.root.index);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        setDiatonicChord: (key: number) => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const chord = DIATONIC_MAJOR_SCALE_LIST[key];\r\n            detail.root = { ...chord.root };\r\n            detail.symbolKey = chord.symbolKey;\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        setDefaultBacking: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            if (symbol.attr != undefined) {\r\n                detail.backing = getDefaultBacking(symbol.attr);\r\n                this.score.setScoreData(data);\r\n            }\r\n        }\r\n    }\r\n\r\n    public symbol = {\r\n\r\n        toNext: (isUp: boolean) => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const sub = isUp ? 1 : -1;\r\n            const index = mng.index + sub;\r\n            if (index >= 0 && index <= mng.curLine.length - 1) {\r\n                mng.index += sub;\r\n                detail.symbolKey = mng.curLine[mng.index];\r\n                this.score.setScoreState(state);\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        toBase: () => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            if (mng.parentLine.length > 0) {\r\n                detail.symbolKey = mng.parentLine[0];\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        toDerive: () => {\r\n            const state = this.store.scoreState;\r\n            const mng = state.symbolMng as SymbolDiagram;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            if (mng.childrenLine.length > 0) {\r\n                detail.symbolKey = mng.childrenLine[0];\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n    }\r\n\r\n    public tune = {\r\n\r\n        setState: (tuneState: MelodyState) => {\r\n            this.dispatch(ActionType.SET_TUNE_STATE, { tuneState });\r\n        },\r\n\r\n        setNotesList: (notesList: TuneNotes[]) => {\r\n            const data = this.store.scoreData;\r\n            data.notesList = notesList;\r\n            this.score.setScoreData(data);\r\n        },\r\n        setInstrument: (soundfontPlayer: Soundfont.Player) => {\r\n            this.dispatch(ActionType.SET_INSTRUMENTS, {\r\n                instruments: {\r\n                    ...this.store.instruments, soundfontPlayer\r\n                }\r\n            });\r\n        },\r\n\r\n        incrementCurNoteKey: (isUpper: boolean, mode: MelodyPitchMode) => {\r\n\r\n            const focusIndex = this.store.melodyState.focusIndex;\r\n            if (focusIndex === -1) return;\r\n\r\n            const init = this.store.scoreData.chordList[0].detail as DetailInit;\r\n            const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n            const notesList = this.store.scoreData.notesList;\r\n\r\n            const cur = notesList[focusIndex];\r\n            const prevPitchIndex = cur.pitchIndex;\r\n            const interval = mode !== 'octave' ? 1 : 12;\r\n            let tempPitchIndex = cur.pitchIndex;\r\n\r\n            while (isUpper ? cur.pitchIndex > 0 : cur.pitchIndex < PITCH_MAX - 1) {\r\n                tempPitchIndex += interval * (isUpper ? -1 : 1);\r\n\r\n                if (mode !== 'scale' ||\r\n                    (mode === 'scale' && scaleIndexies.includes(getKeyIndexFromPitcher(tempPitchIndex)))\r\n                ) {\r\n                    cur.pitchIndex = tempPitchIndex;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // \r\n            if (prevPitchIndex !== cur.pitchIndex) {\r\n                playSoundfont(cur.pitchIndex, this.store);\r\n                // \r\n                this.tune.setNotesList(notesList.slice());\r\n\r\n                this.tune.adjustScrollY();\r\n            }\r\n        },\r\n\r\n        setKeySwitch: (keySwitch: MelodyKeySwitch) => {\r\n            const state = this.store.melodyState;\r\n            state.keySwitch = keySwitch;\r\n            this.tune.setState(state);\r\n        },\r\n\r\n        moveFocus: (isNext: boolean) => {\r\n            const state = this.store.melodyState;\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n\r\n            // \r\n            if (state.focusIndex === -1) {\r\n                if (notesList.length > 0) {\r\n                    state.focusIndex = state.lastFocus;\r\n                    this.tune.setState(state);\r\n                }\r\n            } else {\r\n                if (!isNext ? state.focusIndex > 0 : state.focusIndex < notesList.length - 1) {\r\n                    state.focusIndex += (isNext ? 1 : -1);\r\n                    this.tune.setState(state);\r\n                }\r\n            }\r\n\r\n            this.tune.adjustScrollX();\r\n        },\r\n\r\n        addNotes: () => {\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const pos = getAdditionNotsLen(cur.pos, cur.len);\r\n            const newLeftNormal = getNormalizeLenFromNotes(pos);\r\n            const nextNormalPos = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const newRightNormal = newLeftNormal + 1 / state.quantize;\r\n            // \r\n            if (nextNormalPos === -1 || newRightNormal <= nextNormalPos) {\r\n                data.notesList.splice(state.focusIndex + 1, 0, {\r\n                    pos,\r\n                    pitchIndex: cur.pitchIndex,\r\n                    len: getNotesLenFromQuantize(state.quantize, 1)\r\n                });\r\n                this.score.setScoreData(data);\r\n                state.focusIndex++;\r\n                this.tune.setState(state);\r\n            }\r\n\r\n            this.tune.adjustScrollX();\r\n        },\r\n\r\n        resizeNotes: (isSpread: boolean) => {\r\n\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const curLenNormal = getNormalizeLenFromNotes(cur.len);\r\n            const curNormalRight = getNormalizeLenFromNotes(cur.pos) + curLenNormal;\r\n            const nextNormalPos = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const resizeNormal = 1 / state.quantize;\r\n            const condition = !isSpread ?\r\n                // \r\n                curLenNormal > resizeNormal :\r\n                // \r\n                nextNormalPos === -1 || curNormalRight + resizeNormal <= nextNormalPos\r\n            // \r\n            if (condition) {\r\n                const normal = getNormalizeLenFromNotes(cur.len) + resizeNormal * (isSpread ? 1 : -1);\r\n                cur.len = getNotesLenFromQuantize(state.quantize, normal * state.quantize);\r\n                data.notesList = notesList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        moveNotes: (isBehind: boolean) => {\r\n\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            const data = this.store.scoreData;\r\n            const notesList = data.notesList;\r\n            const cur = notesList[state.focusIndex];\r\n            const curNormalLeft = getNormalizeLenFromNotes(cur.pos);\r\n            const curLenNormal = getNormalizeLenFromNotes(cur.len);\r\n            const curNormalRight = curNormalLeft + curLenNormal;\r\n            const prevNormalRight = state.focusIndex === 0 ? 0 : getNormalizeLenFromNotes(notesList[state.focusIndex - 1].pos) +\r\n                getNormalizeLenFromNotes(notesList[state.focusIndex - 1].len);\r\n            const nextNormalLeft = state.focusIndex === notesList.length - 1 ? -1 : getNormalizeLenFromNotes(notesList[state.focusIndex + 1].pos);\r\n            const moveNormal = 1 / state.quantize;\r\n            const condition = !isBehind ?\r\n                // \r\n                curNormalLeft - moveNormal >= prevNormalRight :\r\n                // \r\n                nextNormalLeft === -1 || curNormalRight + moveNormal <= nextNormalLeft\r\n            // \r\n            if (condition) {\r\n                const normal = getNormalizeLenFromNotes(cur.pos) + moveNormal * (isBehind ? 1 : -1);\r\n                cur.pos = getNotesLenFromQuantize(state.quantize, normal * state.quantize);\r\n                data.notesList = notesList.slice();\r\n                this.score.setScoreData(data);\r\n            }\r\n        },\r\n\r\n        adjustScrollX: () => {\r\n            const state = this.store.melodyState;\r\n            const table = this.store.refs.melody.table;\r\n            if (state.focusIndex !== -1 && table != null) {\r\n                const notesX = getNormalizeLenFromNotes(this.store.scoreData.notesList[state.focusIndex].pos) * state.beatWidth;\r\n                table.scrollTo({ left: notesX - 300, behavior: \"smooth\" });\r\n            }\r\n        },\r\n\r\n        adjustScrollY: () => {\r\n            const state = this.store.melodyState;\r\n            const table = this.store.refs.melody.table;\r\n            if (state.focusIndex !== -1 && table != null) {\r\n                const notesY = this.store.scoreData.notesList[state.focusIndex].pitchIndex * TUNE_PITCH_HEIGHT;\r\n                table.scrollTo({ top: notesY - table.clientHeight / 2, behavior: \"smooth\" });\r\n            }\r\n        },\r\n\r\n        previewStart: () => {\r\n            const state = this.store.melodyState;\r\n            if (state.focusIndex === -1) return;\r\n\r\n            previewStart(this.store, this);\r\n        }\r\n    }\r\n\r\n    public backing = {\r\n\r\n        openBackingEditor: () => {\r\n            const state = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n            const cache = state.elementCacheList[state.focusIndex];\r\n            state.hideMenu = 'backing';\r\n            this.score.setScoreState(state);\r\n            const voicingTable = this.backing.getInitVoicingTable(detail.backing.voicingList);\r\n            this.backing.setState({\r\n                chordInfo: {\r\n                    symbolKey: detail.symbolKey,\r\n                    beatLen: detail.beatLen,\r\n                    minute: detail.minute,\r\n                    chordRoot: ((detail.root as DegreeProps).index + cache.keyIndex) % 12\r\n                },\r\n                voicingTable,\r\n                pattern: null\r\n            });\r\n        },\r\n\r\n        closeBackingEditor: () => {\r\n            const state = this.store.scoreState;\r\n            state.hideMenu = 'none';\r\n            this.score.setScoreState(state);\r\n        },\r\n\r\n        setState: (backingState: BackingState) => {\r\n            this.dispatch(ActionType.SET_BACKING_STATE, { backingState });\r\n        },\r\n\r\n        getInitialLayer: (): BackingLayer => {\r\n            return {\r\n                noteDivList: [{ rate: 4, isHalf: false, isDiv3: 0 }],\r\n                table: [[null]],\r\n                velocityList: [5]\r\n            } as BackingLayer;\r\n        },\r\n\r\n        getInitVoicingTable: (voicingList: VoicingProps[]): boolean[][] => {\r\n            const table = new Array<boolean[]>(8);\r\n            for (let i = 0; i < table.length; i++) {\r\n                table[i] = new Array<boolean>(6);\r\n                const col = table[i];\r\n                for (let j = 0; j < col.length; j++) {\r\n                    const isExist = voicingList.find(voicing => {\r\n                        if (voicing.octave === i && voicing.struct === j) {\r\n                            return voicing;\r\n                        }\r\n                    });\r\n                    table[i][j] = isExist != null;\r\n                }\r\n            }\r\n            return table;\r\n        },\r\n\r\n        applyBackingToChord: () => {\r\n            const scoreState = this.store.scoreState;\r\n            const data = this.store.scoreData;\r\n            const detail = data.chordList[scoreState.focusIndex].detail as DetailChord;\r\n            const backingState = this.store.backingState as BackingState;\r\n            const table = backingState.voicingTable;\r\n            const backing = detail.backing;\r\n            backing.voicingList.length = 0;\r\n            if (table != null) {\r\n                for (let i = 0; i < table.length; i++) {\r\n                    for (let j = 0; j < table[i].length; j++) {\r\n                        if (table[i][j]) {\r\n                            backing.voicingList.push({ octave: i, struct: j });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            detail.backing = backing;\r\n            this.score.setScoreData(data);\r\n        },\r\n\r\n        getChannels: (table: boolean[][]): ChannelParam[] => {\r\n            const channels: ChannelParam[] = [];\r\n            for (let i = 0; i < table.length; i++) {\r\n                for (let j = 0; j < table[i].length; j++) {\r\n                    if (table[i][j]) {\r\n                        channels.push({ octave: i, structIndex: j });\r\n                    }\r\n                }\r\n            }\r\n            if (channels.length === 0) {\r\n                channels.push({ octave: -1, structIndex: 0 });\r\n            }\r\n            return channels;\r\n        },\r\n\r\n        addPatternColumn: () => {\r\n\r\n            const state = this.store.backingState as BackingState;\r\n            const pattern = state.pattern as BackingPattern;\r\n\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const lenList = layer.noteDivList;\r\n            lenList.splice(pattern.lenIndex + 1, 0, { rate: 4, isDiv3: 0, isHalf: false });\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        movePatternColumn: (isRight: boolean) => {\r\n\r\n            const state = this.store.backingState as BackingState;\r\n            const pattern = state.pattern as BackingPattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n\r\n            let tempIndex = pattern.lenIndex;\r\n            tempIndex += 1 * (isRight ? 1 : -1);\r\n            if (tempIndex >= 0 && tempIndex <= layer.noteDivList.length - 1) {\r\n                pattern.lenIndex = tempIndex;\r\n            }\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        setCurrentDivRate: (rate: NoteRate) => {\r\n            const state = this.store.backingState as BackingState;\r\n            const pattern = state.pattern as BackingPattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const cur = layer.noteDivList[pattern.lenIndex];\r\n            cur.rate = rate;\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        toggleCurrentDivHalf: () => {\r\n            const state = this.store.backingState as BackingState;\r\n            const pattern = state.pattern as BackingPattern;\r\n            const layer = pattern.layers[pattern.layerIndex];\r\n            const cur = layer.noteDivList[pattern.lenIndex];\r\n            cur.isHalf = !cur.isHalf;\r\n            this.backing.setState(state);\r\n        },\r\n\r\n        changeLayer: () => {\r\n            const state = this.store.backingState as BackingState;\r\n            const pattern = state.pattern as BackingPattern;\r\n            pattern.layerIndex = pattern.layerIndex === 0 ? 1 : 0;\r\n            pattern.lenIndex = 0;\r\n            this.backing.setState(state);\r\n        }\r\n    }\r\n}","import { Sampler } from \"tone\";\r\nimport { ChordBacking, DetailChord, VoicingProps } from \"../redux/store/scoreData\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST, SymbolAttribute } from \"./theoryUtils\";\r\n\r\nexport const getDefaultSampler = () => {\r\n    return new Sampler({\r\n        \"C2\": \"https://dl.dropbox.com/s/9v1e4vb2y49kvxe/KEPSREC036.mp3?dl=0\",\r\n        \"C3\": \"https://dl.dropbox.com/s/qjkoqqdkqwtnctj/KEPSREC048.mp3?dl=0\",\r\n        \"C4\": \"https://dl.dropbox.com/s/9fgqyu7hsj8fncc/KEPSREC060.mp3?dl=0\",\r\n        \"C5\": \"https://dl.dropbox.com/s/0v042zfk67q4a8d/KEPSREC072.mp3?dl=0\",\r\n        \"C6\": \"https://dl.dropbox.com/s/3u2c7qsmhnse575/KEPSREC084.mp3?dl=0\",\r\n    }).toDestination();\r\n}\r\n\r\nexport const playChord = (sampler: Sampler, detail: DetailChord, bpm: number) => {\r\n\r\n    sampler.releaseAll();\r\n    if (detail.root == null) return;\r\n\r\n    const rootIndex = detail.root.index;\r\n    const symbol = getSymbolFromKey(detail.symbolKey);\r\n\r\n    const channelList = detail.backing.voicingList.map((item) => {\r\n        const interval = IntervalRelationProps[symbol.structs[item.struct]];\r\n        return 12 * item.octave + rootIndex + interval;\r\n    });\r\n\r\n    channelList.forEach((index, i) => {\r\n        const soundName = KEY12_SHARP_LIST[index % 12];\r\n        const octave = Math.floor(index / 12);\r\n        const soundFullName = soundName + octave;\r\n\r\n        sampler.triggerAttack(soundFullName, '+0', 0.5);\r\n        // setTimeout(() => {\r\n        //     sampler.triggerAttack(soundFullName, '+0', 0.5);\r\n        // }, 20 * i);\r\n    });\r\n\r\n    setTimeout(() => {\r\n        // sampler.triggerRelease('C3');\r\n        sampler.releaseAll();\r\n    }, 2000);\r\n}\r\n\r\n\r\nexport const getDefaultBacking = (attr: SymbolAttribute) => {\r\n    let voicingList: VoicingProps[] = [];\r\n    switch (attr) {\r\n        case 'triad': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 }\r\n        ]; break;\r\n        case 'seventh': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 },\r\n            { struct: 3, octave: 3 }\r\n        ]; break;\r\n        case 'add9th': voicingList = [\r\n            { struct: 0, octave: 3 },\r\n            { struct: 1, octave: 3 },\r\n            { struct: 2, octave: 3 },\r\n            { struct: 3, octave: 3 }\r\n        ]; break;\r\n    }\r\n    const backing: ChordBacking = {\r\n        voicingList,\r\n        pattern: null\r\n    };\r\n    return backing;\r\n}","import { themaColorNormal } from \"../../base/design/thema/themaColorNormal\"\r\nimport { getDefaultSampler } from \"../../utils/instrumentsUtil\"\r\nimport { RefsCache as RefsCache } from \"./refsCache\"\r\nimport { Instruments } from \"./instrument\"\r\nimport { ScoreData } from \"./scoreData\"\r\nimport { ScoreState } from \"./scoreState\"\r\nimport { SystemState } from \"./systemState\"\r\nimport { MelodyState } from \"./melodyState\"\r\nimport { getDefaultKeyConfig, UserEnv } from \"./userEnv\"\r\nimport { BackingState } from \"./backingState\"\r\n\r\n\r\nexport type Store = {\r\n    userEnv: UserEnv;\r\n    systemState: SystemState;\r\n    scoreState: ScoreState;\r\n    backingState: null | BackingState;\r\n    melodyState: MelodyState;\r\n    scoreData: ScoreData;\r\n    instruments: Instruments;\r\n    refs: RefsCache;\r\n    reserveTasks: NodeJS.Timeout[];\r\n}\r\n\r\nexport const initialStore: Store = {\r\n    userEnv: {\r\n        keyConfig: getDefaultKeyConfig(),\r\n        colorProps: themaColorNormal,\r\n    },\r\n    systemState: {\r\n        isSplash: true,\r\n        mainChannelIndex: 0,\r\n        scoreTabIndex: 0,\r\n        dialogMode: 'none'\r\n    },\r\n    backingState: null,\r\n    scoreState: {\r\n        isTune: false,\r\n        initialBeat: 4,\r\n        focusIndex: -1,\r\n        elementCacheList: [],\r\n        sectionCacheList: [],\r\n        keySwitch: {\r\n            editMode: false,\r\n            symbolMode: false\r\n        },\r\n        symbolMng: null,\r\n        hideMenu: 'none',\r\n    },\r\n    melodyState: {\r\n        focusIndex: -1,\r\n        lastFocus: -1,\r\n        quantize: 4,\r\n        beatWidth: 120,\r\n        mouseState: {\r\n            isPut: false,\r\n            lock: { x: 0, y: 0 },\r\n            width: 0,\r\n            prevRight: 0,\r\n            nextLeft: 0,\r\n            notesState: { index: -1, side: 'normal', isResize: false, isMove: false },\r\n            curChord: null,\r\n            mousePitchIndex: 0,\r\n            mouseMeasurePos: 0\r\n        },\r\n        soundfontInfo: {\r\n            name: 'violin',\r\n            gain: 5\r\n        },\r\n        keySwitch: {\r\n            scaleMode: false,\r\n            octave: false,\r\n            resize: false,\r\n            move: false\r\n        },\r\n        isPreview: false\r\n    },\r\n    scoreData: {\r\n        chordList: [],\r\n        notesList: []\r\n    },\r\n    instruments: {\r\n        sampler: getDefaultSampler(),\r\n        soundfontPlayer: null\r\n    },\r\n\r\n    refs: {\r\n        harmonize: {\r\n            note: {} as HTMLDivElement\r\n        },\r\n        melody: {\r\n            table: null,\r\n            measure: null,\r\n            chord: null,\r\n            pitch: null,\r\n        }\r\n    },\r\n    reserveTasks: []\r\n}","import { ColorProps } from \"../../base/design/colorProps\";\r\n\r\nexport type UserEnv = {\r\n    keyConfig: KeyConfig;\r\n    colorProps: ColorProps;\r\n}\r\n\r\nexport type KeyConfig = {\r\n    note : {\r\n        prevElement: string;\r\n        nextElement: string;\r\n        prevSection: string;\r\n        nextSection: string;\r\n        addChord: string;\r\n        addSection: string;\r\n        addChange: string;\r\n        deleteCur: string;\r\n        editMode: string;\r\n        incRoot: string;\r\n        decRoot: string;\r\n        incBeat: string;\r\n        decBeat: string;\r\n        symbolMode: string;\r\n    }\r\n}\r\n\r\nexport const getDefaultKeyConfig = ()=> {\r\n    return {\r\n        note: {\r\n            prevElement: 'ArrowLeft',\r\n            nextElement: 'ArrowRight',\r\n            prevSection: 'ArrowUp',\r\n            nextSection: 'ArrowDown',\r\n            addChord: 'a',\r\n            addSection: 's',\r\n            addChange: 'f',\r\n            deleteCur: 'Delete',\r\n            editMode: 'Shift',\r\n            incRoot: 'ArrowUp',\r\n            decRoot: 'ArrowDown',\r\n            incBeat: 'ArrowRight',\r\n            decBeat: 'ArrowLeft',\r\n            symbolMode: 'c',\r\n        }\r\n    } as KeyConfig;\r\n}","import { ColorProps } from \"../colorProps\";\r\n\r\nexport const themaColorNormal: ColorProps = {\r\n    entryBackground: '#e2a9ae',\r\n}","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst SysModalDialog = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const mode = store.systemState.dialogMode;\r\n    const isDisplay = mode !== 'none';\r\n\r\n    return (\r\n        <_Blind isDisplay={isDisplay}>\r\n            <_Frame>\r\n\r\n            </_Frame>\r\n        </_Blind>\r\n    );\r\n}\r\n\r\nexport default SysModalDialog;\r\n\r\nconst _Blind = styled.div<{\r\n    isDisplay: boolean;\r\n}>`\r\n    display: ${props => props.isDisplay ? 'block' : 'none'};\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #000000d8;\r\n    z-index: 10;\r\n`;\r\nconst _Frame = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: 50px;\r\n    top: 50px;\r\n    width: 500px;\r\n    height: 400px;\r\n    background-color: #464646cc;\r\n    border: 1px solid #dadada;\r\n`;","import { useEffect, useState } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\ntype ChannelPaneProps = {\r\n    activeNo: number;\r\n    tabElements: ChannelElements[];\r\n    selectTabIndex?: Function;\r\n}\r\n\r\ntype ChannelElements = {\r\n    name: string;\r\n    icon: JSX.Element;\r\n    disable: boolean;\r\n    cont: JSX.Element;\r\n}\r\n\r\nexport const ChannelPane = (props: ChannelPaneProps) => {\r\n    const [activeNo, setActiveNo] = useState(props.activeNo);\r\n\r\n    // \r\n    const selectTabIndex = (index: number) => {\r\n        if (props.selectTabIndex != undefined) {\r\n            props.selectTabIndex(index);\r\n        } else {\r\n            setActiveNo(index);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setActiveNo(props.activeNo);\r\n    }, [props.activeNo]);\r\n\r\n    return (\r\n        <>\r\n            <_LabelList>\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <ChannelLabel\r\n                            key={index} name={tab.name} icon={tab.icon} isActive={index == activeNo} isDisable={tab.disable}\r\n                            selectTab={() => selectTabIndex(index)}\r\n                        />\r\n                    })\r\n                }\r\n            </_LabelList>\r\n            <_ContList>\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <ChannelContents key={index} cont={tab.cont} isActive={index === activeNo} />\r\n                    })\r\n                }\r\n            </_ContList>\r\n        </>\r\n    );\r\n}\r\n\r\nconst ChannelLabel = (props: {\r\n    name: string;\r\n    icon: JSX.Element;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    selectTab: Function;\r\n}) => {\r\n    return (\r\n        <_Item\r\n            isActive={props.isActive}\r\n            onClick={() => props.selectTab()}\r\n        >\r\n            <_Icon>{props.icon}</_Icon>\r\n            <_Label>{props.name}</_Label>\r\n        </_Item>\r\n    );\r\n}\r\n\r\nconst ChannelContents = (props: {\r\n    isActive: boolean;\r\n    cont: JSX.Element;\r\n}) => {\r\n    return (\r\n        <_Contents isActive={props.isActive}>\r\n            {props.cont}\r\n        </_Contents>\r\n    );\r\n}\r\n\r\nconst _LabelList = styled.div`\r\n    display: inline-block;\r\n    width: 100px;\r\n    margin-right: 5px;\r\n    height: 100%;\r\n    background-color: #b9b9b9;\r\n    border: 1px solid #707070;\r\n    box-sizing: border-box;\r\n    border-radius: 10px 0 0 10px;\r\n    vertical-align: top;\r\n    box-shadow: 1px 2px 12px #aaaaaa;\r\n`;\r\nconst _ContList = styled.div`\r\n    display: inline-block;\r\n    background-color: #b9b9b9;\r\n    border: 1px solid #707070;\r\n    box-sizing: border-box;\r\n    width: calc(100% - 105px);\r\n    height: 100%;\r\n    border-radius: 0 6px 6px 0;\r\n    box-shadow: 1px 2px 12px #aaaaaa;\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    /* margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px); */\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: #ece6e6; */\r\n    ${props => !props.isActive ? css`display: none;` : css`display: inline-block;`}\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 90px;\r\n    height: 90px;\r\n    margin: 5px 0 0 5px;\r\n    border-radius: 10px;\r\n    ${props => {\r\n        if (props.isActive) {\r\n            return css`\r\n                background-color: #e4e3e1;\r\n                border: 1px solid #949494\r\n            `;\r\n        } else {\r\n            return css`\r\n                background-color: #d1d1d1;\r\n                opacity: 0.8;\r\n            `;\r\n        }\r\n    }}\r\n    transition: background-color 500ms;\r\n    & *{\r\n        transition: color 150ms;\r\n    }\r\n    // hover\r\n    ${props => props.isActive ? '' : css`\r\n        &:hover {\r\n            & *{\r\n                transition: color 150ms;\r\n                /* background-color: #e2d6d6; */\r\n                text-shadow: 1px 2px 22px #f7f7f7ea;\r\n                color: #a7a7a7;\r\n            }\r\n        }\r\n    `}\r\n`;\r\n\r\nconst IconHover = css`\r\n    text-shadow: 1px 2px 22px #f7f7f7cf;\r\n    color: #a3a3a3;\r\n`;\r\n\r\nconst _Icon = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 60px;\r\n    /* background-color: #df828221; */\r\n    font-size: 50px;\r\n    color: #757575;\r\n    text-align: center;\r\n    padding-top: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    /* background-color: #8482df20; */\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    color: #757575;\r\n    text-align: center;\r\n`;","import { useEffect, useState } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\n\r\ntype TabbedPaneProps = {\r\n    activeNo: number;\r\n    tabElements: TabElements[];\r\n    selectTabIndex?: Function;\r\n}\r\n\r\ntype TabElements = {\r\n    name: string;\r\n    disable: boolean;\r\n    cont: JSX.Element;\r\n}\r\n\r\nexport const TabbedPane = (props: TabbedPaneProps) => {\r\n    const [activeNo, setActiveNo] = useState(props.activeNo);\r\n\r\n    // \r\n    const selectTabIndex = (index: number) => {\r\n        if (props.selectTabIndex != undefined) {\r\n            props.selectTabIndex(index);\r\n        } else {\r\n            setActiveNo(index);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        setActiveNo(props.activeNo);\r\n    }, [props.activeNo]);\r\n\r\n    return (\r\n        <>\r\n            <_LabelList>\r\n                {/* {tabList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabLabel\r\n                            key={index} name={tab.name} isActive={index == activeNo} isDisable={tab.disable}\r\n                            selectTab={() => selectTabIndex(index)}\r\n                        />\r\n                    })\r\n                }\r\n            </_LabelList>\r\n            <_ContList>\r\n                {/* {contList} */}\r\n                {\r\n                    props.tabElements.map((tab, index) => {\r\n                        return <TabContents key={index} cont={tab.cont} isActive={index === activeNo} />\r\n                    })\r\n                }\r\n            </_ContList>\r\n        </>\r\n    );\r\n}\r\n\r\nconst TabLabel = (props: {\r\n    name: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    selectTab: Function;\r\n}) => {\r\n    return (\r\n        <_TabLabel\r\n            isDisable={props.isDisable}\r\n            isActive={props.isActive}\r\n            onClick={() => props.selectTab()}>\r\n            {props.name}\r\n        </_TabLabel>\r\n    );\r\n}\r\n\r\nconst TabContents = (props: {\r\n    isActive: boolean;\r\n    cont: JSX.Element;\r\n}) => {\r\n    // return props.isActive ?\r\n    //     <div className=\"tab-cont\">{props.cont}</div>\r\n    //     :\r\n    //     <></>\r\n    //     ;\r\n    return (\r\n        <_Contents isActive={props.isActive}>\r\n            {props.cont}\r\n        </_Contents>\r\n    );\r\n}\r\n\r\nconst _LabelList = styled.div`\r\n    display: inline-block;\r\n    height: 35px;\r\n`;\r\nconst _ContList = styled.div`\r\n    display: block;\r\n    background-color: #999999;\r\n    height: calc(100% - 35px);\r\n    border-radius: 0 6px 6px 6px;\r\n    box-shadow: 0 2px 0 0 #000b3a48;\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px);\r\n    ${props => !props.isActive ? css`display: none;` : css`display: inline-block;`}\r\n`;\r\n\r\nconst _TabLabel = styled.div<{\r\n    isDisable: boolean;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    /* width: 100px; */\r\n    padding: 0 10px;\r\n    ${props => {\r\n        if (props.isActive) {\r\n            return css`\r\n                color: #ebebeb;\r\n                padding: 0 35px;\r\n                background-color: #999999;\r\n                height: 35px;\r\n                font-size: 24px;\r\n                border-radius: 3px 15px 0 0;\r\n                text-shadow: 1px 2px 3px #00000065;\r\n            `;\r\n        } else {\r\n            return css`\r\n                height: 100%;\r\n                color: #555;\r\n                /* background-color: #90909b; */\r\n                background: linear-gradient(to bottom, #999999, #7a7a7a);\r\n                height: 30px;\r\n                font-size: 18px;\r\n                border-radius: 3px 10px 0 0;\r\n                ${!props.isDisable ? '' : css`\r\n                    pointer-events: none;\r\n                    opacity: 0.7;\r\n                `}\r\n            `;\r\n        }\r\n    }}\r\n    /* opacity: 0.7; */\r\n    user-select: none;\r\n    margin-right: 6px;\r\n    font-weight: 600;\r\n    box-sizing: border-box;\r\n    line-height: 30px;\r\n    vertical-align: bottom;\r\n    transition: padding 100ms;\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../base/components/button/executableButton\";\r\nimport { ChordBacking, DetailChord, DetailFixed, DetailInit, DetailSection, ScoreData } from \"../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\n\r\nconst ManageTab = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Link onClick={() => {\r\n\r\n                const data: ScoreData = {\r\n                    chordList: [\r\n                        { type: 'init', detail: { keyIndex: 0, bpm: 100, scale: 'major', timeSignature: '4/4' } as DetailInit },\r\n                        { type: 'fixed', detail: { fixed: 'Start' } as DetailFixed },\r\n                        { type: 'section', detail: { labelName: 'Section' } as DetailSection },\r\n                        {\r\n                            type: 'chord', detail: {\r\n                                beatLen: 4, minute: { head: 0, tail: 0 }, root: null, on: null, symbolKey: 'major',\r\n                                backing: {\r\n                                    voicingList: [],\r\n                                    pattern: null\r\n                                }\r\n                            } as DetailChord\r\n                        },\r\n                        { type: 'fixed', detail: { fixed: 'End' } as DetailFixed },\r\n                    ],\r\n                    notesList: []\r\n                };\r\n                dispatcher.score.setScoreData(data);\r\n                store.scoreState.focusIndex = 2;\r\n                dispatcher.score.setScoreState({ ...store.scoreState });\r\n\r\n                dispatcher.score.setScoreTabIndex(1);\r\n                // dispatcher.score.setScoreTabIndex(2);\r\n            }} >Create blank score.</_Link>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ManageTab;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #7e7e7e;\r\n    text-align: left;\r\n`;\r\n\r\nconst _Link = styled.div`\r\n    \r\n    display: inline-block;\r\n    width: calc(100% - 50px);\r\n    height: 80px;\r\n    margin: 20px 25px;\r\n    border: 2px solid #a8a8a8;\r\n    /* background: linear-gradient(to bottom, #585858, #a7a7a7, #585858); */\r\n    background-color: #000;\r\n    color: #ccc;\r\n    font-size: 50px;\r\n    font-weight: 600;\r\n    text-align: left;\r\n    box-sizing: border-box;\r\n    padding-left: 20px;\r\n    border-radius: 10px;\r\n\r\n    &:hover {\r\n        background-color: #5b5e33;\r\n    }\r\n`;","import styled, { css } from \"styled-components\";\r\n\r\nexport const _WrapperFrame = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n`;\r\n\r\nexport const _Object = styled.div`\r\n    display: inline-block;\r\n`;\r\n\r\nexport const _Record = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n`;\r\n\r\nexport const _CSS_LABEL_SMALL = styled.div`\r\n    display: inline-block;\r\n    height: 30px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: black;\r\n    line-height: 18px;\r\n`;\r\n\r\n\r\nexport const _CSS_LABEL_MIDIUM = styled.div`\r\n    display: inline-block;\r\n    height: 30px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: black;\r\n    line-height: 18px;\r\n`;\r\n\r\nexport const _CSS_DISABLE = css`\r\n    opacity: 0.7;\r\n    pointer-events: none;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../contents/entry/systemEntry\";\r\nimport { BUTTON_LARGE_HEIGHT, BUTTON_MIDIUM_HEIGHT, BUTTON_SMALL_HEIGHT } from \"../../../utils/systemConst\";\r\nimport { _Object } from \"../../design/styles\";\r\n\r\nexport type ButtonSize = 'small' | 'midium' | 'large';\r\n\r\nexport interface ExecutableButtonProps {\r\n    labelText: JSX.Element;\r\n    size: ButtonSize;\r\n    width: number;\r\n    callback?: ()=>void;\r\n}\r\n\r\nexport const ExecutableButton = (props: ExecutableButtonProps) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const get = () => {\r\n        switch(props.size) {\r\n            case \"small\": return [BUTTON_SMALL_HEIGHT, 18];\r\n            case \"midium\": return [BUTTON_MIDIUM_HEIGHT, 18];\r\n            case \"large\": return [BUTTON_LARGE_HEIGHT, 18];\r\n        }\r\n    };\r\n    const [height, fontSize] = get();\r\n\r\n    return (\r\n        <_Wrap\r\n            width={props.width} height={height}\r\n            fontSize={fontSize}\r\n            backgroundColor={store.userEnv.colorProps.entryBackground}\r\n            onClick={props.callback}\r\n        >\r\n            {props.labelText}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nconst _Wrap = styled(_Object) <{\r\n    width: number;\r\n    height: number;\r\n    fontSize: number;\r\n    backgroundColor: string;\r\n}>`\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    ${props => {\r\n        if (props.width === 0) {\r\n            return css`\r\n                padding-left: 10px;\r\n                padding-right: 10px;\r\n            `;\r\n        } else {\r\n        }\r\n            return css`width: ${props.width}px`;\r\n    }};\r\n    height: ${props => props.height}px;\r\n    /* background-color: ${props => props.backgroundColor}; */\r\n    background: linear-gradient(to bottom, #e0e0e0, #aaaaaa, #e0e0e0);\r\n    color: #5d6e63;\r\n    border-radius: 2px;\r\n    border: solid 1px #747373;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    /* box-shadow: 2px 2px 2px 2px #000b3a1a; */\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n    &:hover {\r\n        background: linear-gradient(to bottom, #f5efef, #c7afaf, #f5efef);\r\n    }\r\n`;","import { useContext, useEffect, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { SymbolDiagram } from \"../../../../../redux/store/scoreState\";\r\nimport { getSymbolDerives as getSymbolDerives, getSymbolFromKey, SymbolKey, SymbolParams, SYMBOL_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SymbolEditor = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const detail = store.scoreData.chordList[state.focusIndex].detail as DetailChord;\r\n\r\n    // \r\n    useEffect(() => {\r\n\r\n        const curSymbol = getSymbolFromKey(detail.symbolKey) as SymbolParams;\r\n        const baseSymbol = curSymbol.base == null ? null : getSymbolFromKey(curSymbol.base);\r\n\r\n        const curLine: SymbolKey[] = [];\r\n        const parentLine: SymbolKey[] = [];\r\n        const childrenLine: SymbolKey[] = [];\r\n        let index = 0;\r\n\r\n        if (baseSymbol == null) {\r\n            curLine.push('major');\r\n            curLine.push('minor');\r\n            curLine.push('suspend4th');\r\n            curLine.push('diminish');\r\n            curLine.push('augument');\r\n            curLine.push('minor-minus5');\r\n        } else {\r\n            SYMBOL_LIST.forEach((symbol) => {\r\n                if (symbol.key === baseSymbol.key) {\r\n                    parentLine.push(symbol.key);\r\n                }\r\n            });\r\n            const derives = getSymbolDerives(baseSymbol.key);\r\n            SYMBOL_LIST.forEach((symbol) => {\r\n                if (derives.includes(symbol.key)) {\r\n                    curLine.push(symbol.key);\r\n                }\r\n            });\r\n        }\r\n        curLine.forEach((symbol, i)=> {\r\n            if(symbol === detail.symbolKey) {\r\n                index = i;\r\n            }\r\n        });\r\n        const derives = getSymbolDerives(curSymbol.key);\r\n        SYMBOL_LIST.forEach((symbol) => {\r\n            if (derives.includes(symbol.key)) {\r\n                childrenLine.push(symbol.key);\r\n            }\r\n        });\r\n        state.symbolMng = {\r\n            index,\r\n            curLine,\r\n            parentLine,\r\n            childrenLine\r\n        };\r\n        dispatcher.score.setScoreState(state);\r\n    }, [detail.symbolKey]);\r\n\r\n    // const bodyRef = state.elementCacheList[state.focusIndex].reffers.wrap as HTMLDivElement;\r\n\r\n    // const [posX, posY]: [number, number] = useMemo(() => {\r\n    //     return [bodyRef.clientLeft, bodyRef.clientTop + bodyRef.clientHeight];\r\n    // }, []);\r\n    // const posX = bodyRef.getBoundingClientRect().left;\r\n    // const posY = bodyRef.getBoundingClientRect().bottom;\r\n    // alert(`${posX}, ${posY}`);\r\n\r\n    const symbolMng = state.symbolMng as SymbolDiagram;\r\n\r\n    const parentJsx: JSX.Element[] = [];\r\n    const curJsx: JSX.Element[] = [];\r\n    const childrenJsx: JSX.Element[] = [];\r\n\r\n    if (symbolMng != null) {\r\n        parentJsx.push(<_Header key={parentJsx.length}>Base</_Header>);\r\n        symbolMng.parentLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            parentJsx.push(\r\n                <_Item key={parentJsx.length}\r\n                    isActive={false}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n        curJsx.push(<_Header key={curJsx.length}>Current</_Header>);\r\n        symbolMng.curLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            curJsx.push(\r\n                <_Item key={curJsx.length}\r\n                    isActive={symbolMng.index === i}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n        childrenJsx.push(<_Header key={childrenJsx.length}>Derives</_Header>);\r\n        symbolMng.childrenLine.forEach((item, i) => {\r\n            const symbol = getSymbolFromKey(item);\r\n            childrenJsx.push(\r\n                <_Item key={childrenJsx.length}\r\n                    isActive={false}\r\n                >[{symbol?.name}]</_Item>\r\n            );\r\n        });\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Row>{parentJsx}</_Row>\r\n            <_Row>{curJsx}</_Row>\r\n            <_Row>{childrenJsx}</_Row>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SymbolEditor;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 30;\r\n    top: 100px;\r\n    left: 0;\r\n    width: 250px;\r\n    height: 160px;\r\n    background-color: #a9cfd422;\r\n    border: 2px solid #000000ec;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    opacity: 0.9;\r\n    box-shadow: 0 4px 16px 4px #000b3a48;\r\n    backdrop-filter: blur(6px);\r\n`;\r\n\r\nconst _Row = styled.div`\r\n    display: inline-block;\r\n    width: 80px;\r\n    height: 100%;\r\n    /* background-color: #e6e6e6; */\r\n    margin: 1px;\r\n    vertical-align: top;\r\n`;\r\n\r\n\r\nconst _Header = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    box-sizing: border-box;\r\n    /* background-color: #78dab4;\r\n    border: 1px solid #000000; */\r\n    background: linear-gradient(to bottom, #7a9ea3, #78cfda, #7a9ea3);\r\n    /* background: linear-gradient(to bottom, #a37a7a, #da7878, #a37a7a); */\r\n    margin: 1px;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #f3f3f3;\r\n    line-height: 17px;\r\n`;\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: 20px;\r\n    box-sizing: border-box;\r\n    background-color: #dbdbdb;\r\n    ${props => !props.isActive ? '' : css`background-color: #ffef64;`}\r\n    border: 1px solid #000000;\r\n    margin: 1px;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #000000;\r\n    line-height: 16px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../../redux/store/scoreData\";\r\nimport { ElementCache } from \"../../../../../../redux/store/scoreState\";\r\nimport { getChordRoot, getDegreeRoot, getSymbolFromKey } from \"../../../../../../utils/theoryUtils\";\r\nimport { ELEMENT_POS_INFO_WIDTH, FIRST_CHORD_INDEX } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcChord = (props: {\r\n    index: number;\r\n    detail: DetailChord;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const chordList = store.scoreData.chordList;\r\n    const element = chordList[props.index];\r\n    const cache = state.elementCacheList[props.index];\r\n\r\n    const symbolName = getSymbolFromKey(props.detail.symbolKey)?.name;\r\n\r\n    let degreeRoot: null | string = null;\r\n    let degreeOn: null | string = null;\r\n    let chordRoot: null | string = null;\r\n    let chordOn: null | string = null;\r\n    if (props.detail.root != null) {\r\n        degreeRoot = getDegreeRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        });\r\n        chordRoot = getChordRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        }, cache.keyIndex);\r\n\r\n        if (props.detail.on != null) {\r\n            degreeOn = getDegreeRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.on.isFlat\r\n            });\r\n            chordOn = getChordRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.root.isFlat\r\n            }, cache.keyIndex);\r\n        }\r\n    }\r\n\r\n    let bar = -1;\r\n    const prevCache = state.elementCacheList[props.index - 1];\r\n    // \r\n    // 1\r\n    if (props.index === FIRST_CHORD_INDEX || prevCache.bar !== cache.bar) {\r\n        bar = cache.bar + 1;\r\n    }\r\n    const isError = bar !== -1 && cache.beat !== 0;\r\n\r\n    let chordName = '-';\r\n    if (chordRoot != null) {\r\n        chordName = `${chordRoot}${symbolName}`;\r\n    }\r\n\r\n    return (\r\n        <_Detail>\r\n            <_Chord>{chordName}</_Chord>\r\n            {/* <_Backing>\r\n            </_Backing> */}\r\n            <_Pos>\r\n                <_Section\r\n                    isError={isError}\r\n                >\r\n                    {bar === -1 ? <>&nbsp;</> : bar}\r\n                </_Section>\r\n                <_Beat>\r\n                    <span>\r\n                        {cache.beat === 0 ? <>&nbsp;</> : cache.beat}\r\n                        {/* {` (+0.25)`} */}\r\n                    </span>\r\n                    {cache.minute === 0 ? '' : ` (${cache.minute})`}\r\n                </_Beat>\r\n                <_PastSecond>\r\n                    {Math.round(cache.pastSecond / 100) / 10}s\r\n                </_PastSecond>\r\n            </_Pos>\r\n        </_Detail>\r\n    );\r\n}\r\n\r\nexport default CalcChord;\r\n\r\n\r\n\r\nconst _Section = styled.div<{\r\n    isError: boolean;\r\n}>`\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #c72929;\r\n    ${props => !props.isError ? '' : css`\r\n        background-color: #ee5959;\r\n        color: #ffffff;\r\n        /* border: 2px solid #c72929; */\r\n        border-radius: 2px;\r\n    `}\r\n    box-sizing: border-box;\r\n`;\r\nconst _PastSecond = styled.div`\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #000000a0;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Beat = styled.div``;\r\n\r\nconst _Detail = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    // background-color: #00ff2a11;\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    // width: calc(100% - ${ELEMENT_POS_INFO_WIDTH + 10}px);\r\n    width: 100%;\r\n    height: 18px;\r\n    // background-color: #ffc4001c;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #2b2b2b;\r\n`;\r\n\r\nconst _Backing = styled.div`\r\n    display: inline-block;\r\n    width: 56px;\r\n    height: 30px;\r\n    background-color: #1100ff1c;\r\n`;\r\n\r\nconst _Pos = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 5;\r\n    width: ${ELEMENT_POS_INFO_WIDTH}px;\r\n    height: 100%;\r\n    // background-color: #0000ff11;\r\n    top: 0;\r\n    left: -${ELEMENT_POS_INFO_WIDTH / 2}px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    \r\n    & ${_Section} {\r\n    }\r\n    & ${_Beat} {\r\n        font-size: 12px;\r\n        color: #333;\r\n        & span {\r\n            color: #00a;\r\n            font-weight: 600;\r\n        }\r\n    }\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ELEMENT_POS_INFO_WIDTH } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcSection = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sectionNo = state.elementCacheList[props.index].sectionNo;\r\n    const curSection = state.sectionCacheList[sectionNo];\r\n\r\n    const barSum = Math.floor(curSection.beatSum / 4);\r\n    const barRem = curSection.beatSum % 4;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Len>{barSum}{barRem === 0 ? '' : ` (${barRem})`}</_Len>\r\n            <_Border />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default CalcSection;\r\n\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    /* background-color: #ff000011; */\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Len = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    /* min-width: 80px; */\r\n    height: 16px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #474386cf;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    /* background-color: #00000042; */\r\n`;\r\n\r\nconst _Border = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 8px;\r\n    height: calc(100% - 16px);\r\n    background-color: #db0000cf;\r\n    border-radius: 4px 4px 0 0;\r\n`;\r\n","import styled from \"styled-components\";\r\nimport { DetailChange } from \"../../../../../../redux/store/scoreData\";\r\n\r\nconst ElementDetailChange = (props: {\r\n    detail: DetailChange;\r\n}) => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Type>\r\n                Modulation\r\n            </_Type>\r\n            <_Detail>\r\n                Domm+1\r\n            </_Detail>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailChange;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: red; */\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    min-width: 100px;\r\n    height: 20px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    line-height: 20px;\r\n    /* background-color: #1000eb42; */\r\n    margin-top: 3px;\r\n`;\r\n\r\nconst _Type = styled(_Label)`\r\n    color: #0014cc;\r\n`;\r\n\r\nconst _Detail = styled(_Label)`\r\n    color: #5e5e5e;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../../redux/store/scoreData\";\r\nimport { DIATONIC_MAJOR_SCALE_DEGREE_NAMES, getChordRoot, getDegreeRoot, getSymbolFromKey, ScaleRelation } from \"../../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\ntype TipLenType = 'short' | 'normal' | 'long';\r\ntype TipValueType = 0 | 0.5 | 0.25;\r\n\r\nconst ElementDetailChord = (props: {\r\n    detail: DetailChord;\r\n    isCurrent: boolean;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n\r\n    const minute = props.detail.minute;\r\n\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    let degreeRoot: null | string = null;\r\n    let degreeOn: null | string = null;\r\n    let chordRoot: null | string = null;\r\n    let chordOn: null | string = null;\r\n    if (props.detail.root != null) {\r\n        degreeRoot = getDegreeRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        });\r\n        chordRoot = getChordRoot({\r\n            index: props.detail.root.index,\r\n            isFlat: props.detail.root.isFlat\r\n        }, cache.keyIndex);\r\n\r\n        if (props.detail.on != null) {\r\n            degreeOn = getDegreeRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.on.isFlat\r\n            });\r\n            chordOn = getChordRoot({\r\n                index: props.detail.on.index,\r\n                isFlat: props.detail.root.isFlat\r\n            }, cache.keyIndex);\r\n        }\r\n    }\r\n\r\n    const symbolName = getSymbolFromKey(props.detail.symbolKey)?.name;\r\n    return useMemo(() =>\r\n        <_Wrap>\r\n            <_Degree\r\n                isSwitch={keySwitch.editMode && props.isCurrent}\r\n                scaleRelation={degreeRoot != null && DIATONIC_MAJOR_SCALE_DEGREE_NAMES.includes(degreeRoot + symbolName) ? 'diatonic' : 'none'}\r\n                isOnChordScale={props.detail.on != null && [0, 2, 4, 5, 7, 9, 11].includes(props.detail.on.index)}\r\n            >\r\n                {degreeRoot == null ? 'none' : (<>\r\n                    <_DegreeRoot>{degreeRoot}</_DegreeRoot>\r\n                    <_DegreeSymbol>{symbolName}</_DegreeSymbol>\r\n                    <_DegreeOnChord>{degreeOn == null ? '' : `/${degreeOn}`}</_DegreeOnChord>\r\n                </>)}\r\n            </_Degree>\r\n            {/* <_Chord>\r\n                {chordRoot == null ? '-' : (<>\r\n                    {chordRoot}{symbolName}{chordOn == null ? '' : `/${chordOn}`}\r\n                </>)}\r\n            </_Chord> */}\r\n            <_Tip isSwitch={keySwitch.editMode && props.isCurrent}>\r\n                {(() => {\r\n                    const jsxList: JSX.Element[] = [];\r\n                    for (let i = 0; i < props.detail.beatLen; i++) {\r\n                        let lenType: TipLenType = 'normal';\r\n                        let valueType: TipValueType = 0;\r\n                        if ([0, props.detail.beatLen - 1].includes(i)) {\r\n                            const target = i === 0 ? minute.head : minute.tail;\r\n                            if (target !== 0) {\r\n                                lenType = target > 0 ? 'long' : 'short';\r\n                                valueType = Math.abs(target) as TipValueType;\r\n                            }\r\n                        }\r\n                        jsxList.push(\r\n                            <_TipItem\r\n                                key={i}\r\n                                lenType={lenType}\r\n                                valueType={valueType}\r\n                            />\r\n                        );\r\n                    }\r\n                    return jsxList;\r\n                })()}\r\n            </_Tip>\r\n        </_Wrap>\r\n        , [\r\n            props.isCurrent, props.detail.beatLen, props.detail.root?.index,\r\n            props.detail.on?.index,\r\n            props.detail.symbolKey,\r\n            state.keySwitch.editMode,\r\n            cache.keyIndex,\r\n            props.detail.minute.head,\r\n            props.detail.minute.tail\r\n        ]);\r\n}\r\n\r\nexport default ElementDetailChord;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    /* border: 1px solid #c5c5cc; */\r\n    /* padding: 4px; */\r\n    box-sizing: border-box;\r\n    /* background-color: #00000013; */\r\n`;\r\n\r\n\r\nconst _DegreeRoot = styled.div``;\r\nconst _DegreeSymbol = styled.div``;\r\nconst _DegreeOnChord = styled.div``;\r\nconst _Degree = styled.div<{\r\n    isSwitch: boolean;\r\n    scaleRelation: ScaleRelation;\r\n    isOnChordScale: boolean;\r\n}>`\r\n    display: block;\r\n    /* width: 100%; */\r\n    height: 28px;\r\n    /* background-color: #f700d616; */\r\n    ${props => !props.isSwitch ? '' : css`background-color: #0004f729;`}\r\n    font-size: 20px;\r\n    /* color: #4e516394; */\r\n    text-align: center;\r\n\r\n    & * {\r\n        display: inline-block;\r\n    }\r\n\r\n    & ${_DegreeRoot} {\r\n        color: #4e5163cc;\r\n        ${props =>\r\n        props.scaleRelation === 'diatonic' ? css`color: #4e516394;` :\r\n            props.scaleRelation === 'secondaly' ? css`color: #00116e93;` :\r\n                css`color: #70000093;`\r\n    }\r\n        font-weight: 600;\r\n    }\r\n    & ${_DegreeSymbol} {\r\n        color: #4e5163cc;\r\n        ${props =>\r\n        props.scaleRelation === 'diatonic' ? css`color: #4e516394;` :\r\n            props.scaleRelation === 'secondaly' ? css`color: #00116e93;` :\r\n                css`color: #70000093;`\r\n    }\r\n    }\r\n    & ${_DegreeOnChord} {\r\n        color: #422e3099;\r\n        ${props => props.isOnChordScale ? '' : css`color: #70000093;`}\r\n        font-weight: 600;\r\n    }\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 22px;\r\n    /* background-color: #d37979b2; */\r\n    font-size: 14px;\r\n    /* font-weight: 600; */\r\n    color: #9c5f74;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Tip = styled.div<{\r\n    isSwitch: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    ${props => !props.isSwitch ? '' : css`background-color: #0004f729;`}\r\n    /* background-color: #d8ccccb1; */\r\n    text-align: center;\r\n`;\r\n\r\nconst _TipItem = styled.div<{\r\n    lenType: TipLenType;\r\n    valueType: TipValueType;\r\n}>`\r\n    display: inline-block;\r\n    width: 8px;\r\n    ${props => props.lenType === 'short' ? css`\r\n        width: 4px;\r\n    ` : props.lenType === 'long' ? css`\r\n        width: 12px;\r\n    ` : ''}\r\n    height: calc(100% - 4px);\r\n    margin: 2px 2px 0 2px;\r\n    background-color: #e0e0e088;\r\n    ${props => props.valueType === 0.5 ? css`\r\n        background-color: #db828287;\r\n    ` : props.valueType === 0.25 ? css`\r\n        background-color: #9394dd87;\r\n    ` : ''}\r\n    /* background: linear-gradient(to bottom, #9b9b9bc3, #85858514); */\r\n    border: solid 1px #0000004e;\r\n    /* border-radius: 2px; */\r\n    box-sizing: border-box;\r\n`;","import styled from \"styled-components\";\r\nimport { DetailFixed } from \"../../../../../redux/store/scoreData\";\r\nimport { ELEMENT_HEAD_WIDTH } from \"../../../../../utils/systemConst\";\r\n\r\nconst ElementFixedBorder = (props: {\r\n    detail: DetailFixed;\r\n}) => {\r\n\r\n    const jsxList: JSX.Element[] = [];\r\n    jsxList.push(<_Border key={0} />);\r\n    jsxList.push(<_Label key={1}>{props.detail.fixed}</_Label>);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {props.detail.fixed === 'Start' ? jsxList : jsxList.reverse()}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementFixedBorder;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 80px;\r\n    height: calc(100% - ${ELEMENT_HEAD_WIDTH}px);\r\n    /* border: 1px solid #00000083; */\r\n    background-color: #c2c2c237;\r\n`;\r\n\r\nconst _Border = styled.div`\r\n    display: inline-block;\r\n    width: 10px;\r\n    height: 100%;\r\n    background-color: #d1d1d1;\r\n    vertical-align: middle;\r\n`;\r\n\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 10px);\r\n    height: 48px;\r\n    /* background-color: #47438678; */\r\n    font-size: 26px;\r\n    font-weight: 600;\r\n    font-style: italic;\r\n    line-height: 46px;\r\n    color: #1b003d6f;\r\n    text-align: center;\r\n    vertical-align: middle;\r\n`;\r\n","import styled from \"styled-components\";\r\nimport { DetailInit } from \"../../../../../../redux/store/scoreData\";\r\nimport { KEY12_MAJOR_SCALE_LIST } from \"../../../../../../utils/theoryUtils\";\r\n\r\nconst ElementDetailInit = (props: {\r\n    detail: DetailInit;\r\n}) => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Record>\r\n                <_Title>Scale:</_Title>\r\n                <_Value>{props.detail.scale}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>Key:</_Title>\r\n                <_Value>{KEY12_MAJOR_SCALE_LIST[props.detail.keyIndex]}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>tempo:</_Title>\r\n                <_Value>{props.detail.bpm}</_Value>\r\n            </_Record>\r\n            <_Record>\r\n                <_Title>Rate:</_Title>\r\n                <_Value>{props.detail.timeSignature}</_Value>\r\n            </_Record>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailInit;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100px;\r\n`;\r\n\r\nconst _Record = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100px;\r\n    height: 16px;\r\n    margin: 1px 0;\r\n    /* background-color: #0066ff16; */\r\n    /* border-bottom: 1px solid #000; */\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #2a2a2c;\r\n    line-height: 16px;\r\n`;\r\nconst _Title = styled.div`\r\n    display: inline-block;\r\n    margin: 0 2px;\r\n    width: 50px;\r\n    height: 100%;\r\n    color: #14a800;\r\n    /* background-color: #ff00b329; */\r\n`;\r\nconst _Value = styled.div`\r\n    display: inline-block;\r\n    margin: 0 2px;\r\n    width: 40px;\r\n    height: 100%;\r\n    color: #000000;\r\n    /* background-color: #ff00b329; */\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst ElementDetailSection = (props: {\r\n    index: number;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sectionNo = state.elementCacheList[props.index].sectionNo;\r\n    const curSection = state.sectionCacheList[sectionNo];\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Label>{curSection.labelName}</_Label>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ElementDetailSection;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    position: relative;\r\n    /* width: 100px; */\r\n    text-align: center;\r\n    border: 1px;\r\n    /* border: 1px solid #c5c5cc; */\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    min-width: 80px;\r\n    height: 20px;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #c00;\r\n    text-align: center;\r\n    line-height: 20px;\r\n    /* background-color: #1000eb42; */\r\n    margin-top: 13px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ELEMENT_POS_INFO_WIDTH } from \"../../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../../entry/systemEntry\";\r\n\r\nconst CalcChange = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Type>Key</_Type>\r\n            <_Detail>CAm</_Detail>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default CalcChange;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 4;\r\n    width: 100%;\r\n    height: 50px;\r\n    /* background-color: #ff000011; */\r\n    bottom: 0;\r\n    left: 0;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    /* min-width: 80px; */\r\n    height: 16px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    /* background-color: #00000042; */\r\n`;\r\n\r\nconst _Type = styled(_Label)`\r\n    color: #0b00a8cf;\r\n`;\r\n\r\nconst _Detail = styled(_Label)`\r\n    color: #050505cf;\r\n`;","import { ElementType, useContext, useEffect, useRef } from \"react\";\r\nimport { CgDetailsLess } from \"react-icons/cg\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { TypeElement } from \"typescript\";\r\nimport { DetailChange, DetailChord, DetailFixed, DetailInit, DetailSection, TypeDetail } from \"../../../../../redux/store/scoreData\";\r\nimport { KEY12_SHARP_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { ELEMENT_FOOT_WIDTH, ELEMENT_HEAD_WIDTH, ELEMENT_HEIGHT, ELEMENT_OPERATIONS_WIDTH, ELEMENT_POS_INFO_WIDTH, ELEMENT_SIDE_PADDING, FIRST_CHORD_INDEX } from \"../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport SymbolEditor from \"../input/symbolEditor\";\r\nimport CalcChord from \"./calc/calcChord\";\r\nimport CalcSection from \"./calc/calcSection\";\r\nimport ElementDetailChange from \"./form/elementDetailChange\";\r\nimport ElementDetailChord from \"./form/elementDetailChord\";\r\nimport ElementFixedBorder from \"./elementFixedBorder\";\r\nimport ElementDetailInit from \"./form/elementDetailInit\";\r\nimport ElementDetailSection from \"./form/elementDetailSection\";\r\nimport CalcChange from \"./calc/calcChange\";\r\n\r\nconst ScoreElement = (props: {\r\n    index: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const wrapRef = useRef({} as HTMLDivElement);\r\n    const bodyRef = useRef({} as HTMLDivElement);\r\n\r\n    const state = store.scoreState;\r\n    const isCurrent = state.focusIndex == props.index;\r\n    const chordList = store.scoreData.chordList;\r\n    const element = chordList[props.index];\r\n    const cache = state.elementCacheList[props.index];\r\n\r\n    useEffect(() => {\r\n        cache.reffers.wrap = wrapRef.current;\r\n        cache.reffers.body = bodyRef.current;\r\n        dispatcher.score.setScoreState(state);\r\n    }, [state.elementCacheList.length]);\r\n\r\n    // if (props.index > state.elementCacheList.length - 1) {\r\n    //     return <></>;\r\n    // }\r\n\r\n    const isFocus = state.focusIndex === props.index;\r\n    const isSameSection = state.elementCacheList[state.focusIndex].sectionNo === cache.sectionNo;\r\n\r\n    const chordDetail = element.type !== 'chord' ? null : element.detail as DetailChord;\r\n    return (\r\n        <_Wrap\r\n            ref={wrapRef}\r\n            isSelectable={element.type !== 'fixed'}\r\n            isActive={isFocus}\r\n            isInactive={!isSameSection}\r\n            isChord={element.type === 'chord'}\r\n        >\r\n            <_Head>\r\n                {element.type !== 'chord' ? <></> : (\r\n                    <_CurKey>{KEY12_SHARP_LIST[cache.keyIndex]}</_CurKey>\r\n                )}\r\n            </_Head>\r\n\r\n            {/*  */}\r\n            {['init', 'chord', 'section', 'change'].includes(element.type) ? (\r\n                <_Form\r\n                    ref={bodyRef}\r\n                    isActive={isFocus}\r\n                    isInactive={!isSameSection}\r\n                    type={element.type}\r\n                    isAnytime={['fixed', 'init'].includes(element.type) || state.focusIndex === 0}\r\n                    onClick={() => {\r\n                        if (element.type === 'fixed') {\r\n                            return;\r\n                        }\r\n                        state.focusIndex = props.index;\r\n                        dispatcher.score.setScoreState(state);\r\n                    }}\r\n                >{(() => {\r\n                    switch (element.type) {\r\n                        case 'init': {\r\n                            const detail = element.detail as DetailInit;\r\n                            return (<ElementDetailInit detail={detail} />);\r\n                        }\r\n                        case 'section': {\r\n                            const detail = element.detail as DetailSection;\r\n                            return (<ElementDetailSection index={props.index} />);\r\n                        }\r\n                        case 'chord': {\r\n                            const detail = element.detail as DetailChord;\r\n                            return (<ElementDetailChord detail={detail} isCurrent={isFocus} />);\r\n                        }\r\n                        case 'change': {\r\n                            const detail = element.detail as DetailChange;\r\n                            return (<ElementDetailChange detail={detail} />);\r\n                        }\r\n                    }\r\n                })()}\r\n                </_Form>\r\n            ) : (<ElementFixedBorder detail={element.detail as DetailFixed} />)}\r\n\r\n            {/*  */}\r\n            {\r\n                element.type === 'chord' ? (<CalcChord index={props.index} detail={chordDetail as DetailChord} />) :\r\n                    element.type === 'section' ? (<CalcSection index={props.index} />) :\r\n                        element.type === 'change' ? (<CalcChange index={props.index} />) :\r\n                            <></>\r\n            }\r\n            <>{!(isCurrent && chordDetail != null && chordDetail.root != null && store.scoreState.keySwitch.symbolMode) ? '' :\r\n                <SymbolEditor />\r\n            }</>\r\n            {['fixed', 'init'].includes(element.type) ? <></> : (\r\n                <_Operations>\r\n                    <_OperationItem>-</_OperationItem>\r\n                    <_OperationItem onClick={() => dispatcher.score.addChordElement()}>+</_OperationItem>\r\n                </_Operations>\r\n            )}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ScoreElement;\r\n\r\nconst _NextLine = styled.div`\r\n    display: block;\r\n    width: 1px;\r\n    height: 10px;\r\n    background-color: #ad0c0c;\r\n`;\r\n\r\nconst _Form = styled.div<{\r\n    isActive: boolean;\r\n    isInactive: boolean;\r\n    //\r\n    isAnytime: boolean;\r\n    type: TypeDetail;\r\n}>`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    min-width: 80px;\r\n    height: calc(100% - ${ELEMENT_HEAD_WIDTH + ELEMENT_FOOT_WIDTH}px);\r\n    border: solid 1px #00000049;\r\n    ${props => props.type !== 'section' ? '' : css`\r\n        border: solid 1px #ff000084;\r\n    ` }\r\n    ${props => props.type !== 'init' ? '' : css`\r\n        border: solid 1px #006823a7;\r\n        height: 85px;\r\n    ` }\r\n    ${props => props.type !== 'change' ? '' : css`\r\n        border: solid 1px #1800a1a7;\r\n    ` }\r\n\r\n    opacity: 0.4;\r\n    border-radius: 6px;\r\n    ${props => props.isInactive ? '' : css`\r\n        background-color: #ebebeb84;\r\n        opacity: 1;\r\n    ` }\r\n    ${props => !props.isAnytime ? '' : css`\r\n        opacity: 1;\r\n    ` }\r\n    box-sizing: border-box;\r\n    padding: 4px;\r\n    transition: background-color 100ms;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #d85cce5a;\r\n        box-shadow: 0 0 8px 0 #000b3a48;\r\n    `}\r\n`;\r\n\r\nconst _Operations = styled.div``;\r\nconst _OperationItem = styled.div``;\r\n\r\nconst _Wrap = styled.div<{\r\n    // \r\n    isSelectable: boolean;\r\n    isActive: boolean;\r\n    isInactive: boolean;\r\n    isChord: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    height: ${ELEMENT_HEIGHT}px;\r\n    padding: 0 ${ELEMENT_SIDE_PADDING}px;\r\n    box-sizing: border-box;\r\n    /* margin: 10px 5px 5px 5px; */\r\n    border-bottom: 1px solid #47438678;\r\n    margin-bottom: 4px;\r\n    vertical-align: top;\r\n    /* width: 1px; */\r\n    transition: width 500ms, opacity 300ms;\r\n    /* border: 1px solid #00000015; */\r\n    ${props => props.isInactive || !props.isChord ? '' : css`\r\n        background-color: #e4ecd039;\r\n    `}\r\n\r\n    & ${_Operations} {\r\n        display: none;\r\n        position: absolute;\r\n        z-index: 5;\r\n        width: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n        height: 44px;\r\n        /* background-color: #0000ff11; */\r\n        top: ${35}px;\r\n        right: -${ELEMENT_OPERATIONS_WIDTH / 2}px;\r\n\r\n        /* background-color: #0400d84e; */\r\n        & ${_OperationItem} {\r\n            display: inline-block;\r\n            width: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n            height: ${ELEMENT_OPERATIONS_WIDTH}px;\r\n            background-color: #ebebeb6e;\r\n            border: 1px solid #818181;\r\n            margin: 1px 0;\r\n            font-size: 15px;\r\n            font-weight: 600;\r\n            text-align: center;\r\n            color: #818181;\r\n            box-sizing: border-box;\r\n            line-height: 15px;\r\n\r\n            &:hover {\r\n                background-color: #fffb0b9d\r\n            }\r\n        }\r\n    }\r\n\r\n    &:hover {\r\n        ${props => !props.isSelectable ? '' : css<{\r\n    isActive: boolean;\r\n}>`\r\n            & ${_Form} {\r\n                ${props => props.isActive ? '' : css`background-color: #fffb0018;`}\r\n                opacity: 1;\r\n            }\r\n            & ${_Operations} {\r\n                display: inline-block;\r\n            }\r\n        `}\r\n    }\r\n`;\r\n\r\nconst _CurKey = styled.div``;\r\nconst _Head = styled.div`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    width: 100%;\r\n    height: ${ELEMENT_HEAD_WIDTH}px;\r\n    /* background-color: #eca8813b; */\r\n\r\n    & ${_CurKey} {\r\n        display: inline-block;\r\n        position: absolute;\r\n        top: -2px;\r\n        left: 10px;\r\n        width: 50px;\r\n        font-size: 12px;\r\n        color: #ca0000;\r\n        /* background-color: #fff; */\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ELEMENT_NOTE_PADDING_LEN, ELEMENT_NOTE_PADDING_SID } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport ScoreElement from \"./elements/scoreElement\";\r\nimport SymbolEditor from \"./input/symbolEditor\";\r\n\r\n\r\nconst HarmNote = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const num = store.scoreData.chordList.length;\r\n\r\n    // alert(`num=${num}, cache=${store.scoreState.elementCacheList.length}`);\r\n    const list: JSX.Element[] = [];\r\n    if (store.scoreState.elementCacheList.length === num) {\r\n        for (let i = 0; i < num; i++) {\r\n            list.push(\r\n                <ScoreElement key={i} index={i} />\r\n            );\r\n        };\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            {/* <_Frame> */}\r\n            <_Note>\r\n                {list}\r\n            </_Note>\r\n            <_Note>\r\n            </_Note>\r\n            {/* </_Frame> */}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default HarmNote;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: 4px 0 0 4px;\r\n    width: calc(100% - 8px);\r\n    height: calc(100% - 8px);\r\n    /* background-color: #e7dddd; */\r\n    background-color: #e9e9e9;\r\n    border: 1px solid #b3b3b3;\r\n    border-radius: 2px;\r\n    box-sizing: border-box;\r\n    text-align: left;\r\n    overflow: auto;\r\n    \r\n    &::-webkit-scrollbar {\r\n        width: 10px;\r\n        height: 10px;\r\n    }\r\n    &::-webkit-scrollbar-thumb {\r\n        border-radius: 5px;\r\n        background: #1959A8;\r\n    }\r\n    &::-webkit-scrollbar-track {\r\n        border-radius: 5px;\r\n        box-shadow: 0 0 4px #aaa inset;\r\n    }\r\n`;\r\n\r\nconst _Frame = styled.div`\r\n    transform-origin: top left;\r\n    /* width: 100%;\r\n    height: 100%; */\r\n    transform: scale(1);\r\n`;\r\n\r\nconst _Note = styled.div`\r\n    display: inline-block;\r\n    /* position: relative; */\r\n    padding: ${ELEMENT_NOTE_PADDING_LEN}px ${ELEMENT_NOTE_PADDING_SID}px;\r\n    width: ${891}px;\r\n    height: ${1260}px;\r\n    background-color: #f1f1f1;\r\n    /* overflow: hidden; */\r\n    margin: 10px 0 0 10px;\r\n    box-shadow: 0 0 18px 0 #000b3a48;\r\n`;","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { KeyboardEvent } from \"react\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { playChord } from \"../../../../../utils/instrumentsUtil\";\r\n\r\nexport const NoteBasicInput = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.scoreState;\r\n    const curType = data.chordList[state.focusIndex].type;\r\n    const isElement = curType !== 'init'\r\n\r\n    switch (curType) {\r\n        case 'chord': {\r\n            const hideMode = store.scoreState.hideMenu;\r\n            switch (e.key) {\r\n                case 'z': {\r\n                    const detail = data.chordList[state.focusIndex].detail as DetailChord;\r\n                    playChord(store.instruments.sampler, detail, 100);\r\n                }\r\n                    break;\r\n                case 'e': {\r\n                    dispatcher.score.setDefaultBacking();\r\n                }\r\n                    break;\r\n                case 'b': {\r\n                    dispatcher.backing.openBackingEditor();\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n            break;\r\n    }\r\n    switch (e.key) {\r\n        // \r\n        case config.prevElement: {\r\n            dispatcher.score.moveElement(false);\r\n        }\r\n            break;\r\n        case config.nextElement: {\r\n            dispatcher.score.moveElement(true);\r\n        }\r\n            break;\r\n        // \r\n        case config.prevSection: {\r\n            dispatcher.score.moveSection(false);\r\n        }\r\n            break;\r\n        case config.nextSection: {\r\n            dispatcher.score.moveSection(true);\r\n        }\r\n            break;\r\n        case config.addChord: {\r\n            dispatcher.score.addChordElement();\r\n        }\r\n            break;\r\n        case config.addSection: {\r\n            dispatcher.score.addSectionElement();\r\n        }\r\n            break;\r\n        case 'f': {\r\n            dispatcher.score.addChangeElement();\r\n        }\r\n            break;\r\n        case 'f': {\r\n            dispatcher.score.addChangeElement();\r\n        }\r\n            break;\r\n        case config.deleteCur: {\r\n            dispatcher.score.removeCurElement();\r\n        }\r\n            break;\r\n        case '1':\r\n        case '2':\r\n        case '3':\r\n        case '4':\r\n        case '5':\r\n        case '6':\r\n        case '7': {\r\n            dispatcher.score.setDiatonicChord(Number(e.key) - 1);\r\n        }\r\n            break;\r\n    }\r\n}","import { KeyboardEvent } from \"react\";\r\nimport { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { playChord } from \"../../../../../utils/instrumentsUtil\";\r\nimport { backingEditorInput } from \"./backingEditorInput\";\r\nimport { NoteBasicInput } from \"./noteBasicInput\";\r\n\r\nexport const NoteKeyDown = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.scoreState;\r\n    const curType = data.chordList[state.focusIndex].type;\r\n    const isElement = curType !== 'init'\r\n\r\n    if (store.scoreState.hideMenu === 'none') {\r\n        if (isElement) {\r\n            if (keySwitch.editMode) {\r\n                switch (e.key) {\r\n                    case config.decRoot: {\r\n                        dispatcher.score.incrementDegreeRoot(false);\r\n                    }\r\n                        break;\r\n                    case config.incRoot: {\r\n                        dispatcher.score.incrementDegreeRoot(true);\r\n                    }\r\n                        break;\r\n                    case config.decBeat: {\r\n                        dispatcher.score.incrementBeatLen(false);\r\n                    }\r\n                        break;\r\n                    case config.incBeat: {\r\n                        dispatcher.score.incrementBeatLen(true);\r\n                    }\r\n                        break;\r\n                    case 'A': dispatcher.score.incrementMinuteValRelation(false, -0.25); break;\r\n                    case 'S': dispatcher.score.incrementMinuteValRelation(false, 0.25); break;\r\n                    case 'D': dispatcher.score.incrementMinuteValRelation(true, -0.25); break;\r\n                    case 'F': dispatcher.score.incrementMinuteValRelation(true, 0.25); break;\r\n                }\r\n            } else if (keySwitch.symbolMode) {\r\n                switch (e.key) {\r\n                    case 'ArrowUp': {\r\n                        dispatcher.symbol.toNext(false);\r\n                    }\r\n                        break;\r\n                    case 'ArrowDown': {\r\n                        dispatcher.symbol.toNext(true);\r\n                    }\r\n                        break;\r\n                    case 'ArrowLeft': {\r\n                        dispatcher.symbol.toBase();\r\n                    }\r\n                        break;\r\n                    case 'ArrowRight': {\r\n                        dispatcher.symbol.toDerive();\r\n                    }\r\n                        break;\r\n                }\r\n            } else {\r\n                NoteBasicInput(e, store, dispatcher);\r\n            }\r\n        }\r\n    } else if (store.scoreState.hideMenu === 'backing') {\r\n        backingEditorInput(e, store, dispatcher);\r\n    }\r\n}\r\n\r\n\r\nexport const NoteKeySwitch = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher, isPress: boolean) => {\r\n\r\n    if (store.scoreState.hideMenu === 'none') {\r\n        const config = store.userEnv.keyConfig.note;\r\n        const keySwitch = store.scoreState.keySwitch;\r\n        // alert(e.key);\r\n        // alnfig.nextElement);\r\n        switch (e.key) {\r\n            case config.editMode: {\r\n                keySwitch.editMode = isPress;\r\n                dispatcher.score.setKeySwitch(keySwitch);\r\n            }\r\n                break;\r\n            case config.symbolMode: {\r\n                keySwitch.symbolMode = isPress;\r\n                dispatcher.score.setKeySwitch(keySwitch);\r\n            }\r\n                break;\r\n        }\r\n    }\r\n\r\n    if (isPress) {\r\n        NoteKeyDown(e, store, dispatcher);\r\n    }\r\n}","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { KeyboardEvent } from \"react\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { playChord } from \"../../../../../utils/instrumentsUtil\";\r\n\r\nexport const backingEditorInput = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n    const config = store.userEnv.keyConfig.note;\r\n    const keySwitch = store.scoreState.keySwitch;\r\n    // alert(e.key);\r\n    // alert(config.nextElement);\r\n\r\n    const data = store.scoreData;\r\n    const state = store.backingState;\r\n\r\n    if (state == null) return;\r\n\r\n    const pattern = state.pattern;\r\n\r\n    switch (e.key) {\r\n        case 'b': {\r\n            dispatcher.backing.closeBackingEditor();\r\n        }\r\n            break;\r\n    }\r\n\r\n    if (pattern != null) {\r\n        switch (e.key) {\r\n            case 'ArrowLeft': {\r\n                dispatcher.backing.movePatternColumn(false);\r\n            }\r\n                break;\r\n            case 'ArrowRight': {\r\n                dispatcher.backing.movePatternColumn(true);\r\n            }\r\n                break;\r\n            case 'a': {\r\n                dispatcher.backing.addPatternColumn();\r\n            }\r\n                break;\r\n            case 'w': {\r\n                dispatcher.backing.changeLayer();\r\n            }\r\n                break;\r\n            case '1': {\r\n                dispatcher.backing.setCurrentDivRate(16);\r\n            }\r\n                break;\r\n            case '2': {\r\n                dispatcher.backing.setCurrentDivRate(8);\r\n            }\r\n                break;\r\n            case '3': {\r\n                dispatcher.backing.setCurrentDivRate(4);\r\n            }\r\n                break;\r\n            case '4': {\r\n                dispatcher.backing.setCurrentDivRate(2);\r\n            }\r\n                break;\r\n            case '5': {\r\n                dispatcher.backing.setCurrentDivRate(1);\r\n            }\r\n                break;\r\n            case '.': {\r\n                dispatcher.backing.toggleCurrentDivHalf();\r\n            }\r\n                break;\r\n\r\n        }\r\n    }\r\n}","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { ROOT_ALL, getChordRoot, getDegreeRoot, SYMBOL_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport MinuteForm from \"./minuteForm\";\r\n\r\nconst SideFormChord = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    \r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const detail = cur.detail as DetailChord;\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n\r\n    const beatItemsJsx: JSX.Element[] = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        const isExist = detail.beatLen >= (i + 1);\r\n        beatItemsJsx.push(\r\n            <_BeatItem key={i} isExist={isExist} onClick={() => {\r\n                const data = store.scoreData;\r\n                data.chordList = data.chordList.slice();\r\n                detail.beatLen = (i + 1);\r\n                data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                <span></span>\r\n            </_BeatItem>\r\n        );\r\n    }\r\n\r\n    const rootItemsJsx: JSX.Element[] = [];\r\n    ROOT_ALL.forEach((root, i) => {\r\n        const isRootActive = JSON.stringify(detail.root) === JSON.stringify(root);\r\n        const isOnActive = detail.on != null && JSON.stringify(detail.on) === JSON.stringify(root);\r\n        rootItemsJsx.push(\r\n            <_RootItem key={i}\r\n                isRootActive={isRootActive}\r\n                isOnActive={isOnActive}\r\n                isDiatonic={root != null && [0, 2, 4, 5, 7, 9, 11].includes(root.index)}\r\n                onClick={() => {\r\n                    const data = store.scoreData;\r\n                    // \r\n                    if (isOnActive || root == null) {\r\n                        detail.on = null;\r\n                    }\r\n                    detail.root = root == null ? null : { ...root };\r\n                    data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                    dispatcher.score.setScoreData(data);\r\n                }}\r\n                onContextMenu={() => {\r\n                    const data = store.scoreData;\r\n                    // \r\n                    if (detail.root != null && !isRootActive) {\r\n                        // \r\n                        if (isOnActive) {\r\n                            detail.on = null;\r\n                        } else {\r\n                            detail.on = root == null ? null : { ...root };\r\n                        }\r\n                        data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                        dispatcher.score.setScoreData(data);\r\n                    }\r\n                }}\r\n            >\r\n                {root == null ? '-' : <>\r\n                    {getDegreeRoot(root)} ({getChordRoot(root, cache.keyIndex)})\r\n                </>}\r\n            </_RootItem>\r\n        );\r\n    });\r\n\r\n    const symbolItemsJsx: JSX.Element[] = [];\r\n    SYMBOL_LIST.forEach((symbol, i) => {\r\n        const isActive = detail.root != null && symbol.key === detail.symbolKey;\r\n        symbolItemsJsx.push(\r\n            <_SymbolItem key={i}\r\n                isActive={isActive}\r\n                isDiatonic={true}\r\n                onClick={() => {\r\n                    const data = store.scoreData;\r\n                    detail.symbolKey = symbol.key;\r\n                    data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                    dispatcher.score.setScoreData(data);\r\n                }}\r\n            >\r\n                [{symbol.name}]\r\n            </_SymbolItem>\r\n        );\r\n    });\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Timing>\r\n                <_LabelBeat>{'Beat Length'}</_LabelBeat>\r\n                <_Beat>\r\n                    {beatItemsJsx}\r\n                </_Beat>\r\n                <_Minute>\r\n                    <_LabelMinute>{'Minute Head'}</_LabelMinute>\r\n                    {/* <MinuteForm isHeadAdjust={true} /> */}\r\n                    <_MinuteItem isReverse={true} type=\"range\" step={0.25} min={-0.5} max={0.5}\r\n                        value={detail.minute.head}\r\n                        onChange={(e) => {\r\n                            const data = store.scoreData;\r\n                            data.chordList = data.chordList.slice();\r\n                            detail.minute.head = Number(e.target.value);\r\n                            data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                            dispatcher.score.setScoreData(data);\r\n                        }}\r\n                    />\r\n                    <_LabelMinute>{'Minute Tail'}</_LabelMinute>\r\n                    {/* <MinuteForm isHeadAdjust={false} /> */}\r\n                    <_MinuteItem isReverse={false} type=\"range\" step={0.25} min={-0.5} max={0.5}\r\n                        value={detail.minute.tail}\r\n                        onChange={(e) => {\r\n                            const data = store.scoreData;\r\n                            data.chordList = data.chordList.slice();\r\n                            detail.minute.tail = Number(e.target.value);\r\n                            data.chordList[store.scoreState.focusIndex].detail = detail;\r\n                            dispatcher.score.setScoreData(data);\r\n                        }}\r\n                    />\r\n                </_Minute>\r\n            </_Timing>\r\n            <_Chord>\r\n                <_Root>\r\n                    {rootItemsJsx}\r\n                </_Root>\r\n                <_Symbol\r\n                    isDisable={detail.root == null}\r\n                >\r\n                    {symbolItemsJsx}\r\n                </_Symbol>\r\n            </_Chord>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormChord;\r\n\r\n\r\nconst _LabelBeat = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    /* border: 1px solid #c50000; */\r\n    text-align: center;\r\n`;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #8a8a8a;\r\n`;\r\n\r\nconst _Timing = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100px;\r\n    text-align: left;\r\n    background-color: #9c93b9;\r\n`;\r\n\r\nconst _Beat = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 25px;\r\n    text-align: left;\r\n    background-color: #afafaf;\r\n`;\r\nconst _BeatItem = styled.div<{\r\n    isExist: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 25%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #696969;\r\n\r\n    & span{\r\n        display: inline-block;\r\n        margin: 2px 0 0 2px;\r\n        width: calc(100% - 4px);\r\n        height: calc(100% - 4px);\r\n        background-color: #9b8585;\r\n        ${props => !props.isExist ? '' : css`\r\n            /* background-color: #ebf37eb7; */\r\n            background: linear-gradient(to bottom, #c5c5c5d2, #f3f3f3d2, #c5c5c5d2);\r\n        `}\r\n    }\r\n`;\r\n\r\nconst _Minute = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 75px;\r\n    text-align: left;\r\n    background-color: #cecece;\r\n`;\r\n\r\nconst _LabelMinute = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    border: 1px solid #222222;\r\n    text-align: center;\r\n`;\r\n// const _Minutetem = styled.div<{\r\n//     isExist: boolean;\r\n// }>`\r\n//     display: inline-block;\r\n//     width: 20%;\r\n//     height: 20px;\r\n//     text-align: left;\r\n//     background-color: #4c3696;\r\n//     font-size: 18px;\r\n//     font-weight: 600;\r\n//     color: #ce0000;\r\n//     line-height: 12px;\r\n//     text-align: center;\r\n\r\n//     & span{\r\n//         display: inline-block;\r\n//         margin: 2px 0 0 2px;\r\n//         width: calc(100% - 4px);\r\n//         height: calc(100% - 4px);\r\n//         background-color: #9b8585;\r\n//         ${props => !props.isExist ? '' : css`\r\n//             /* background-color: #ebf37eb7; */\r\n//             background: linear-gradient(to bottom, #bdb652d2, #fff56cd3, #bdb652d2);\r\n//         `}\r\n//     }\r\n// `;\r\nconst _MinuteItem = styled.input<{\r\n    isReverse: boolean;\r\n}>`\r\n    display: inline-block;\r\n    margin: 0 0 0 5px;\r\n    width: calc(100% - 10px);\r\n    height: 20px;\r\n    color: #3b51d1;\r\n    ${props => !props.isReverse ? '' : css`\r\n        transform: rotateY(180deg);\r\n    `}\r\n`;\r\n\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 360px;\r\n    text-align: left;\r\n    background-color: #78b48c;\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Root = styled.div`\r\n    display: inline-block;\r\n    width: 90px;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #e6e6e6;\r\n`;\r\nconst _RootItem = styled.div<{\r\n    isRootActive: boolean;\r\n    isOnActive: boolean;\r\n    isDiatonic: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #75757575;\r\n    ${props => !props.isRootActive ? '' : css`background-color: #ff6060bd;`}\r\n    ${props => !props.isOnActive ? '' : css`background-color: #6070ffbc;`}\r\n    border: 1px solid #000;\r\n    box-sizing: border-box;\r\n    color: #3030308d;\r\n    ${props => !props.isDiatonic ? '' : css`color: #17007e;`}\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 16px;\r\n    text-align: center;\r\n    & span {\r\n        color: #9e9e9e;\r\n    }\r\n    &:hover {\r\n        background-color: #fffdfd40;\r\n        ${props => !props.isRootActive ? '' : css`background-color: #ff9090bc;`}\r\n        ${props => !props.isOnActive ? '' : css`background-color: #90d3ffbb;`}\r\n    }\r\n`;\r\n\r\nconst _Symbol = styled.div<{\r\n    isDisable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 90px);\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #99e07d;\r\n    ${props => !props.isDisable ? '' : css`\r\n        opacity: 0.3;\r\n        pointer-events: none;\r\n    `}\r\n`;\r\n\r\nconst _SymbolItem = styled.div<{\r\n    isActive: boolean;\r\n    isDiatonic: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    text-align: left;\r\n    background-color: #75757575;\r\n    ${props => !props.isActive ? '' : css`background-color: #ff6060bd;`}\r\n    border: 1px solid #000;\r\n    box-sizing: border-box;\r\n    color: #3030308d;\r\n    ${props => !props.isDiatonic ? '' : css`color: #17007e;`}\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 16px;\r\n    text-align: center;\r\n    & span {\r\n        color: #9e9e9e;\r\n    }\r\n    &:hover {\r\n        background-color: #fffdfd40;\r\n        ${props => !props.isActive ? '' : css`background-color: #ff9090bc;`}\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord, DetailInit, DetailSection, Scale, BeatSignature } from \"../../../../../redux/store/scoreData\";\r\nimport { KEY12_MAJOR_SCALE_LIST, KEY12_MINOR_SCALE_LIST } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SideFormInit = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const data = store.scoreData;\r\n    const detail = data.chordList[0].detail as DetailInit;\r\n\r\n    const scaleItemJsxList: JSX.Element[] = ['major', 'minor'].map((item, i) => {\r\n        return (\r\n            <_ScaleItem key={i} isActive={detail.scale === item} onClick={() => {\r\n                detail.scale = item as Scale;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {item}\r\n            </_ScaleItem>\r\n        )\r\n    });\r\n\r\n    const keyList = detail.scale === 'major' ? KEY12_MAJOR_SCALE_LIST : KEY12_MINOR_SCALE_LIST;\r\n    const keyItemJsxList: JSX.Element[] = keyList.map((item, i) => {\r\n        const scale = detail.scale;\r\n        return (\r\n            <_KeyItem key={i} isActive={detail.keyIndex === i} onClick={() => {\r\n                detail.keyIndex = i;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {`${item} ${scale}`}\r\n            </_KeyItem>\r\n        )\r\n    });\r\n\r\n\r\n    const rateItemJsxList: JSX.Element[] = ['4/4', '3/4'].map((item, i) => {\r\n        return (\r\n            <_RateItem key={i} isActive={detail.timeSignature === item} onClick={() => {\r\n                detail.timeSignature = item as BeatSignature;\r\n                data.chordList = data.chordList.slice();\r\n                dispatcher.score.setScoreData(data);\r\n            }}>\r\n                {item}\r\n            </_RateItem>\r\n        )\r\n    });\r\n\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_LabelTitle>Scale</_LabelTitle>\r\n            <_ScaleWrap>{scaleItemJsxList}</_ScaleWrap>\r\n            <_LabelTitle>Key</_LabelTitle>\r\n            <_KeyWrap>{keyItemJsxList}</_KeyWrap>\r\n            <_LabelTitle>Tempo</_LabelTitle>\r\n            <_TempoWrap>\r\n                <input\r\n                    type=\"number\" min={30} max={220} step={1}\r\n                    value={detail.bpm}\r\n                    onChange={(e) => {\r\n                        detail.bpm = e.currentTarget.valueAsNumber;\r\n                        data.chordList = data.chordList.slice();\r\n                        dispatcher.score.setScoreData(data);\r\n                    }}\r\n                />\r\n                <input\r\n                    type=\"range\" min={30} max={220} step={1}\r\n                    value={detail.bpm}\r\n                    onChange={(e) => {\r\n                        detail.bpm = e.currentTarget.valueAsNumber;\r\n                        data.chordList = data.chordList.slice();\r\n                        dispatcher.score.setScoreData(data);\r\n                    }}\r\n                />\r\n            </_TempoWrap>\r\n            <_LabelTitle>Rate</_LabelTitle>\r\n            <_RateWrap>{rateItemJsxList}</_RateWrap>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormInit;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #9b9eb8;\r\n`;\r\n\r\nconst _LabelTitle = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 18px;\r\n    text-align: left;\r\n    /* background-color: #f0f0f0; */\r\n    background: linear-gradient(to bottom, #707070, #b3b3b3, #707070);\r\n    font-size: 14px;\r\n    margin: 5px 0 0 0;\r\n    color: #ffffff;\r\n    font-weight: 600;\r\n    line-height: 14px;\r\n    box-sizing: border-box;\r\n    text-align: center;\r\n`;\r\n\r\nconst _ScaleWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _ScaleItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 50%;\r\n    height: 100%;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #6182b4;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;\r\n\r\n\r\nconst _KeyWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 24px; */\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _KeyItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #61b47d;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;\r\n\r\n\r\nconst _TempoWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    background-color: #ececec;\r\n\r\n    & * {\r\n        display: inline-block;\r\n        box-sizing: border-box;\r\n        vertical-align: top;\r\n    }\r\n    & input:nth-child(1) {\r\n        background-color: #dddddd;\r\n        width: 60px;\r\n        height: calc(100% - 4px);\r\n        margin: 2px 0 0 0;\r\n        border: 1px solid #9b9b9b;\r\n        border-radius: 4px;\r\n    }\r\n    & input:nth-child(2) {\r\n        margin-left: 5px;\r\n        background-color: #f00;\r\n        width: calc(100% - 70px);\r\n        height: 100%;\r\n    }\r\n`;\r\n\r\n\r\nconst _RateWrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 24px; */\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: left;\r\n    /* background-color: #ececec; */\r\n`;\r\n\r\nconst _RateItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 24px;\r\n    /* margin: 5px 0 0 0; */\r\n    background-color: #61b47d;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #da909082;\r\n    `}\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 18px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord, DetailSection } from \"../../../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst SideFormSection = (props: {\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const detail = cur.detail as DetailSection;\r\n\r\n    const setLabelName = (value: string) => {\r\n        detail.labelName = value;\r\n        store.scoreData.chordList = store.scoreData.chordList.slice();\r\n        dispatcher.score.setScoreData(store.scoreData);\r\n    }\r\n\r\n    const templateItemJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        ['Intro', 'A-mero', 'B-mero', 'Sabi', 'C-mero', 'Outro'].forEach((item) => {\r\n            const isActive = detail.labelName.indexOf(item) === 0;\r\n            jsxList.push(\r\n                <_TemplateItem key={jsxList.length} isActive={isActive}\r\n                    onClick={()=>{\r\n                        setLabelName(item);\r\n                    }}\r\n                >\r\n                    {item}\r\n                </_TemplateItem>\r\n            );\r\n        });\r\n        return jsxList;\r\n    }, []);\r\n\r\n    const numberItemJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        [1, 2, 3, 4].forEach((item) => {\r\n            const isActive = detail.labelName.indexOf(item.toString()) !== -1;\r\n            jsxList.push(\r\n                <_NumberItem key={jsxList.length} isActive={isActive}>\r\n                    {item}\r\n                </_NumberItem>\r\n            );\r\n        });\r\n        return jsxList;\r\n    }, []);\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_DirectText type=\"text\"\r\n                value={detail.labelName}\r\n                onChange={(e) => {\r\n                    setLabelName(e.target.value);\r\n                }}\r\n            />\r\n            <_TemplateFrame>{templateItemJsxList}</_TemplateFrame>\r\n            <_NumberFrame>{numberItemJsxList}</_NumberFrame>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SideFormSection;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    text-align: left;\r\n    background-color: #b89b9b;\r\n`;\r\n\r\nconst _DirectText = styled.input`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    text-align: left;\r\n    background-color: #bbbbbb;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    color: #a30000;\r\n    box-sizing: border-box;\r\n    outline: none;\r\n    border: 1px solid black;\r\n    border-radius: 4px;\r\n`;\r\n\r\n\r\n\r\nconst _ItemBase = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    line-height: 24px;\r\n    text-align: center;\r\n    border-radius: 5px;\r\n    border: solid 1px #ffffff;\r\n    box-sizing: border-box;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _TemplateFrame = styled.div`\r\n    display: inline-block;\r\n    width: 60%;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: center;\r\n    background-color: #dac3d8;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _NumberFrame = styled.div`\r\n    display: inline-block;\r\n    width: 40%;\r\n    /* margin: 5px 0 0 0; */\r\n    text-align: center;\r\n    background-color: #dac3d8;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _TemplateItem = styled(_ItemBase)<{\r\n    isActive: boolean;\r\n}>`\r\n    background-color: #6182b4;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #ad993fe6;\r\n    `}\r\n`;\r\n\r\nconst _NumberItem = styled(_ItemBase)<{\r\n    isActive: boolean;\r\n}>`\r\n    background-color: #61b4b0;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #ad993fe6;\r\n    `}\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DetailChord, DetailInit, DetailSection } from \"../../../../../redux/store/scoreData\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport SideFormChord from \"./sideFormChord\";\r\nimport SideFormInit from \"./sideFormInit\";\r\nimport SideFormSection from \"./sideFormSection\";\r\n\r\nconst NoteSideForm = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.scoreState;\r\n    const chordList = store.scoreData.chordList;\r\n\r\n    if (state.focusIndex === -1 || state.focusIndex > chordList.length - 1) {\r\n        return <></>;\r\n    }\r\n\r\n    const element = chordList[state.focusIndex];\r\n\r\n    return (\r\n        <_Wrap>\r\n            {(() => {\r\n                switch (element.type) {\r\n                    case 'init': return <SideFormInit />;\r\n                    case 'section': return <SideFormSection />;\r\n                    case 'chord': return <SideFormChord />;\r\n                    case 'change': return <></>;\r\n                }\r\n            })()}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default NoteSideForm;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    margin: 3px 0 0 3px;\r\n    width: calc(100% - 6px);\r\n    height: calc(100% - 6px);\r\n    text-align: left;\r\n    background-color: #8a8a8a;\r\n`;\r\n","import { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { ElementCache } from \"../../../../../redux/store/scoreState\";\r\nimport { TIMELINE_BEAT_WIDTH } from \"../../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport BlockItem from \"./blockItem\";\r\n\r\nconst HarmMeasure = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const dataList = store.scoreData.chordList;\r\n    const focusIndex = state.focusIndex;\r\n    const cacheList = state.elementCacheList;\r\n\r\n    let curBeatJsx: JSX.Element = <></>;\r\n    let prevBeatJsx: JSX.Element = <></>;\r\n    let nextBeatJsx: JSX.Element = <></>;\r\n    let curMinuteJsx: JSX.Element = <></>;\r\n    let prevMinuteJsx: JSX.Element = <></>;\r\n    let nextMinuteJsx: JSX.Element = <></>;\r\n\r\n    const memoriJsxList: JSX.Element[] = [];\r\n\r\n    //\r\n\r\n    let curIndex = 2;\r\n    let prevIndex = 2;\r\n    let nextIndex = dataList.length - 1;\r\n    let temp = focusIndex;\r\n    while (temp > 2) {\r\n        const element = dataList[temp];\r\n        if (element.type === 'chord') {\r\n            curIndex = temp;\r\n            break;\r\n        }\r\n        temp--;\r\n    }\r\n    // \r\n    if (curIndex > 2) {\r\n        temp = curIndex - 1;\r\n        while (temp > 2) {\r\n            const element = dataList[temp];\r\n            if (element.type === 'chord') {\r\n                prevIndex = temp;\r\n                break;\r\n            }\r\n            temp--;\r\n        }\r\n    }\r\n    temp = focusIndex + 1;\r\n    while (temp < dataList.length - 1) {\r\n        const element = dataList[temp];\r\n        if (element.type === 'chord') {\r\n            nextIndex = temp;\r\n            break;\r\n        }\r\n        temp++;\r\n    }\r\n    if (state.focusIndex === -1 || state.focusIndex > state.elementCacheList.length) {\r\n        return <></>;\r\n    }\r\n\r\n    const add = (sustain: number, cache: ElementCache): void => {\r\n        const adjust = cache.beat + cache.minute;\r\n        for (let i = 0; i < Math.floor(sustain / 0.25); i++) {\r\n            const pos = i + Math.floor(adjust / 0.25);\r\n            let bean: { width: number, height: number, color: string } = { width: 1, height: 10, color: '#555' }\r\n            switch (true) {\r\n                case pos % 16 === 0: bean = { width: 2, height: 22, color: '#747474' }; break;\r\n                case pos % 4 === 0: bean = { width: 1, height: 18, color: '#646464' }; break;\r\n                case pos % 2 === 0: bean = { width: 1, height: 14, color: '#7a7a7a' }; break;\r\n            }\r\n            memoriJsxList.push(\r\n                <_Memori\r\n                    key={memoriJsxList.length}\r\n                    width={bean.width}\r\n                    height={bean.height}\r\n                    color={bean.color}\r\n                >\r\n                    {pos % 16 === 0 ? <_Bar>{cache.bar + 1 + (adjust === 0 ? 0 : 1)}</_Bar> : ''}\r\n                </_Memori>\r\n            );\r\n        }\r\n    }\r\n\r\n    if (curIndex > 2) {\r\n\r\n        if (prevIndex === 2) {\r\n            prevBeatJsx = (\r\n                <_Prev sustain={4}>start</_Prev>\r\n            );\r\n            prevMinuteJsx = (\r\n                <_Prev sustain={4} />\r\n            );\r\n\r\n            memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n        } else {\r\n            const chord = dataList[prevIndex].detail as DetailChord;\r\n            const cache = cacheList[prevIndex];\r\n            const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n            prevBeatJsx = (\r\n                <_Prev sustain={chord.beatLen}>Prev</_Prev>\r\n            );\r\n            prevMinuteJsx = (\r\n                <_Prev sustain={sustain} />\r\n            );\r\n\r\n            add(sustain, cache);\r\n        }\r\n    }\r\n    if (curIndex === 2) {\r\n        curBeatJsx = (\r\n            <_Cur sustain={4}>start</_Cur>\r\n        );\r\n        curMinuteJsx = (\r\n            <_Cur sustain={4} />\r\n        );\r\n\r\n        memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n    } else {\r\n        const chord = dataList[curIndex].detail as DetailChord;\r\n        const cache = cacheList[curIndex];\r\n        const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n        curBeatJsx = (\r\n            <_Cur sustain={chord.beatLen}>Cur</_Cur>\r\n        );\r\n        curMinuteJsx = (\r\n            <_Cur sustain={sustain} />\r\n        );\r\n\r\n        add(sustain, cache);\r\n    }\r\n    if (nextIndex === dataList.length - 1) {\r\n        nextBeatJsx = (\r\n            <_Next sustain={4}>end</_Next>\r\n        );\r\n        nextMinuteJsx = (\r\n            <_Next sustain={4} />\r\n        );\r\n\r\n        memoriJsxList.push(<_Start key={memoriJsxList.length} />);\r\n    } else {\r\n        const chord = dataList[nextIndex].detail as DetailChord;\r\n        const cache = cacheList[nextIndex];\r\n        const sustain = chord.beatLen + chord.minute.head + chord.minute.tail;\r\n        nextBeatJsx = (\r\n            <_Next sustain={chord.beatLen}>Next</_Next>\r\n        );\r\n        nextMinuteJsx = (\r\n            <_Next sustain={sustain} />\r\n        );\r\n\r\n        add(sustain + 0.25, cache);\r\n    }\r\n\r\n    // const curSustain = nextCache.beat - curCache.beat;\r\n    return (\r\n        <_Wrap>\r\n            <_Blocks>\r\n                <_Beat>\r\n                    {prevBeatJsx}\r\n                    {curBeatJsx}\r\n                    {nextBeatJsx}\r\n                </_Beat>\r\n                <_Minute>\r\n                    {prevMinuteJsx}\r\n                    {curMinuteJsx}\r\n                    {nextMinuteJsx}\r\n                </_Minute>\r\n            </_Blocks>\r\n            <_Measure>\r\n                {memoriJsxList}\r\n            </_Measure>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default HarmMeasure;\r\n\r\nconst BEAT_WIDTH = 50;\r\n\r\nconst _Wrap = styled.div`\r\n    overflow: hidden;\r\n    text-align: left;\r\n    white-space: nowrap;  \r\n`;\r\n\r\nconst _Blocks = styled.div`\r\n    display: block;\r\n    /* position: relative; */\r\n    height: 40px;\r\n    /* width: 2200px; */\r\n    background-color: rgb(131, 131, 131);\r\n`;\r\n\r\nconst _Beat = styled.div`\r\n    display: block;\r\n    height: 30px;\r\n`;\r\n\r\nconst _Minute = styled.div`\r\n    display: block;\r\n    height: 10px;\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    sustain: number;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.sustain * BEAT_WIDTH}px;\r\n    height: 100%;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: white;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Prev = styled(_Item) <{\r\n}>`\r\n    background-color: rgba(0, 21, 211, 0.158);\r\n`;\r\n\r\nconst _Cur = styled(_Item) <{\r\n}>`\r\n    background-color: rgb(233, 5, 5);\r\n`;\r\n\r\nconst _Next = styled(_Item) <{\r\n}>`\r\n    background-color: rgba(31, 189, 0, 0.144);\r\n`;\r\n\r\nconst _Measure = styled.div`\r\n    display: block;\r\n    position: relative;\r\n    height: 38px;\r\n    background-color: rgb(48, 48, 48);\r\n    border-top: solid 2px rgb(128, 128, 128);\r\n    background: linear-gradient(to bottom, rgb(255, 255, 255), rgb(98, 97, 114));\r\n`;\r\n\r\n\r\nconst _Start = styled.div`\r\n    display: inline-block;\r\n    width: ${BEAT_WIDTH * 4}px;\r\n    height: 100%;\r\n    background-color: #cecece;\r\n    box-sizing: border-box;\r\n`;\r\nconst _Memori = styled.div<{\r\n    width: number;\r\n    height: number;\r\n    color: string;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: ${BEAT_WIDTH / 4}px;\r\n    height: ${props => props.height}px;\r\n    border-left: solid ${props => props.width}px ${props => props.color};\r\n    box-sizing: border-box;\r\n`;\r\nconst _Bar = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: -5px;\r\n    top: 18px;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #dd0000;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { DetailChord } from \"../../../../../redux/store/scoreData\";\r\nimport { getIntervalValues, getSymbolFromKey, IntervalRelationProps } from \"../../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst ChordInfo = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const cur = store.scoreData.chordList[state.focusIndex];\r\n    const cache = state.elementCacheList[state.focusIndex];\r\n    const scaleList = cache == null ? [] : [0, 2, 4, 5, 7, 9, 11].map(value => (cache.keyIndex + value) % 12);\r\n    let structs: number[] = [];\r\n\r\n    const [structJsxList, tipJsxList]: [JSX.Element[], JSX.Element[]] = useMemo(() => {\r\n\r\n        const structJsxList: JSX.Element[] = [];\r\n        let tipJsxList: JSX.Element[] = [];\r\n\r\n        if (cur.type === 'chord') {\r\n            const detail = cur.detail as DetailChord;\r\n            const root = detail.root;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            if (root != null && symbol != null) {\r\n                structs = getIntervalValues((root.index + cache.keyIndex) % 12, symbol.structs);\r\n                // alert(structs);\r\n\r\n                tipJsxList = symbol.structs.map((struct, i) => <_InfoItem key={i}>\r\n                    <span>{struct}</span><span>{IntervalRelationProps[struct]}</span>\r\n                </_InfoItem>)\r\n            }\r\n        }\r\n        for (let i = 0; i < 14; i++) {\r\n            {\r\n                const curIndex = structJsxList.length;\r\n                const isScale = scaleList.includes(curIndex % 12);\r\n                const isUse = structs.includes(curIndex);\r\n                structJsxList.push(\r\n                    <_Item key={structJsxList.length} isBlack={false} index={i} isScale={isScale} isUse={isUse}></_Item>\r\n                );\r\n            }\r\n            if ([0, 1, 3, 4, 5].includes(i % 7)) {\r\n                const curIndex = structJsxList.length;\r\n                const isScale = scaleList.includes(curIndex % 12);\r\n                const isUse = structs.includes(curIndex);\r\n                structJsxList.push(\r\n                    <_Item key={structJsxList.length} isBlack={true} index={i} isScale={isScale} isUse={isUse}></_Item>\r\n                );\r\n            }\r\n        }\r\n        return [structJsxList, tipJsxList];\r\n    }, [structs]);\r\n\r\n    return (\r\n        <_Wrap isUse={structs.length > 0}>\r\n            {/* <_Info>{tipJsxList}</_Info> */}\r\n            <_Struct>{structJsxList}</_Struct>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ChordInfo;\r\n\r\nconst _Wrap = styled.div<{\r\n    isUse: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    ${props => props.isUse ? '' : css`\r\n        opacity: 0.5;\r\n    `}\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _Info = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 100%;\r\n    background-color: #949494;\r\n    /* border: solid 1px #a3a3a3; */\r\n    box-sizing: border-box;\r\n    /* padding: 2px 0 0 0; */\r\n`;\r\nconst _InfoItem = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 15px;\r\n    box-sizing: border-box;\r\n\r\n    /* background-color: #4b4b4b; */\r\n    /* background: linear-gradient(to bottom, #adac6c, #e0df7d, #adac6c); */\r\n    /* background: linear-gradient(to bottom, #858585, #4b4b4b, #858585); */\r\n    border: solid 1px rgb(207, 207, 207);\r\n    margin-bottom: 1px;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    line-height: 12px;\r\n    text-align: center;\r\n\r\n    & span:nth-child(1){\r\n        color: #f5e400;\r\n    }\r\n    & span:nth-child(2){\r\n        margin-left: 10px;\r\n        color: #ffffff;\r\n    }\r\n`;\r\n\r\nconst _Struct = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - 50px);\r\n    height: 100%;\r\n    /* background-color: #383838; */\r\n    /* padding: 12px 0 0 2px;\r\n    box-sizing: border-box; */\r\n`;\r\n\r\nconst WIDTH = 25;\r\nconst MARGIN = 2;\r\nconst HEIGHT_WHITE = 43;\r\nconst HEIGHT_BLACK = 32;\r\nconst INTERVAL = WIDTH + MARGIN;\r\nconst _Item = styled.div<{\r\n    isScale: boolean;\r\n    isUse: boolean;\r\n    isBlack: boolean;\r\n    index: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: ${props => 2 + (!props.isBlack ? HEIGHT_BLACK : 0)}px;\r\n    left: ${props => 2 + (props.index * INTERVAL) + (!props.isBlack ? 0 : WIDTH / 2)}px;\r\n    z-index: 2;\r\n    border: 1px solid #ffffffda;\r\n    border-radius: 20px;\r\n    width: 25px;\r\n    height: ${props => !props.isBlack ? HEIGHT_WHITE : HEIGHT_BLACK}px;\r\n    /* background-color: #7d7d9e; */\r\n    ${props => props.isScale ? css`\r\n    background: radial-gradient(#c3c3d6, #8989a8);\r\n    ` : css`\r\n    background: radial-gradient(#d6c3ca, #a88995);\r\n    `}\r\n    ${props => !props.isUse ? '' : props.isScale ? css`\r\n        background: radial-gradient(#3e9ef7, #254e74);\r\n    ` : css`\r\n        background: radial-gradient(#d43131, #722a2a);\r\n    `}\r\n    box-sizing: border-box;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\nconst InitialBeatTip = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const tipJsxList:JSX.Element[] = [];\r\n    for(let i = 0; i < 4; i ++) {\r\n        tipJsxList.push(\r\n            <_Tip key={i} isActive={state.initialBeat > i} onClick={()=> {\r\n                state.initialBeat = i + 1;\r\n                dispatcher.score.setScoreState(state);\r\n            }}/>\r\n        );\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Label>inital beat</_Label>\r\n            <_WrapTip>{tipJsxList}</_WrapTip>\r\n        </_Wrap>\r\n    );\r\n\r\n}\r\n\r\nexport default InitialBeatTip;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    /* background-color: red; */\r\n    & *{\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #979797;\r\n    margin-left: 4px;\r\n    font-style: italic;\r\n    line-height: 38px;\r\n    /* background-color: yellow; */\r\n`;\r\nconst _WrapTip = styled.div`\r\n    display: inline-block;\r\n    width: 142px;\r\n    height: calc(100% - 6px);\r\n    margin: 3px 0 0 8px;\r\n    border-radius: 4px;\r\n    border: solid 1px #747474;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Tip = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 30px;\r\n    height: calc(100% - 6px);\r\n    margin: 3px 0 0 4px;\r\n    background-color: #d6d6d6;\r\n    ${props => !props.isActive ? '' : css`background-color: #eeedcf;`}\r\n    border: solid 1px #b9b9b9;\r\n    box-sizing: border-box;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingPattern, BackingState } from \"../../../../redux/store/backingState\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst PatternLength = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n\r\n    const itemJsxList: JSX.Element[] = [];\r\n    const pattern = state.pattern as BackingPattern;\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n    layer.noteDivList.forEach((note, i) => {\r\n        const isActive = pattern.lenIndex === i;\r\n        let rate = note.rate;\r\n        if (note.isHalf) rate /= 1.5;\r\n        if (note.isDiv3 !== 0) rate /= note.isDiv3 / 3;\r\n        itemJsxList.push(\r\n            <_Item key={i} rate={rate} isActive={isActive}>\r\n                {note.rate}{!note.isHalf ? '' : '.'}{note.isDiv3 === 0 ? '' : '/'}\r\n            </_Item>\r\n        );\r\n    });\r\n\r\n    return (<_Wrap>\r\n        {itemJsxList}\r\n    </_Wrap>);\r\n}\r\n\r\nexport default PatternLength;\r\n\r\nconst _Wrap = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n`;\r\n\r\n\r\nconst _Item = styled.div<{\r\n    rate: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => NOTES_1BAR_WIDTH / props.rate - 1}px;\r\n    height: calc(100% - 4px);\r\n    margin: 2px 0 0 1px;\r\n    background-color: #1616beb0;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #6363eeaf;\r\n    `}\r\n    box-sizing: border-box;\r\n\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: #ffffffba;\r\n    text-align: center;\r\n`;\r\n\r\n","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingPattern, BackingState, NoteSignal, NoteStatus } from \"../../../../redux/store/backingState\";\r\nimport { NOTES_1BAR_WIDTH, PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst PatternTable = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const pattern = state.pattern as BackingPattern;\r\n    const channelCount = pattern.channels.length;\r\n    // const layer = pattern.layers[pattern.layerIndex];\r\n\r\n    const layerJsxList: JSX.Element[][] = Array(2);\r\n    pattern.layers.forEach((layer, j) => {\r\n\r\n        const jsxLsit: JSX.Element[] = [];\r\n        for (let i = 0; i < channelCount; i++) {\r\n            const notesJsxLsit: JSX.Element[] = [];\r\n\r\n            layer.noteDivList.forEach((note, k) => {\r\n                const isActive = pattern.lenIndex === k;\r\n                const isUse = layer.table[i][k] != null;\r\n                let rate = note.rate;\r\n                if (note.isHalf) rate /= 1.5;\r\n                if (note.isDiv3 !== 0) rate /= note.isDiv3 / 3;\r\n                notesJsxLsit.push(\r\n                    <_Notes key={k} rate={rate} isActive={isActive}>\r\n                        <_State isUse={isUse} signal={'n'}/>\r\n                    </_Notes>\r\n                );\r\n            });\r\n            jsxLsit.push(\r\n                <_Record key={i} isEven={i % 2 == 0} isFront={true}>\r\n                    {notesJsxLsit}\r\n                </_Record>\r\n            );\r\n        }\r\n        layerJsxList[j] = jsxLsit;\r\n    });\r\n\r\n\r\n    return (<>\r\n        <_Layer zIndex={1}>{layerJsxList[pattern.layerIndex]}</_Layer>\r\n    </>);\r\n}\r\n\r\nexport default PatternTable;\r\n\r\nconst _Layer = styled.div<{\r\n    zIndex: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _Record = styled.div<{\r\n    isEven: boolean;\r\n    isFront: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 20px;\r\n    ${props => !props.isFront ? '' : css<{\r\n    isEven: boolean;\r\n}>`\r\n        ${props => !props.isEven ? css`\r\n            background-color: #3a3a502f;\r\n        ` : css`\r\n            background-color: #42425542;\r\n        `}\r\n    `}\r\n`;\r\n\r\nconst _Notes = styled.div<{\r\n    rate: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => NOTES_1BAR_WIDTH / props.rate - 1}px;\r\n    height: calc(100% - 1px);\r\n    margin: 1px 0 0 1px;\r\n    background-color: #ffffff31;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #ffffff56;\r\n    `}\r\n    box-sizing: border-box;\r\n\r\n    &:hover {\r\n        background-color: #82f7ff57;\r\n    }\r\n`;\r\n\r\nconst _State = styled.div<{\r\n    isUse: boolean;\r\n    signal: NoteSignal;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: calc(100% - 2px);\r\n    margin: 1px 0 0 1px;\r\n    background-color: #a7a7a754;\r\n    &:hover {\r\n        background-color: #82ff9d56;\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { BackingState } from \"../../../../redux/store/backingState\";\r\nimport { PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport PatternLength from \"./patternLength\";\r\nimport PatternTable from \"./patternTable\";\r\n\r\nconst PatternBuilder = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const chordInfo = state.chordInfo;\r\n\r\n    const isUsePattern = state.pattern != null;\r\n\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n    }\r\n\r\n    return (<>\r\n        <_Header>\r\n            <_LengthDiv>\r\n                <PatternLength />\r\n            </_LengthDiv>\r\n            <_MeasureDiv>\r\n            </_MeasureDiv>\r\n        </_Header>\r\n        <_Body>\r\n            <PatternTable />\r\n        </_Body>\r\n        <_Footer>\r\n        </_Footer>\r\n    </>);\r\n}\r\n\r\nexport default PatternBuilder;\r\n\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT}px;\r\n    background-color: #9292bdd6;\r\n`;\r\nconst _LengthDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2}px;\r\n    background-color: #9292bdd6;\r\n`;\r\nconst _MeasureDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT / 2}px;\r\n    background-color: #b492bdd5;\r\n`;\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${PATTERN_BODY_HEIGHT}px;\r\n    background-color: #97d3cec8;\r\n`;\r\nconst _Footer = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_FOOTER_HEIGHT}px;\r\n    background-color: #898997cc;\r\n`;","import styled from \"styled-components\";\r\n\r\nconst ChannelItem = (props:{\r\n    soundFullName: string;\r\n}) => {\r\n\r\n    return (<>\r\n        <_Wrap>\r\n            <_Struct>{props.soundFullName}</_Struct>\r\n            <_Option>-</_Option>\r\n            <_Option>+</_Option>\r\n        </_Wrap>\r\n    </>);\r\n}\r\n\r\nexport default ChannelItem;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 19px;\r\n    background-color: #b4b3b36f;\r\n    margin: 0 0 1px 0;\r\n`;\r\n\r\nconst _Item = styled.div`\r\n    display: inline-block;\r\n    height: 100%;\r\n    margin: 0 1px 0 0;\r\n    border: 1px solid #322e4292;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    text-align: center;\r\n`;\r\n\r\nconst _Struct = styled(_Item)`\r\n    width: 47px;\r\n\r\n`;\r\n\r\nconst _Option = styled(_Item)`\r\n    width: 25px;\r\n    \r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { BackingPattern, BackingState } from \"../../../../redux/store/backingState\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../../utils/theoryUtils\";\r\nimport { PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport ChannelItem from \"./channelItem\";\r\n\r\nconst PatternChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const chordInfo = state.chordInfo;\r\n    const symbol = getSymbolFromKey(chordInfo.symbolKey);\r\n    const pattern = state.pattern;\r\n\r\n    const channelJsxList: JSX.Element[] = [];\r\n    if (pattern != null) {\r\n        const channels = pattern.channels;\r\n        channels.forEach((channel, i) => {\r\n            let name = '-';\r\n            if (channel.octave !== -1) {\r\n                const soundIndex = chordInfo.chordRoot + IntervalRelationProps[symbol.structs[channel.structIndex]];\r\n                const octave = channel.octave + Math.floor(soundIndex / 12);\r\n                name = KEY12_SHARP_LIST[soundIndex % 12] + octave;\r\n            }\r\n            channelJsxList.push(\r\n                <ChannelItem key={i}\r\n                    soundFullName={name}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    return (<>\r\n        <_Header>\r\n        </_Header>\r\n        <_Body>\r\n            {channelJsxList}\r\n        </_Body>\r\n        <_Footer>\r\n        </_Footer>\r\n    </>);\r\n}\r\n\r\nexport default PatternChannel;\r\n\r\nconst _Header = styled.div`\r\n    /* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_HEADER_HEIGHT}px;\r\n    background-color: #9292bdd6;\r\n`;\r\nconst _Body = styled.div`\r\n/* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_BODY_HEIGHT}px;\r\n    background-color: #97d3cec8;\r\n`;\r\nconst _Footer = styled.div`\r\n/* display: inline-block; */\r\n    width: 100%;\r\n    height: ${PATTERN_FOOTER_HEIGHT}px;\r\n    background-color: #898997cc;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingPattern, BackingState, NoteRate } from \"../../../redux/store/backingState\";\r\nimport { PATTERN_BODY_HEIGHT, PATTERN_FOOTER_HEIGHT, PATTERN_HEADER_HEIGHT } from \"../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\n\r\nconst PatternStatus = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const pattern = state.pattern as BackingPattern;\r\n    const layer = pattern.layers[pattern.layerIndex];\r\n    const cur = layer.noteDivList[pattern.lenIndex];\r\n    const chordInfo = state.chordInfo;\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n    }\r\n\r\n    const setRate = (rate: NoteRate) => {\r\n        cur.rate = rate;\r\n        update();\r\n    }\r\n\r\n    const createItem = (name: string, isActive: boolean, callback: () => void): JSX.Element => {\r\n        return (\r\n            <_Item isEnable={true} isActive={isActive}\r\n                onClick={callback}>\r\n                {name}\r\n            </_Item>\r\n        );\r\n    }\r\n    const createRateItem = (rate: NoteRate): JSX.Element => {\r\n        return createItem(String(rate), cur.rate === rate, () => setRate(rate));\r\n    }\r\n\r\n    const sizeJsxList: JSX.Element[] = [];\r\n    for (let i = 0; i < 12; i++) {\r\n        const value = i + 1;\r\n        sizeJsxList.push(\r\n            <_ListItem key={i}\r\n                value={value}>\r\n                {value}\r\n            </_ListItem>\r\n        );\r\n    }\r\n\r\n    return (<>\r\n        <_List onChange={(e) => {\r\n            pattern.channels = [];\r\n            for (let i = 0; i < Number(e.target.value); i++) {\r\n                pattern.channels.push({ octave: -1, structIndex: 0 });\r\n            }\r\n            update();\r\n        }}>\r\n            {sizeJsxList}\r\n        </_List>\r\n        {createRateItem(16)}\r\n        {createRateItem(8)}\r\n        {createRateItem(4)}\r\n        {createRateItem(2)}\r\n        {createRateItem(1)}\r\n        {createItem('.', cur.isHalf, () => {\r\n            cur.isHalf = !cur.isHalf;\r\n            update();            \r\n        })}\r\n        {createItem('1/3', cur.isDiv3 === 1, () => {\r\n            if(cur.isDiv3 === 1) cur.isDiv3 = 0;\r\n            else cur.isDiv3 = 1;\r\n            update();            \r\n        })}\r\n        {createItem('2/3', cur.isDiv3 === 2, () => {\r\n            if(cur.isDiv3 === 2) cur.isDiv3 = 0;\r\n            else cur.isDiv3 = 2;\r\n            update();            \r\n        })}\r\n        {/* {createItem('.')}\r\n        {createItem('/')} */}\r\n    </>);\r\n}\r\n\r\nexport default PatternStatus;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n`;\r\n\r\n\r\nconst _List = styled.select<{\r\n\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    color: #ff0000;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    background-color: #d4d4d422;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n    outline: none;\r\n`;\r\nconst _ListItem = styled.option<{\r\n}>`\r\n    background-color: black;\r\n    color: white;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n`;\r\n\r\nconst _Item = styled.div<{\r\n    isEnable: boolean;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 50px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #ff008023;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #fbff0050;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n    }\r\n`;","\r\nimport { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingState } from \"../../../redux/store/backingState\";\r\nimport { BackingPattern, ChannelParam, BackingLayer } from \"../../../redux/store/backingState\";\r\nimport { PATTERN_FRAME_HEIGHT, PATTERN_OPERATION_HEIGHT as PATTERN_STATUS_HEIGHT } from \"../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\nimport PatternBuilder from \"./builder/patternBuilder\";\r\nimport PatternChannel from \"./channel/patternChannel\";\r\nimport PatternStatus from \"./patternStatus\";\r\n\r\nconst PatternFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const chordInfo = state.chordInfo;\r\n\r\n    const isUsePattern = state.pattern != null;\r\n\r\n    const update = () => {\r\n        dispatcher.backing.setState(state);\r\n    }\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Header>\r\n                <_UseSwitch>\r\n                    <_Label>Pattern</_Label>\r\n                    <_Button isActive={isUsePattern}\r\n                        onClick={() => {\r\n                            if (!isUsePattern) {\r\n                                const table = state.voicingTable as boolean[][];\r\n                                const channels = dispatcher.backing.getChannels(table).reverse();\r\n                                state.pattern = {\r\n                                    layerIndex: 0,\r\n                                    lenIndex: 0,\r\n                                    channels,\r\n                                    isUsePedal: false,\r\n                                    layers: [dispatcher.backing.getInitialLayer(), dispatcher.backing.getInitialLayer()],\r\n                                } as BackingPattern;\r\n                                update();\r\n                            } else {\r\n                                state.pattern = null;\r\n                                update();\r\n                            }\r\n                        }}>Use\r\n                    </_Button>\r\n                </_UseSwitch>\r\n            </_Header>\r\n            <_Main isActive={isUsePattern}>\r\n                {!isUsePattern ? <></> : (<>\r\n                    <_StatusDiv><PatternStatus /></_StatusDiv>\r\n                    <_MainDiv>\r\n                        <_ChannelDiv>\r\n                            <PatternChannel />\r\n                        </_ChannelDiv>\r\n                        <_BuilderDiv>\r\n                            <PatternBuilder />\r\n                        </_BuilderDiv>\r\n                    </_MainDiv>\r\n                </>)}\r\n            </_Main>\r\n        </_Wrap>\r\n    )\r\n}\r\n\r\nexport default PatternFrame;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    /* height: 300px; */\r\n    background-color: #001279;\r\n\r\n    & *{\r\n        /* display: inline-block;\r\n        width: 100%; */\r\n    }\r\n`;\r\n\r\nconst _Header = styled.div`\r\n    height: 30px;\r\n    background-color: #a5d1c3;\r\n`;\r\n\r\n\r\nconst _Label = styled.div``;\r\nconst _UseSwitch = styled.div`\r\n    display: inline-block;\r\n    width: 200px;\r\n    height: 100%;\r\n    /* background-color: #7986d1; */\r\n\r\n    & * {\r\n        display: inline-block;\r\n        height: calc(100% - 4px);\r\n        margin-top: 2px;\r\n        box-sizing: border-box;        \r\n    }\r\n\r\n    & ${_Label} {\r\n        width: 80px;\r\n        font-size: 20px;\r\n        color: #f1fffb;\r\n        font-weight: 600;\r\n        /* background-color: #00000028; */\r\n        margin: 2px 2px 0 2px;\r\n        line-height: 22px;\r\n        text-align: center;\r\n    }\r\n`;\r\n\r\nconst _Button = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    width: 100px;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #ff008023;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => !props.isActive ? '' : css`\r\n        /* background-color: #b1dfc979; */\r\n        color: #fa1d1d;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n    }\r\n`;\r\n\r\nconst _Main = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    overflow: hidden;\r\n    height: ${PATTERN_FRAME_HEIGHT}px;\r\n    ${props => props.isActive ? '' : css`\r\n        height: 0;\r\n    `}\r\n    transition: height 100ms;\r\n`;\r\n\r\nconst _StatusDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${PATTERN_STATUS_HEIGHT}px;\r\n    background-color: #8d98d4;\r\n    text-align: left;\r\n`;\r\n\r\nconst _MainDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #d48d8d;\r\n\r\n    /* & *{\r\n        display: inline-block;\r\n        height: 100%;\r\n    } */\r\n`;\r\n\r\nconst _ChannelDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100px;\r\n    background-color: #dadada;\r\n`;\r\n\r\nconst _BuilderDiv = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 100px);\r\n    background-color: #76af90;\r\n`;","\r\n\r\nexport class BackingUtil {\r\n\r\n    // \r\n    static OCTAVE_NUM = 8;\r\n    // \r\n    static STRUCT_NUM = 6;\r\n}\r\n\r\nexport default BackingUtil;","\r\nimport { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingState, ChannelParam } from \"../../../redux/store/backingState\";\r\nimport BackingUtil from \"../../../utils/backingUtil\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\n\r\nconst VoicingChooser = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n    const chordInfo = state.chordInfo;\r\n    const symbol = getSymbolFromKey(chordInfo.symbolKey);\r\n\r\n    const table = state.voicingTable as boolean[][];\r\n\r\n    const voicingLaneJsxList: JSX.Element[] = [];\r\n    for (let i = 0; i < BackingUtil.OCTAVE_NUM; i++) {\r\n        const tipJsxList: JSX.Element[] = [];\r\n        for (let j = 0; j < BackingUtil.STRUCT_NUM; j++) {\r\n            let isEnable: boolean = symbol.structs.length > j;\r\n            let isSelected: boolean = table[i][j];\r\n\r\n            const interval = IntervalRelationProps[symbol.structs[j]];\r\n            const chordIndex = (chordInfo.chordRoot + interval) % 12;\r\n            const octave = i + Math.floor((chordInfo.chordRoot + interval) / 12);\r\n\r\n            const name = !isEnable ? '' : `${KEY12_SHARP_LIST[chordIndex]}${octave}`;\r\n            tipJsxList.push(\r\n                <_VoicingItem key={j}\r\n                    isEnable={isEnable}\r\n                    isSelected={isSelected}\r\n                    onClick={() => {\r\n                        table[i][j] = !isSelected;\r\n                        const pattern = state.pattern;\r\n                        if(pattern != null) {\r\n                            const tempChannels: ChannelParam[] = dispatcher.backing.getChannels(table);\r\n                            pattern.channels.forEach((channel, i) => {\r\n                                if(i < tempChannels.length) {\r\n                                    channel.octave = tempChannels[i].octave;\r\n                                    channel.structIndex = tempChannels[i].structIndex;\r\n                                } else {\r\n                                    channel.octave = -1;\r\n                                    channel.structIndex = 0;\r\n                                }\r\n                            });\r\n                            pattern.channels = pattern.channels.reverse();\r\n                        }\r\n                        dispatcher.backing.setState({ ...state, voicingTable: table, pattern });\r\n                    }}\r\n                >\r\n                    {name}\r\n                </_VoicingItem>\r\n            );\r\n        }\r\n        voicingLaneJsxList.push(\r\n            <_VoicingLane key={i}>\r\n                {tipJsxList}\r\n            </_VoicingLane>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Info>\r\n\r\n            </_Info>\r\n            <_Main>\r\n                <_Left>\r\n                    <_Relation>root [C]</_Relation>\r\n                    <_Relation>long3 [E]</_Relation>\r\n                    <_Relation>perfect5 [G]</_Relation>\r\n                </_Left>\r\n                <_Right>{voicingLaneJsxList}</_Right>\r\n            </_Main>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default VoicingChooser;\r\n\r\nconst TIP_WIDTH = 60;\r\nconst TIP_HEIGHT = 22;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 600px;\r\n`;\r\n\r\nconst _Info = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    background-color: #338f8f;\r\n`;\r\n\r\nconst _Main = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${(TIP_HEIGHT + 1) * 6 + 4}px;\r\n    background-color: #c09e05;\r\n    border: solid 1px #888;\r\n    border-radius: 5px;\r\n    box-sizing: border-box;\r\n\r\n    & *{\r\n        vertical-align: top;\r\n        height: 100%;\r\n    }\r\n`;\r\n\r\nconst _Left = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${TIP_WIDTH * 8}px);\r\n    /* width: 100px; */\r\n    background-color: #8fb5bc;\r\n`;\r\n\r\nconst _Relation = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 2px);\r\n    height: ${TIP_HEIGHT}px;\r\n    margin-top: 1px;\r\n    /* width: 100px; */\r\n    /* background-color: #8fb5bc; */\r\n    background: linear-gradient(to bottom, #10828a, #76d5db, #10828a);\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: white;\r\n    padding-left: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Right = styled.div`\r\n    display: inline-block;\r\n    background-color: #a7acd8;\r\n`;\r\n\r\nconst _VoicingLane = styled.div`\r\n    display: inline-block;\r\n    width: ${TIP_WIDTH}px;\r\n    height: 100%;\r\n    /* margin-left: 1px; */\r\n    background-color: #a7d8c4;\r\n    padding-bottom: 2px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _VoicingItem = styled.div<{\r\n    isEnable: boolean;\r\n    isSelected: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 1px);\r\n    height: ${TIP_HEIGHT}px;\r\n    margin: 1px 0 0 1px;\r\n    background-color: #409ca3;\r\n    color: #01004e;\r\n    ${props => !props.isSelected ? '' : css`\r\n        background-color: #43a6c4;\r\n    color: #ffffff;\r\n    `}\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n    /* border: 1px solid #ffffff; */\r\n    box-sizing: border-box;\r\n\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    &:hover {\r\n        background-color: #117dbb;\r\n        ${props => !props.isSelected ? '' : css`\r\n            background-color: #3f70bb;\r\n        `}\r\n    }\r\n`;\r\n\r\n","\r\nimport { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { BackingState } from \"../../redux/store/backingState\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\nimport PatternFrame from \"./pattern/patternFrame\";\r\nimport VoicingChooser from \"./voicing/voicingChooser\";\r\n\r\nconst BackingEditorFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.backingState as BackingState;\r\n\r\n    return (\r\n        <_Wrap>\r\n            <VoicingChooser />\r\n            <PatternFrame />\r\n            <_FooterDiv>\r\n                <_Button isEnable={true}>Test</_Button>\r\n                <_Button isEnable={true}>Cancel</_Button>\r\n                <_Button isEnable={true} onClick={()=> {\r\n                    dispatcher.backing.applyBackingToChord();\r\n                    dispatcher.backing.closeBackingEditor();\r\n                }}>Update</_Button>\r\n            </_FooterDiv>\r\n        </_Wrap>\r\n    )\r\n}\r\n\r\nexport default BackingEditorFrame;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    width: 600px;\r\n`;\r\n\r\nconst _FooterDiv = styled.div`\r\n    display: inline-block;\r\n    height: 30px;\r\n    width: 100%;\r\n    /* background-color: #bd4646; */\r\n    text-align: right;\r\n`;\r\n\r\nconst _Button = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100px;\r\n    height: 26px;\r\n    margin: 2px 2px 0 0;\r\n    font-size: 20px;\r\n    color: white;\r\n    font-weight: 600;\r\n    background-color: #ff008023;\r\n    border: solid 1px #555;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n    line-height: 20px;\r\n    text-align: center;\r\n\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n\r\n    &:hover {\r\n        background-color: #ff008039;\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport { Stream } from \"stream\";\r\nimport styled, { css } from \"styled-components\";\r\nimport BackingEditorFrame from \"../../../backing/backingEditorFrame\";\r\nimport PatternFrame from \"../../../backing/pattern/patternFrame\";\r\nimport VoicingChooser from \"../../../backing/voicing/voicingChooser\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst HarmHideFrame = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const isOpen = state.hideMenu === 'backing';\r\n\r\n    const chordList = store.scoreData.chordList;\r\n    const focusIndex = store.scoreState.focusIndex;\r\n\r\n    return (<>\r\n        <_Blind isOpen={isOpen} onClick={() => {\r\n            dispatcher.backing.closeBackingEditor();\r\n        }} />\r\n        <_Wrap>\r\n            <_Contents isOpen={isOpen}>\r\n                {store.backingState == null ? <></> : <BackingEditorFrame />}\r\n            </_Contents>\r\n            <_Label\r\n                isEnable={chordList[focusIndex].type === 'chord'}\r\n                onClick={() => {\r\n                    dispatcher.backing.openBackingEditor();\r\n                }}>\r\n                <div>Backing</div>\r\n            </_Label>\r\n        </_Wrap>\r\n    </>);\r\n}\r\n\r\nexport default HarmHideFrame;\r\n\r\nconst _Blind = styled.div<{\r\n    isOpen: boolean;\r\n}>`\r\n    display: ${props => props.isOpen ? 'inline-block' : 'none'};\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #01004216;\r\n    backdrop-filter: blur(6px);\r\n`;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 11;\r\n    left: 0;\r\n    top: 0;\r\n    /* width: 525px; */\r\n\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Contents = styled.div<{\r\n    isOpen: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.isOpen ? '600px' : 0};\r\n    /* height: 400px; */\r\n    background-color: #a3a3a3;\r\n    opacity: 0.9;\r\n    transition: width 0.1s;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _Label = styled.div<{\r\n    isEnable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 25px;\r\n    height: 150px;\r\n    background-color: #e4e4e4;\r\n    border-top: 1px solid #5a5a5a;\r\n    border-right: 1px solid #5a5a5a;\r\n    border-bottom: 1px solid #5a5a5a;\r\n    border-radius: 0 10px 10px 0;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #5a5a5a;\r\n    text-align: center;\r\n    line-height: 16px;\r\n    box-sizing: border-box;\r\n    ${props => props.isEnable ? '' : css`\r\n        opacity: 0.5;\r\n        pointer-events: none;\r\n    `}\r\n    \r\n    & div {\r\n        width: 150px;\r\n        transform-origin: top left;\r\n        transform: rotate(-90deg) translateX(-100%);\r\n        /* background-color: #fff; */\r\n    }\r\n\r\n    &:hover {\r\n        background-color: #d1e5eb;\r\n    }\r\n`;","import styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../../base/components/button/executableButton\";\r\nimport { HARMONIZE_FOOT_WIDTH, HARMONIZE_HEAD_WIDTH, HARMONIZE_STRUCT_WIDTH, HARMONIZE_RIGHT_WIDTH, HARMONIZE_SECTIONS_WIDTH } from \"../../../../utils/systemConst\";\r\nimport HarmNote from \"./harmNote\";\r\nimport HarmSections from \"./harmSections\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport { KeyboardEvent, useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport { DetailChord, DetailInit, DetailSection } from \"../../../../redux/store/scoreData\";\r\nimport { ElementCache, SectionCache } from \"../../../../redux/store/scoreState\";\r\nimport { NoteKeyDown, NoteKeySwitch } from \"./input/noteInput\";\r\nimport NoteSideForm from \"./side/noteSideForm\";\r\nimport HarmMeasure from \"./measure/harmMeasure\";\r\nimport { Timeline } from \"tone\";\r\nimport ChordInfo from \"./info/chordInfo\";\r\nimport InitialBeatTip from \"./initial/initialBeat\";\r\nimport { getBeatRate } from \"../../../../utils/theoryUtils\";\r\nimport HarmHideFrame from \"./harmHideFrame\";\r\n\r\nconst HarmonizeTab = (props: {\r\n    isActive: boolean;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const wrapRef = useRef<HTMLDivElement>({} as HTMLDivElement);\r\n    const chordList = store.scoreData.chordList;\r\n    const focusIndex = store.scoreState.focusIndex;\r\n    const init = (store.scoreData.chordList[0].detail as DetailInit);\r\n\r\n    const isTune = store.scoreState.isTune;\r\n\r\n    useEffect(() => {\r\n        if (!isTune) {\r\n            wrapRef.current.focus();\r\n        }\r\n    }, [isTune]);\r\n\r\n    useEffect(() => {\r\n        const elementCacheList: ElementCache[] = [];\r\n        const sectionCacheList: SectionCache[] = [];\r\n\r\n        let prevBeat = 0;\r\n        let totalBeat = 0;\r\n        let prevMinute = 0;\r\n        let totalMinute = 0;\r\n        let sectionNo = -1;\r\n        let keyIndex = -1;\r\n        let sectionBeatSum = 0;\r\n\r\n        chordList.forEach((element, i) => {\r\n            const type = element.type;\r\n            switch (type) {\r\n                case 'fixed': {\r\n\r\n                }\r\n                    break;\r\n                case 'init': {\r\n                    const detail = element.detail as DetailInit;\r\n                    keyIndex = detail.keyIndex;\r\n                }\r\n                    break;\r\n                case 'section': {\r\n                    const detail = element.detail as DetailSection;\r\n                    sectionCacheList.push({\r\n                        labelName: detail.labelName,\r\n                        beatSum: 0,\r\n                        rangeIndexStart: i,\r\n                        rangeIndexEnd: chordList.length - 2\r\n                    });\r\n                    sectionNo++;\r\n                    // 21End\r\n                    if (sectionNo > 0) {\r\n                        sectionCacheList[sectionNo - 1].rangeIndexEnd = i - 1;\r\n                        sectionCacheList[sectionNo - 1].beatSum = sectionBeatSum;\r\n                        sectionBeatSum = 0;\r\n                    }\r\n                }\r\n                    break;\r\n                case 'chord': {\r\n                    const detail = element.detail as DetailChord;\r\n                    prevBeat = totalBeat;\r\n                    totalBeat += detail.beatLen;\r\n                    sectionBeatSum += detail.beatLen;\r\n\r\n                    prevMinute = totalMinute;\r\n                    totalMinute += detail.minute.head;\r\n                    totalMinute += detail.minute.tail;\r\n                }\r\n                    break;\r\n                case 'change': {\r\n\r\n                }\r\n                    break;\r\n            }\r\n\r\n            const pastSecond = 60000 / init.bpm * (prevBeat + prevMinute);\r\n            const beatRate = getBeatRate(init.timeSignature)[0];\r\n            elementCacheList.push({\r\n                bar: Math.floor(prevBeat / beatRate),\r\n                beat: prevBeat % beatRate,\r\n                minute: prevMinute,\r\n                keyIndex,\r\n                sectionNo,\r\n                pastSecond,\r\n                reffers: {}\r\n            });\r\n        });\r\n        sectionCacheList[sectionNo].beatSum = sectionBeatSum;\r\n\r\n        store.scoreState.elementCacheList = elementCacheList;\r\n        store.scoreState.sectionCacheList = sectionCacheList;\r\n        dispatcher.score.setScoreState(store.scoreState);\r\n    }, [chordList, chordList.length, init.bpm]);\r\n\r\n    return (\r\n        <_Wrap\r\n            tabIndex={999}\r\n            ref={wrapRef}\r\n            isActive={props.isActive}\r\n            // onKeyDown={(e: KeyboardEvent) => noteKeyDown(e, store, dispatcher)}\r\n            onKeyDown={(e: KeyboardEvent) => NoteKeySwitch(e, store, dispatcher, true)}\r\n            onKeyUp={(e: KeyboardEvent) => NoteKeySwitch(e, store, dispatcher, false)}\r\n        >\r\n            <_Left>\r\n                <_Head><InitialBeatTip /></_Head>\r\n                <_Middle>\r\n                    <HarmHideFrame />\r\n                    <_Main><HarmNote /></_Main>\r\n                </_Middle>\r\n                <_Foot>\r\n                    <_TIMELINE_WRAP><HarmMeasure /></_TIMELINE_WRAP>\r\n                    <_INFO_WRAP><ChordInfo /></_INFO_WRAP>\r\n                </_Foot>\r\n            </_Left>\r\n            <_Right>\r\n                <NoteSideForm />\r\n            </_Right>\r\n        </_Wrap>\r\n    );\r\n}\r\nexport default HarmonizeTab;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: ${props => !props.isActive ? 'none' : 'inline-block'};\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst _Left = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_RIGHT_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #c7c7c7;\r\n    vertical-align: top;\r\n`;\r\nconst _Right = styled.div`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_RIGHT_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #d6d6d6;\r\n    vertical-align: top;\r\n`;\r\nconst _Head = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${HARMONIZE_HEAD_WIDTH}px;\r\n    background-color: #d4d4d4;\r\n`;\r\n\r\nconst _Middle = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: calc(100% - ${HARMONIZE_HEAD_WIDTH + HARMONIZE_FOOT_WIDTH}px);\r\n    background-color: #e0e0e0;\r\n`;\r\n\r\nconst _Main = styled.div`\r\n    display: inline-block;\r\n    margin-left: 25px;\r\n    width: calc(100% - 25px);\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _Foot = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${HARMONIZE_FOOT_WIDTH}px;\r\n    background-color: #cacaca;\r\n    & * {\r\n        vertical-align: top;\r\n    }\r\n`;\r\nconst _TIMELINE_WRAP = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_STRUCT_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #ddc2c2;\r\n`;\r\nconst _INFO_WRAP = styled.div`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_STRUCT_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #757575;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst HarmSections = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n    const sections = state.sectionCacheList;\r\n\r\n    if (state.focusIndex === -1 || state.focusIndex > state.elementCacheList.length) {\r\n        return <></>;\r\n    }\r\n\r\n    const curSectionNo = state.elementCacheList[state.focusIndex].sectionNo;\r\n\r\n    const list: JSX.Element[] = [];\r\n    sections.forEach((section, i) => {\r\n        const barSum = Math.floor(section.beatSum / 4);\r\n        const barRem = section.beatSum % 4;\r\n        const isActive = i === curSectionNo;\r\n        list.push(\r\n            <_Item\r\n                key={i}\r\n                isActive={isActive}\r\n                onClick={() => {\r\n                    state.focusIndex = section.rangeIndexStart;\r\n                    dispatcher.score.setScoreState(state);\r\n                }}\r\n            >\r\n                <_Label>{section.labelName}</_Label>\r\n                <_Total>{barSum}{barRem === 0 ? '' : ` (${barRem})`}</_Total>\r\n            </_Item>\r\n        );\r\n    });\r\n\r\n    return (<>\r\n        {list}\r\n    </>);\r\n}\r\n\r\nexport default HarmSections;\r\n\r\n\r\nconst _Label = styled.div``;\r\nconst _Total = styled.div``;\r\nconst _Item = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    margin: 4px 4px 0 4px;\r\n    width: calc(100% - 8px);\r\n    height: 36px;\r\n    background-color: ${props => props.isActive ? css`\r\n        #e7e7e6be;\r\n        box-shadow: 0 0 8px 0 #000b3a48;\r\n    ` : css`\r\n        #c4c4c42b;\r\n    `} ;\r\n    border: 1px solid #aaaaaa;\r\n    border-radius: 20px 20px 20px 20px;\r\n\r\n    text-align: center;\r\n\r\n    & ${_Label} {\r\n        display: inline-block;\r\n        width: 100%;\r\n        height: 20px;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #888;\r\n        /* background-color: #c500003b; */\r\n        line-height: 18px;\r\n    }\r\n    & ${_Total} {\r\n        display: inline-block;\r\n        width: 100%;\r\n        height: 16px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #003eb3;\r\n        /* background-color: #10c5003a; */\r\n        line-height: 16px;\r\n    }\r\n`;","import { useContext, useEffect, useMemo, useRef } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ChordElement, DetailChord } from \"../../../../redux/store/scoreData\";\r\nimport { getChordRoot, getSymbolFromKey } from \"../../../../utils/theoryUtils\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\nconst MelodyTimeline = (props: {\r\n    barLength: number;\r\n    beatWidth: number;\r\n    curChord: ChordElement | null;\r\n    timelineLength: number;\r\n    mouseMeasurePos: number;\r\n}) => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const measureRef = useRef<null | HTMLDivElement>(null);\r\n    const chordRef = useRef<null | HTMLDivElement>(null);\r\n\r\n    const state = store.scoreState;\r\n\r\n    const chordList = store.scoreData.chordList;\r\n    const barLength = props.barLength;\r\n    const beatWidth = props.beatWidth;\r\n    const curChord = props.curChord;\r\n    const timelineLength = props.timelineLength;\r\n    const mouseMeasurePos = props.mouseMeasurePos;\r\n    const rate = 1 / store.melodyState.quantize;\r\n\r\n    useEffect(() => {\r\n        store.refs.melody.measure = measureRef.current;\r\n        store.refs.melody.chord = chordRef.current;\r\n    }, []);\r\n\r\n    const measureJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        for (let i = 0; i <= barLength * 4 * 4; i++) {\r\n            let barJsx = <></>;\r\n            if (i % 16 == 0) {\r\n                barJsx = <_Bar>{Math.floor(i / 16) + 1}</_Bar>\r\n            }\r\n            jsxList.push(\r\n                <_Scale key={i} isHead={i % 4 === 0} beatWidth={beatWidth}>\r\n                    {barJsx}\r\n                </_Scale>\r\n            );\r\n        }\r\n        return jsxList;\r\n    }, [barLength]);\r\n\r\n    const chordJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        chordList.forEach((element, i) => {\r\n            if (element.type === 'chord') {\r\n                const detail = element.detail as DetailChord;\r\n                const name = detail.root == null ? '-' :\r\n                    getChordRoot(detail.root, 0) + getSymbolFromKey(detail.symbolKey)?.name;\r\n                jsxList.push(\r\n                    <_ChordItem key={jsxList.length}\r\n                        width={beatWidth * (detail.beatLen + detail.minute.head + detail.minute.tail)}\r\n                        isActive={element == curChord}\r\n                        onClick={() => {\r\n                            state.isTune = false;\r\n                            state.focusIndex = i;\r\n                            dispatcher.score.setScoreState(state);\r\n                        }}\r\n                    >\r\n                        {name}\r\n                    </_ChordItem>\r\n                );\r\n            }\r\n        });\r\n        return jsxList;\r\n    }, [chordList, curChord]);\r\n\r\n    return (<>\r\n        <_Chord ref={chordRef}>\r\n            <_ChordWrap width={timelineLength}>\r\n                {chordJsxList}\r\n            </_ChordWrap>\r\n        </_Chord>\r\n        <_Measure ref={measureRef}>\r\n            {measureJsxList}\r\n            <_MousePos\r\n                left={mouseMeasurePos * beatWidth * rate}\r\n                width={beatWidth * rate}\r\n            />\r\n        </_Measure>\r\n    </>);\r\n}\r\n\r\nexport default MelodyTimeline;\r\n\r\nconst _Measure = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    background: linear-gradient(to bottom, #ffffff, #808080);\r\n    width: 100%;\r\n    height: 40px;\r\n    text-align: left;\r\n    border-top: solid 2px #000;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n`;\r\n\r\n\r\nconst _MousePos = styled.div<{\r\n    left: number;\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    left: ${props => props.left}px;\r\n    top: 0px;\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    background-color: #ffff006c;\r\n`;\r\n\r\nconst _Chord = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    background-color: #c0c0c0;\r\n    width: 100%;\r\n    height: calc(100% - 40px);\r\n    text-align: left;\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _ChordWrap = styled.div<{\r\n    width: number;\r\n}>`\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    overflow: hidden;\r\n`;\r\n\r\nconst _ChordItem = styled.div<{\r\n    width: number;\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: ${props => props.width - 1}px;\r\n    height: calc(100% - 2px);\r\n    box-sizing: border-box;\r\n    border: 1px solid #646464;\r\n    border-left: 4px solid #940000;\r\n    background-color: #ffffff22;\r\n    ${props => !props.isActive ? '' : css`background-color: #5e88af21;`}\r\n    margin: 1px 0 0 1px;\r\n    \r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #2b2b2b;\r\n    text-align: center;\r\n\r\n    &:hover {\r\n        background-color: #fffb0037;\r\n    }\r\n`;\r\n\r\nconst _Scale = styled.div<{\r\n    isHead: boolean;\r\n    beatWidth: number;\r\n}>`\r\n    display: inline-block;\r\n    position: relative;\r\n    /* background-color: #ffffffbe; */\r\n    width: ${props => props.beatWidth / 4}px;\r\n    vertical-align: bottom;\r\n    margin-top: 25px;\r\n    height: ${props => props.isHead ? '15px' : '10px'};\r\n    box-sizing: border-box;\r\n    border-left: solid ${props => props.isHead ? '2px' : '1px'} #000;\r\n`;\r\n\r\nconst _Bar = styled.div`\r\n    display: inline-block;\r\n    position: absolute;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: #ec0000;\r\n    left: -5px;\r\n    top: -20px;\r\n`;","import { useContext, useMemo } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ChordElement, DetailChord } from \"../../../../redux/store/scoreData\";\r\nimport { getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST } from \"../../../../utils/theoryUtils\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\n\r\n\r\nconst MelodyPitchList = (props: {\r\n    mousePitchIndex: number;\r\n    curChord: ChordElement | null;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    // JSX\r\n    const pitchItemJsxList = useMemo(() => {\r\n        const structIndexList: number[] = [];\r\n        if (props.curChord != null) {\r\n            const detail = props.curChord.detail as DetailChord;\r\n            const symbol = getSymbolFromKey(detail.symbolKey);\r\n            const root = detail.root;\r\n            if (root != null && symbol != null) {\r\n                symbol.structs.forEach((struct) => {\r\n                    structIndexList.push((root.index + IntervalRelationProps[struct]) % 12);\r\n                });\r\n            }\r\n        }\r\n\r\n        const list: JSX.Element[] = [];\r\n        for (let i = 0; i < 60; i++) {\r\n            const keyIndex = ((59 - i) + 9) % 12;\r\n            const octave = Math.floor(((59 - i) + 9) / 12) + 1;\r\n            const soundName = KEY12_SHARP_LIST[keyIndex % 12];\r\n            const octaveName = getOctaveName(octave);\r\n            list.push(\r\n                <_PitchItem key={i}\r\n                    isScale={[0, 2, 4, 5, 7, 9, 11].includes(keyIndex)}\r\n                    isStruct={structIndexList.includes(keyIndex)}\r\n                    isActive={i === props.mousePitchIndex}\r\n                    onClick={() => {\r\n                        const instrument = store.instruments.soundfontPlayer;\r\n                        if (instrument != null) {\r\n                            instrument.stop();\r\n                            instrument.play(soundName + octave, 0, { duration: 1 });\r\n                        }\r\n                    }}\r\n                >\r\n                    {/* {octaveName} */}\r\n                    {soundName}\r\n                </_PitchItem>\r\n            );\r\n        }\r\n        return list;\r\n    }, [props.mousePitchIndex, props.curChord]);\r\n\r\n    return (<>\r\n        <_OctaveWrap>\r\n            <_OctaveItem isActive={false}><div>hihi</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>hi</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>mid2</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>mid1</div></_OctaveItem>\r\n            <_OctaveItem isActive={false}><div>low</div></_OctaveItem>\r\n        </_OctaveWrap>\r\n        <_PitchWrap>\r\n            {pitchItemJsxList}\r\n        </_PitchWrap>\r\n    </>);\r\n};\r\n\r\nexport default MelodyPitchList;\r\n\r\nconst getOctaveName = (num: number) => {\r\n    switch (num) {\r\n        case 0: return 'low';\r\n        case 1: return 'mid1';\r\n        case 2: return 'mid2';\r\n        case 3: return 'hi';\r\n        case 4: return 'hihi';\r\n        default: return '';\r\n    }\r\n}\r\n\r\nconst _OctaveWrap = styled.div`\r\n    display: inline-block;\r\n    width: 30px;\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _PitchWrap = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - 30px);\r\n    height: 100%;\r\n    vertical-align: top;\r\n`;\r\n\r\nconst _OctaveItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    border: 1px solid black;\r\n    width: 100%;\r\n    height: 360px;\r\n    background-color: #758f94;\r\n    ${props => !props.isActive ? '' : css`background-color: #ffc40089;`}\r\n    box-sizing: border-box;\r\n\r\n    font-size: 18px;\r\n    color: #dfdfdf;\r\n    font-weight: 600;\r\n    & div {\r\n        width: 360px;\r\n        transform-origin: top left;\r\n        transform: rotate(-90deg) translateX(-50%);\r\n        /* background-color: #fff; */\r\n    }\r\n`;\r\n\r\nconst _PitchItem = styled.div<{\r\n    isScale: boolean;\r\n    isActive: boolean;\r\n    isStruct: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: calc(100% - 20px);\r\n    border: 1px solid black;\r\n    ${props => !props.isScale ? '' : css`\r\n        width: 100%;\r\n    `}\r\n    height: ${TUNE_PITCH_HEIGHT}px;\r\n    background-color: #637596;\r\n    ${props => !props.isStruct ? '' : css`background-color: #949494;`}\r\n    ${props => !props.isActive ? '' : css`background-color: #9e9e6c;`}\r\n    box-sizing: border-box;\r\n\r\n    padding-left: 5px;\r\n    line-height: 28px;\r\n    font-size: 18px;\r\n    color: #dfdfdf;\r\n    font-weight: 600;\r\n`;\r\n","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { SoundfontInfo } from \"../../../../../redux/store/melodyState\";\r\n\r\n\r\nconst InstrumentSwitch = (props: {\r\n    labelName: string;\r\n    icon: JSX.Element;\r\n    soundfontInfo: SoundfontInfo;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    return (\r\n        <_Wrap\r\n            isActive={props.soundfontInfo.name === state.soundfontInfo.name}\r\n            onClick={() => {\r\n                // state.quantize = props.value;\r\n                // dispatcher.tune.setState(state);\r\n\r\n                state.soundfontInfo = props.soundfontInfo;\r\n                dispatcher.tune.setState(state);\r\n\r\n                const info = props.soundfontInfo;\r\n                Soundfont.instrument(new AudioContext(), info.name,\r\n                    { gain: info.gain, release: 0.5 }).then((soundFontPlayer) => {\r\n                        dispatcher.tune.setInstrument(soundFontPlayer);\r\n                    });\r\n            }}\r\n        >\r\n            <_Icon>{props.icon}</_Icon>\r\n            <_Label>{props.labelName}</_Label>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default InstrumentSwitch;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 85px;\r\n    height: 40px;\r\n    text-align: center;\r\n    border: 1px solid #4b4b4b;\r\n    background-color: #c7c6abda;\r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #fffd7eda;\r\n    `}\r\n    border-radius: 6px;\r\n    margin-left: 4px;\r\n    box-sizing: border-box;\r\n\r\n    &:hover {\r\n        background-color: #e6e2c5da;\r\n        ${props => !props.isActive ? '' : css`\r\n            background-color: #fffd7eda;\r\n        `}\r\n    }\r\n`;\r\n\r\n\r\nconst _Icon = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 30px;\r\n    /* background-color: #ff0000da; */\r\n    font-size: 20px;\r\n    color: #4b4b4b;\r\n    text-align: center;\r\n    /* padding-top: 5px; */\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 10px;\r\n    /* background-color: #0400ffdc; */\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    line-height: 0;\r\n    color: #3b3b3b;\r\n    text-align: center;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { _CSS_DISABLE } from \"../../../../../base/design/styles\";\r\nimport { GlobalContext } from \"../../../../entry/systemEntry\";\r\n\r\n\r\nconst QuantizeSwitch = (props: {\r\n    labelName: string;\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n    callback: () => void;\r\n}) => {\r\n    // const { store, dispatcher } = useContext(GlobalContext);\r\n    // const state = store.melodyState;\r\n\r\n    return (\r\n        <_Wrap\r\n            isActive={props.isActive}\r\n            isDisable={props.isDisable}\r\n            onClick={props.callback}\r\n        >\r\n            {props.labelName}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default QuantizeSwitch;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n    isDisable: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100px;\r\n    height: 28px;\r\n    background: linear-gradient(to bottom, #e0e0e0, #aaaaaa, #e0e0e0);\r\n    ${props => !props.isActive ? '' : css`\r\n        background: linear-gradient(to bottom, #b7d9df, #59c6da, #b7d9df);\r\n    `}\r\n    ${props => !props.isDisable ? '' : _CSS_DISABLE}\r\n    color: #5d6e63;\r\n    border-radius: 2px;\r\n    border: solid 1px #747373;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n\r\n    margin-left: 4px;\r\n`;","import { useContext } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport InstrumentSwitch from \"./item/instrumentSwitch\";\r\nimport QuantizeSwitch from \"./item/quantizeSwitch\";\r\n\r\n\r\nimport { GiViolin, GiGuitar, GiSaxophone, GiViola, GiTrumpet, GiClarinet, GiOcarina } from 'react-icons/gi'\r\n\r\n\r\nconst MelodyHeader = () => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    return (<>\r\n        <_QuantizeSelector>\r\n            <QuantizeSwitch labelName={'16'} isDisable={false} isActive={state.quantize === 4} callback={() => {\r\n                state.quantize = 4;\r\n                dispatcher.tune.setState(state);\r\n            }} />\r\n            <QuantizeSwitch labelName={'8'} isDisable={false} isActive={[2, 6].includes(state.quantize)} callback={() => {\r\n                state.quantize = 2;\r\n                dispatcher.tune.setState(state);\r\n            }} />\r\n            <QuantizeSwitch labelName={'4'} isDisable={false} isActive={[1, 3].includes(state.quantize)} callback={() => {\r\n                state.quantize = 1;\r\n                dispatcher.tune.setState(state);\r\n            }} />\r\n            <QuantizeSwitch labelName={'/3'} isDisable={state.quantize === 4} isActive={[3, 6].includes(state.quantize)} callback={() => {\r\n                if ([3, 6].includes(state.quantize)) {\r\n                    state.quantize /= 3;\r\n                } else {\r\n                    state.quantize *= 3;\r\n                }\r\n                dispatcher.tune.setState(state);\r\n            }} />\r\n        </_QuantizeSelector>\r\n        <_InstrumentSelector>\r\n            <InstrumentSwitch icon={<GiViolin />} labelName=\"violin\" soundfontInfo={{ name: 'violin', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiGuitar />} labelName=\"e-guitar\" soundfontInfo={{ name: 'distortion_guitar', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiSaxophone />} labelName=\"saxphone\" soundfontInfo={{ name: 'tenor_sax', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiViola />} labelName=\"viola\" soundfontInfo={{ name: 'viola', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiTrumpet />} labelName=\"trumpet\" soundfontInfo={{ name: 'trumpet', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"clarinet\" soundfontInfo={{ name: 'clarinet', gain: 3 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"oboe\" soundfontInfo={{ name: 'oboe', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiClarinet />} labelName=\"flute\" soundfontInfo={{ name: 'flute', gain: 5 }} />\r\n            <InstrumentSwitch icon={<GiOcarina />} labelName=\"ocarina\" soundfontInfo={{ name: 'ocarina', gain: 3 }} />\r\n        </_InstrumentSelector>\r\n    </>);\r\n}\r\n\r\nexport default MelodyHeader;\r\n\r\nconst _QuantizeSelector = styled.div<{\r\n}>`\r\n    display: block;\r\n    padding: 4px 4px 4px 0;\r\n    background-color: #bbbbbb;\r\n`;\r\n\r\nconst _InstrumentSelector = styled.div<{\r\n}>`\r\n    display: inline-block;\r\n    /* padding: 4px 4px 4px 0; */\r\n    background-color: #e4e4e486;\r\n`;\r\n\r\n","import { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { DetailChord, TuneNotes } from \"../../../../../redux/store/scoreData\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { getNormalizeLenFromNotes, getNotesLenFromQuantize, playSoundfont } from \"../../../../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../../utils/systemConst\";\r\n\r\nclass MelodyMouseOperation {\r\n\r\n    static mouseDownEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const refs = store.refs.melody;\r\n        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n            const state = store.melodyState;\r\n            const mouse = store.melodyState.mouseState;\r\n            const notesState = mouse.notesState;\r\n            const notesList = store.scoreData.notesList;\r\n            const rate = 1 / state.quantize;\r\n\r\n            const getNextLeft = () => {\r\n                const next = notesList.find(note => x < getNormalizeLenFromNotes(note.pos) * state.beatWidth);\r\n                let nextLeft = timelineLength;\r\n                if (next != undefined) {\r\n                    nextLeft = getNormalizeLenFromNotes(next.pos) * state.beatWidth;\r\n                }\r\n                return nextLeft;\r\n            }\r\n\r\n            const rect = refs.table.getBoundingClientRect();\r\n            const x = e.clientX + refs.table.scrollLeft - rect.left;\r\n            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n\r\n            // \r\n            if (notesState.index === -1) {\r\n\r\n                mouse.isPut = true;\r\n                mouse.lock = {\r\n                    x: Math.floor(x / state.beatWidth / rate) * state.beatWidth * rate,\r\n                    y: Math.floor(y / TUNE_PITCH_HEIGHT) * TUNE_PITCH_HEIGHT\r\n                };\r\n\r\n                mouse.nextLeft = getNextLeft();\r\n                mouse.width = 0;\r\n\r\n\r\n            } else {\r\n                if (notesState.side === 'normal') {\r\n\r\n                        const refs = store.refs.melody;\r\n                        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n                            const rect = refs.table.getBoundingClientRect();\r\n                            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n                            const pitchIndex = Math.floor(y / TUNE_PITCH_HEIGHT);\r\n                            notesList[notesState.index].pitchIndex = pitchIndex;\r\n                            store.scoreData.notesList = notesList.slice();\r\n\r\n                            playSoundfont(pitchIndex, store);\r\n                        }\r\n                } else {\r\n                    const notes = notesList[notesState.index];\r\n                    mouse.lock = {\r\n                        // x: (Math.floor(x / state.beatWidth / rate) * state.beatWidth * rate) - getNormalizeLenFromNotes(notes.len) * state.beatWidth,\r\n                        x: getNormalizeLenFromNotes(notes.pos) * state.beatWidth,\r\n                        y: 0\r\n                    };\r\n                    mouse.nextLeft = getNextLeft();\r\n\r\n                    if (notesState.side === 'left') {\r\n                        notesState.isMove = true;\r\n                        mouse.prevRight = 0;\r\n                        if (notesState.index > 0) {\r\n                            const prev = notesList[notesState.index - 1];\r\n                            mouse.prevRight = (getNormalizeLenFromNotes(prev.pos) + getNormalizeLenFromNotes(prev.len)) * state.beatWidth;\r\n                        }\r\n                    }\r\n                    else if (notesState.side === 'right') {\r\n                        notesState.isResize = true;\r\n                    }\r\n\r\n                    mouse.notesState = { ...notesState };\r\n                }\r\n            }\r\n\r\n            update();\r\n        }\r\n    }\r\n\r\n    static mouseMoveEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const refs = store.refs.melody;\r\n        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n            const state = store.melodyState;\r\n            const mouse = store.melodyState.mouseState;\r\n            // const update = () => dispatcher.tune.setState(state);\r\n            const notesState = mouse.notesState;\r\n            const notesList = store.scoreData.notesList;\r\n            const chordList = store.scoreData.chordList;\r\n            const rate = 1 / state.quantize;\r\n\r\n            const rect = refs.table.getBoundingClientRect();\r\n            const x = e.clientX + refs.table.scrollLeft - rect.left;\r\n            const y = e.clientY + refs.table.scrollTop - rect.top;\r\n\r\n            if (!mouse.isPut && !notesState.isResize && !notesState.isMove) {\r\n                mouse.mousePitchIndex = Math.floor(y / TUNE_PITCH_HEIGHT);\r\n                mouse.mouseMeasurePos = Math.floor(x / state.beatWidth / rate);\r\n\r\n                let left = 0;\r\n                const searchedChord = chordList.find((element) => {\r\n                    if (element.type === 'chord') {\r\n                        const detail = element.detail as DetailChord;\r\n                        const width = detail.beatLen * state.beatWidth;\r\n                        if (x >= left && x < left + width) {\r\n                            return element;\r\n                        }\r\n                        left += width;\r\n                    }\r\n                });\r\n                mouse.curChord = searchedChord == undefined ? null : searchedChord;\r\n\r\n                notesState.index = -1;\r\n                const prevFocus = state.focusIndex;\r\n                state.focusIndex = -1;\r\n                for (let i = 0; i < notesList.length; i++) {\r\n                    const notes = notesList[i];\r\n                    const left = getNormalizeLenFromNotes(notes.pos) * state.beatWidth;\r\n                    const right = left + getNormalizeLenFromNotes(notes.len) * state.beatWidth;\r\n                    if (x >= left && x <= right) {\r\n                        notesState.index = i;\r\n                        state.focusIndex = i;\r\n\r\n                        if (x < left + 10) notesState.side = 'left';\r\n                        else if (x > right - 10) notesState.side = 'right';\r\n                        else notesState.side = 'normal';\r\n                        break;\r\n                    }\r\n                };\r\n                if (prevFocus !== -1 && prevFocus !== state.focusIndex) {\r\n                    state.lastFocus = prevFocus;\r\n                    // dispatcher.tune.setState(state);\r\n                }\r\n                // dispatcher.tune.setState(state);\r\n                mouse.notesState = { ...notesState };\r\n            } else {\r\n                if (mouse.isPut) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 1) * state.beatWidth * rate;\r\n                    mouse.width = (curPos > mouse.nextLeft ? mouse.nextLeft : curPos) - mouse.lock.x;\r\n                } else if (notesState.isResize) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 1) * state.beatWidth * rate;\r\n                    const notes = notesList[notesState.index];\r\n                    // console.log(`${mouse.nextLeft}, ${curPos}`);\r\n                    let posX = curPos - mouse.lock.x;\r\n                    // \r\n                    if (curPos > mouse.nextLeft) {\r\n                        posX = mouse.nextLeft - mouse.lock.x;\r\n                    }\r\n                    // \r\n                    if (curPos <= mouse.lock.x) {\r\n                        posX = state.beatWidth / state.quantize;\r\n                    }\r\n                    notes.len = getNotesLenFromQuantize(state.quantize, Math.floor(posX / state.beatWidth * state.quantize));\r\n                    // dispatcher.tune.setNotesList(notesList.slice());\r\n                    store.scoreData.notesList = notesList.slice();\r\n                } else if (notesState.isMove) {\r\n                    const curPos = (Math.floor(x / state.beatWidth / rate) + 0) * state.beatWidth * rate;\r\n                    const notes = notesList[notesState.index];\r\n                    const lenWidth = getNormalizeLenFromNotes(notes.len) * state.beatWidth;\r\n                    // console.log(`${mouse.nextLeft}, ${curPos}`);\r\n                    let posX = curPos;\r\n                    // \r\n                    if (curPos + lenWidth > mouse.nextLeft) {\r\n                        posX = mouse.nextLeft - lenWidth;\r\n                    }\r\n                    // \r\n                    if (curPos < mouse.prevRight) {\r\n                        posX = mouse.prevRight;\r\n                    }\r\n                    notes.pos = getNotesLenFromQuantize(state.quantize, Math.floor(posX / state.beatWidth * state.quantize));\r\n                    // dispatcher.tune.setNotesList(notesList.slice());\r\n                    store.scoreData.notesList = notesList.slice();\r\n                }\r\n            }\r\n            update();\r\n        }\r\n    }\r\n\r\n    static mouseUpEvent = (e: React.MouseEvent<HTMLDivElement, MouseEvent>,\r\n        store: Store, dispatcher: Dispatcher, timelineLength: number, update: Function) => {\r\n\r\n        if (e.button !== 0) return;\r\n\r\n        const state = store.melodyState;\r\n        const mouse = store.melodyState.mouseState;\r\n        // const update = () => dispatcher.tune.setState(state);\r\n        const notesState = mouse.notesState;\r\n        const notesList = store.scoreData.notesList;\r\n        const quantize = state.quantize;\r\n\r\n        if (mouse.isPut) {\r\n            mouse.isPut = false;\r\n            if (mouse.width > 0) {\r\n                const pitchIndex = Math.floor(mouse.lock.y / TUNE_PITCH_HEIGHT);\r\n                // alert(mouse.width / state.beatWidth * quantize);\r\n                // const a = getNotesLenFromQuantize(quantize, Math.floor(mouse.lock.x / state.beatWidth * quantize));\r\n                // const b = getNotesLenFromQuantize(quantize, Math.floor(mouse.width / state.beatWidth * quantize));\r\n                // alert(`lockX: ${JSON.stringify(a)},/n width: ${JSON.stringify(b)}`);\r\n                notesList.push({\r\n                    pos: getNotesLenFromQuantize(quantize, Math.floor(mouse.lock.x / state.beatWidth * quantize)),\r\n                    pitchIndex,\r\n                    len: getNotesLenFromQuantize(quantize, Math.floor(mouse.width / state.beatWidth * quantize)),\r\n\r\n                });\r\n                // \r\n                notesList.sort((a, b) => {\r\n                    const posA = getNormalizeLenFromNotes(a.pos);\r\n                    const posB = getNormalizeLenFromNotes(b.pos);\r\n                    return posA === posB ? 0 : (\r\n                        posA < posB ? -1 : 1\r\n                    );\r\n                });\r\n                dispatcher.tune.setNotesList(notesList);\r\n\r\n                playSoundfont(pitchIndex, store);\r\n            }\r\n        } else {\r\n            notesState.isMove = false;\r\n            notesState.isResize = false;\r\n            mouse.notesState = { ...notesState };\r\n            dispatcher.tune.setNotesList(notesList.slice());\r\n        }\r\n        update();\r\n    }\r\n}\r\n\r\nexport default MelodyMouseOperation;","import { KeyboardEvent } from \"react\";\r\nimport { Dispatcher } from \"../../../../../redux/dispatcher/dispatcher\";\r\nimport { MelodyPitchMode } from \"../../../../../redux/store/melodyState\";\r\nimport { Store } from \"../../../../../redux/store/store\";\r\nimport { getNormalizeLenFromNotes } from \"../../../../../utils/melodyUtil\";\r\nimport { TUNE_PITCH_HEIGHT } from \"../../../../../utils/systemConst\";\r\n\r\n\r\nclass MelodyInput {\r\n\r\n    static keyDownEvent = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher) => {\r\n\r\n        const config = store.userEnv.keyConfig.note;\r\n        const keySwitch = store.melodyState.keySwitch;\r\n        // alert(e.key);\r\n        // alert(config.nextElement);\r\n\r\n        const state = store.melodyState;\r\n        const mouse = state.mouseState;\r\n\r\n        // \r\n        if (state.isPreview) {\r\n            switch (e.key) {\r\n                case ' ': {\r\n                    state.isPreview = false;\r\n                    state.focusIndex = state.lastFocus;\r\n                    store.reserveTasks.forEach(id => clearTimeout(id));\r\n                    dispatcher.system.setReserveTasks([]);\r\n                    dispatcher.tune.setState(state);\r\n                }\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // \r\n        if (mouse.notesState.index !== -1) {\r\n            mouse.notesState.index = -1;\r\n            mouse.notesState.isResize = false;\r\n            mouse.notesState.side = 'normal';\r\n        }\r\n\r\n        if (keySwitch.scaleMode || keySwitch.octave || keySwitch.resize || keySwitch.move) {\r\n            if (keySwitch.scaleMode || keySwitch.octave) {\r\n                const mode: MelodyPitchMode = keySwitch.scaleMode ? 'scale' : 'octave';\r\n                switch (e.key) {\r\n                    case 'ArrowUp': {\r\n                        dispatcher.tune.incrementCurNoteKey(true, mode);\r\n                    }\r\n                        break;\r\n                    case 'ArrowDown': {\r\n                        dispatcher.tune.incrementCurNoteKey(false, mode);\r\n                    }\r\n                        break;\r\n                }\r\n            } else if (keySwitch.resize) {\r\n                switch (e.key) {\r\n                    case 'ArrowLeft': dispatcher.tune.resizeNotes(false); break;\r\n                    case 'ArrowRight': dispatcher.tune.resizeNotes(true); break;\r\n                }\r\n            } else if (keySwitch.move) {\r\n                switch (e.key) {\r\n                    case 'ArrowLeft': dispatcher.tune.moveNotes(false); break;\r\n                    case 'ArrowRight': dispatcher.tune.moveNotes(true); break;\r\n                }\r\n            }\r\n        } else {\r\n            switch (e.key) {\r\n                case 'ArrowUp': dispatcher.tune.incrementCurNoteKey(true, 'normal'); break;\r\n                case 'ArrowDown': dispatcher.tune.incrementCurNoteKey(false, 'normal'); break;\r\n                case 'ArrowLeft': dispatcher.tune.moveFocus(false); break;\r\n                case 'ArrowRight': dispatcher.tune.moveFocus(true); break;\r\n                case 'a': dispatcher.tune.addNotes(); break;\r\n                case 'q': {\r\n                    alert(JSON.stringify(store.scoreData.notesList[state.focusIndex].len));\r\n                }\r\n                    break;\r\n                case 'w': dispatcher.tune.adjustScrollX(); break;\r\n                case 'e': dispatcher.tune.adjustScrollY(); break;\r\n            }\r\n        }\r\n\r\n        switch (e.key) {\r\n            case '1': {\r\n                state.quantize = 4;\r\n                dispatcher.tune.setState(state);\r\n            }\r\n                break;\r\n            case '2': {\r\n                state.quantize = 2;\r\n                dispatcher.tune.setState(state);\r\n            }\r\n                break;\r\n            case '3': {\r\n                state.quantize = 1;\r\n                dispatcher.tune.setState(state);\r\n            }\r\n                break;\r\n            case '/': {\r\n                if ([3, 6].includes(state.quantize)) {\r\n                    state.quantize /= 3;\r\n                } else {\r\n                    state.quantize *= 3;\r\n                }\r\n                dispatcher.tune.setState(state);\r\n            }\r\n                break;\r\n            case 'Delete': {\r\n                const notesList = store.scoreData.notesList;\r\n                notesList.splice(state.focusIndex, 1);\r\n                dispatcher.tune.setNotesList(notesList);\r\n                state.focusIndex--;\r\n                dispatcher.tune.setState(state);\r\n            }\r\n                break;\r\n            case ' ': {\r\n                dispatcher.tune.previewStart();\r\n            }\r\n                break;\r\n        }\r\n    }\r\n\r\n    static keySwitchEvent = (e: KeyboardEvent, store: Store, dispatcher: Dispatcher, isPress: boolean) => {\r\n\r\n        const config = store.userEnv.keyConfig.note;\r\n        const keySwitch = store.melodyState.keySwitch;\r\n        const state = store.melodyState;\r\n        // alert(e.key);\r\n        // alnfig.nextElement);\r\n\r\n        if (!state.isPreview) {\r\n            switch (e.key) {\r\n                case 'z': {\r\n                    keySwitch.octave = isPress;\r\n                    dispatcher.tune.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n                case 'c': {\r\n                    keySwitch.scaleMode = isPress;\r\n                    dispatcher.tune.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n                case 'f': {\r\n                    keySwitch.resize = isPress;\r\n                    dispatcher.tune.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n                case 'd': {\r\n                    keySwitch.move = isPress;\r\n                    dispatcher.tune.setKeySwitch(keySwitch);\r\n                }\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (isPress) {\r\n            MelodyInput.keyDownEvent(e, store, dispatcher);\r\n        }\r\n    }\r\n}\r\n\r\nexport default MelodyInput;","import { posix } from \"path\";\r\nimport { KeyboardEvent, useContext, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport styled, { css, keyframes } from \"styled-components\";\r\nimport Soundfont from 'soundfont-player';\r\nimport { ExecutableButton } from \"../../../../base/components/button/executableButton\";\r\nimport { ChordElement, DetailChord, DetailInit } from \"../../../../redux/store/scoreData\";\r\nimport { getChordRoot, getSymbolFromKey, IntervalRelationProps, KEY12_SHARP_LIST, SCALE_INDEX } from \"../../../../utils/theoryUtils\";\r\nimport { TUNE_HEADER_WIDTH, TUNE_PITCH_HEIGHT, TUNE_PITCH_WIDTH, TUNE_TIMELINE_WIDTH } from \"../../../../utils/systemConst\";\r\nimport { GlobalContext } from \"../../../entry/systemEntry\";\r\nimport MelodyTimeline from \"./melodyTimeline\";\r\nimport MelodyPitchList from \"./melodyPitchList\";\r\nimport MelodyHeader from \"./melodyHeader\";\r\nimport { getKeyIndexFromPitcher, getMinimumLenUnit, getNormalizeLenFromNotes, PITCH_MAX, playSoundfont } from \"../../../../utils/melodyUtil\";\r\nimport MelodyMouseOperation from \"./util/melodyMouseOperation\";\r\nimport { Side } from \"../../../../redux/store/melodyState\";\r\nimport MelodyInput from \"../harmonize/input/melodyInput\";\r\n\r\n\r\nconst MelodyFrame = (props: {\r\n    isActive: boolean;\r\n}) => {\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n    const state = store.melodyState;\r\n\r\n    const wrapRef = useRef<null | HTMLDivElement>(null);\r\n    const tableRef = useRef<null | HTMLDivElement>(null);\r\n    const pitchRef = useRef<null | HTMLDivElement>(null);\r\n\r\n    const [invalidate, setInvalidate] = useState<{}>({});\r\n\r\n    const update = () => setInvalidate({});\r\n\r\n    const mouse = state.mouseState;\r\n    const isPut = mouse.isPut;\r\n    const notesState = mouse.notesState;\r\n    const curChord = mouse.curChord;\r\n    const mouseMeasurePos = mouse.mouseMeasurePos;\r\n    const mousePitchIndex = mouse.mousePitchIndex;\r\n    const width = mouse.width;\r\n    const lock = mouse.lock;\r\n\r\n    const barCount = 20;\r\n\r\n    const timelineLength = barCount * state.beatWidth * 4;\r\n    const notesList = store.scoreData.notesList;\r\n\r\n    // const rate = 4 / state.quantize;\r\n\r\n    const isTune = store.scoreState.isTune;\r\n\r\n    const tableWidth = tableRef.current == null ? 0 : tableRef.current.scrollLeft + tableRef.current.clientWidth / 2\r\n\r\n    useEffect(() => {\r\n        dispatcher.system.setRefs({\r\n            ...store.refs, melody: {\r\n                ...store.refs.melody,\r\n                table: tableRef.current,\r\n                pitch: pitchRef.current\r\n            }\r\n        });\r\n\r\n        const info = state.soundfontInfo;\r\n        Soundfont.instrument(new AudioContext(), info.name,\r\n            { gain: info.gain, release: 0.5 }).then((soundFontPlayer) => {\r\n                dispatcher.tune.setInstrument(soundFontPlayer);\r\n            });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (isTune && wrapRef.current != null) {\r\n            wrapRef.current.focus();\r\n        }\r\n    }, [isTune]);\r\n\r\n    const measureJsxList: JSX.Element[] = useMemo(() => {\r\n        const jsxList: JSX.Element[] = [];\r\n        for (let i = 0; i <= barCount * 4 * 4; i++) {\r\n            jsxList.push(\r\n                <_Scale key={i} isHead={i % 4 === 0} beatWidth={state.beatWidth} />\r\n            );\r\n        }\r\n        return jsxList;\r\n    }, [barCount]);\r\n\r\n    const init = store.scoreData.chordList[0].detail as DetailInit;\r\n    const scaleLineJsxList = useMemo(() => {\r\n        const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n        const list: JSX.Element[] = [];\r\n        for (let i = 0; i < PITCH_MAX; i++) {\r\n            const keyIndex = getKeyIndexFromPitcher(i);\r\n            list.push(\r\n                <_ScaleLine key={i}\r\n                    isScale={scaleIndexies.includes(keyIndex)}\r\n                    isBase={keyIndex === scaleIndexies[0]}\r\n                />\r\n            );\r\n        }\r\n        return list;\r\n    }, [init.keyIndex]);\r\n\r\n    const notesJsxList = useMemo(() => {\r\n        const list: JSX.Element[] = [];\r\n        // notesList.forEach((notes, i) => {\r\n        for (let i = 0; i < notesList.length; i++) {\r\n            const notes = notesList[i];\r\n            const normalX = getNormalizeLenFromNotes(notes.pos);\r\n            if (tableRef.current != null) {\r\n                const scroll = tableRef.current.scrollLeft;\r\n                if (Math.abs(normalX * state.beatWidth - (scroll + tableWidth)) > tableWidth) {\r\n                    continue;\r\n                }\r\n            }\r\n            const isActive = state.focusIndex === i;\r\n            const scaleIndexies = SCALE_INDEX.map(value => (init.keyIndex + value) % 12);\r\n            const keyIndex = getKeyIndexFromPitcher(notes.pitchIndex);\r\n            const isScale = scaleIndexies.includes(keyIndex);\r\n            list.push(\r\n                <_NotesWrap key={i}\r\n                    left={getNormalizeLenFromNotes(notes.pos) * state.beatWidth}\r\n                    width={getNormalizeLenFromNotes(notes.len) * state.beatWidth}\r\n                    side={notesState.side}\r\n                    isActive={isActive}\r\n                    isScale={state.keySwitch.scaleMode}\r\n                    isResize={state.keySwitch.resize}\r\n                    isMove={state.keySwitch.move}\r\n                    isOctave={state.keySwitch.octave}\r\n                    isPreview={state.isPreview}\r\n                >\r\n                    <_Notes\r\n                        y={notes.pitchIndex * TUNE_PITCH_HEIGHT}\r\n                        lenType={getMinimumLenUnit(notes.len)}\r\n                        isScale={isScale}\r\n                    >\r\n                        {/* {notes.posX} */}\r\n                    </_Notes>\r\n                </_NotesWrap>\r\n            );\r\n        }\r\n        // });\r\n        return list;\r\n    }, [notesList, notesList.length, state.focusIndex, notesState, state.isPreview,\r\n        state.keySwitch.scaleMode, state.keySwitch.octave, state.keySwitch.resize, state.keySwitch.move,\r\n        invalidate]);\r\n\r\n    return (\r\n        <_Wrap\r\n            tabIndex={999}\r\n            ref={wrapRef}\r\n            isActive={props.isActive}\r\n            onKeyDown={(e: KeyboardEvent) => MelodyInput.keySwitchEvent(e, store, dispatcher, true)}\r\n            onKeyUp={(e: KeyboardEvent) => MelodyInput.keySwitchEvent(e, store, dispatcher, false)}\r\n        >\r\n            <_Header>\r\n                <MelodyHeader />\r\n            </_Header>\r\n            <_Body>\r\n                <_Timeline>\r\n                    <MelodyTimeline\r\n                        barLength={barCount}\r\n                        beatWidth={state.beatWidth}\r\n                        curChord={curChord}\r\n                        timelineLength={timelineLength}\r\n                        mouseMeasurePos={mouseMeasurePos}\r\n                    />\r\n                </_Timeline>\r\n                <_Pitch ref={pitchRef}>\r\n                    <MelodyPitchList mousePitchIndex={mousePitchIndex} curChord={curChord} />\r\n                </_Pitch>\r\n                <_TableWrap ref={tableRef}\r\n                    onScroll={() => {\r\n                        const refs = store.refs.melody;\r\n\r\n                        if (refs.table != null && refs.measure != null && refs.chord != null && refs.pitch != null) {\r\n                            const scrollLeft = refs.table.scrollLeft;\r\n                            const scrollTop = refs.table.scrollTop;\r\n                            refs.measure.scrollTo({ left: scrollLeft });\r\n                            refs.chord.scrollTo({ left: scrollLeft });\r\n                            refs.pitch.scrollTo({ top: scrollTop });\r\n                        }\r\n                        update();\r\n                    }}\r\n                >\r\n                    <_TableMeasure\r\n                        width={timelineLength}\r\n                    >\r\n                        {measureJsxList}\r\n                    </_TableMeasure>\r\n                    <_TablePitch\r\n                        width={timelineLength}\r\n                    >\r\n                        {scaleLineJsxList}\r\n                    </_TablePitch>\r\n                    <_TableNotes\r\n                        width={timelineLength}\r\n                        onMouseDown={(e) => MelodyMouseOperation.mouseDownEvent(e, store, dispatcher, timelineLength, update)}\r\n                        onMouseMove={(e) => MelodyMouseOperation.mouseMoveEvent(e, store, dispatcher, timelineLength, update)}\r\n                        onMouseUp={(e) => MelodyMouseOperation.mouseUpEvent(e, store, dispatcher, timelineLength, update)}\r\n                    >\r\n                        {!isPut ? <></> : <_Test x={lock.x} y={lock.y} width={width}\r\n                            lenType={width % state.beatWidth === 0 ? 4 : (width % (state.beatWidth / 2) === 0 ? 8 : 16)}\r\n                        />}\r\n                        {notesJsxList}\r\n                    </_TableNotes>\r\n                    <_PrevireBrind\r\n                        isUse={state.isPreview}\r\n                        width={timelineLength}\r\n                    />\r\n                </_TableWrap>\r\n            </_Body>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default MelodyFrame;\r\n\r\nconst _Wrap = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: ${props => !props.isActive ? 'none' : 'inline-block'};\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst editAnimation = keyframes`\r\n  0%,100% {\r\n    opacity: 0.2;\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n  }\r\n`;\r\n\r\nconst _Test = styled.div<{\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    lenType: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: ${props => props.x}px;\r\n    top: ${props => props.y}px;\r\n    width: ${props => props.width}px;\r\n    height: ${props => {\r\n        switch (props.lenType) {\r\n            case 4: return TUNE_PITCH_HEIGHT;\r\n            case 8: return TUNE_PITCH_HEIGHT - 6;\r\n            case 16: return TUNE_PITCH_HEIGHT - 12;\r\n            default: return TUNE_PITCH_HEIGHT - 14;\r\n        }\r\n    }}px;\r\n    background: linear-gradient(to bottom, #dff85230, #fffb00, #dff85230);\r\n    border: 1px solid #fbffd9;\r\n    \r\n    animation: ${editAnimation} .8s linear infinite;\r\n`;\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${TUNE_HEADER_WIDTH}px;\r\n    background-color: #b3b3b3;\r\n`;\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - ${TUNE_HEADER_WIDTH}px);\r\n    background-color: #464646;\r\n`;\r\n\r\nconst _Timeline = styled.div`\r\n    display: inline-block;\r\n    margin-left: ${TUNE_PITCH_WIDTH}px;\r\n    width: calc(100% - ${TUNE_PITCH_WIDTH}px - 10px);\r\n    height: ${TUNE_TIMELINE_WIDTH}px;\r\n    background-color: #534b81;\r\n    overflow-y: hidden;\r\n`;\r\n\r\nconst _Pitch = styled.div`\r\n    display: inline-block;\r\n    width: ${TUNE_PITCH_WIDTH}px;\r\n    height: calc(100% - ${TUNE_TIMELINE_WIDTH}px - 10px);\r\n    background-color: #534b81;\r\n    vertical-align: top;\r\n    overflow-y: hidden;\r\n`;\r\n\r\nconst _TableWrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - ${TUNE_PITCH_WIDTH}px);\r\n    height: calc(100% - ${TUNE_TIMELINE_WIDTH}px);\r\n    background-color: #bdbdbd;\r\n    vertical-align: top;\r\n    overflow: scroll;\r\n    &::-webkit-scrollbar {\r\n        width: 10px;\r\n        height: 10px;\r\n    }\r\n    &::-webkit-scrollbar-thumb {\r\n        border-radius: 5px;\r\n        background: #1959A8;\r\n    }\r\n    &::-webkit-scrollbar-track {\r\n        border-radius: 5px;\r\n        box-shadow: 0 0 4px #aaa inset;\r\n    }\r\n`;\r\n\r\nconst _TableMeasure = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 3;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    white-space: nowrap;\r\n`;\r\n\r\nconst _TablePitch = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    /* z-index: 6; */\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    /* pointer-events: none; */\r\n`;\r\n\r\n// \r\nconst _ScaleLine = styled.div<{\r\n    isScale: boolean;\r\n    isBase: boolean;\r\n}>`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: ${TUNE_PITCH_HEIGHT - 1}px;\r\n    margin: 1px 0 0 0;\r\n    background-color: #00000024;\r\n    /* border-bottom: 1px solid #00000018; */\r\n    ${props => !props.isScale ? '' : css`\r\n        background-color: #d1d1d11f;\r\n    `}\r\n    ${props => !props.isBase ? '' : css`\r\n        background-color: #e0e0e0;\r\n    `}\r\n`;\r\n\r\nconst _TableNotes = styled.div<{\r\n    width: number;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 5;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    cursor: crosshair;\r\n`;\r\n\r\n\r\nconst _Scale = styled.div<{\r\n    isHead: boolean;\r\n    beatWidth: number;\r\n}>`\r\n    display: inline-block;\r\n    /* background-color: #ffffffbe; */\r\n    width: ${props => props.beatWidth / 4}px;\r\n    vertical-align: top;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    box-sizing: border-box;\r\n    border-left: solid ${props => props.isHead ? '2px' : '1px'} #757575;\r\n`;\r\n\r\n\r\nconst _NotesWrap = styled.div<{\r\n    left: number;\r\n    width: number;\r\n    isActive: boolean;\r\n    isResize: boolean;\r\n    isMove: boolean;\r\n    isOctave: boolean;\r\n    isScale: boolean;\r\n    isPreview: boolean;\r\n    side: Side;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 9;\r\n    left: ${props => props.left}px;\r\n    top: 0;\r\n    width: ${props => props.width}px;\r\n    height: 100%;\r\n    cursor: default;\r\n    background-color: #0044ff1f;\r\n    box-sizing: border-box;\r\n\r\n    // \r\n    ${props => !props.isActive ? '' : css`\r\n        background-color: #39cfd452;\r\n    `}\r\n    // ON\r\n    ${props => !(props.isActive && props.isScale) ? '' : css`\r\n        background-color: #00cf4552;\r\n    `}\r\n    // ON\r\n    ${props => !(props.isActive && props.isOctave) ? '' : css`\r\n        background-color: #ffa9a952;\r\n    `}\r\n    /* border-left: 1px solid #ff0000b2; */\r\n    ${props => props.isActive ? props.side === 'left' ? css`\r\n        border-left: 3px solid #0026ffb1;\r\n        cursor : col-resize;\r\n        background-color: #1900ff52;\r\n    ` : props.side === 'right' ? css`\r\n        border-right: 3px solid #0026ffb1;\r\n        cursor : col-resize;\r\n        background-color: #ff00006e;\r\n    ` : '' : ''}\r\n\r\n    // ON\r\n    ${props => !(props.isActive && props.isResize) ? '' : css`\r\n        border-right: 3px solid #0026ffb1;\r\n        background-color: #ff00006e;\r\n    `};\r\n    // ON\r\n    ${props => !(props.isActive && props.isMove) ? '' : css`\r\n        border-left: 3px solid #0026ffb1;\r\n        background-color: #1900ff52;\r\n    `};\r\n    // \r\n    ${props => !(props.isActive && props.isPreview) ? '' : css`\r\n        background-color: #fffb006d;\r\n    `}\r\n`;\r\nconst _Notes = styled.div<{\r\n    y: number;\r\n    lenType: number;\r\n    isScale: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    z-index: 10;\r\n    top: ${props => props.y}px;\r\n    width: 100%;\r\n    height: ${props => TUNE_PITCH_HEIGHT - (props.lenType === 1 ? 0 : props.lenType === 2 ? 6 : props.lenType === 4 ? 12 : 14)}px;\r\n    /* background-color: red; */\r\n    /* background: linear-gradient(to bottom, ${props => {\r\n        switch (props.lenType) {\r\n            case 4: return '#f8525232, #ff0000, #f8525232';\r\n            case 8: return '#5d52f831, #0400ff, #5d52f831';\r\n            case 16: return '#52f85a31, #00ff15, #52f85a31';\r\n        }\r\n    }}); */\r\n    background: linear-gradient(to bottom, #f8525232, #ff0000, #f8525232);\r\n    ${props => props.isScale ? '' : css`    \r\n       background: linear-gradient(to bottom, #f8b65231, #ffae00, #f8b65231);\r\n    `}\r\n    /* border: 1px solid #000; */\r\n    box-sizing: border-box;\r\n    font-size: 12px;\r\n    color: #000000;\r\n    box-shadow: 0 0 22px 0 #0000007d;\r\n    &:hover {\r\n        opacity: 0.8;\r\n    }\r\n`;\r\n\r\nconst _PrevireBrind = styled.div<{\r\n    width: number;\r\n    isUse: boolean;\r\n}>`\r\n    position: absolute;\r\n    display: ${props => props.isUse ? 'block' : 'none'};\r\n    z-index: 80;\r\n    width: ${props => props.width}px;\r\n    height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n    background-color: #007a1428;\r\n`;\r\n\r\n// const _Scroll = styled.div<{\r\n//     left: number;\r\n// }>`\r\n//     position: absolute;\r\n//     left: ${props => props.left}px;\r\n//     top: 0px;\r\n//     z-index: 20;\r\n//     width: 4px;\r\n//     height: ${TUNE_PITCH_HEIGHT * 60}px;\r\n//     background-color: #00f;\r\n// `;","import { useContext, useMemo, useRef } from \"react\";\r\nimport styled, { css } from \"styled-components\";\r\nimport { ExecutableButton } from \"../../../base/components/button/executableButton\";\r\nimport { GlobalContext } from \"../../entry/systemEntry\";\r\nimport HarmonizeTab from \"./harmonize/harmonizeFrame\";\r\nimport { FiHelpCircle } from 'react-icons/fi'\r\nimport { AiOutlinePlaySquare } from 'react-icons/ai'\r\nimport { BsStopBtn } from 'react-icons/bs'\r\nimport { AiTwotoneSetting } from 'react-icons/ai'\r\nimport { HARMONIZE_SECTIONS_WIDTH } from \"../../../utils/systemConst\";\r\nimport HarmSections from \"./harmonize/harmSections\";\r\nimport MelodyFrame from \"./melody/melodyFrame\";\r\n\r\nconst EditTab = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const state = store.scoreState;\r\n\r\n    const switchMode = () => {\r\n        state.isTune = !state.isTune;\r\n        dispatcher.score.setScoreState(state);\r\n    };\r\n\r\n    if (store.scoreData.chordList.length === 0) {\r\n        return <></>;\r\n    }\r\n    return (\r\n        <_Wrap>\r\n            <_Header>\r\n                <_Mode>\r\n                    <_ModeItem isActive={!state.isTune} onClick={() => {\r\n                        if (state.isTune) switchMode();\r\n                    }}>Harmonize</_ModeItem>\r\n                    <_ModeItem isActive={state.isTune} onClick={() => {\r\n                        if (!state.isTune) switchMode();\r\n                    }}>Melody</_ModeItem>\r\n                </_Mode>\r\n                <_Buttons>\r\n                    <ExecutableButton labelText={<><FiHelpCircle /> Help</>} size={'midium'} width={100} />\r\n                    <ExecutableButton labelText={<><AiOutlinePlaySquare /> Play</>} size={'midium'} width={100} />\r\n                    <ExecutableButton labelText={<><BsStopBtn /> Stop</>} size={'midium'} width={100} />\r\n                    <ExecutableButton labelText={<><AiTwotoneSetting /> Setting</>} size={'midium'} width={110} />\r\n                </_Buttons>\r\n            </_Header>\r\n            <_Body\r\n                tabIndex={999}\r\n                onKeyDown={(e) => {\r\n                    switch (e.key) {\r\n                        case 'r': switchMode(); break;\r\n                    }\r\n                }}>\r\n                <_SECTIONS><HarmSections /></_SECTIONS>\r\n                <_Main>\r\n                    <HarmonizeTab isActive={!state.isTune} />\r\n                    <MelodyFrame isActive={state.isTune} />\r\n                </_Main>\r\n            </_Body>\r\n        </_Wrap>\r\n    );\r\n}\r\nexport default EditTab;\r\n\r\nconst _Wrap = styled.div`\r\n    width: 100%;\r\n    height: 100%;\r\n    outline: none;\r\n`;\r\n\r\nconst _Header = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: 35px;\r\n    background-color: #ececec;\r\n`;\r\n\r\nconst _Mode = styled.div`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    text-align: center;\r\n    margin-right: 20px;\r\n`;\r\nconst _ModeItem = styled.div<{\r\n    isActive: boolean;\r\n}>`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    width: 140px;\r\n    height: calc(100% - 8px);\r\n    /* background-color: #e0ff6f55; */\r\n    ${props => !props.isActive ? '' : css`background-color: #f3b200c0;`}\r\n    margin: 4px 0 0 4px;\r\n\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: #505050;\r\n    border-radius: 5px;\r\n    border: 1px solid #969696;\r\n    box-sizing: border-box;\r\n    &:hover {\r\n        background-color: #e0ff6f55;\r\n        ${props => !props.isActive ? '' : css`background-color: #f3b200c0;`}\r\n    }\r\n`;\r\nconst _Buttons = styled.div`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    /* background-color: #e0ff6f55; */\r\n\r\n    & * {\r\n        margin: 3px 0 0 5px;\r\n    }\r\n`;\r\n\r\nconst _Body = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - 35px);\r\n    background-color: #c50000;\r\n    outline: none;\r\n`;\r\n\r\nconst _SECTIONS = styled.div`\r\n    display: inline-block;\r\n    width: ${HARMONIZE_SECTIONS_WIDTH}px;\r\n    height: 100%;\r\n    background-color: #d8d8d8;\r\n    border-right: 1px solid #3e3f57;\r\n    box-sizing: border-box;\r\n    vertical-align: top;\r\n`;\r\nconst _Main = styled.div`\r\n    display: inline-block;\r\n    width: calc(100% - ${HARMONIZE_SECTIONS_WIDTH}px);\r\n    height: 100%;\r\n    background-color: #dddddd;\r\n    vertical-align: top;\r\n`;\r\n\r\n","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\nimport ManageTab from \"./manage/manageTab\";\r\nimport EditTab from \"./edit/editTab\";\r\n\r\nconst ScoreChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const isAccept = store.scoreState.focusIndex !== -1;\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <TabbedPane\r\n                tabElements={[\r\n                    { name: 'Manage', disable: false, cont: <ManageTab /> },\r\n                    { name: 'Edit', disable: !isAccept, cont: <EditTab /> },\r\n                    { name: 'Thema', disable: !isAccept, cont: <div></div> },\r\n                    { name: 'Preview', disable: !isAccept, cont: <div></div> },\r\n                ]}\r\n                activeNo={store.systemState.scoreTabIndex}\r\n                selectTabIndex={(index: number) => dispatcher.score.setScoreTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default ScoreChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${SCORE_TAB_MARGIN}px 0 0 ${SCORE_TAB_MARGIN}px;\r\n    width: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    height: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst SettingChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <TabbedPane\r\n                tabElements={[\r\n                    { name: 'Sound', disable: true, cont: <div></div> },\r\n                    { name: 'Design', disable: true, cont: <div></div> }\r\n                ]}\r\n                activeNo={store.systemState.scoreTabIndex}\r\n                selectTabIndex={(index: number) => dispatcher.score.setScoreTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default SettingChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${SCORE_TAB_MARGIN}px 0 0 ${SCORE_TAB_MARGIN}px;\r\n    width: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    height: calc(100% - ${SCORE_TAB_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { DEGREE12_FLAT_LIST, DEGREE12_SHARP_LIST, DegreeProps, getSymbolFromKey, IntervalRelationProps, KEY12_FLAT_LIST, KEY12_SHARP_LIST, SymbolKey } from \"../../utils/theoryUtils\";\r\nimport { SCORE_TAB_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"../entry/systemEntry\";\r\n\r\nconst PerformChannel = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const sampler = store.instruments.sampler;\r\n    const createLane = (label: string, items: {\r\n        degree: DegreeProps;\r\n        symbolKey: SymbolKey;\r\n    }[]): JSX.Element => {\r\n        const jsxList: JSX.Element[] = [];\r\n\r\n\r\n        // \r\n        jsxList.push(<_Header key={jsxList.length}><div>{label}</div></_Header>);\r\n        items.forEach((item) => {\r\n            const degree = item.degree;\r\n            const degreeRootName = (degree.isFlat ? DEGREE12_FLAT_LIST : DEGREE12_SHARP_LIST)[degree.index];\r\n            const chordRootName = (degree.isFlat ? KEY12_FLAT_LIST : KEY12_SHARP_LIST)[degree.index];\r\n            const symbol = getSymbolFromKey(item.symbolKey);\r\n            const symbolName = symbol.name;\r\n            jsxList.push(<_Item key={jsxList.length}\r\n                onMouseDown={(e) => {\r\n                    if (e.button !== 0) return;\r\n                    sampler.releaseAll();\r\n\r\n                    const symbol = getSymbolFromKey(item.symbolKey);\r\n\r\n                    const voicingList = symbol.structs.map((struct) => {\r\n                        const interval = IntervalRelationProps[struct];\r\n                        return 12 * 3 + item.degree.index + interval;\r\n                    });\r\n\r\n                    voicingList.forEach((index) => {\r\n                        const soundName = KEY12_SHARP_LIST[index % 12];\r\n                        const octave = Math.floor(index / 12);\r\n                        const soundFullName = soundName + octave;\r\n                        sampler.triggerAttack(soundFullName, '+0', 0.5);\r\n                    });\r\n                }}\r\n            >\r\n                <div>{degreeRootName}{symbolName}</div>\r\n                <div>{chordRootName}{symbolName}</div>\r\n            </_Item>);\r\n        });\r\n        return (<_Lane>{jsxList}</_Lane>);\r\n    }\r\n\r\n    return (\r\n        <_Wrap\r\n            onMouseDown={(e) => {\r\n                if (e.button !== 2) return;\r\n                sampler.releaseAll();\r\n            }}>\r\n            {createLane('Diatonic Triad', [\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 5, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'minor' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'minor-minus5' },\r\n            ])}\r\n            {createLane('Diatonic Tetrad', [\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major-maj7th' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 5, isFlat: false }, symbolKey: 'major-maj7th' },\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'minor-7th' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'minor7-minus5' },\r\n            ])}\r\n            {createLane('Parallel Triad', [\r\n                { degree: { index: 0, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 2, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 3, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 5, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 7, isFlat: true }, symbolKey: 'minor' },\r\n                { degree: { index: 8, isFlat: true }, symbolKey: 'major' },\r\n                { degree: { index: 10, isFlat: true }, symbolKey: 'major' },\r\n            ])}\r\n            {createLane('Secondary Dominant', [\r\n                { degree: { index: 7, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 9, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 11, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 0, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 2, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 4, isFlat: false }, symbolKey: 'major-min7th' },\r\n                { degree: { index: 10, isFlat: false }, symbolKey: 'major-min7th' },\r\n            ])}\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default PerformChannel;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: calc(100% - 8px);\r\n    height: calc(100% - 8px);\r\n    margin: 4px 0 0 4px;\r\n    background-color: #c3d8dd6f;\r\n    border: solid 1px #888;\r\n    border-radius: 5px;\r\n    box-sizing: border-box;\r\n`;\r\n\r\nconst _Lane = styled.div`\r\n    display: inline-block;\r\n    width: 160px;\r\n    background-color: #bbbbbb;\r\n    padding-bottom: 5px;\r\n`;\r\n\r\nconst _Box = styled.div`\r\n    display: inline-block;\r\n    width: 150px;\r\n    height: 80px;\r\n    margin: 5px 0 0 5px;\r\n    box-sizing: border-box;\r\n    border-radius: 4px;\r\n`;\r\n\r\nconst _Header = styled(_Box)`\r\n    background-color: #51608f;\r\n    /* border: 1px solid #dfdfdf; */\r\n    font-weight: 600;\r\n    & div:nth-child(1) {\r\n        width: 100%;\r\n        text-align: center;\r\n        height: 100%;\r\n        font-size: 26px;\r\n        color: #ebebeb;\r\n    }\r\n`;\r\n\r\nconst _Item = styled(_Box)`\r\n    background-color: #e0ebe5;\r\n    border: 1px solid #777;\r\n    & *{\r\n        width: 100%;\r\n        text-align: center;\r\n        height: 50%;\r\n    }\r\n    & div:nth-child(1) {\r\n        font-size: 26px;\r\n        color: #d40000;\r\n    }\r\n    & div:nth-child(2) {\r\n        font-size: 24px;\r\n        color: #000000;\r\n    }\r\n    &:hover {\r\n        background-color: #fcf29f;\r\n    }\r\n`;","import { useContext } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { ExecutableButton } from \"../../base/components/button/executableButton\";\r\nimport { ChannelPane } from \"../../base/components/tab/channelPane\";\r\nimport { TabbedPane } from \"../../base/components/tab/tabbedPane\";\r\nimport { MAIN_FRAME_MARGIN } from \"../../utils/systemConst\";\r\nimport { GlobalContext } from \"./systemEntry\";\r\nimport { AiFillHome } from 'react-icons/ai'\r\nimport { CgOptions, CgPiano } from 'react-icons/cg'\r\nimport { GiMusicalScore } from 'react-icons/gi'\r\nimport ScoreChannel from \"../score/scoreChannel\";\r\nimport SettingChannel from \"../setting/settingChannel\";\r\nimport PerformChannel from \"../perform/performChannel\";\r\n\r\nconst MainFrame = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    return (\r\n        <_Wrap>\r\n            {/* <DraggableDialog /> */}\r\n            {/* <ExecutableButton labelText={'test'} size={'midium'} /> */}\r\n            <ChannelPane\r\n                tabElements={[\r\n                    { name: 'Home', icon: <AiFillHome />, disable: true, cont: <div></div> },\r\n                    { name: 'Perform', icon: <CgPiano />, disable: true, cont: <PerformChannel/> },\r\n                    { name: 'Score', icon: <GiMusicalScore />, disable: true, cont: <ScoreChannel /> },\r\n                    { name: 'Option', icon: <CgOptions />, disable: true, cont: <SettingChannel /> }\r\n                ]}\r\n                activeNo={store.systemState.mainChannelIndex}\r\n                selectTabIndex={(index: number) => dispatcher.system.setMainTabIndex(index)}\r\n            />\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default MainFrame;\r\n\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin: ${MAIN_FRAME_MARGIN}px 0 0 ${MAIN_FRAME_MARGIN}px;\r\n    width: calc(100% - ${MAIN_FRAME_MARGIN * 2}px);\r\n    height: calc(100% - ${MAIN_FRAME_MARGIN * 2}px);\r\n    background-color: transparent;\r\n    /* background-color: #c3d8dd6f; */\r\n    /* border: solid 1px black;\r\n    border-radius: 5px; */\r\n    /* box-shadow: 0 2px 14px 4px #000b3a48; */\r\n`;","\r\nimport { useContext, useEffect, useState } from 'react';\r\nimport styled, { css, keyframes } from 'styled-components';\r\nimport { GlobalContext } from './systemEntry';\r\n\r\nconst Splash = () => {\r\n\r\n    const { store, dispatcher } = useContext(GlobalContext);\r\n\r\n    const [isSwitch, setSwitch] = useState<boolean>(false);\r\n    const [timerId, setTimerId] = useState<NodeJS.Timeout>();\r\n\r\n    useEffect(() => {\r\n        setTimerId(setTimeout(() => {\r\n            setSwitch(true);\r\n        }, 3000));\r\n    }, []);\r\n    useEffect(() => {\r\n        if (isSwitch) {\r\n            setTimeout(() => {\r\n                dispatcher.system.switchSplashToMain();\r\n            }, 500);\r\n        }\r\n    }, [isSwitch]);\r\n\r\n    return (\r\n        <_Wrap isSwitch={isSwitch} onClick={(e) => {\r\n            clearTimeout(timerId as NodeJS.Timeout);\r\n            setSwitch(true);\r\n        }}>\r\n            <_Title>\r\n                <span>L</span>iCreSia\r\n            </_Title>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default Splash;\r\n\r\nconst _Wrap = styled.div<{\r\n    isSwitch: boolean;\r\n}>`\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    z-index: 10;\r\n    /* width: 500px;\r\n    height: 500px; */\r\n    width: 100%;\r\n    height: 100%;\r\n    /* background-color: #d8d8d8; */\r\n    background: radial-gradient(#868686, #ffffff);\r\n    opacity: ${props => props.isSwitch ? '0' : '1'};\r\n    transition: opacity 500ms;\r\n`;\r\n\r\n\r\nconst fadeIn = keyframes`\r\n  0%, 100% {\r\n    opacity: 0.4;\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n  }\r\n`;\r\n\r\nconst _Title = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    margin-top: 15%;\r\n    width: 100%;\r\n    height: 400px;\r\n    background-color: #ffffff1f;\r\n    /* background: linear-gradient(to bottom, #99999913, #ffffff13,#ffffff13,#ffffff13, #99999913); */\r\n    color: white;\r\n    font-size: 130px;\r\n    font-weight: 600;\r\n    text-align: center;\r\n    text-shadow: 1px 2px 22px #0000003d;\r\n    line-height: 350px;\r\n    animation: ${fadeIn} 3s linear infinite;\r\n    & span {\r\n        color: red;\r\n        font-size: 160px;\r\n    }\r\n`;","import styled from \"styled-components\";\r\nimport { TOTAL_HEADER_WIDTH } from \"../../utils/systemConst\";\r\nimport { ImUser } from 'react-icons/im'\r\nimport { MdOutlineLanguage } from 'react-icons/md'\r\n\r\nconst TotalHeader = () => {\r\n\r\n    return (\r\n        <_Wrap>\r\n            <_Label>\r\n                <_ACCENT>L</_ACCENT><_NORMAL>iCreSia</_NORMAL>\r\n            </_Label>\r\n            <_Menu>\r\n                <_LoginButton>\r\n                    <div><ImUser /></div>\r\n                    Login / Sign up\r\n                </_LoginButton>\r\n                <_Language>\r\n                    <div><MdOutlineLanguage /></div>\r\n                </_Language>\r\n            </_Menu>\r\n        </_Wrap>\r\n    );\r\n}\r\n\r\nexport default TotalHeader;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: ${TOTAL_HEADER_WIDTH}px;\r\n    background: linear-gradient(to bottom, #ececec, #e2e2e2, #eeeeee);\r\n    /* background-color: #c2c2c2; */\r\n    box-shadow: 0 0 8px 0 #000b3a48;\r\n`;\r\n\r\nconst _Label = styled.div`\r\n    display: inline-block;\r\n    margin: 2px 0 0 10px;\r\n    width: 200px;\r\n    height: calc(100% - 4px);\r\n    /* background-color: #00000013; */\r\n    font-size: 34px;\r\n    font-weight: 600;\r\n    line-height: 36px;\r\n    text-shadow: 1px 2px 3px #8080806a;\r\n`;\r\n\r\nconst _NORMAL = styled.span`\r\n    color: #ffffff;\r\n`;\r\nconst _ACCENT = styled.span`\r\n    font-size: 34px;\r\n    color: #da4242;\r\n`;\r\n\r\n\r\n\r\nconst _Menu = styled.div`\r\n    display: inline-block;\r\n    /* width: 300px; */\r\n    height: 100%;\r\n    position: absolute;\r\n    right: 30px;\r\n    /* background-color: #ff00002b; */\r\n`\r\n\r\nconst _MenuItem = styled.div`\r\n    background-color: #c9c7c7;\r\n    &:hover {\r\n        background-color: #cf9bae;\r\n    }\r\n    transition: background-color 800ms;\r\n`\r\n\r\nconst _LoginButton = styled(_MenuItem)`\r\n    display: inline-block;\r\n    width: 240px;\r\n    margin: 5px 10px 0 0;\r\n    height: calc(100% - 10px);\r\n    border-radius: 20px;\r\n    /* background: linear-gradient(to bottom, #e9baba, #d39d9d, #e9baba); */\r\n    /* background-color: #adadad; */\r\n    /* border: 1px solid #7e7e7e; */\r\n    /* box-shadow: 0 0 8px 0 #000b3a48; */\r\n    /* text-shadow: 1px 2px 3px #808080ba; */\r\n    text-align: center;\r\n    font-size: 22px;\r\n    font-weight: 600;\r\n    line-height: 28px;\r\n    color: #ffffff;\r\n    vertical-align: top;\r\n\r\n    & div {\r\n        display: inline-block;\r\n        /* background-color: #0000007d; */\r\n        margin: 2px 5px 0 0;\r\n        vertical-align: top;\r\n    }\r\n`;\r\n\r\nconst _Language = styled(_MenuItem)`\r\n    display: inline-block;\r\n    width: ${TOTAL_HEADER_WIDTH - 6}px;\r\n    height: ${TOTAL_HEADER_WIDTH - 6}px;\r\n    margin: 3px 0 0 0;\r\n    border-radius: 50%;\r\n    /* background: linear-gradient(to bottom, #e9baba, #d39d9d, #e9baba); */\r\n    /* background-color: #48aa9d; */\r\n    /* border: 1px solid #7e7e7e; */\r\n    /* box-shadow: 0 0 8px 0 #000b3a48; */\r\n    /* text-shadow: 1px 2px 3px #808080ba; */\r\n    /* text-align: center; */\r\n    font-size: 28px;\r\n    font-weight: 600;\r\n    color: #ffffff;\r\n    & div {\r\n        display: inline-block;\r\n        margin: 2px 0 0 5px;\r\n        /* background-color: #0000007d; */\r\n        vertical-align: top;\r\n    }\r\n`;","import { createContext, useReducer } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { ExecutableButton } from '../../base/components/button/executableButton';\r\nimport { DraggableDialog } from '../../base/components/dialog/draggableDialog';\r\nimport { Dispatcher } from '../../redux/dispatcher/dispatcher';\r\nimport { reducer } from '../../redux/reducer';\r\nimport { initialStore, Store } from '../../redux/store/store';\r\nimport { MAIN_FRAME_MARGIN, TOTAL_HEADER_WIDTH } from '../../utils/systemConst';\r\nimport SysModalDialog from '../dialog/sysModalDialog';\r\nimport MainFrame from './mainFrame';\r\nimport Splash from './splash';\r\nimport TotalHeader from './totalHeader';\r\n\r\n\r\ntype GlobalContextType = {\r\n    store: Store;\r\n    dispatcher: Dispatcher;\r\n}\r\n\r\nexport const GlobalContext = createContext({} as GlobalContextType);\r\n\r\nconst SystemEntry = () => {\r\n\r\n    const [store, dispatch] = useReducer(reducer, initialStore);\r\n    const dispatcher = new Dispatcher(store, dispatch);\r\n    return (\r\n        <GlobalContext.Provider value={{ store, dispatcher }}>\r\n            <>\r\n                {!store.systemState.isSplash ? <></> : <Splash />}\r\n                <_Wrap>\r\n                    <SysModalDialog />\r\n                    <TotalHeader />\r\n                    <_MainDiv>\r\n                        <MainFrame />\r\n                    </_MainDiv>\r\n                </_Wrap>\r\n            </>\r\n        </GlobalContext.Provider>\r\n    );\r\n}\r\n\r\nexport default SystemEntry;\r\n\r\nconst _Wrap = styled.div`\r\n    display: inline-block;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #d8d8d8;\r\n`;\r\n\r\nconst _MainDiv = styled.div`\r\n    display: inline-block;\r\n    width: 100%;\r\n    height: calc(100% - ${TOTAL_HEADER_WIDTH}px);\r\n    /* background-color: #c2c2c2; */\r\n`;","import React, { useEffect } from 'react';\nimport logo from './logo.svg';\nimport SystemEntry from './system/contents/entry/systemEntry';\n\nfunction App() {\n  \n  useEffect(() => {\n    // \n    document.oncontextmenu = function () { return false; }\n\n    window.addEventListener(\"keydown\", function (e) {\n      // space and arrow keys\n      if ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {\n        e.preventDefault();\n      }\n    }, false);\n\n  }, []);\n  return (\n    <SystemEntry />\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}